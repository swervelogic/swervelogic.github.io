!function(){for(var e,t=function(){},a=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=a.length,o=window.console=window.console||{};n--;)e=a[n],o[e]||(o[e]=t)}();var app={};app.core={},app.plugin={},app.charts={},app.setup={},app.menu={},app.factory={},app.mods={},app.canvas={},app.popup={},app.managers={},app.modHelper={},app.share={},app.home={},app.dash={},app.editor={},app.common={},app.console={},app.charts.pie=function(){return{draw:function(e){var t=d3.layout.pie().sort(null),a=e.$el.width();if(a<1&&(e.$el.parents(".module-container").hasClass("col-sm-2")?a=170:e.$el.parents(".module-container").hasClass("col-sm-4")?a=170:e.$el.parents(".module-container").hasClass("col-sm-6")?a=270:e.$el.parents(".module-container").hasClass("col-sm-8")?a=370:e.$el.parents(".module-container").hasClass("col-sm-10")?a=390:e.$el.parents(".module-container").hasClass("col-sm-12")&&(a=390)),a>0){e.$el.empty();var n=d3.select(e.$el.get(0)).append("svg").attr("width",a).attr("height",a),o=n.append("g"),i=Math.ceil(a/2);o.attr("transform","translate("+i+","+i+")");var s=d3.svg.arc().innerRadius(.98*i).outerRadius(Math.floor(.8*i));o.text("");var r=o.selectAll("path").data(t(e.items));r.enter().append("path").attr("fill",function(t,a){return e.colorFunc(a)}).attr("d",s),r.exit().remove()}}}},app.common.main=function(e,t,a,n,o,i,s,r,l,c){var d=this;d.notification(e,t,a,n,i,s,o,r),d.menu(e,t,a,o,i,r,l,s,c),d.session(a,o),d.undrop(a),d.urlHash(o)},app.common.menu=function(e,t,a,n,o,i,s,r,l){function c(){l.getData(1,function(t,a,n,o){1==t.ST||2==t.ST||9==t.ST?(h.hide(),m.find(".plus-menu").removeClass("move-left")):e.Team&&0!=e.Team.Id?(h.hide(),m.find(".plus-menu").removeClass("move-left")):(h.show(),m.find(".plus-menu").addClass("move-left")),t.Count||t.Referrals.length?$(".user-menu-popup .billing").text("Billing"):$(".user-menu-popup .billing").text("Upgrade")},!0)}var d=$('<div id="logo-bar" class="header-edit container-fluid"></div>'),u=$('<div id="top-bar"></div>'),m=e.isHome?$("#tmp-dash-topbar"):$("#tmp-primary-bar"),p=m.find(e.isHome?".menu-tile .inside":".menu-tile"),f=$("#tmp-user-menu"),h=f.find(".upgrade-btn"),g=f.find(".gear-button"),v=(app.plugin.lockedTip(e,a),$('<div id="app-load-animation" style="top: 0; left: 0; position: fixed;height: 100%;width: 100%;"><div class="loading-animation"></div></div>').hide());v.find(".loading-animation").html(n.spinner),$("body").append(v),u.append(d).append($("#tmp-user-menu-popup").html());var b=function(e){return function(){return window.location=e,!1}};setTimeout(function(){if(e.UserTeams&&e.UserTeams.length>0){if(e.Team.Id){var t="";window.location.hostname;"live"==e.Environment?t="https://app.xtensio.com/#dashboard":"dev"==e.Environment?t="https://app.xtensio.tech/#dashboard":"local"==e.Environment&&(t="https://www.localhost.com:44301/#dashboard");var a='<li class="item team-item personal-dashboard"><a href="'+t+'">Personal Dashboard</a></li>';$(a).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .personal-dashboard.team-item").click(b(t))}for(var o=0;o<e.UserTeams.length;o++){if(e.Team.Id!=e.UserTeams[o].Id){var i=e.UserTeams[o].TeamUrl.indexOf("http")<0?"https://":"",a='<li class="item team-item teamind-'+o+'"><a  href="'+i+e.UserTeams[o].TeamUrl+'">'+e.UserTeams[o].Name+"</a></li>";$("#top-bar .nav-setmenu .team-item a[href*='"+e.UserTeams[o].TeamUrl+"']").length<1&&($(a).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item.teamind-"+o).click(b(i+e.UserTeams[o].TeamUrl)))}$("#top-bar .nav-setmenu .team-item").show()}if(e.Team&&e.Team.Id>0&&e.Team.Role<3){var s='<li class="item team-menu team-settings">Team Settings</li>';if($(s).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"),e.Team.ST&&14==e.Team.ST){var r='<li class="item team-menu team-edit">Manage Team Members</li>';$(r).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu")}$("#top-bar .nav-setmenu .team-menu").show()}if(e.Team.Role>0&&e.Team.Role<5){var l='<li class="item team-menu import-folios">Import Folios</li>';$(l).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"),$("#top-bar .nav-setmenu .team-menu").show()}}if(e.Team&&0==e.Team.Id&&$("#top-bar .nav-setmenu .li-sep.team-menu").remove(),e.Team&&0==e.Team.Id){for(var c=!1,o=0;o<e.UserTeams.length;o++)1==e.UserTeams[o].Role&&(c=!0);if(!c){var d='<li class="item team-menu create-team"><a href="/teams/create" target="_blank">Create Team</a></li>';$(d).insertBefore("#top-bar .nav-setmenu .li-sep.li-sep-one"),$("#top-bar .nav-setmenu .create-team").show()}}$("#top-bar .nav-setmenu .team-settings").click(function(){n.teamSettingPopup()}),$("#top-bar .nav-setmenu .invite-people").click(function(){n.teamManagePopup(!0)}),$("#top-bar .nav-setmenu .team-edit").click(function(){n.teamManagePopup()}),$("#top-bar .nav-setmenu .import-folios").click(function(){n.importFolioPopup()})},2e3),h.click(function(){return l.getData(1,function(t,a,o,i){1==t.ST||2==t.ST||9==t.ST||10==t.ST||11==t.ST||a||e.Team.Id>0?n.billing():n.payment()},!0),!1}),c();var y=function(){if(e.fullName)try{var t=e.fullName.toUpperCase().match(/\b\w/g);t=t.length>1?t.shift()+t.pop():t.shift(),g.find(".initials").text(t)}catch(a){g.find(".initials").text("")}};if(a.addListener("plusUnlocked",function(){c()}),a.addListener("plusCancelled",function(){c()}),e.plusInfo&&e.plusInfo.End>Date.now()&&a.raiseEvent("plusUnlocked"),a.addListener("nameChanged",y),y(),e.editMode){var C=$('<div id="folio-bar" class="header-edit container-fluid"></div>'),T=m.find(".folio-name").val(i.FolioName);u.append(C);var w,x,k=function(){clearTimeout(x);var e=Date.now();if(w=w||e,e-w>3e3){w=e;var a=$.trim(T.val());a?(t.renameFolio({name:a}),r.raiseEvent("FolioRename",a)):T.val(i.FolioName)}else x=setTimeout(k,1e3)};i.Role>1&&T.on("change keydown",k),r.addListener("FolioRename",function(e){i.FolioName=e,T.val(e)})}else m.find(".fa-angle-right").remove(),m.find(".folio-name").remove();if(d.append(m),$("body").prepend(u),p.append(f),s.popupMenu("#tmp-user-menu .gear-button","#top-bar .user-menu-popup"),n.getUserMenu(e,n,a,l),e.Team&&0!=e.Team.Id&&($("#tmp-dash-topbar .menu-tile .nav-main-menu a:eq(0)").text("Folios"),e.Team.LogoUrl?($("#logo-bar .app-title a").append('<img style="max-width: 80px; max-height: 40px; margin-top: -4px; max-height:calc(100% - 4px);" src="'+e.Team.LogoUrl+'">').css({textAlign:"center"}),$("#logo-bar .app-title a .icon-Logo").remove()):e.Team.Name&&"5"!=e.Team.Role&&($("#logo-bar .app-title a").append('<h4 style="color: #4c7ba0;font-weight: bold;">'+e.Team.Name+"</h4>"),$("#logo-bar .app-title a .icon-Logo").remove())),setTimeout(function(){$("#logo-bar .app-title").removeClass("hidden")},200),e.Team.Id>0&&1==e.Team.Role&&("nadeem@fakecrow.com"==e.userEmail||"ali@fakecrow.com"==e.userEmail)){var D='<li class="item team-item add-mem" style="text-decoration: underline;">Add Member</li>';$(D).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item.add-mem").click(function(){n.addTeamMember()})}},app.common.notification=function(e,t,a,n,o,i,s,r){function l(e){e.find(".block").each(function(){var e=$(this),t=e.data("tobj");t&&e.find(".date").text(t.format("MMMM DD"))})}function c(){Y&&clearTimeout(Y),Y=setTimeout(function(){var t;$("#top-bar .nav-setmenu .team-item").hide(),e.Team&&e.Team.Id>0&&("live"==e.Environment?verb="https://app.xtensio.com/#dashboard":"dev"==e.Environment?verb="https://app.xtensio.tech/#dashboard":"local"==e.Environment&&(verb="https://www.localhost.com:44301/#dashboard"),t='<li class="item team-item"><a href="'+verb+'">Personal Dashboard</a></li>',$("#top-bar .nav-setmenu .team-item a[href='"+verb+"']").length<1&&$(t).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item").show());for(var a=0;a<e.UserTeams.length;a++){if(e.Team.Id!=e.UserTeams[a].Id){var n=e.UserTeams[a].TeamUrl.indexOf("http")<0?"https://":"";t='<li class="item team-item"><a href="'+n+e.UserTeams[a].TeamUrl+'">'+e.UserTeams[a].Name+"</a></li>",$("#top-bar .nav-setmenu .team-item a[href*='"+e.UserTeams[a].TeamUrl+"']").length<1&&$(t).insertBefore("#top-bar .nav-setmenu .li-sep.team-item")}$("#top-bar .nav-setmenu .team-item").show()}},1e3)}function d(t){for(var a=!1,n=0;n<e.UserTeams.length;n++)t.Data.TeamID==e.UserTeams[n].Id&&(a=!0);if(!a){var o={Id:t.Data.TeamID,Name:t.Data.TeamName,LogoUrl:null,TeamUrl:t.Data.TeamURL,Status:0,Role:t.Data.Role};e.UserTeams.push(o)}c()}function u(t,a){for(var n=0;n<e.UserTeams.length;n++)if(e.UserTeams[n].Id==t){e.UserTeams.splice(n,1);break}$("#top-bar .nav-setmenu .team-item a[href*='"+a+"']").parent().remove(),c()}function m(e,a){t.loadNotifications({data:{userEmail:e,nextCount:a},success:function(){},error:function(e){}})}function p(e){return function(){s.signupPerformance(e.Data.ModId)}}function f(e){i.send(Z.bRead,{Arr:e})}function h(a,n,o,i){var r;r={verb:a,secret:n,teamId:o},t.processTransfer({data:r,success:function(){i.parent().find(".yes, .no").remove(),e.isHome&&(window.location="/")},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}})}function g(t){return function(){var a=$(this),n=a.hasClass("yes")?"accept":"reject";return 1==t.Data.AllowOutside?e.UserTeams&&e.UserTeams.length>0&&t.Data.UserDefinedTeam<0?s.transferFolioToSpace(t):e.UserTeams&&e.UserTeams.length>0&&t.Data.UserDefinedTeam>-1?e.Team&&e.Team.Id==t.Data.UserDefinedTeam&&s.transferFolioToSpace(t):t.Process&&e.isHome&&h(n,t.Key,0,a):h(n,t.Key,t.Data.TeamID,a),!1}}function v(e){t.processSFG({data:{id:e.Id},success:function(t){window.location="https://"+e.teamURL},error:function(e){1002!=e.StatusCode&&2!=e.StatusCode&&s.error(e.Message,"Error Accepting Folio")}})}function b(a){return function(){var n=$(this),o=n.hasClass("yes")?"accept":"reject";return t.processCollaborator({data:{verb:o,id:a.Data.Id},success:function(){n.parent().find(".yes, .no").remove(),e.isHome&&(a.Data.TeamID!=e.Team.Id?a.Data.TeamID>0?window.location="https://"+a.Data.TeamURL+"/edit/"+a.Data.Token:window.location=O()+"/edit/"+a.Data.Token:window.location="/")},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}}),!1}}function y(t){e.isHome&&J.find(".folio-item-shell[data-token='"+t+"']").remove()}function C(t){e.isHome&&(J.find(".folio-item-shell[data-token='"+t.Data.Token+"']").remove(),x())}function T(e,t){return function(){var a=t?"edit":"folio";e.Data.TeamID>0?window.open("https://"+e.Data.TeamURL+"/"+a+"/"+e.Data.Token):window.open(O()+"/"+a+"/"+e.Data.Token)}}function w(e){return function(){var t=e.indexOf("http")<0?"https://":"";window.location=t+e}}function x(){window.location="/"}function k(){s.billing(1)}function D(e,t,a,n){s.message({heading:e||"Folio Deleted",message:t||"This folio has been deleted by its owner. You can no longer view or edit it.",btnText:a||"Go To Dashboard",noClose:!0,enterAsOK:!0,handleOK:n||x})}function S(){s.billing()}function I(e){return Faltu(G).filter(function(t){return t.Data.Token&&t.Data.Token==e.Data.Token&&t.Kind==e.Kind&&t.Time>=e.Time&&t.Id!=e.Id}).get()}function M(e,t,n){e&&(clearTimeout(_[t.Kind]),_[t.Kind]=setTimeout(function(){var o=I(t);o.length>0||$.each(e.Collaborators,function(o,i){(t.User||t.Data.Email)==i.Email&&(e.Collaborators[o].Accepted=!n,e.Collaborators[o].Privilege=t.Data.Privilege||t.Data.Role||0,a.raiseEvent("collabChange",e))})},1e3))}function P(t){return r&&r.Token==t||!e.isHome?r:Faltu(e.folios).find({Token:t}).get()[0]}function E(e){M(P(e.Data.Token),e)}function A(e,t){return Date.now()-e.Time<=(t||1e4)}function F(e){return window.location.href.indexOf(e.Data.Token)>1}function N(t){G.push(t);var n,o=e.nType;if(t.Data.Folio=t.Data.Folio||"Untitled",t.Kind==o.collaboratorRequest)return n=$(xe),n.find(".name").text(t.Data.Name),n.find(".role").text(1===parseInt(t.Privilege)?"view":"edit"),n.find(".folio").text(t.Data.Folio),t.Process&&K.indexOf(t.Data.Id)<0?(K.push(t.Data.Id),t.Data.TeamID==e.Team.Id&&a.raiseEvent("collabRequestArrived",t),n.on("click",".yes, .no",b(t))):n.find(".yes, .no").remove(),n;if(t.Kind==o.collaboratorReceive||t.Kind==o.collaboratorChange){n=$(Se);var i=1===parseInt(t.Data.Role||t.Data.Privilege);if(t.Kind==o.collaboratorChange&&t.New&&E(t),t.New&&A(t,1e3)&&F(t)){var s=i?"changed your access to be view-only.":"granted you edit access.";D("Access Changed","Owner of this folio has "+s,"Reload Folio",function(){f([t.Id]),location.reload()})}return n.find(".role").text(i?"view-only access to":"access to edit"),n.find(".folio").text(t.Data.Folio),n.click(T(t,!0)),n}return t.Kind==o.collaboratorAccept?(n=$(ke),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),t.New&&E(t),n.click(T(t,!0)),n):t.Kind==o.collaboratorDecline?(n=$(Ie),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),n):t.Kind==o.collaboratorReject?(n=$($e),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),r=P(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!0),n.click(T(t,!0)),n):t.Kind==o.collaboratorRemoveHimself?(n=$(De),t.Data.Email==e.userName?n.html('You have left "<span class="bold folio">'+t.Data.Folio+'</span>".'):(n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),n.click(T(t,!0))),r=P(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!0),n):t.Kind==o.collaboratorRemove?(n=$(Me),n.find(".folio").text(t.Data.Folio),t.New&&q&&(y(t.Data.Token),F(t)&&D("Access Changed","You no longer have access to this folio.",null,function(){f([t.Id]),x()})),n):t.Kind==o.collaboratorRemoveToAllCollaborators?(n=$(De),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),r=P(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!0),n.click(T(t,!0)),n):t.Kind==o.collaboratorAddedToAllCollaborators?(n=$(ke),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),r=P(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!1),n.click(T(t,!0)),n):t.Kind==o.sendCollaboratorFolioArchived?(n=$(Pe),n.find(".folio").text(t.Data.Folio),q&&t.New&&(F(t)&&D(),C(t)),n):t.Kind==o.folioReverted?(n=$(Ee),t.Data.Email==e.userName?n.html('You have reverted to a different version of "<span class="bold folio">'+t.Data.Folio+'</span>".'):(n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),clearTimeout(_[t.Kind]),_[t.Kind]=setTimeout(function(){var e=I(t);F(t)&&t.New&&e.length<1&&t.Data.CurrentVersion&&r.CurrentVersion!==t.Data.CurrentVersion&&D("Folio Reverted",t.Data.Name+' has reverted to a different version of "'+t.Data.Folio+'".',"Refresh Page",function(){f([t.Id]),location.reload()})},1e3)),n.click(T(t,!0)),n):void 0}function O(){return"live"==e.Environment?"https://app.xtensio.com":"dev"==e.Environment?"https://app.xtensio.tech":"local"==e.Environment?"https://www.localhost.com:44301/":void 0}function U(t){if(e.Team.Id==t.Data.TeamID&&t.New)if(e.userEmail==t.Data.Email)app.popup.message({heading:"Access Revoked",message:"You have been removed from this team<br>If you think this was a mistake please contact the team owner.",btnText:"Go to your Personal Dashboard",noClose:!0,handleOK:function(){window.location=O()}});else if(e.editMode)for(var n=0;n<r.Collaborators.length;n++)r.Collaborators[n].Email==t.Data.Email&&(r.Collaborators[n].Accepted=!1,r.Collaborators[n].Privilege=0,a.raiseEvent("collabChange",r));else e.folios&&$.each(e.folios,function(e,n){for(var e=0;e<n.Collaborators.length;e++)n.Collaborators[e].Email==t.Data.Email&&(n.Collaborators[e].Accepted=!1,n.Collaborators[e].Privilege=0,a.raiseEvent("collabChange",n))})}function R(t){for(var a=0;a<e.TeamRoles.length;a++)if(e.TeamRoles[a].Id==t)return e.TeamRoles[a].Name}function B(e){return function(){s.importFolioPopup(),f([e])}}function L(e){return function(){s.close(),f([e])}}function H(t){var n=$("#all-labels-container .item").length;if(t.Data.Folios.length>0&&e.Team&&e.Team.Id==t.Data.TeamID&&e.isHome){for(var o=[],i=0,s=[],r={Name:t.Data.LabelName,Token:t.Data.LabelToken,FolioTokens:o,Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:e.colors[n%e.colors.length]},l=0;l<t.Data.Folios.length;l++){for(var c=!1,d=0;d<e.folios.length;d++)e.folios[d].Token==t.Data.Folios[l].Token&&(c=!0);c||(i++,o.push(t.Data.Folios.Token),t.Data.Folios[l].Role=3,t.Data.Folios[l].Labels.push(r.Token),s.push(l))}if(i>0){e.labels.push(r),a.raiseEvent("addlabel",n);for(var l=0;l<s.length;l++)a.raiseEvent("foliosRecieved",t.Data.Folios[s[l]],!0)}}}var j,q,Y,_=[],K=[],V=[],G=[],z=$("#notify-btn"),X=$("#n-panel"),W=$("#load-more"),J=$("#folio-items-container"),Q=X.find(".contents"),Z=e.msgType,ee=e.nType,te=($("#trans-folio-tile").html(),$("#plus-news").html()),ae=$("#data-news").html(),ne=$("#transfer-news").html(),oe=$("#accept-news").html(),ie=$("#reject-news").html(),se=$("#receive-news").html(),re=$("#decline-news").html(),le=$("#plus-added-news").html(),ce=$("#plus-started-news").html(),de=$("#billing-saved-news").html(),ue=$("#card-updated-news").html(),me=$("#plus-cancel-news").html(),pe=$("#plus-expire-news").html(),fe=$("#added-to-team").html(),he=$("#team-owner-changed").html(),ge=$("#removed-from-team").html(),ve=$("#added-to-team-for-owner").html(),be=$("#removed-from-team-for-owner").html(),ye=$("#team-access-changed").html(),Ce=($("#section-copy-moved").html(),$("#team-role-changed").html()),Te=$("#team-created").html(),we=[],xe=$("#collaboration-news").html(),ke=$("#collaboration-accept-news").html(),$e=$("#collaboration-reject-news").html(),De=$("#collaboration-left-news").html(),Se=$("#collaboration-receive-news").html(),Ie=$("#collaboration-decline-news").html(),Me=$("#collaboration-removed-news").html(),Pe=$("#collaboration-archived-news").html(),Ee=$("#collaboration-reverted-news").html(),Ae=[11,12,14,15,16,24,25,27,28,29,30,31,32,36,37],Fe=function(e){for(var t=0;t<we.length;t++)we[t].Data.Token==e&&1==we[t].New&&Ae.indexOf(we[t].type)&&(n.removeFromList(V,we[t].Id),we[t].New=!1)};a.addListener("hubMsg",function(t,o){var i,r,c,m,h,b,C,D,I=moment();if(t==Z.bRead)for(i=0;i<o.Arr.length;i++)n.removeFromList(V,o.Arr[i]);else if(t==Z.bell||t==Z.loadMore){if(o.length>0)for(Q.find(".empty").remove(),n.sort(o,"Time"),t==Z.bell&&z.addClass("active"),i=0;i<o.length;i++)if(c=o[i],D=null,Ae.indexOf(c.Kind)>-1&&Fe(o[i].Data.Token),console.log(c),we.push(o[i]),c.Kind!=ee.transferFolioRequest||c.Process){switch(c.Data.Data&&(c.Data.Data=JSON.parse(c.Data.Data)),c.New&&c.Kind!=ee.teamFirstTimeSignin&&V.push(c.Id),c.End>e.plusExpireTime&&(e.plusExpireTime=c.End),b=moment(c.Time),m=I.diff(b,"day")<1,C=Q.find('[data-time="'+b.format("YYYY-MM-DD")+'"]'),m?(h="Today",r=I.diff(b,"minute"),r<60?r+=" minute"+(1==b?"":"s"):(r=I.diff(b,"hour"),r+=" hour"+(1==r?"":"s")),r+=" ago",l(Q)):(h=b.format("MMMM DD"),r=b.format("hh:mm A")),C.length<1&&(C=$('<div class="block" data-time="'+b.format("YYYY-MM-DD")+'"><div class="date">'+h+"</div></div>"),C.data("tobj",b),t==Z.bell?Q.prepend(C):Q.append(C)),c.Kind){case ee.referralSignup:D=$(te),D.find(".name").text(c.Data.Name),D.click(s.plusInfo);break;case ee.transferFolioRequest:case ee.transferFolioAccept:case ee.transferFolioReject:case ee.folioReceive:case ee.folioDecline:c.Kind==ee.transferFolioRequest?(D=$(ne),D.find(".yes, .no").click(g(c)),1==c.Data.AllowOutside?e.UserTeams&&e.UserTeams.length>0&&c.Data.UserDefinedTeam<0&&!e.editMode?s.transferFolioToSpace(c):e.UserTeams&&e.UserTeams.length>0&&c.Data.UserDefinedTeam>-1&&!e.editMode?e.Team&&e.Team.Id==c.Data.UserDefinedTeam&&s.transferFolioToSpace(c):c.Process&&e.isHome&&a.raiseEvent("transferRequestArrived",c.Data):c.Data.TeamID==e.Team.Id&&a.raiseEvent("transferRequestArrived",c.Data)):c.Kind==ee.transferFolioAccept?(D=$(oe),q&&c.Owner!=e.userName&&(y(c.Data.Token),window.location.href.indexOf(c.Data.Token)>0&&s.message({heading:"Folio Transferred",message:"This folio has been transferred. You no longer have access to edit.",btnText:"Return to Dashboard",noClose:1,handleOK:x}))):D=c.Kind==ee.transferFolioReject?$(ie):c.Kind==ee.folioReceive?$(se):$(re),D.find(".name").text(c.Data.Name),D.find(".folio").text(c.Data.Folio||"Untitled"),c.Data.Token?D.click(T(c,c.Kind==ee.folioReceive)):D.addClass("simple");break;case ee.plusExpiring1Week:break;case ee.plusExpiringToday:break;case ee.subscribed:D=$("<div class='item'>You've successfully upgraded to Xtensio Plus.</div>"),D.click(S);break;case ee.plusStarted:D=$(ce),D.click(S);break;case ee.billingSaved:D=$(de),D.click(k);break;case ee.cardUpdate:D=$(ue),D.click(k);break;case ee.planChange:"DiscountYearly"==c.Data.Plan&&(c.Data.Plan="DiscountYear"),"Month"==c.Data.Plan&&(c.Data.Plan="ProMonth"),"Year"==c.Data.Plan&&(c.Data.Plan="ProYear"),D=$('<div class="item">You are now on a '+c.Data.Plan+"ly plan.</div>"),D.click(S);break;case ee.planCancel:D=$(me),D.click(S);break;case ee.plusExpire:D=$(pe),10==c.Data.PlanName||11==c.Data.PlanName?D.find("pname").text("Plus"):D.find("pname").text("Pro"),D.click(S);break;case ee.plusTimeAdded:D=$(le),D.find(".via").text(c.Data.Via),D.click(s.plusInfo);break;case ee.dataCollectionSignup:D=$(ae),c.Folio=(c.Folio||"Untitled")+".",c.Folio.length>40&&(c.Folio=c.Folio.substr(c.Folio,37)+" ..."),c.Data.Count&&c.Data.Count>1&&D.find(".count").text(c.Data.Count+" form responses"),D.find(".folio").text(c.Folio),D.click(p(c)),q&&a.raiseEvent("newSignUp",c);break;case ee.collaboratorAccept:case ee.collaboratorDecline:case ee.collaboratorReceive:c.Kind==ee.collaboratorReceive&&0!=c.Data.TeamID&&X.find(".item.sfg-accept").each(function(){$this=$(this);$this.data("team");o.teamId==c.Data.TeamID&&$this.find(".yes, .no, br").remove()});case ee.collaboratorReject:D=N(c);break;case ee.collaboratorRequest:D=N(c),D.attr("data-token",c.Data.Token);break;case ee.collaboratorChange:case ee.collaboratorRemove:D=N(c);break;case ee.folioReverted:case ee.collaboratorRemoveHimself:case ee.sendCollaboratorFolioArchived:case ee.collaboratorRemoveToAllCollaborators:D=N(c);break;case ee.collaboratorAddedToAllCollaborators:D=N(c);break;case ee.folioUpgraded:D=N(c);break;case ee.teamMemberAdded:D=1==c.Data.Role?$(he):$(fe),1==c.Data.Role?D.find(".user").text("You").removeClass("bold"):e.userEmail==c.Data.Email?D.find(".user").text("You have").removeClass("bold"):e.userEmail!=c.Data.Email&&D.find(".user").text((c.Data.Name||c.Data.Email)+" has"),D.find(".role").text(R(c.Data.Role)),D.find(".team").text(c.Data.TeamName),D.find("a").attr("href","https://"+c.Data.TeamURL),D.attr("data-teamaddid",c.Data.TeamID),5==c.Data.Role&&(D.addClass("sfg-accept"),D.find("a").text("Accept"),D.find("a").data("team",{teamURL:c.Data.TeamURL,Id:c.Data.Id,teamId:c.Data.TeamID,notifId:c.Id}),c.New?D.find("a").on("click",function(e){e.preventDefault();var t=$(this).data("team");return f([t.notifId]),v(t),$(this).parent().find(".yes, .no, br").remove(),!1}):(D.find(".yes, .no, br").remove(),D.click(w(c.Data.TeamURL))),e.Team&&e.Team.Id==c.Data.TeamID&&c.New&&(f([c.Id]),v({teamURL:c.Data.TeamURL,Id:c.Data.Id,teamId:c.Data.TeamID}),D.find(".yes, .no, br").remove(),D.click(w(c.Data.TeamURL)))),e.Team.Id!=c.Data.TeamID&&q&&d(c);break;case ee.teamMemberAddedToTO:D=$(fe),1==c.Data.Role?D.find(".user").text("You").removeClass("bold"):e.userEmail==c.Data.Email?D.find(".user").text("You have").removeClass("bold"):e.userEmail!=c.Data.Email&&D.find(".user").text((c.Data.Name||c.Data.Email)+" has"),D.find(".role").text(R(c.Data.Role)),D.find(".team").text(c.Data.TeamName),D.find("a").attr("href","https://"+c.Data.TeamURL),D.attr("data-teamaddid",c.Data.TeamID);break;case ee.teamMemberRemoved:D=$(ge),D.find(".team").text(c.Data.TeamName),1==c.Data.Role?D.find(".user").text("You").removeClass("bold"):e.userEmail==c.Data.Email?D.find(".user").text("You have").removeClass("bold"):e.userEmail!=c.Data.Email&&D.find(".user").text((c.Data.Name||c.Data.Email)+" has"),e.userEmail==c.Data.Email&&q&&(C.find('.item[data-teamaddid="'+c.Data.TeamID+'"]').find(".links").remove(),u(c.Data.TeamID,c.Data.TeamURL)),q&&U(c);break;case ee.teamMemberRemovedToTO:e.userEmail==c.Data.Email&&c.New&&(C.find('.item[data-teamaddid="'+c.Data.TeamID+'"]').find(".links").remove(),u(c.Data.TeamID,c.Data.TeamURL)),D=$(ge),D.find(".team").text(c.Data.TeamName),1==c.Data.Role?D.find(".user").text("You").removeClass("bold"):e.userEmail==c.Data.Email?D.find(".user").text("You have").removeClass("bold"):e.userEmail!=c.Data.Email&&D.find(".user").text((c.Data.Name||c.Data.Email)+" has"),c.New&&(f([c.Id]),U(c));break;case ee.folioRecievedToTO:H(c);break;case ee.teamMemberAddedToTO:D=$(ve),D.find(".team").text(c.Data.TeamName),D.find(".user").text(c.Data.Name);break;case ee.teamMemberRemovedToTO:D=$(be),D.find(".team").text(c.Data.TeamName),D.find(".user").text(c.Data.Name);break;case ee.teamMemberAccessChanged:D=$(ye),D.find(".team").text(c.Data.TeamName),D.find(".role").text(R(c.Data.Role));break;case ee.copyMoveSectionToFolio:e.editMode&&e.token==c.Data.Token&&app.popup.message({heading:"Section Added",message:"A section from another folio has been copied or moved to this folio. Please reload to get the latest changes.",btnText:"Reload",noClose:!0,handleOK:function(){permDisc=!0,window.location.reload()}}),c.New&&f([c.Id]);break;case ee.teamFirstTimeSignin:e.Team&&0!=e.Team.Id&&c.New&&e.Team.Id==c.Data.TeamID&&(5!=e.Team.Role&&4!=e.Team.Role?c.Data.NewUser||s.message({heading:"Welcome to "+e.Team.Name+"!<br><h3>Let's finalize your setup.</h3>",message:'<div style="margin: 0 -20px; text-align: center;"><h3 style="margin-bottom: 10px;">Would you like to import any folios from your personal dashboard?</h3><span style="font-family: Proxima-Bold;">Tip:</span> This option is also available under your profile menu.</div>',btnText:"Import Folios",cancelText:"Skip",noClose:!0,notMini:!0,isSwitchCta:!0,okClass:"ok-blue",handleOK:B(c.Id),handleNo:L(c.Id)}):f([c.Id]));break;case ee.teamMemberAccessChanged:case ee.teamMemberAccessChangedToTO:D=$(Ce),e.userEmail==c.Data.Email?D.find(".user").text("Your").removeClass("bold"):D.find(".user").text((c.Data.Name||c.Data.Email)+"'s"),D.find(".role").text(R(c.Data.Role)),D.find(".team").text(c.Data.TeamName),D.find("a").attr("href","https://"+c.Data.TeamURL),e.userEmail==c.Data.Email&&e.Team.Id==c.Data.TeamID&&c.New&&(f([c.Id]),app.popup.message({heading:"Team Access Changed",message:"Your Access to team has been updated. Please reload.",btnText:"Reload",noClose:!0,handleOK:function(){window.location.reload()}}));break;case ee.transferredFolios:if(0==e.Team.Id)for(var i=0;i<c.Data.Folios.length;i++){var M=$('#folio-items-container .folio-item-shell[data-token="'+c.Data.Folios[i].Token+'"]');M.animate({width:0,opacity:0,padding:0},500,"linear",function(){M.remove()})}else if(e.Team.Id==c.Data.TeamID)for(var i=0;i<c.Data.Folios.length;i++)a.raiseEvent("foliosRecieved",c.Data.Folios[i],!0);c.New&&f([c.Id]);break;case ee.addedFromEditTemplate:c.New&&(s.addFolioToSpace(c.Data.FToken,""),f([c.Id]));break;case ee.teamPurchased:D=$(Te),D.find(".team").text(c.Data.TeamName),D.find("a").attr("href","https://"+c.Data.TeamURL),c.New&&f([c.Id])}D&&(D.toggleClass("new",c.New),D.find(".time").text(r),C.find(".date").after(D))}q=1}z.toggleClass("active",V.length>0)}),z.add(X.find(".close-btn")).click(function(){return!j&&V.length>0&&(f(V),X.find(".new").removeClass("new")),j=!j,X.toggle(),!1}),W.click(function(){var t=$("#n-panel .block .item").length;return m(e.userEmail,t),!1}),a.addListener("docClick",function(e){j&&X.has(e.target).length<=0&&(X.hide(),j=!1)})},app.common.session=function(e,t){e.addListener("loggedOut",function(e){t.message({heading:"Signin Required",message:"Session expired. Please sign in again.",btnText:"Sign In",noClose:!0,handleOK:function(){t.signIn(!0,function(){t.close(),e()})}})})},app.common.undrop=function(e){e.addListener("docClick",function(e){$(".top-comp").removeClass("top-comp"),$(".drop-down-container").each(function(){var t=$(this);0===t.closest(".keep-open").length&&0===t.has(e.target).length&&(t.find(".drop-down").slideUp(150),t.find(".drop-down-open").removeClass("drop-down-open"),t.removeClass("showing"))}),$(".two-state-container.editing").each(function(){var t=$(this);0===t.has(e.target).length&&t.removeClass("editing")}),$(".edit-content.active").each(function(){var t=$(this);0===t.has(e.target).length&&t.removeClass("active")}),$(".gear-drop-down").each(function(){var t=$(this);0!==t.has(e.target).length||t.is(e.target)||t.find(".drop-down").slideUp(150)})})},app.common.urlHash=function(e){function t(){var t=$.trim(window.location.hash.substr(1));"billing"==t?e.billing():"plus"==t?e.plusInfo():"manage-notifications"==t?e.emailSettings():t.indexOf("res-")>=0?(t=t.replace("res-",""),e.signupPerformance(t)):"active"==t?app.dash.changeView(0):"shared"==t?app.dash.changeView(1):"archived"==t?app.dash.changeView(2):"mytemplates"==t&&setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click"),$("#tmp-my-labels-container .item:eq(0)").trigger("click")},2e3)}window.onpopstate=function(){var a=document.location.href;a=a.toLowerCase(),a.indexOf("account/teamsignup")>-1?e.signUp():a.indexOf("account/signup")>-1?e.signUp():a.indexOf("account/signin")>-1?e.signIn():a.indexOf("teams/create")>-1?e.signUpTeam():a.indexOf("#")>-1&&t()},t()},app.menu.bgPanel=function(e,t){var a,n,o,i=(e.apiHelper,e.eventManager,$("#tmp-change-bg-panel").html()),s=$("<div>"),r=$(i),l=r.find(".gallery-container"),c=r.find(".img-btn"),d=r.find(".gallery-btn"),u=r.find(".color-btn"),m=r.find(".color-buttons"),p=r.find(".reset-btn");return c.uploader({type:"bg",success:function(e){t.add(e)},imageLoaded:function(e){}}),u.on("click",function(){t.$node.hide(),n.$node.toggle()}),d.on("click",function(){n.$node.hide(),t.$node.toggle()}),p.on("click",function(){o()}),{$node:r,detach:function(){r.hide(),$("body").append(r)},setCallback:t.setCallback,mount:function(e,i){a=i.bgUrl,o=i.reset,n=i.colorPanel,s.append(m.find("> div")),m.append(n.$node),t.mount(l,i),e.append(r),n.$node.hide(),t.$node.hide(),r.hide()}}},app.menu.getColorPanelFunc=function(){var e=$("#tmp-color-buttons").html(),t=".color-btn.selected",a=["#000","#FFF","#C18656","#DCBC9F","#242E33","#7E8589","#B1B6B9","#E3E5E6","#862B5C","#9E557D","#C93555","#D45D77","#052B3E","#2E5668","#3C688F","#6386A5","#1AB9D3","#76D5E5","#00BD9C","#66D7C4","#FFC536","#FFD371","#FC871F","#FD9F4C","#F44D2C","#F67156","#DD2F2F","#E95F5E"];return function(n,o){var i=$(e),s=i.find(".text-box"),r=i.find(".sample"),l=i.find(".btn"),c=i.find(".color-list");$.each(a,function(e,t){var a=$('<div class="color-btn col-sm-3"><i class="icon-CheckMark"></i></div>').css("background-color",t).data("color",t).addClass(t==n?"selected":"");c.append(a)});var d=function(e){var t=s.val();t=$.trim(t),t.indexOf("#")<0&&(t="#"+t),s.val(t);var a=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t);s.toggleClass("error",!a),a&&n!=t&&(r.css("background-color",t),e&&(o(t),i.hide(),n=t))};return c.on("click",".color-btn",function(){var e=$(this);$(t).removeClass("selected"),e.addClass("selected"),s.val(e.data("color")),o(e.data("color")),d()}),s.on("change",function(){d()}),l.on("click",function(){d(!0)}),s.val(n),r.css("background-color",n),{$node:i}}},app.menu.getColumnPicker=function(){var e=["One","Two","Three","Four","Five","Six"],t='<div class="column-picker child drop-down">';return function(a,n){var o=$(t);return $.each(e,function(e,t){var n=e+1,i=$('<div class="btn num-btn settings-btn" data-num="'+n+'"><span>'+t+"</span></div>").addClass(n==a?"selected":"");o.append(i)}),o.on("click",".num-btn",function(){var e=$(this);o.find(".selected").removeClass("selected"),e.addClass("selected"),n(e.data("num"))}),{$node:o}}},app.menu.gallery=function(e,t,a){function n(e){return g.indexOf(e.Id)>-1||e.isLibraryItem}function o(e){g.push(e)}function i(e){var t=g.indexOf(e);
t>-1&&g.splice(t,1)}function s(e,t){var a=t&&t.length?t:p.find("[data-id='"+e+"']");p.find(".cover-image-thumb").each(function(){var e=$(this),t=u.obtain(c,"Id",e.data("id"));e.removeClass("selected used"),n(t)&&e.addClass("used")}),a.addClass("used selected")}function r(e){var t=p.find("[data-id="+e+"]");$.each(c,function(a,o){if(o.Id==e)return n(o)||(t.remove(),c.splice(a,1)),!1})}function l(e){c.unshift(e),y(e,!0),C(e)}var c=e.imageLibrary,d=a.apiHelper,u=a.utility,m=a.appHub,p=$('<div class="cover-image-preview"></div>'),f=u.obtain(t.Modules,"Type","DataModule"),h=t.UserBgImages||[],g=[];c.length>0&&c.unshift(c.pop()),$.each(c,function(e,t){t.isLibraryItem=!0}),c=h.concat(c);var v,b,y=function(e,t){var a=$('<div class="cover-image-thumb" data-id="'+e.Id+'"><span class="fi-x close-btn"></span><img src="'+e.ThumbUrl+'"/></div>');n(e)&&a.addClass("used"),t?p.prepend(a):p.append(a),a.on("click",function(t){a.hasClass("selected")||$(t.target).hasClass("close-btn")||(v&&v(e.ImageUrl),s(null,a))}),t&&a.click()};p.on("click",".close-btn",function(){var e=$(this).closest(".cover-image-thumb"),t=e.data("id");d.deleteImage(t,function(){r(t)},function(){}),m.sync(f,"ImageRemove",t)});var C=function(e){var t=p.find('[data-id="'+e.Id+'"]');t.toggleClass("used",n(e))},T=!0;return m.reg(f,"ImageAdd",function(e,t){l(t)}),m.reg(f,"ImageRemove",function(e,t){r(t)}),{$node:p,add:function(e){var t={Id:e.Data,ThumbUrl:e.Message,ImageUrl:e.Message};l(t),m.sync(f,"ImageAdd",t)},mount:function(e,t){if(T){for(var a=0;a<c.length;a++)p.find("[data-id='"+c[a].Id+"']").length<1&&y(c[a]);T=!1}var n=u.obtain(c,"ImageUrl",t.url);v=t.bgUrl,p.find(".selected").removeClass("selected"),n&&s(n.Id),e.append(p)},setCallback:function(e){v=e},changeImage:function(e,t){e=e!=t?e:b;var a=u.obtain(c,"ImageUrl",e);a&&(i(a.Id),C(a)),a=u.obtain(c,"ImageUrl",t),a&&(o(a.Id),s(a.Id),C(a)),b=t}}},app.menu.main=function(e,t,a,n){var o=app.menu,i=o.getColorPanelFunc(),s=o.getColumnPicker(),r=o.gallery(e,t,a),l=o.bgPanel(a,r),c=o.getModButtonsFunc(t,a,n,i,l,s),d=o.getSectionButtonsFunc(a,i,l,n);return{changeImage:r.changeImage,setCallback:r.setCallback,colorPicker:i,bgPanel:l,modButtons:c,sectionButtons:d,detach:function(){l.detach()}}},app.menu.getModButtonsFunc=function(e,t,a,n,o,i){var s=t.appHub,r=(t.eventManager,$("#tmp-mod-settings").html());return function(t,l,c){function d(e,t){h.Theme=e,l.applyStyle(e),l.editObj&&l.editObj.applyStyle&&l.editObj.applyStyle(e,!0),t||s.sync(l,"Theme",e)}function u(e){_.not(e.toggle()).hide()}function m(){l.clone?l.clone():t.modManager.duplicateModule(l)}var p,f,h=l.Data,g=$(r),v=c.changeColumns,b=c.addModule,y=c.align,C=c.addItem,T=!1,w=n(h.Theme,d),x=g.find(".drop-down .btn"),k=g.find(".button-panel"),D=g.find(".add-mod-btn"),S=k.find(".col-btn"),I=k.find(".theme-btn"),M=k.find(".bg-panel-btn"),P=k.find(".share-btn"),E=k.find(".exp-btn"),A=k.find(".dup-btn"),F=k.find(".del-btn"),N=k.find(".adv-btn"),O=k.find(".cls-btn"),U=g.find(".mod-setting-btn"),R=g.find(".mod-top-buttons"),B=R.find(".plus"),L=R.find(".align"),H=g.find(".adv-panel"),j=g.find(".border-btn").text((1==h.Border?"Hide":"Show")+" Border"),q=g.find(".header-btn").text((1==h.Head?"Hide":"Show")+" Header"),Y=g.find(".txt-btn").text((1==h.Txt?"Hide":"Show")+" Text"),_=H.add(o.$node).add(w.$node);return p=n(h.BgColor,function(e){t.bgColor(l,e)}),g.append(w.$node),g.find(".border-btn").on("click",function(){$(this).toggleClass("is-present")}),x.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),I.on("click",function(){u(w.$node)}),M.on("click",function(){u(o.$node)}),N.on("click",function(){u(H)}),b?D.click(b):D.remove(),y&&"Text"!=l.Type?(L.attr("class","align icon-Align"+h.Align),L.find(".align-btn").on("click",function(){var e=$(this).data("align");L.attr("class","align icon-Align"+e),h.Align=e,y(),s.sync(l,"Align",e)})):L.remove(),C?B.click(function(){C(),s.sync(l,"Items",h.Items)}):B.remove(),v?(f=i(h.Arr.length,v),g.append(f.$node),_=_.add(f.$node),S.on("click",function(){u(f.$node)})):S.remove(),j.on("click",function(){h.Theme||"#4C7BA0";h.Border=1==h.Border?2:1,j.text((1==h.Border?"Hide":"Show")+" Border"),s.sync(l,"Border",h.Border),l.$editNode.css({borderWidth:1==h.Border?"1px":"0"})}),q.on("click",function(){h.Theme||"#4C7BA0";h.Head=1==h.Head?2:1,l.editObj.$node.find("> .header-container").css({display:1==h.Head?"":"none"}),q.text((1==h.Head?"Hide":"Show")+" Header"),s.sync(l,"Head",h.Head)}),T?Y.on("click",function(){h.Txt=1==h.Txt?2:1,T(),Y.text((1==h.Txt?"Hide":"Show")+" Text"),s.sync(l,"Txt",h.Txt)}):Y.remove(),F.on("click",function(){k.slideToggle(150),t.removeModule(l,!1,function(){s.sync(l,"RemoveModule")})}),A.on("click",function(){k.slideToggle(150),t.modManager.currentAction("dup"),m(),s.sync(l,"DuplicateModule")}),l.menuCb=function(e,a){"Head"==e?(q.text((1==h.Head?"Hide":"Show")+" Header"),l.editObj.$node.find("> .header-container").css({display:1==h.Head?"":"none"})):"Txt"==e?Y.text((1==h.Txt?"Hide":"Show")+" Text"):"Col"==e||("Theme"==e?d(h.Theme,!0):"BgColor"==e?t.bgColor(l,h.BgColor,!0):"BgUrl"==e?(o.setCallback(null),t.bgUrl(l,h.BgUrl,!0)):"ResetBg"==e?t.resetBg(l,!0):"Border"==e?(j.text((1==h.Border?"Hide":"Show")+" Border"),l.$editNode.css({borderWidth:1==h.Border?"1px":"0"})):"DuplicateModule"==e?m():"RemoveModule"==e&&t.removeModule(l,!0))},E.on("click",function(){k.slideToggle(150),t.handleExport(l)}),P.on("click",function(){k.slideToggle(150),t.shareModule(e,l)}),O.on("click",function(){a.message({heading:"Format Class",message:"One or more css class names for the module. You can use these class names to provide custom styles under Folio Settings.",btnText:"Save",showInput:1,enterAsOK:1,input:h.CssClass||h.FormatClass,handleOK:function(e){l.$editNode.add(l.$previewNode).removeClass(h.CssClass).addClass(e),h.CssClass=e,s.sync(l,"CssClass",e)}})}),U.on("click",function(){k.slideToggle(150),U.toggleClass("drop-down-open"),U.closest(".drop-down-container").toggleClass("showing"),U.closest(".edit-content").addClass("active"),u($("<p>")),o.mount(g,{url:h.BgUrl,colorPanel:p,bgUrl:function(e){t.bgUrl(l,e)},reset:function(){t.resetBg(l)}}),setTimeout(function(){g.closest(".module-container, .edit-div").addClass("top-comp")},0)}),"RowBreak"==l.Type&&(I.remove(),M.remove(),P.remove(),E.remove(),N.remove()),{$node:g}}},app.menu.getSectionButtonsFunc=function(e,t,a,n){var o=$("#tmp-section-settings").html();return function(e,i){var s=$(o),r=s.find(".drop-down .btn"),l=s.find(".button-panel"),c=s.find(".move-menu"),d=s.find(".add-mod-btn"),u=l.find(".bg-panel-btn"),m=l.find(".exp-btn"),p=l.find(".del-sec-btn"),f=l.find(".dup-btn"),h=l.find(".move-sec-btn"),g=l.find(".copy-to-folio-btn"),v=l.find(".move-to-folio-btn"),b=s.find(".sec-btn"),y=t(e.BgColor,i.bgColor),C=function(){l.slideToggle(150),b.toggleClass("drop-down-open"),b.closest(".drop-down-container").toggleClass("showing"),b.closest(".edit-content").addClass("active"),c.hide()};return r.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),c.on("click","button",function(){C(),i.move($(this).data("action"))}),u.on("click",function(){c.hide(),a.$node.toggle()}),p.on("click",function(){C(),i.del()}),f.on("click",function(){C(),i.dup()}),m.on("click",function(){C(),i.handleExport()}),h.on("click",function(){a.$node.hide(),c.toggle()}),g.on("click",function(){C(),n.copySectionPopup($(this).closest(".edit-div").index(),"Copy Section")}),v.on("click",function(){C(),n.copySectionPopup($(this).closest(".edit-div").index(),"Move Section",function(){i.del(!0)})}),d.on("click",function(){i.addModule()}),b.on("click",function(){l.slideToggle(150),b.toggleClass("drop-down-open"),b.closest(".drop-down-container").toggleClass("showing"),b.closest(".edit-content").addClass("active"),c.hide(),a.$node.hide(),a.mount(s,{url:e.BgUrl,colorPanel:y,bgUrl:i.bgUrl,reset:i.resetBg})}),{$node:s}}},app.menu.xSelect=function(){function e(e,t){t.siblings().removeClass("active"),t.addClass("active");var a=t.data("name")||t.text(),n=t.data("value"),o=n||a;e.data("value",o).find(".text").text(a)}var t=$(".x-select");$.each(t,function(t,a){var n=$(a),o=n.find(".popup-menu");n.on("click",".item",function(t){var a=$(this);n.hasClass("no-select")||a.hasClass("active")||(e(n,a),n.trigger("change"))}),n.on("val",function(t,a,o){e(n,n.find(".item[data-"+a+'="'+o+'"]'))}),o.length&&app.plugin.popupMenu(n,o)})},app.core.apiHelper=function(e,t,a,n,o){function i(t){return"__RequestVerificationToken="+e.verificationToken+(t?"&"+t:"")}function s(t){$.ajax({url:"/Account/RefreshToken",type:"POST",success:function(t,n,o){var i=$("<div />").html(t).find('input[type="hidden"]').val();i&&(e.verificationToken=i,a.raiseEvent("tokenRenewed"))},complete:t})}function r(e){function t(l){return!e.noPause&&_e?void setTimeout(function(){t(l)},3e3):(l=l||2,void(n=o++<r?$.ajax({type:"POST",url:e.url,data:i(e.data),success:function(n,i,l){$("#saving-popup").removeClass("error").hide(),o=r,1==n.StatusCode?e.success&&e.success(n):401==n.StatusCode?(_e=!0,o--,a.raiseEvent("loggedOut",function(){_e=!1})):1001==n.StatusCode?(o--,$("#saving-popup").show().addClass("error").find(".popup-text").text("Not logged in."),s(function(){t(1)})):e.appError&&e.appError(n)},error:function(a,n,i){if("abort"!=n)if(o==r)e.error&&e.error(a,n,i);else{var s=Math.min(6e4,1e3*(l+l));setTimeout(t,s)}},complete:function(t,a){o==r&&e.complete&&e.complete(t,a)}}):null))}var n,o=0,r=e.maxAttempts||100;return t(),{abort:function(){o=r,n&&4!=n.readystate&&n.abort()}}}function l(t){r({url:"/Apiv1/SaveModuleRecord",maxAttempts:1,data:$.param({token:e.token,moduleId:t.moduleId,data:JSON.stringify(t.dataObj)}),success:t.success,appError:t.error,error:t.error})}function c(t){t&&t.ID&&t.ID>0&&r({url:"/Apiv1/DeleteModule",maxAttempts:999,data:$.param({token:e.token,moduleId:t.ID})})}function d(t){t&&r({url:"/Apiv1/DeleteModules",maxAttempts:999,data:$.param({token:e.token,moduleIds:t})})}function u(e,t,a,n){t.addClass("error"),a.html(n),setTimeout(function(){t.fadeOut("slow")},8e3),e.error()}function m(t,a,n,o){var i=new FormData(t),s=$("#uploading-popup"),r=s.find(".popup-text"),l=$('<span class="upload-progress"></span>');s.removeClass("error").show();try{if(a.type.indexOf("image")<0)return void u(n,s,r,"Please use an image for background.");if(o&&a.size>e.FreeUserLimitPerImage)return void u(n,s,r,"File size exceeds the 1MB limit,  but if you upgrade to a premium plan you can upload images up to 5MB.");if(a.size>e.PaidUserLimitPerImage)return void u(n,s,r,"The image is too big. <br/>Maximum size for uploads is 5MB.")}catch(c){}s.find(".upload-progress").length||r.text("Uploading image").after(l),l.show(),i.append("token",e.token),i.append("type",n.type||"image"),i.append("custom",n.custom),i.append("__RequestVerificationToken",e.verificationToken),$.ajax({url:"/Apiv1/UploadImage",type:"POST",data:i,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return s.show(),e.upload.onprogress=function(e){l.text((e.loaded&&1/e.total*100).toFixed(0)+"%")},e.upload.onload=function(){r.text("Processing image .."),l.hide()},e},success:function(e,t,a){s.show(),1==e.StatusCode?(r.text("Image uploaded"),l.hide(),setTimeout(function(){r.text("Downloading image")},300),n.success&&n.success(e),$("<img>").attr("src",e.Message).on("load",function(){s.fadeOut(),n.imageLoaded&&n.imageLoaded(e.Message),$(this).remove()})):u(n,s,r,"Error. Please try again.")},error:function(e,t,a){n.error(),r.text("Image Failed to process."),l.hide(),setTimeout(function(){s.hide(),l.show(),r.text("Uploading image")},2e3)}})}function p(t,a,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),r({maxAttempts:1,url:"/Apiv1/DeleteBgImage",data:$.param({token:e.token,imageId:t}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),a()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(e,t,a){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")},complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})}function f(e){r({maxAttempts:e.maxAttempts||1,url:e.url,data:$.param(e.data),success:e.success,appError:e.error,noPause:e.noPause,error:function(t,a,n){e.error&&e.error({Message:"Failed to connect. Please try again."})},complete:e.complete})}function h(a){if(!a.isAuto||!e.renameAutoSaveDisabled){var n=$("#tmp-secondary-bar").find(".nav-save-section");n.addClass("saving"),f({url:"/Apiv1/RenameFolio",data:{token:a.token||e.token,name:a.name,isAuto:a.isAuto||!1},success:function(o){n.removeClass("saving").addClass("saved"),setTimeout(function(){n.removeClass("saved")},1500),e.renameAutoSaveDisabled=!0,t&&(t.FolioName=a.name),a.success&&a.success(o)},error:a.error})}}function g(e){f({url:"/Apiv1/ChangeCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function v(t){var a=t.teamId||0;e.Team&&e.Team.Id>0&&(a=t.teamId||e.Team.Id),f({url:"/Apiv1/Duplicate",data:{token:t.token,name:t.name,CopiedFromTemplate:t.fToken,teamId:a},success:t.success,error:t.error,complete:t.complete})}function b(t){f({url:"/Apiv1/ShareFolioByEmail",data:{token:t.token||e.token,modId:t.modId,message:t.message,emails:t.addresses&&$.trim(t.addresses)},success:t.success,error:t.error,complete:t.complete})}function y(e){f({url:"/Labels/ShareByEmail",data:{token:e.token,message:e.message,emails:e.addresses&&$.trim(e.addresses)},success:e.success,error:e.error,complete:e.complete})}function C(t){f({url:"/Apiv1/SetSlug",data:{token:t.token||e.token,slug:t.slug},success:t.success,error:t.error})}function T(t,a,n,o,i,s){console.log(s),f({url:"/Account/LoginAJAX",noPause:!0,data:{Email:t,Password:a,RememberMe:n,returnUrl:e.returnUrl+"#"+window.location.hash.substr(1),FolioToken:s},success:o,error:i})}function w(t,a,n){f({url:"/Account/RegisterAJAX",data:$.extend({refToken:e.refToken},t),success:function(e){try{window.intercomSettings=e.IntercomConfig,sendIntercom(),ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(t){}a()},error:n})}function x(t,a,n){f({url:"/Account/RegisterTeamAJAX",data:$.extend({refToken:e.refToken},t),success:function(e){try{window.intercomSettings=e.IntercomConfig,sendIntercom(),ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(t){}a()},error:n})}function k(e){f({url:"/Account/ResendConfirmationEmailAJAX",data:{Email:e.email},success:e.success,error:e.error})}function D(e){f({url:"/Account/ForgotPassword",data:{Email:e.email},success:e.success,error:e.error,appError:e.error})}function S(e){f({url:"/Account/ChangePassword",data:{OldPassword:e.oldPassword,NewPassword:e.newPassword,ConfirmPassword:e.confirmPassword},success:e.success,error:e.error})}function I(e){f({url:"/Account/ChangeEmail",data:{email:e.email},success:e.success,error:e.error})}function M(e){f({url:"/Account/ChangeName",data:{name:e.fullName},success:e.success,error:e.error})}function P(t){f({url:"/Apiv1/Export",data:{token:e.token,html:t.html,format:t.format,settings:t.settings&&JSON.stringify(t.settings)},success:t.success,error:function(a){6==a.StatusCode&&(e.plusExpireTime=Date.now()),t.error(a)},complete:t.complete})}function E(e){f({url:"/Apiv1/GetExportCreditsLeft",data:{},success:e.success,error:e.error,complete:e.complete})}function A(t){f({url:t.isLabel?"/labels/SetPass":"/Apiv1/SetFolioPass",data:{token:t.token,pass:t.pass},success:t.success,error:function(a){6==a.StatusCode&&(e.plusExpireTime=Date.now()),t.error(a)},complete:t.complete})}function F(t){f({url:t.isLabel?"/labels/RemovePass":"/Apiv1/RemoveFolioPass",data:{token:t.token},success:t.success,error:function(a){6==a.StatusCode&&(e.plusExpireTime=Date.now()),t.error(a)},complete:t.complete})}function N(e){r({maxAttempts:1,url:"/Apiv1/GetFreePlusInfo",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function O(t){f({url:"/Apiv1/SubmitFolio",data:{token:t.token||e.token},success:t.success,appError:t.appError,error:t.error})}function U(t){f({url:"/Apiv1/ChangePresentationMode",data:{token:t.token||e.token,isPresentable:t.present},success:t.success,appError:t.appError,error:t.error})}function R(e){f({url:"/Apiv1/DeleteFolio",data:e.data,success:e.success,error:e.error,complete:e.complete})}function B(e){f({url:"/Apiv1/EmptyTrash",data:{},success:e.success,error:e.error,complete:e.complete})}function L(e){f({url:"/Apiv1/GetFolioByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function H(e){f({url:"/Apiv1/GetFolioFullByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function j(e,t){f({url:e.isLabel?"/labels/ChangePrivacy":"/Apiv1/ChangeFolioPrivacy",data:{token:e.Token,isPrivate:e.Private,isIndexed:e.Indexed},success:t.success,error:t.error,complete:t.complete})}function q(e){f({url:"/Apiv1/GetTemplateMods2",data:{name:e.name,id:e.token},success:e.success,error:e.error,complete:e.complete})}function Y(e){f({url:"/Apiv1/GetMaxTag",data:{count:e.count,token:e.token},success:e.success,error:e.error,complete:e.complete})}function _(e){f({url:"/Apiv1/AddCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function K(e){f({url:"/TeamApi/AddSingleFolioGuest",data:{members:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}function V(e){f({url:"/TeamApi/ReSendSingleFolioGuestEmailNotification",data:e.data,success:e.success,error:e.error,complete:e.complete})}function G(t){t.teamId=0,e.Team&&e.Team.Id>0&&(t.teamId=e.Team.Id),f({url:"/Apiv1/TransferFolio",data:t.data,success:t.success,error:t.error,complete:t.complete})}function z(t){t.teamId=t.teamId||0,e.Team&&e.Team.Id>0&&(t.teamId=t.teamId||e.Team.Id),f({url:"/Apiv1/ProcessTransfer",data:t.data,success:t.success,error:t.error,complete:t.complete})}function X(e){f({url:"/Apiv1/ProcessCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function W(e){f({url:"/TeamApi/ProcessSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}function J(e){f({url:"/TeamApi/RemoveSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Q(t){f({url:"/Apiv1/UpgradeFolio",data:{token:e.token||t.token},success:t.success,error:t.error,complete:t.complete})}function Z(e){f({url:"/Apiv1/GetModRecords",data:{id:e.id},success:e.success,error:e.error,complete:e.complete})}function ee(e){f({url:"/Apiv1/EmailSettings",data:e.data||{},success:e.success,error:e.error,complete:e.complete})}function te(e){f({url:"/Apiv1/FindUser",data:{email:e.email},success:e.success,error:e.error,complete:e.complete})}function ae(e){f({url:"/Apiv1/GetUserActiveFolios",data:{},success:e.success,error:e.error,complete:e.complete})}function ne(e){f({url:"/Apiv1/GetFolioDataPoints",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function oe(e){f({url:"/Apiv1/GetUserTemplateCount",data:{},success:e.success,error:e.error,complete:e.complete})}function ie(e,t){f({url:e,data:t.data,success:t.success,error:t.error,complete:t.complete})}function se(e){ie("/Apiv1/ModStore",e)}function re(e){ie("/Apiv1/FolioStore",e)}function le(e){f({url:"/billing/changecard/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}function ce(e){f({url:"/billing/purchase/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}function de(e){f({url:"/billing/changeplan/",data:e.data,success:e.success,error:e.error,complete:e.complete})}function ue(t){var a=0;e.Team&&e.Team.Id>0&&(a=e.Team.Id),f({url:"/create/"+t.id,data:{teamId:a},success:t.success,error:t.error,complete:t.complete})}function me(e){f({url:"/labels/create",data:{name:e.name,title:e.title||"",desc:e.desc||""},success:e.success,error:e.error,complete:e.complete})}function pe(e){f({url:"/labels/change",data:{token:e.token,list:e.list},success:e.success,error:e.error,complete:e.complete})}function fe(e){f({url:"/labels/RemoveLableFromFolio",data:{token:e.token,labelId:e.id},success:e.success,error:e.error,complete:e.complete})}function he(e,t){f({url:"/labels/ChangeLabelProps",data:{labelId:e.Token,title:e.Title,desc:e.Description},success:t.success,error:t.error,complete:t.complete})}function ge(e){f({url:"/labels/ChangeLabelName",data:{labelId:e.token,name:e.name},success:e.success,error:e.error,complete:e.complete})}function ve(e){f({url:"/labels/remove",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})}function be(e){f({url:"/apiv1/version",data:e.data,success:e.success,error:e.error,complete:e.complete})}function ye(e){f({url:"/Apiv1/UserInAppNotifications",data:{email:e.data.userEmail,nextCount:e.data.nextCount},success:e.success,error:e.error,complete:e.complete})}function Ce(e){f({url:"/apiv1/SaveFolio",data:{data:e.data,token:t.Token},success:e.success,error:e.error,complete:e.complete})}function Te(e){f({url:"/apiv1/GetTagStore",data:{token:t.Token},success:e.success,error:e.error,complete:e.complete})}function we(e){f({url:"/Apiv1/Pull",data:{timestamp:e.data.timestamp,token:e.data.token,connectionId:e.data.connecId},success:e.success,error:e.error,complete:e.complete})}function xe(e){f({url:"/TeamApi/CheckTeamURL",data:{data:e.data.teamUrl},success:e.success,error:e.error,complete:e.complete})}function ke(e){f({url:"/TeamApi/SaveTeam",data:{email:e.data.email,teamMem:JSON.stringify(e.data.members),teamId:e.data.teamId,imageID:e.data.imageID,data:JSON.stringify(e.data.data)},success:e.success,error:e.error,complete:e.complete})}function $e(e){f({url:"/Billing/PurchaseTeam",data:{teamInfo:JSON.stringify(e.data.teamInfo),billingInfo:JSON.stringify(e.data.billingInfo)},success:e.success,error:e.error,complete:e.complete})}function De(e){f({url:"/Billing/RemoveTeamMember/",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}function Se(e){f({url:"/Billing/AddTeamMembers/",data:{teamMembers:JSON.stringify(e.data.teamMembers)},success:e.success,error:e.error,complete:e.complete})}function Ie(e){f({url:"/TeamApi/DeleteTeam",data:{email:e.data.email,teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}function Me(e){f({url:"/TeamApi/AddUser",data:{userEmail:e.data.userEmail,name:e.data.name,userRole:e.data.userRole,teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}function Pe(e){f({url:"/TeamApi/ProcessInvite",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Ee(e){f({url:"/TeamApi/GetTeamMembers",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}function Ae(t,a,n){var o=new FormData(t),i=$("#uploading-popup"),s=i.find(".popup-text"),r=$('<span class="upload-progress"></span>');n.isProgress&&i.removeClass("error").show();try{if(a.type.indexOf("image")<0)return void(n.isProgress?u(n,i,s,"Please use an image for background."):n.error("Please use an image for background."));if(a.size>e.PaidUserLimitPerImage)return void(n.isProgress?u(n,i,s,"The image is too big. Maximum size for uploads is 5MB."):n.error("The image is too big. Maximum size for uploads is 5MB."))}catch(l){}n.isProgress&&(i.find(".upload-progress").length||s.text("Uploading image").after(r),r.show()),o.append("token",e.teamId),o.append("type",n.type||"image"),o.append("custom",n.custom),o.append("__RequestVerificationToken",e.verificationToken),o.append("file",a),$.ajax({url:"/TeamApi/UploadTeamImage",type:"POST",data:o,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,t,a){n.isProgress?(i.show(),1==e.StatusCode?(s.text("Image uploaded"),r.hide(),setTimeout(function(){s.text("Downloading image")},300),n.success&&n.success(e),$("<img>").attr("src",e.Message).on("load",function(){i.fadeOut(),n.imageLoaded&&n.imageLoaded(e.Message),$(this).remove()})):u(n,i,s,"Error. Please try again.")):1==e.StatusCode?n.success(e):n.error("Error. Please try again.")},error:function(e,t,a){n.isProgress?n.error():n.error(a)}})}function Fe(t,a,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),r({maxAttempts:1,url:"/TeampApi/DeleteTeamImage",data:$.param({teamId:e.teamId,imageId:t}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),a()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(e,t,a){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")},complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})}function Ne(e){console.log(e),f({url:"/Apiv1/GetInvoiceTabData",data:{},success:e.success,error:e.error,complete:e.complete})}function Oe(e){f({url:"/Apiv1/GetUserFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}function Ue(e){f({url:"/Apiv1/GetUserOwnFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}function Re(e){f({url:"/Apiv1/CopySections",data:{sourceToken:e.sourceToken,destinationToken:e.destinationToken,sectionTag:e.sectionTag,order:e.order,action:e.action},success:e.success,error:e.error,complete:e.complete})}function Be(e){f({url:"/TeamApi/MoveFolios",data:{userEmail:e.userEmail,source:e.source,destination:e.destination,folios:e.folios},success:e.success,error:e.error,complete:e.complete})}function Le(e){f({url:"/Apiv1/UpdateNotification",data:{id:e.notificationId,teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}function He(e){f({url:"/Apiv1/SaveAsTemplate",data:{token:e.token,name:e.name,teamId:e.teamId,CopiedFromTemplate:e.CopiedFromTemplate},success:e.success,error:e.error,complete:e.complete})}function je(e){f({url:"/Apiv1/DeleteTemplate",data:{token:e.token,op:e.op},success:e.success,error:e.error,complete:e.complete})}function qe(e){f({url:"/TeamApi/AddUser",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}function Ye(e){f({url:"/billing/ChangeAccess",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}var _e=!1;return $("#saving-popup").append($("#spinner-container > .loading-animation").clone().addClass("size-30")),{signIn:T,signUp:w,TeamSignUp:x,deleteModule:c,deleteModules:d,sendShareEmail:b,sendLabelEmail:y,uploadImage:m,deleteImage:p,saveModuleRecord:l,resendEmail:k,forgotPassword:D,changePassword:S,changeEmail:I,changeFullName:M,renameFolio:h,setSlug:C,duplicateFolio:v,exportFolio:P,setObjPass:A,removeObjPass:F,getFreePlusInfo:N,getFolioByToken:L,getFolioFullByToken:H,deleteFolio:R,submitFolio:O,updatePrivacy:j,getMaxTag:Y,templateMods:q,addCollaborator:_,changeCollaborator:g,transfer:G,upgradeFolio:Q,getRecords:Z,emailSettings:ee,findUser:te,processTransfer:z,processCollaborator:X,modStore:se,folioStore:re,card:le,buy:ce,changePlan:de,createFolio:ue,createLabel:me,changeLabels:pe,changeLabelProps:he,renameLabel:ge,removeLabel:ve,folioVersion:be,getTagStore:Te,changePresentMode:U,saveFolioSnapShot:Ce,removeFromLabels:fe,loadNotifications:ye,getRecentMessages:we,checkTeamURL:xe,uploadTeamImage:Ae,deleteTeamImage:Fe,saveTeam:ke,deleteTeam:Ie,addUserToTeam:Me,processInvite:Pe,listTeamMembers:Ee,getExportCreditsLeft:E,getUserActiveFoliosCount:ae,getStripInvoiceData:Ne,getFolioDataPoints:ne,getUserFolios:Oe,getUserOwnFolios:Ue,getCopySections:Re,moveUserFolios:Be,addSingleFolioGuest:K,removeSingleFolioGuest:J,setUserDefinedTeam:Le,resendSFGEmailNotification:V,processSFG:W,saveAsTemplate:He,deleteUserTemplate:je,getUserTemplateCount:oe,addTeamUser:qe,changeMemberAccess:Ye,purchaseTeam:$e,addMembers:Se,removeMember:De,emptyTrash:B}},app.core.appHub=function(e,t,a,n,o,i){function s(e,t){var a=new Array;if(!e[0]||!t[0])return!1;if(e.length!=t.length)return!1;if(0==e.length&&0==t.length)return!0;for(var n=0;n<e.length;n++)key=typeof e[n]+"~"+e[n],a[key]?a[key]++:a[key]=1;for(var n=0;n<t.length;n++){if(key=typeof t[n]+"~"+t[n],!a[key])return!1;if(0==a[key])return!1;a[key]--}return!0}function r(e,t){I[e]=t}function l(e,t,a){v>5?A.server.send(e,JSON.stringify(t)).done(function(e){a&&a(e)}):setTimeout(function(){l(e,t,a)},3e3)}function c(e){$.connection.hub.start({transport:"webSockets"}).done(function(){w[$.connection.hub.id]={},v=7,e&&e(),W("on",!0),K=$.connection.hub.id}).fail(function(){v=0,setTimeout(c,1e4),W("synclost"),B=!0})}function d(e,t){if(b=!0,P=!1,E(1),J(1),!N)try{A.server.saveMods(o.Token,JSON.stringify(e)).always(function(){b=!1}).fail(function(e){console.log("fail",e),le()}).done(function(e){1==e.Status?t&&t(e.TagMap):console.error(e)})}catch(a){console.log("exception: "+a),le()}finally{}}function u(e){o.LastSavedUtc=Date.now(),E(2,o.LastSavedUtc),J(2),$.each(e,function(e,t){var a=n.obtain(x,"Tag",t.Tag);if(a){a.ID=t.Id,k[a.Key]=0,a.lastSavedData=a.dataToSave,n.removeFromList(M,null,"Tag",a.Tag),n.removeFromList(x,a);var o=S[a.Tag];o&&o()}})}function m(e,t){clearTimeout(y),n.pushUnique(M,{Tag:e.Tag||0,ModType:e.Type,ModId:e.ID||0,Data:e.dataToSave}),y=setTimeout(function(){d(M,t)},3e3)}function p(e,t){k[e.Key]=1,S[e.Tag]=t,m(e,u)}function f(e,t){if(B){var a={type:"processSave",mod:e,success:t};return void H.push(a)}e.Tag&&(Q=!0,k[e.Key]||e.suspend?setTimeout(function(){f(e,t)},1e3):(e.dataToSave=JSON.stringify(e.Data),e.Syncd||e.dataToSave==e.lastSavedData||o.Role<2?(e.Syncd&&(e.Syncd=null),o.LastSavedUtc=Date.now(),E(2,o.LastSavedUtc),J(2),n.removeFromList(x,e),t&&t()):(n.pushUnique(x,e),p(e,t))))}function h(e){var t=new Image;t.src="https://app.xtensio.com/img/v-"+Date.now()+"-xtensio-icon.jpg",t.onload=function(){e(!0)},t.onerror=function(){e(!1)}}function g(e,t,a){var n=e.Tag||0;n>0?(e["onReg"+t]&&e["onReg"+t](),D[n+t]=a):"EmptyModule"!=e.Type&&setTimeout(function(){g(e,t,a)},500)}var v,b,y,C=e.timeStamp,T=Date.now(),w={},x=[],k={},D=[],S=[],I=[],M=[],P=!0,E=app.editor.saveSpinner,A=$.connection.appHub,F=(e.msgType,$("#notify-popup")),N=!1,O=null,U=!1,R=!1,B=!1,L=[],H=[],j=null,q=12e4,Y=null,_=!1,K="",V=0,G=!1,z=function(){setInterval(function(){if(0==V)V=Date.now();else{var e=Date.now();e-V>13e4?W("unable"):V=Date.now()}},1e4)};z();var X=function(){return B},W=function(t,a){if(!G&&(e.editMode||e.userName)&&!F.hasClass("logged-in")&&!(F.hasClass("unable")||F.hasClass(t)||F.hasClass("off")&&("synclost"==t||"stilltrying"==t)||F.hasClass("stilltrying")&&"synclost"==t||"stilltrying"==t&&F.hasClass("savingdelayed")||F.hasClass("savingdelayed")&&"on"==t&&a||F.hasClass("savingdelayed")&&"synclost"==t||(clearTimeout(j),"on"==t&&7!=v))){F.removeClass("off on unable synclost stilltrying savingdelayed gettingchanges logged-in "),F.addClass(t).show(),"synclost"==t&&(j=setTimeout(function(){W("stilltrying")},15e3));$(".add-module-button, .module-button.dup-btn, .module-button.del-btn, .module-button.del-sec-btn, .preview-bottom .white-blue-btn,.empty-module .add-btn, .settings-btn.add-mod-btn, .tag-module .tag-close, .slider-outer .item-close-btn, .images-module .close-btn, .donut-module .breakup-row .item-close-btn"),$(".settings-btn.gallery-btn, .settings-btn.img-btn");"off"!=t&&"stilltrying"!=t&&"savingdelayed"!=t||($("body").addClass("no-internet"),e.editMode&&(_=!0,Y=setTimeout(function(){_&&W("unable")},q))),"on"==t&&(_=!1,clearTimeout(Y),$("body").removeClass("no-internet"),$("body").removeClass("block-reload"),j=setTimeout(function(){F.fadeOut(500)},2500),e.editMode&&re()),"unable"==t&&(console.trace(),$.connection.hub.stop(),
N=!0,$("body").addClass("block-reload"))}},J=function(t){e.editMode&&(1==t?(U=!1,O=setTimeout(function(){U||(console.log("Saving Delayed Called",U),W("savingdelayed"),O=setTimeout(function(){U||W("unable")},q))},15e3)):2==t&&(clearTimeout(O),U=!0,W("on")))},Q=!1;A.client.update=function(e,a){t.raiseEvent("hubMsg",e,JSON.parse(a))},A.client.editor=function(a,n,i,s){if(w[s]={email:n,name:i,time:Date.now()},t.raiseEvent("editorStatus",{email:n,status:2==a?2:1}),1==a){A.server.editorPing(e.userEmail,e.fullName,o.Token);var r=e.currentlyEditing[e.userEmail];r&&Date.now()-r.time<=6e4&&ce(r,"Editor",e.userEmail)}else 2==a&&delete w[s]};var Z=null,ee=null,te=null;A.client.syncMod=function(e,t,a,n,o){var i=!1,s=!1;o&&(i=0!=o,s=2==o);var r=D[e+t];if(console.log("got",t,"for",e,"val",a,"timestamp",n),B&&!i){var l={tag:e,prop:t,val:a,ts:n};L.indexOf(l)<0&&L.push(l)}else if(r){if(C>n&&!s)return void console.log("old message returned",C,n,e,t,a);if(C==n&&e==Z&&t==ee&&a==te)return void console.log("old message returned",C,n,e,t,a);Z=e,ee=t,te=a,"Editor"==t||s||(C=n),T=Date.now(),r(e,a)}};var ae=50,ne=function(e){setTimeout(function(){"syncSend"==H[e].type?(console.log(H[e].mod,H[e].prop,H[e].val),ce(H[e].mod,H[e].prop,H[e].val)):(console.log(H[e].mod,H[e].success),f(H[e].mod,H[e].success))},ae*e)},oe=function(){console.log("afterDiscArr",H);var e=0,t=H.length;for(e=0;e<H.length;e++)ne(e);setTimeout(function(){H=[]},ae*t)},ie=function(e,t){console.log("processRecievedMsgs",e,D);for(var a=0;a<e.length;a++)t!=e[a].ConnectionId?A.client.syncMod(e[a].Tag,e[a].Prop,e[a].Value,e[a].TimeStamp,1):console.log("Msg from current User Ignored");console.log("processing after reconnect preprocessed messages",L.length);for(var a=0;a<L.length;a++){for(var n=!1,o=0;o<e.length;o++)if(e[o].TimeStamp==L[a].ts&&(e[o].Tag==L[a].tag,e[o].Prop==L[a].prop&&(console.log("duplicate Check",e[o].Value,L[a].val),jQuery.type(e[o].Value)==jQuery.type(L[a].val)))){var i=jQuery.type(e[o].Value);"boolean"==i||"number"==i||"string"==i?e[o].Value==L[a].val&&(n=!0):"array"==i?s(e[o].Value,L[a].val)&&(n=!0):n=!0}n||A.client.syncMod(L[a].tag,L[a].prop,L[a].val,L[a].ts,2)}L=[]},se=0,re=function(){var t="";console.log("callbacksArr",L),console.log("afterDiscArr",H),console.log("timestamp",C),console.log("browserwasDC",B),console.log("currConnectId",K),t=K==$.connection.hub.id?$.connection.hub.id:K,setTimeout(function(){K=$.connection.hub.id},5e3),i.getRecentMessages({data:{token:e.token,timestamp:C,connecId:t},success:function(e){console.log(e);var a=JSON.parse(e.Data),n=a.Messages;if(se=0,console.log("msgs",n),2==e.StatusCode)return void(B=!1);for(var o=a.MaxCount,i=n.length,s=!1,r=!1,l=!1,c=!1,d=0;d<n.length;d++)n[d].TimeStamp>C&&t!=n[d].ConnectionId&&(s=!0),t==n[d].ConnectionId&&(r=!0),n[d].TimeStamp>C&&(l=!1);(n[0].TimeStamp<=C&&n[n.length-1].TimeStamp>=C||i<o||r)&&(l=!0),console.log("has Time Stamp",n[0].TimeStamp,C,n[n.length-1].TimeStamp,n[0].TimeStamp<=C,n[n.length-1].TimeStamp>=C),n[n.length-1].ConnectionId==t&&(c=!0),console.log("has Latest",t,n[n.length-1].ConnectionId),s=l&&!c,console.log("hasNewMsg",s),l?B&&H.length>0&&s?app.popup.message({heading:"This folio has been updated",message:"This folio was updated when you were disconnected, would you like to merge (may overwrite their changes) or reload to discard your changes",btnText:"Merge the changes",cancelText:"Reload",noClose:!0,handleOK:function(){ie(n,t),B=!1,oe()},handleNo:function(){N=!0,window.location.reload()}}):B&&H.length<1&&s?(ie(n,t),B=!1):(B=!1,oe()):app.popup.message({heading:"This folio has been updated",message:"We were unable to merge changes kindly reload to continue editing.",btnText:"Reload",handleOK:function(){N=!0,window.location.reload()}})},error:function(e){e.StatusCode?se=0:se++;var t=Date.now()-T>3*q;return 3!=e.StatusCode||t?(2==e.StatusCode?(B=!1,oe()):e.StatusCode?app.popup.message({heading:"Error",message:"Unable to merge kindly reload to continue.",btnText:"Reload",handleOK:function(){window.location.reload()}}):e.StatusCode||setTimeout(function(){se<3?re():app.popup.message({heading:"Error",message:"Unable to connect to Xtensio servers. Kindly reload to continue.",btnText:"Reload",handleOK:function(){window.location.reload()}})},3e3),console.log("next error is minor"),void console.error(e)):void app.popup.message({heading:"This folio has been updated",message:"We were unable to merge changes kindly reload to continue editing.",btnText:"Reload",handleOK:function(){N=!0,window.location.reload()}})}})};A.client.onEvent=function(e,t){console.log("appHub.client.onEvent",e,"data",t);var a=I[e];a&&a(t)},$.connection.hub.reconnecting(function(){W("off"),B=!0,v=1}),$.connection.hub.reconnected(function(){v=7,setTimeout(function(){W("on",!0)},1e3)}),$.connection.hub.connectionSlow(function(){v=6,W("synclost")}),$.connection.hub.disconnected(function(){v=0,setTimeout(c,3e3),W("synclost"),B=!0}),e.editMode&&o&&(E(2,o.LastSavedUtc),J(2),$.connection.hub.qs={fid:o.Token},$(window).on("beforeunload",function(e){G=!0}));var le=function(){N||h(function(e){R&&(R=!1),e?(W("on"),c(function(){b||d(M,u)})):setTimeout(le,2e3)})};(e.isHome||e.editMode)&&(c(),$(window).on("offline",function(){N||(W("off"),B=!0)}),$(window).on("online",function(){app.console("browser online"),le()}));var ce=function(e,t,a){if(B){if("Editor"!=t){var n={type:"syncSend",mod:e,prop:t,val:a};H.push(n)}}else"Editor"!=t&&(Q=!0),v>5&&e.Tag>0&&A.server.syncMod(o.Token,e.Tag,t,a),e.save&&e.save()};return{send:l,saveMod:f,reg:g,sync:ce,raiseEvent:function(e,t){A.server.raise(o.Token,e,t)},addListener:r,getBrowserDC:X}},app.core.eventManager=function(){var e={},t={reset:function(){$(e).each(function(e,t){t.listeners=[]})},addEvent:function(t){e[t]={listeners:[]}},addListener:function(t,a,n,o){if("string"==typeof t)e[t].listeners.push({method:a,once:n,data:o});else for(var i=0;i<t.length;i++)e[t[i]].listeners.push({method:a,once:n,data:o})},removeListener:function(t,a){for(var n=e[t].listeners.length-1;n>=0;n--)e[t].listeners[n].method===a&&e[t].listeners.splice(n,1)},raiseEvent:function(t,a,n,o){for(var i=e[t].listeners.length-1;i>=0;i--){var s=e[t].listeners[i];s.data?s.method(s.data,a,n,o):s.method(a,n,o),s.once&&e[t].listeners.splice(i,1)}}};return $.each(["resize","loggedOut","nameChanged","tokenRenewed","docClick","donutError","nameChanged","plusUnlocked","hubMsg","newSignUp","labelChange","transferRequestArrived","duplicateFolio","collabChange","editorStatus","collabRequestArrived","getFolio","removeCollabs","beforeunload","collabreqaccpt","plusCancelled","foliosRecieved","addlabel"],function(e,a){t.addEvent(a)}),$(document).on("click",function(e){t.raiseEvent("docClick",e)}),$(window).on("resize",function(){var e=$(this);t.raiseEvent("resize",e.width(),e.height())}),t},app.core.folioStore=function(e,t){var a=JSON.parse(t.Store||"{}");return{get:function(e){return a[e]},set:function(n,o){a[n]=o,e.folioStore({data:{id:t.Token,data:JSON.stringify(a)}})}}},app.core.main=function(e,t){var a,n=this,o=n.eventManager(),i=n.store(),s=n.utility(),r=n.apiHelper(e,t,o,i,s),l=n.appHub(e,o,i,s,t,r),c=n.pageManager(e,t,l),d=n.modStore(r),u=n.plusHelper(e,r,o);return t&&(a=n.folioStore(r,t)),{eventManager:o,pageManager:c,store:i,utility:s,apiHelper:r,appHub:l,modStore:d,folioStore:a,plusHelper:u}},app.core.modStore=function(e){var t={},a={reg:function(e,a){e&&!t[e]&&(t[e]=a||{})},get:function(a,n,o,i){t[a]?o(t[a][n]):e.modStore({data:{id:a},maxAttempts:99,success:function(e){t[a]=JSON.parse(e.Message||"{}"),o(t[a][n])},error:i})},set:function(n,o,i){a.get(n,o,function(){t[n][o]=i,e.modStore({data:{id:n,data:JSON.stringify(t[n])}})})}};return a},app.core.pageManager=function(e,t,a){var n,o={home:"home-page",edit:"edit-page"},i=e.editMode&&t.Role>1?o.edit:o.home;return{pages:o,showPage:function(e){$("#"+i).hide(),$("#"+e).show(),i=e,n.activatePreview()},hidePage:function(e){$("#"+e).hide()},setupEditPage:function(e,t,s){function r(e){var t=s.createSection({Tag:e});return s.addModule("EmptyModule"),s.saveLayout(),t}n=s;var l='<button type="button" class="btn btn-lg white-blue-btn">+ Add New Section</button>',c='<div class="preview-bottom" style="text-align: center; padding: 20px 0;"></div>',d=$(l);$("#edit-sections").after($(c).append(d)),$("#home-page").append($(c).append(l).css("visibility","hidden")),d.on("click",function(){var e=r();a.raiseEvent("NewSection",e[0].data("Tag"))}),a.addListener("NewSection",r),i!=o.home?this.hidePage(o.home):(this.showPage(o.home),n.activatePreview())},isCurrent:function(e){return i==e},toggle:function(){i==o.home&&t.Role>1?this.showPage(o.edit):(this.showPage(o.home),n.activatePreview())},hideCurrent:function(){$("#"+i).hide()},restore:function(){$("#"+i).show()},getCurrentPage:function(){return i}}},app.core.plusHelper=function(e,t,a){function n(e,t){var n,o="",i=!1;s&&s.End&&(o=moment(s.End).format("MMMM Do, YYYY"),i=new Date(s.End)>r,n=s.AR,Date.now()<s.End&&!t&&a.raiseEvent("plusUnlocked")),e(s,i,n,o)}function o(e,t){var a=document.createElement("script");a.addEventListener("load",t),a.src=e,a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a)}var i,s,r,l=0,c=0;return{loadStripe:function(t){i?t&&t():o("https://js.stripe.com/v2/",function(){i=1,Stripe.setPublishableKey(e.stripePublic),t&&t()})},refresh:function(){s=null,this.getData(1,function(){})},getData:function(a,o,i){setTimeout(function(){r=Date.now(),s&&(a||r-l<3e4)?n(o,i):t.getFreePlusInfo({success:function(t){c=0,l=r,s=JSON.parse(t.Message),e.plusExpireTime=s.End,n(o,i)},error:function(){c=0,n(o,i)}})},2e3*c),c=1}}},app.core.store=function(){var e={},t={showSignupPropmt:"ssp",refCount:"refcount"},a=function(t,a){e[t]=a,"undefined"!=typeof Storage&&localStorage.setItem(t,a)},n=function(t){return e[t]||"undefined"==typeof Storage||(e[t]=localStorage.getItem(t)),e[t]},o=function(t){delete e[t],"undefined"!=typeof Storage&&localStorage.removeItem(t)};return{keys:t,get:n,getNumber:function(e,t){return+(n(e)||t||0)},set:a,remove:o}},app.core.utility=function(){function e(e,t,a){e&&(a=a||1,e.sort(function(e,n){return e[t]>n[t]?1*a:e[t]<n[t]?a*-1:0}))}function t(e,t){var a=!0;return function(n){a&&(a=!1,e.call(this,n),setTimeout(function(){a=!0},t?t:1e3))}}function a(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1}function n(e,t,a,n,o){if(a){for(var i=0;i<e.length;i++)if(e[i][t]==a)return e[i];for(i=0;i<e.length;i++)if(n&&e[i][n]==a)return e[i];for(i=0;i<e.length;i++)if(o&&e[i][o]==a)return e[i]}return null}function o(e,t){return t.x>=e.left&&t.y>=e.top&&t.x<=e.right&&t.y<=e.bottom}function i(e,t,a){for(var n=!1,o=0;o<e.length;o++)if(a&&e[a]==t||e[o]==t){n=!0;break}n||e.push(t)}function s(e,t,a,n){for(var o=0;o<e.length;o++)if(a&&e[o][a]==n||e[o]==t)return e.splice(o,1),t}function r(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return a;return-1}function l(e,t,a){e.busy();var n=new Image;n.onload=function(){t.prepend(p.attr("class",t.attr("class")).hide()),p.css("backgroundImage","url("+a+")"),p.show(),t.css("backgroundImage","url("+a+")"),m.append(p.hide()),e.close()},n.src=a}function c(e,t){var a=null;return $.each(e,function(e,n){if(n==t)return a=e,!1}),a}function d(e){var t;try{t=e.toUpperCase().match(/\b\w/g),t=t.length>1?t.shift()+t.pop():t.shift()}catch(a){t=e.charAt(0)}return t}var u=function(){var e=0;return function(t){return e++,t?e:"_"+e}}(),m=$("body"),p=$("<div>").css({position:"absolute",width:"100%",height:"100%",left:0,top:0});return{sort:e,contains:a,obtain:n,createEventFunc:t,uniqueId:u,isPointInRect:o,pushUnique:i,getInitials:d,removeFromList:s,indexOf:r,changeBg:l,valToProp:c}},app.editor.collaboratorsMenu=function(e,t,a,n,o,i){function s(){var t=$(this),a=t.data("email"),n=e.currentlyEditing[a];n&&n.active&&n.module.bringInView()}function r(t){p.find(".person:not(.add)").remove();var a=5,n=0;if($.each(t.Collaborators,function(t,i){if(i.Accepted&&i.Privilege>0&&i.Email!=e.userEmail)if(++n<=a){var r=$(f.html());r.on("click",s).attr("data-tip",i.FullName).attr("data-email",i.Email).find(".initials").text(o.getInitials(i.FullName||i.Email)),p.prepend(r.addClass(u[i.Email]))}else d.push(i.FullName)}),n&&(m.find(".add-new").addClass("hidden"),p.find(".add").removeClass("hidden")),n>a){var i=p.find(".person:not(.add)").last();d.unshift(i.attr("data-tip")),i.removeClass("active").attr("data-html","true").attr("data-tip",d.join("<br/>")).find(".initials").text("+"+(n-a+1))}app.plugin.tooltip()}function l(e){for(var a=0;a<t.Collaborators.length;a++)if(t.Collaborators[a].Email==e)return t.Collaborators[a].FullName;return!1}var c,d=[],u=[],m=$("#tmp-collaborators"),p=m.find(".others"),f=$("#tmp-single-collab");m.on("click",".add-new, .add",function(){e.Team&&e.Team.Id&&5==e.Team.Role?n.teamUserActionBlocked("collab"):n.collaborators(t)}),r(t),i.addListener("collabChange",r),i.addListener("editorStatus",function(t){setTimeout(function(){var a=e.currentlyEditing[t.email],n=1==t.status?a&&a.active?"editing":"active":"";p.find('.person[data-email="'+t.email+'"]').removeClass("active editing").addClass(n),u[t.email]=n,clearTimeout(c),a&&(a.active&&(a.name=l(t.email),c=setTimeout(function(){e.currentlyEditing[t.email].active=!1,a.module.listEditors(),i.raiseEvent("editorStatus",t)},1e4)),1!=t.status&&(a.active=!1),a.module.listEditors())},500)}),$(".app-title .icon-Edit").after(m)},app.editor.main=function(e,t,a,n,o,i,s,r,l,c,d){e.currentlyEditing={};var u=app.plugin.lockedTip(e,n),m=this,p=$("#tmp-power-by-footer"),f=m.topBar(t,n);m.createSecondaryBar(e,t,a,n,l,i,o,f,c,d,u),m.templateMessage(e,t,r),m.collaboratorsMenu(e,t,a,i,s,n),$("#home-page").append(p),p.find("a:not(.normal)").click(function(){return i.billing(),!1})},app.editor.present=function(e){function t(e){i=e,$("html").css({backgroundColor:"#fff","overflow-y":"auto"}),$("body, .preview-div").addClass("present"),$(".preview-div:first-child").addClass("current"),p&&p.call(l),$(s).on("keydown.present",o),setTimeout(function(){c.show(),a()},100),$(".preview-available").addClass("hidden"),$(s).on("mousemove.idleMouse",function(){clearTimeout(r),$("body").removeClass("idle"),r=setTimeout(function(){$("body").addClass("idle")},2e3)}),d.click(function(){a(-1)}),u.click(function(){a(1)}),m.click(n),$(window).on("resize.presentFix",a)}function a(t){t=t||0,$("html, body").scrollTop(0);var a=$(".preview-div.current").css("min-height",""),n=a.index(),o=$(".preview-div").length-1;t>0&&n<o?a.add(a.next()).toggleClass("current"):t<0&&n>0&&a.add(a.prev()).toggleClass("current"),n+=t,a=$(".preview-div.current").css("min-height",window.innerHeight),d.toggleClass("disable",n<=0),u.toggleClass("disable",n>=o),e.raiseEvent("resize")}function n(){if(s.fullscreenElement||s.mozFullScreen||s.webkitIsFullScreen){var e=s.cancelFullscreen||s.mozCancelFullScreen||s.webkitCancelFullScreen;e&&e.call(s)}c.hide(),$("html").css({backgroundColor:"","overflow-y":""}),$(".preview-div").css("min-height",""),$(".preview-available").removeClass("hidden"),$(window).off(".presentFix"),$("body, .preview-div").removeClass("present current"),clearTimeout(r),$("body").removeClass("idle"),$(s).off(".idleMouse .present"),i&&i()}function o(e){var t=e.which;32==t||39==t?a(1):37==t?a(-1):27==t&&n()}var i,s=document,r=null,l=$("body")[0],c=$("#presentation-buttons"),d=c.find(".left-btn"),u=c.find(".right-btn"),m=c.find(".exit"),p=l.requestFullscreen||l.mozRequestFullScreen||l.webkitRequestFullscreen;return{stop:n,start:t}},app.editor.createSecondaryBar=function(e,t,a,n,o,i,s,r,l,c,d){function u(){f&&f.hide()}function m(){f&&f.show()}function p(e){switch(e){case y.edit:h=!0,m(),r.toggle(1),R.removeClass("preview"),s.showPage("edit-page"),B.removeClass("visible-hidden"),w.addClass("in-edit-mode").removeClass("in-preview-mode");break;case y.preview:h=!1,u(),r.toggle(0),R.addClass("preview"),s.showPage("home-page"),B.addClass("visible-hidden"),w.addClass("in-preview-mode").removeClass("in-edit-mode");break;case y.present:h=!1,u(),r.toggle(0),s.showPage("home-page"),w.removeClass("in-edit-mode"),C.start(function(){p(1)})}}var f,h=!0,g=0,v=0,b=!1,y={edit:1,preview:2,present:3},C=app.editor.present(n),T=$("#tmp-secondary-bar"),w=T.find(".navs-preview"),x=T.find(".export"),k=T.find(".share"),D=T.find(".add-module-button"),S=T.find(".more-opts"),I=T.find(".transfer"),M=T.find(".present"),P=T.find(".settings"),E=T.find(".navs-archive"),A=T.find(".save-as-template"),F=T.find(".navs-delete-template"),N=T.find(".navs-revision"),O=T.find(".navs-stats"),U=T.find(".nav-save-section"),R=$("#folio-bar"),B=$("#tmp-primary-bar, #tmp-secondary-bar .left, #tmp-secondary-bar .right > *:not(.preview-available), .nav-save-section > *"),L=T.find(".nav-settings.popup-menu");R.append(T),setTimeout(function(){f=$("#intercom-container")},3e3),O.click(function(){if($(this).hasClass("locked"))return void i.billing();var a=t.IsUserTemplate||!1,n=t.UsedCount||0;i.folioStats(e.token,t.FolioName,{isTemplate:a,UsedCount:n})});var H=function(){if(e.userName&&(e.editMode||e.isDashboard)){var t,a="Requires Xtensio Plus or up";c.getData(1,function(e,n,o,i){t=0==e.ST,t&&!n?d.add(O,a,0):d.remove(O)},!0)}};H(),n.addListener("plusUnlocked",function(){H()}),n.addListener("plusCancelled",function(){H()}),T.click(function(){var e=Date.now();e-v<1e3?g++:g=0,v=e,5==g&&($("body").addClass("show-adv"),$(".button-panel .cls-btn").removeClass("hidden-btn"))}),P.click(function(){i.message({heading:"Folio Styles",btnText:"Save",showArea:1,areaPlaceholder:"Folio Styles",rows:10,areaText:l.get("style"),handleOK:function(e,t){l.set("style",t);var a='<style id="folio-style">'+t+"</style>";$("head #folio-style").remove(),$("head").append(a)}})}),M.click(function(){p(3)}),w.click(function(){t.Role>1&&p(h?2:1)}),k.click(function(){i.shareLink(t)}),x.click(function(){var e,a="",n=$("#home-page"),r=o.getExport();i.exp(t,r,{$el:n,cb:function(t,i){$("head").find(".module-style, #folio-style").each(function(e,t){a+="<style>"+t.innerHTML+"</style>"}),e=s.isCurrent(s.pages.home),e||s.showPage(s.pages.home),n.css("width",Math.max($(window).width(),1367)+"px"),setTimeout(function(){o.activatePreview(),a+=n.html(),i(a),n.css("width",""),e?o.activatePreview():s.showPage(s.pages.edit),o.saveData()},1e3)}})}),I.click(function(){e.Team&&e.Team.Id>0?i.transferTeamFolio():i.transferFolio()}),E.click(function(){i.archive(t,function(){window.location.href=window.location.href.replace("edit","folio")})}),c.getData(1,function(t,a,n,o){a&&10!=t.ST&&11!=t.ST&&3!=t.ST&&16!=t.ST?b=!0:e.Team.Id<1&&setTimeout(function(){A.addClass("locked")},1e3)}),t.IsUserTemplate?(E.remove(),I.remove(),O.find("span").text("Template Stats"),A.remove()):F.remove(),F.click(function(){i.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,handleOK:function(){a.deleteUserTemplate({token:t.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),window.location=e.baseUrl},error:function(e){$("#dashboard-page > .loader").hide(),i.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})},cancelText:"Cancel",handleNo:function(){i.close()}})}),A.click(function(){if(!b)return void i.billing();$("#app-load-animation").show();var n=t.Token,o=t.FolioName;a.saveAsTemplate({token:n,name:o,teamId:e.Team.Id,CopiedFromTemplate:!1,success:function(){$("#app-load-animation").hide(),i.message({heading:"Success",message:"This folio has been successfully saved as a template.",btnText:"Go To My Templates",enterAsOK:!0,notMini:!0,handleOK:function(){window.location=e.baseUrl+"#mytemplates"},cancelText:"Ok",handleNo:function(){i.close()}})},error:function(e){$("#app-load-animation").hide(),i.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})}),D.click(function(){i.addModule(o.addModule)}),N.click(function(){i.folioVersion(e,t.Token)}),U.click(function(){t.Role>1&&i.folioVersion(e,t.Token)}),t.Role<3&&(I.hide(),N.css({marginTop:"12px"}),E.addClass("leave").html('Leave Folio <i class="icon-Transfer"></i>'),t.Role<2&&(N.addClass("hidden"),E.css({paddingTop:"12px"}),U.addClass("view-only").tooltip("disable"))),app.plugin.popupMenu(S,L)},app.editor.saveSpinner=function(e,t){var a={spin:1,save:2},n=$("#tmp-secondary-bar").find(".nav-save-section").attr("class","nav-save-section info"),o=n.find(".info .saved-time");switch(e){case a.spin:n.removeClass("saved").addClass("saving");break;case a.save:n.removeClass("saving").addClass("saved"),o.text(moment(t||Date.now()).format("lll")),setTimeout(function(){n.removeClass("saved")},1500)}},app.editor.templateMessage=function(e,t,a){var n="hideTemplateMessage:"+t.ParentID;if(t.TemplateMessage&&"true"!==a.get(n)){var o=$("#template-message-wrapper"),i=$("#template-message");i.html(t.TemplateMessage);var s=$('<span class="close-btn"></span>');o.prepend(s),s.on("click",function(){a.set(n,"true"),o.slideToggle(150),setTimeout(function(){o.remove()},1e3)}),o.show()}},app.editor.topBar=function(e,t){var a,n=!0,o={duration:400,queue:!1},i=$(document),s=$("body"),r=$("#top-bar"),l=($("#n-panel"),86);return s.css("padding-top",l),t.addListener("resize",function(){n?setTimeout(function(){r.css("top",0),s.css({paddingTop:l})},0):r.animate({top:-$("#top-bar").height()},o)}),{toggle:function(e){if(n=e){var t=i.scrollTop();t>0&&$("html, body").animate({scrollTop:i.scrollTop()-a},o),s.animate({paddingTop:l},o),r.animate({top:a},o)}else a=parseInt(r.css("top")),s.animate({paddingTop:0},o),r.animate({top:-$("#top-bar").height()},o)}}},app.editor.viewOnly=function(e){e&&1===e.Role&&($("#edit-page").hide(),$(".folio-name").attr("readonly",!0),$(".others .person.add").remove(),$(".user-options .left").css("padding","5px 30px 3px").html('<p style="line-height: 28px;margin-bottom: 0;">You only have access to view this folio.</p>').css("font-size","14px"),$(".navs-preview").addClass("view-only").find(".preview").html("View Only"))},app.editor.addWatermark=function(e,t){function a(e){var t=$("#tmp-power-by-footer");return t.removeClass("hidden").find("upgrade"==e?".normal":".upgrade").addClass("hidden"),t.find("."+e).removeClass("hidden"),t}function n(){var e=$("#tmp-power-by-footer");return e.addClass("hidden"),e}var o=!(e.plusExpireTime>=Date.now()),i=$("#home-page .persona-canvas.canvas-module-container .canvas-module > .header-container"),s=$(location).attr("href"),r="/folio/"+e.token,l=s.indexOf(r)>=0,c=s.indexOf("/project/")>=0;(l||c)&&(o=!(e.PlusEnd>=Date.now()));var d=e.Team&&e.Team.Id>0;!o||e.isProject||d?o&&!d||(n(),i.length&&i.find(".watermark").remove()):(i.length&&(l||c?i.append('<div class="watermark"><a href="https://www.xtensio.com" target="_blank" ><div class="logo"></div></a></div>'):i.append('<div class="watermark"><a href="'+s+'#billing"><div class="logo"></div></a></div>')),a(l||c?"normal":"upgrade"))},app.dash.archivedFolioTopBanner=function(e,t){t&&1==t.Status&&($("#home-page").prepend($("#tmp-archived-topbar")).on("click",".unarchive",function(){return e.unarchive(t,function(){window.location.href="/"}),!1}),$("#tmp-power-by-footer").hide())},app.dash.archiveFolio=function(e,t,a){var n=$("#folio-items-container");n.on("click",".delete-folio",function(){var t=$(this).closest(".folio-item-shell");return a.archive(t.data("folio"),function(){t.animate({width:0,opacity:0,padding:0},500,"linear",function(){a.close();var o=t.toggleClass("active archived").removeClass("locked").attr("style","");$("#folio-arch-container").prepend(o),o.find(".collabs .initials:not(.add)").remove(),o.find(".edit").each(function(){console.log($(this),$(this).attr("href")),$(this).attr("href")&&$(this).attr("href",$(this).attr("href").replace("edit","folio"))}).eq(1).text("View Folio");var i=n.find(".folio-item-shell.active").length;i<1&&app.dash.emptyState(e,a).addNoFolio()})}),!1})},app.dash.changeView=function(e){return"complete"!=document.readyState?void setTimeout(function(){app.dash.changeView(e)},1e3):(0==e||2==e?(e=0==e?0:1,$(".filter-bar .filter-popup-menu .item").eq(e).click(),$(".filter-bar .filter").removeClass("menu-active"),$(".filter-bar .filter-popup-menu").hide()):1==e&&$("#tmp-sidebar .popup-menu .item").eq(2).click(),void(window.location.hash=""))},app.dash.copyFolio=function(e,t,a,n,o){$("#folio-items-container").on("click",".copy-folio-btn",function(){if(o.Team&&o.Team.Id&&5==o.Team.Role)return void a.teamUserActionBlocked("dupicate");if(o.Team&&o.Team.Id&&4==o.Team.Role)return void a.teamUserActionBlocked("dupicate","Premium Guests");var e=$(this),i=e.data("token"),s=e.closest(".folio-item-shell"),r=s.find("h4"),l=s.data("copy-count")||1;s.data("copy-count",l+1);var c="Copy "+l+" - "+r.text();return s.prepend($("#spinner-container > .loading-animation").clone()),t.duplicateFolio({token:i,name:c,success:function(e){t.getFolioByToken({token:e.Message,success:function(e){var t=JSON.parse(e.Data);o.folios.push(t)},error:function(e){console.log("error",e)},complete:function(e){}}),n.raiseEvent("duplicateFolio",i,e.Message,c)},error:function(e){5==e.StatusCode?a.plusPrompt("create",null,!0):10==e.StatusCode&&a.plusPrompt("create",null,!1,!0)},complete:function(){s.find(".loading-animation").remove()}}),!1})},app.dash.createFolio=function(e,t,a,n){$(".folio-item").on("click",".create-btn",function(){return e.Team&&e.Team.Id&&5==e.Team.Role?void n.teamUserActionBlocked("create"):e.Team&&e.Team.Id&&4==e.Team.Role?void n.teamUserActionBlocked("create","Premium Guests"):void a.createFolio({id:$(this).closest(".folio-item").data("template"),success:function(e){window.location="/edit/"+e.Message+"#new"},error:function(e){5==e.StatusCode?n.plusPrompt("create",null,!0):10==e.StatusCode?n.plusPrompt("create",null,!1,!0):n.error(e.Message)}})})},app.dash.createNewMenu=function(){$(".ribbon-button").on("click",function(){var e=$(this).parent(".plus-menu");e.toggleClass("active"),e.hasClass("active")&&setTimeout(function(){$("body").on("click.remover",function(){e.removeClass("active"),$("body").off(".remover")})},100)})},app.dash.delFolio=function(e,t){$("#folio-arch-container .warning span").click(function(){var a=$("#folio-arch-container .folio-item-shell"),n=[];a.each(function(e){n.push($(this).data("token"))}),a.length>0?t.message({heading:'Are you sure you want to delete </br>all folios in trash forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete All",cancelText:"Cancel",enterAsOK:!0,notMini:!0,handleOK:function(){t.busy(),e.emptyTrash({success:function(){t.close(),$("#folio-arch-container .warning").hide(),a.each(function(e){$(this).animate({width:0,opacity:0,padding:0},500,"linear",function(){$(this).remove()})})},error:function(){t.error("There was an error. Please refresh page and try again.")}})}}):t.error("There is no folios in archived list.")}),$(".folios-container").on("click",".archived-options .delete",function(){var a=$(this).closest(".folio-item-shell");return t.message({heading:'Are you sure you want to <br/>delete forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){e.deleteFolio({data:{op:"del",token:a.data("token")},success:function(){a.animate({width:0,opacity:0,padding:0},500,"linear",function(){a.remove()})},error:function(){t.error("There was an error. Please refresh page and try again.")}})}}),!1})},app.dash.delLabel=function(e,t,a,n,o){var i=function(i){o.message({heading:"Are you sure?",message:"Deleting this channel will only remove the channel name.<br/> No folios will be deleted.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){a.removeLabel({token:i.Token,success:function(){$("#all-folios-button").click(),$("#all-labels-container").find(".item[data-name="+i.Token+"]").remove(),t.removeFromList(e.labels,i),n.raiseEvent("labelChange")},error:function(){o.error("There was an error. Please refresh page and try again.")}})}})};$("#all-labels-container").on("click",".delete-btn",function(){return i($(this).data("label")),!1}),$(".label-details").on("click",".delete",function(){return i($(this).closest(".label-details").data("label")),!1})},app.dash.downgrade=function(e,t,a,n){function o(){var e=$(".folio-item-shell.active"),t=$("#templates-items-container .folio-item.own");e.length<=a.limit&&0==t.length?location.href="/":setTimeout(o,1e3)}var i=$(".folio-item-shell.active"),s=$("#templates-items-container .folio-item.own");(Date.now()>=e.plusInfo.End||i.length>a.limit)&&t.expiredBlocker(a);var r=$("#tmp-downgrade-bar");r.find(".downgrade-bar .plan").text(a.currUser),r.find(".downgrade-bar .limit").text(a.limit),r.find(".downgrade-bar .s").text(a.limit>1?"s":""),$("#logo-bar").after(r),$("#dashboard-page").addClass("downgrade"),$(".upgrade-btn, .plus-menu").remove(),$(".sidebar #add-label").remove(),$(".folio-item.as-template .cta-btn.primary").addClass("visible-hidden"),r.find(".link").click(function(){t.payment()}),i.each(function(e,t){var a=$(t),n=a.data("folio"),o=Faltu(n.Collaborators).find({Accepted:!0}).count(),i=a.addClass("locked").find(".edit");i.eq(0).attr("href",i.eq(0).attr("href").replace("edit","folio")),i.eq(1).remove();var s=a.find(".archived-options").empty();n.Role>2&&s.append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>').data("token",n.Token),o>1&&n.Role<3&&s.append('<div class="action delete-folio" data-tip="Leave"><i class="icon-Transfer"></i></div>').data("token",n.Token)}),s.each(function(e,t){var a=$(t),n=(a.data("folio"),a.addClass("locked").find(".edit"));n.eq(0).removeAttr("href"),n.eq(1).remove(),a.find(".use-template").remove();var o=a.find(".archived-options").empty();o.append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>')}),s.on("click",".delete-folio",function(){var e=$(this).closest(".folio-item-shell");t.message({heading:"Delete this template?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){n.deleteUserTemplate({token:e.data("token"),op:"del",success:function(){e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})},error:function(e){$("#dashboard-page > .loader").hide(),t.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})}})}),o()},app.dash.emptyState=function(e,t){function a(){$('.as-template[data-template="blank"] .create-btn:eq(0)').click()}function n(a,n,o,i,s){var c=$(l);c.find("h2").text(a),c.find("p.tag").text(n),o?c.find("button").text(o).on("click",i):c.find("button").hide(),e.Team&&e.Team.Id>0&&e.Team.Role<4?c.find("p.imp-folio").on("click",function(){t.importFolioPopup()}):c.find("p.imp-folio").remove(),r.append(c.addClass(s||""))}function o(){n("You don't have any folios yet.","A folio is a document, webpage or presentation, all in one.","Create a Folio",a,"empty")}function i(){n("You don't have any folios yet.","A folio is a document, webpage or presentation, all in one.","Create a Folio",a,"my-empty")}function s(){n("Looks like no one's shared folios with you yet.","When collaborators add you to their folios, you will see them here.",!1,null,"empty-shared")}var r=$("#folio-items-container"),l=$("#tmp-empty-state").html();return{addNoFolio:o,addNoShared:s,addNoMyFolio:i}},app.dash.getExploreFolio=function(e,t,a){var n=$("#tmp-dashboard-content .explore .loading-animation");n.html(a.spinner),t.getFolioFullByToken({token:e.ExploreTabFolioToken,success:function(t){console.log("Success from GetFolioByTOken",t);var a,o,i,s,r,l=JSON.parse(t.Data).FolioData,c=app.core.main(e,l),d=c.utility,u=c.apiHelper,m=c.eventManager,p=c.pageManager,f=c.store,h=c.modStore,g=c.folioStore,v=(c.appHub,
c.plusHelper),b=g.get("style")||"",y='<style id="folio-style" type="text/css">'+b+"</style>";$("head").append(y),app.plugin.main(e,c,l,v),i=app.popup.main(e,m,d,u,p,v,h,f,l,g),a={},o=app.managers.main(e,l,c,a,i),s=o.modManager,r=o.rddm,console.log(l),app.factory.main(e,l,c,a,i,s,r),s.activatePreview(),e.EditTemplate="dash-explore",app.menutcopy(e,u,m,i),$("#home-page").after($("#presentation-buttons").addClass("public")),n.hide()},error:function(e){console.log("Error from GetFolioByTOken",e),$("#tmp-dash-topbar .explore").hide(),n.hide()}})},app.dash.filterBar=function(e,t){function a(e){return{animation:{duration:1e3},selectors:{target:e}}}var n,o,i,s=$("#folio-items-container"),r=$("#tmp-filter-bar"),l=$(r.html());s.before(l),$("#templates-items-container").before($("#tmp-temp-filter-bar").html());var c=function(){o&&o.destroy(),i&&i.destroy(),n&&n.destroy(),o=mixitup(s,a(".folio-item-shell.active")),i=mixitup($("#folio-arch-container"),a(".folio-item-shell.archived")),setTimeout(function(){n=mixitup($(".tab-content #templates-items-container"),a(".folio-item"))},1e3)};c(),t.addListener("collabreqaccpt",function(){setTimeout(function(){c()},1e3)}),$(".filter-bar .sort").change(function(){(s.hasClass("active")?o:i).sort($(this).data("value"))}),$(".filter-bar .filter").change(function(){var e=$(this).data("value");"Deleted"==e?$("#folio-arch-container .folio-item-shell").length>0?($("#folio-arch-container .warning").show(),$("#dashboard-page").addClass("has-archived")):($("#folio-arch-container .warning").hide(),$("#dashboard-page").removeClass("has-archived")):$("#dashboard-page").removeClass("has-archived"),s.removeClass("active archived").addClass($(this).data("value").replace("Deleted","Archived").toLowerCase());var t=l.find(".label-details");t.hasClass("normal")&&t.find(".label-name").text($(this).data("value")+" Folios")}),$(".filter-bar .tmp-sort").change(function(){n.sort($(this).data("value"))})},app.dash.filter=function(e,t,a){function n(e){g.show(),y.filter(e),C.filter(e),setTimeout(function(){g.hide()},500)}function o(e){r.removeClass("mine shared").addClass(e)}function i(e){l=r.find(".folio-item-shell");var t=l.filter("."+e);n(t);var a=t.filter(".active").length,o=t.filter(".archived").length;$("#folio-items-container")[a>0?"addClass":"removeClass"]("has-label-folios"),$("#folio-arch-container")[o>0?"addClass":"removeClass"]("has-label-folios")}function s(e){if(!($(e.target).closest(".options").length>0)){var t=$(this);c.removeClass("active"),t.addClass("active");var a=t.data("name"),o=t.find(".name").text(),s=t.find(".label").attr("style");if(r.removeClass("has-label-folios"),!a)return r.removeClass("label-view"),n("all"),void d.addClass("normal").find(".label-name").text(o);r.addClass("label-view"),d.removeClass("normal").data("label",t.data("label")),d.find(".label-name").text(o),d.find(".label-color").attr("style",s),i(a)}}var r=$(".folios-container:not(.templates)"),l=r.find(".folio-item-shell"),c=$("#tmp-sidebar .sidebar").find(".item:not(.pmenu)"),d=$(".label-details:not(.temp)"),u=$(".labels-dropdown"),m=$(".my-shared-popup-menu"),p=$("#tmp-empty-state").html(),f=$("#all-folios-button"),h='<div class="loader" style="position: fixed;width: 100%;height: 100%;top: 0;left: 0;display: none;z-index: 99999;"><div class="loading-animation"></div></div>';$("#dashboard-page").append(h);var g=$("#dashboard-page > .loader");g.find(".loading-animation").html(a.spinner);var v=app.plugin.popupMenu(f,m,!0),b={selectors:{target:".folio-item-shell"}},y=mixitup(r.eq(0),b),C=mixitup(r.eq(1),b);f.click(function(){$(this).hasClass("active")&&v()}),m.find(".item").on("click",function(){var e=$(this);e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),f.find(".name").text(e.data("show-name")),d.addClass("normal").find(".label-name").text(e.data("show-name")),o(e.data("orderby")))}),c.on("click",s);var T=$(p);T.find("h2").text("You don't have any folios under this channel yet."),T.find("p").text('Go back to "All Folios" to add folios to this channel. Channels let you organize and share folios in batches.'),T.find("button").text("View all folios").on("click",function(){f.click()}),r.append(T.addClass("empty-label")),u.on("change",function(a){var n=$(this).val(),s=t.obtain(e.labels,"Token",n);return null===s?(o("all"!=n?n:""),l.removeClass("hidden"),void d.addClass("normal")):(i(s.Token),void d.removeClass("normal").data("label",s))})},app.dash.folios=function(e,t,a,n,o,i){function s(t,a){return function(){return 0===e.labels.length?$("#add-label").click():n.labels(a,t,function(e){t.find(".labels >*:not(:last-child)").remove(),d(t,a)}),!1}}function r(e){return function(){return n.shareLink(e),!1}}function l(e){return function(){return n.collaborators(e),!1}}function c(e,t){var n=$(this),i=a.removeFromList(t.Labels,n.data("token"));n.animate({width:0,opacity:0,padding:0},500,"linear",function(){n.hide()}),e.removeClass(i),o.removeFromLabels({token:t.Token,id:$(this).data("token")})}function d(t,n){t.find(".labels").empty(),$.each(n.Labels,function(o,i){var s=a.obtain(e.labels,"Token",i);if(s){var r=$('<div class="label"></div>').css("background-color",s.color).html(s.Name+'<div class="ghost"><i class="icon-Close"></i></div>');r.data("token",s.Token),r.find(".ghost").on("click",function(){c.call(r,t,n)}),t.addClass(s.Token),t.find(".labels").prepend(r)}})}function u(t,n){if(!(n.Version<2)){var o=t.find(".collabs"),i=5,s=0,r=[];if($.each(n.Collaborators,function(t,n){if(n.Accepted&&n.Privilege>0&&n.Email!=e.userEmail)if(++s<=i){var l=$('<div class="outer"><div class="initials">MU</div></div>');l.find(".initials").text(a.getInitials(n.FullName||n.Email)).attr("data-tip",n.FullName),o.prepend(l.find(".initials"))}else r.push(n.FullName)}),s>i){var c=o.find(".initials:last-child");r.unshift(c.attr("data-tip")),c.attr("data-html","true").text("+"+(s-i+1)).attr("data-tip",r.join("<br/>"))}var d=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');d.attr("data-tip","Add / Remove People"),d.click(l(n)),o.append(d)}}function m(a,o,l,c){var m=$(T),g=(e.baseUrl+"/folio/"+a.Token,a.FolioName||"Untitled"),v=moment(a.LastSavedUtc);a.Status<1&&(f++,a.Role>2&&p++),a.Role<3&&h++,m.attr("data-token",a.Token).attr("data-saved",a.LastSavedUtc).attr("data-name",g.toLowerCase()).data("folio",a),m.addClass(0===a.Status?"active":"archived"),m.addClass(a.Role>1?a.Role<3?"shared edit-access":"mine":"shared"),m.find("h4").text(g),m.find(".inline-title").val(g),m.find(".edit").attr("href",e.baseUrl+"/"+(0===a.Status?"edit":"folio")+"/"+a.Token);var b=1==a.Status?"View":"Edit";m.find(".options .edit").text(b+" Folio"),m.find(".delete-folio, .copy-folio-btn, .rename-folio-btn, .transfer-folio-btn").data("token",a.Token),m.find(".last-update").find("span").text(v.fromNow()).attr("title",v.format("lll")),a.Role<3&&(m.find(".delete-folio span").text("Leave"),m.find(".delete-folio i").removeClass("icon-Delete").addClass("icon-Transfer")),d(m,a),u(m,a),m.find(".manage-label").click(s(m,a)),m.find(".share").click(r(a)),e.Team&&0==e.Team.Id&&!k&&(m.find(".save-template-btn").addClass("locked"),setTimeout(function(){var a=app.plugin.lockedTip(e,t);app.dash.folioStats(e,n,i,a,t)},100)),o?($("body").animate({scrollTop:0},500),m.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),y.find('.folio-item-shell:not(".transfer-item"):eq(0)').before(m)):a.Status<1?(c&&($("body").animate({scrollTop:0},500),m.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),setTimeout(function(){m.removeClass("scaleup")},2e3)),l?y.prepend(m):y.append(m)):C.append(m),t.addListener("labelChange",function(e){m.find(".labels >*:not(:last-child)").remove(),d(m,a)})}var p=(Date.now()>=e.plusInfo.End,0),f=0,h=0,g=($("#home-page"),$("#dashboard-page")),v=$("#tmp-sidebar"),b=$("#tmp-dashboard-content"),y=b.find("#folio-items-container"),C=b.find("#folio-arch-container"),T=$("#folio-item").html(),w=($("#single-label"),v.find("#all-labels-container"),b.find("#sidebar")),x=($("#top-bar"),!1),k=!1;g.append(b),w.append(v),y.addClass("visible-hidden"),0===e.folios.length&&0===e.tansFolios.length&&e.Team&&0==e.Team.Id&&$(".nav-main-menu a:eq(1)").click(),e.folios.sort(function(e,t){return t.LastSavedUtc-e.LastSavedUtc});for(var D=0;D<e.folios.length;D++)m(e.folios[D]);$(".custom-select").on("click",function(){$(this).parent(".folio-item").toggleClass("selected",$(this).is(":checked"))}),y.addClass("active").removeClass("visible-hidden"),t.addListener("collabChange",function(e){var t=$('.folio-item-shell[data-token="'+e.Token+'"]');t.find(".collabs").empty(),u(t,e),app.plugin.tooltip()}),t.addListener("duplicateFolio",function(t,n,o){var i=$.extend({},a.obtain(e.folios,"Token",t)),s=Faltu(i.Collaborators||[]).find({Email:e.userName}).get();s[0].Privilege=3,i.Role=3,i.Token=n,i.Labels=[],i.Private=!0,i.FolioName=o,i.LastSavedUtc=Date.now(),i.Collaborators=s,m(i,!0)}),i.getData(1,function(t,a,i,s){var r=0,l={};i&&(10!=t.ST&&11!=t.ST||(r=5,l.currUser="Plus",l.limit=5)),a&&10!=t.ST&&11!=t.ST&&3!=t.ST&&16!=t.ST?(k=!0,y.find(".save-template-btn").removeClass("locked")):e.Team.Id<1&&y.find(".save-template-btn").addClass("locked"),a||i||(r=1,l.currUser="Free",l.limit=1),!a||10!=t.ST&&11!=t.ST&&16!=t.ST&&3!=t.ST||(x=!0,r=5,l.currUser="Plus",l.limit=5,console.log("here")),r>0&&o.getUserActiveFoliosCount({success:function(t){var a=t.Data;o.getUserTemplateCount({success:function(t){var i=t.Data;if(a>r||i>0){var s=$(".folio-item-shell.active"),c=$("#templates-items-container .folio-item.own");l.foliosCount=t.Data,(s.length>l.limit||c.length>0)&&0==e.Team.Id&&app.dash.downgrade(e,n,l,o)}},error:function(e){$comp.removeClass("busy"),console.log("error: ",e)}})},error:function(e){console.log("error: ",e)}})}),f<1&&0===e.tansFolios.length&&app.dash.emptyState(e,n).addNoFolio(),f>0&&p<1&&app.dash.emptyState(e,n).addNoMyFolio(),h<1&&app.dash.emptyState(e,n).addNoShared(),t.addListener("collabreqaccpt",function(e,t){m(e,!1,t)}),t.addListener("foliosRecieved",function(t,a){t.Collaborators.push({Email:e.userEmail,FullName:e.fullName,Privilege:3,Accepted:!0}),m(t,!1,a,!0)})},app.dash.folioStats=function(e,t,a,n,o){var i=$("#folio-items-container"),s=function(){if(e.userName&&!(e.Team&&e.Team.Id>0)&&(e.editMode||e.isDashboard)){var t,o=i.find(".settings-btns .show-stats"),s="Requires Xtensio Plus or up";a.getData(1,function(e,a,i,r){t=0==e.ST,t&&!a?n.add(o,s,0):n.remove(o)},!0)}};s(),o.addListener("plusUnlocked",function(){s()}),o.addListener("plusCancelled",function(){s()}),i.on("click",".show-stats",function(){if($(this).hasClass("locked"))return void t.billing();var e=$(this).closest(".folio-item-shell");return t.folioStats(e.data("token"),e.find(".edit h4").text()),!1})},app.dash.inlineRename=function(e,t){$(" #folio-items-container, #templates-items-container").on("click",".inline-action-edit",function(){var e=$(this),t=e.prev(".edit").find("h4"),a=$(this).next(".inline-action-save"),n=a.find(".inline-title");a.removeClass("hidden"),e.addClass("inactive"),n.removeClass("error").focus().blur(function(){a.addClass("hidden"),e.removeClass("inactive")}).on("keydown",function(e){13==(e.which||e.keyCode)?a.find(".save-icon").trigger("mousedown"):27==(e.which||e.keyCode)&&n.blur()}).data("lastVal",t.text())}),$("#folio-items-container, #templates-items-container").on("mousedown",".save-icon",function(){var a=$(this),n=a.parent(".inline-action-save"),o=n.closest(".folio-item").find("h4"),i=n.find(".inline-title"),s=i.val(),r=a.closest(".folio-item-shell").data("folio");return console.log(o),0===s.length?void i.addClass("error"):s==i.data("lastVal")?void n.addClass("hidden"):(o.text(s),n.addClass("fadeout"),i.off("keypress"),$(".inline-action-edit").removeClass("inactive"),void e.renameFolio({token:r.Token,name:s,success:function(){r.FolioName=s,r.LastSavedUtc=Date.now(),i.val(s).data("lastVal",s),n.removeClass("fadeout").addClass("hidden")},error:function(e){o.text(i.data("lastVal")),i.val(i.data("lastVal")),t.error(e.Message)}}))})},app.dash.labels=function(e,t,a,n,o){function i(t){var a=e.labels[t],o=$(r).data("label",a);o.find(".label").css("background-color",a.color),o.find(".name").text(a.Name||"Untitled"),o.find(".share").click(function(){n.shareLink(a)}),o.find(".delete-btn, .rename-btn").data("label",a),o.attr("data-name",a.Token),s.append(o);var i=$("<option></option>");i.text(a.Name||"Untitled").val(a.Token),l.append(i)}for(var s=$("#all-labels-container"),r=$("#single-label").html(),l=$(".labels-dropdown"),c=0;c<e.labels.length;c++)i(c);$("#add-label, #add-label-from-popup").on("click",function(){return e.Team&&e.Team.Id>0&&5==e.Team.Role?void n.teamUserActionBlocked("label"):(n.message({heading:"New Channel",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Create",emptyError:"Please provide a name for the channel",namespace:"add-label-popup",inputPlaceholder:"Enter name",input:$(this).data("suggestedName")||"",handleOK:function(a){t.createLabel({name:a,success:function(t){n.close();var o=s.find(".item").length;e.labels.push({Name:a,Token:t.Message,FolioTokens:[],Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:e.colors[o%e.colors.length]}),i(o),app.dash.filter()},error:function(e){if(2==e.StatusCode){var t=$("#tmp-message");n.push(t),n.close(),t.find(".msg").addClass("error").html(e.Message)}else n.error(e.Message)}})}}),!1)}),o.addListener("addlabel",function(t){i(t),app.dash.filter(e,a,n)})},app.dash.listRequests=function(e,t){function a(e){var t=s.find("div").data();t&&t.code==(e.Secret||e.Code)||(o=$(r),o.data("code",e.Secret||e.Code),o.data("item",e),o.find("h4").text(e.FolioName||e.Folio||"Untitled"),o.find(".description").text((e.UserName||e.Name)+" wants to transfer this folio to you."),s.prepend(o))}function n(e){o=$(r),o.addClass("collabRequest").data("Id",e.Data.Id).attr("data-token",e.Data.Token),o.find("h4").text(e.Data.Folio||"Untitled"),o.find(".description").text(e.Data.Name+" has invited you to "+(e.Privilege>1?"edit":"view")+" this folio."),s.prepend(o),$(".nav-main-menu a:eq(0)").click()}for(var o=null,i=$("#tmp-dashboard-content"),s=i.find("#folio-items-container"),r=$("#tmp-tranfer-item").html(),l=0;l<e.tansFolios.length;l++)a(e.tansFolios[l]);t.addListener("transferRequestArrived",a),t.addListener("collabRequestArrived",n)},app.dash.main=function(e,t,a,n,o,i){for(var s=this,r=e.labels,l=e.colors,c=app.plugin.lockedTip(e,t),d=0;d<r.length;d++)r[d].isLabel=!0,r[d].color=l[d%l.length];s.tabs(e),s.listRequests(e,t),s.folios(e,t,n,o,a,i),s.labels(e,a,n,o,t),s.createNewMenu(),s.filterBar(app.plugin.popupMenu,t),s.subOptionsMenu(),s.subOptionLabelMenu(e,n,o),s.templateLabels(e,n),s.templates(e,n,o,a,i),s.delFolio(a,o),s.archiveFolio(e,a,o),s.saveAsTemplate(e,a,o),s.unarchiveFolio(a,o,e),s.createFolio(e,s,a,o),s.copyFolio(s,a,o,t,e),s.rename(s,a,o),s.inlineRename(a,o),s.processRequests(a,o,t,e),s.transferFolio(e,o),s.renameLabel(s,e,n,a,t,o),s.delLabel(e,n,a,t,o),s.folioStats(e,o,i,c,t),s.filter(e,n,o),app.plugin.tooltip()},app.dash.processRequests=function(e,t,a,n){$("#folio-items-container").on("click",".request-btn",function(o){o.preventDefault(),t.busy();var i=$(this),s=i.hasClass("yes")?"accept":"reject",r=i.closest(".folio-item-shell");if(r.hasClass("collabRequest"))e.processCollaborator({data:{verb:s,id:r.data().Id},success:function(){r.remove(),t.close(),"accept"==s&&(e.getFolioByToken({token:r.data().token,success:function(e){var t=JSON.parse(e.Data);a.raiseEvent("collabreqaccpt",t,!0),$('#n-panel .item[data-token="'+r.data().token+'"]').find(".yes, .no").remove(),n.folios.push(t)},error:function(e){console.log("error",e)},complete:function(e){}}),$("#folio-items-container").find(".empty-shared, .empty").remove())},error:function(e){5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}});else{var l,c=r.data("item");l=n.UserTeams&&n.UserTeams.length>0&&c.TeamID>0?{verb:s,secret:r.data("code"),teamId:c.TeamID}:{verb:s,secret:r.data("code")},e.processTransfer({data:l,success:function(){window.location="/"},error:function(e){5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}})}})},app.dash.rename=function(e,t,a,n){$(".edit-link").each(function(){var t=$(this),a=t.text();t.data("name",a),e.setName(t,a)}),$(" #folio-items-container").on("click",".rename-folio-btn",function(){var e=$(this),n=e.data("token"),o=e.closest(".folio-item-shell").find("h4");return a.message({heading:"Rename Folio",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",emptyError:"Please provide a name for the folio",cancelText:"Cancel",input:o.text(),namespace:"rename-folio-popup",inputPlaceholder:"Enter name",handleOK:function(e){t.renameFolio({token:n,name:e,success:function(){o.text(e),a.close()},error:function(e){a.error(e.Message)}})}}),!1})},app.dash.renameLabel=function(e,t,a,n,o,i){var s=function(e,t,a){i.message({heading:"Rename Channel",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",cancelText:"Cancel",emptyError:"Please provide a name for the channel",namespace:"rename-label-popup",inputPlaceholder:"Enter name",input:e,handleOK:function(e){n.renameLabel({token:t.Token,name:e,success:function(){t.Name=e,o.raiseEvent("labelChange"),a(e),i.close()},error:function(e){i.error(e.Message)}})}})};$("#all-labels-container").on("click",".rename-btn",function(){var e=$(this),t=e.data("label"),a=e.closest(".item").find(".name");return s(a.text(),t,function(t){a.text(t),e.closest(".item").hasClass("active")&&$(".label-name").text(t)}),!1}),$(".label-details").on("click",".rename",function(){var e=$(this).closest(".label-details"),t=e.data("label"),a=e.find(".label-name");return s(t.Name,t,function(e){a.text(e),$("#all-labels-container").find(".item[data-name="+t.Token+"] .name").text(e),$(".labels-dropdown").find("option[value="+t.Token+"]").text(e)}),!1})},app.dash.saveAsTemplate=function(e,t,a){var n=$("#folio-items-container");n.on("click",".save-template-btn",function(){if($(this).hasClass("locked"))return void a.billing();var n=$(this).closest(".folio-item-shell"),o=n.data("token"),i=n.find("h4").text()+" - Template";return $("#dashboard-page > .loader").show(),t.saveAsTemplate({token:o,name:i,teamId:e.Team.Id,CopiedFromTemplate:!1,success:function(){window.location.hash="#mytemplates",setTimeout(function(){location.reload()},100)},error:function(e){$("#dashboard-page > .loader").hide(),a.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}}),!1})},app.dash.subOptionLabelMenu=function(e,t,a){$("#sidebar").on("click",".menu",function(e){e.preventDefault();var t=$(this);t.toggleClass("active"),t.hasClass("active")&&setTimeout(function(){$("body").on("click.labelMenuRemover",function(){t.removeClass("active"),$("body").off(".labelMenuRemover")})},100)}),$(".left-section").on("click",".share",function(){a.shareLink(t.obtain(e.labels,"Token",$(this).closest(".label-details").data("label").Token))})},app.dash.subOptionsMenu=function(){$("#folio-items-container , #templates-items-container").on("click",".menu",function(e){e.preventDefault(),$(".more-options .menu").not(this).removeClass("active");var t=$(this);t.toggleClass("active"),t.next(".settings-btns").children().on("click",function(){t.removeClass("active")}),$("body").off(".menuRemover"),t.hasClass("active")&&setTimeout(function(){$("body").on("click.menuRemover",function(){t.removeClass("active"),$("body").off(".menuRemover")})},100)})},app.dash.tabs=function(e){var t="hidden",a="colored-dashboard",n=$(".tab-content"),o=$(".nav-main-menu a");o.on("click",function(i){o.removeClass("active");var s=$(this).addClass("active").index();return n.addClass(t).filter(":eq("+s+")").removeClass(t),$("body").toggleClass(a,!$(this).hasClass("template")),e.userTemplates.length>0&&$("#tmp-my-labels-container .item:eq(0)").trigger("click"),!1}),$(".use-template").click(function(){o.filter(":eq(1)").trigger("click")}),$(".plus-menu .create-new").click(function(){$('div[data-template="blank"]').find(".cta-btn.primary").trigger("click")}),$("body").addClass(a)},app.dash.templateLabels=function(e,t){function a(e){u=$("#templates-items-container .as-template"),d.filter(u.filter("."+e))}function n(){var e=$(this),t=e.data("label");return s.find(".item").removeClass("active"),e.addClass("active"),$("#templates-items-container .state").hide(),m.find(".label-name").css({paddingLeft:"0"}),t&&"own"==t.Token&&(m.find(".label-color").hide(),$("#templates-items-container").find(".own").removeClass("hidden"),$("#templates-items-container").find(".own").length<1&&$("#templates-items-container .state").show()),t?(m.removeClass("normal"),m.find(".label-name").text(t.Name),m.find(".label-color").css("background-color",t.color),void a(t.Token)):(d.filter(".xtensio"),void m.addClass("normal").find(".label-name").text("Xtensio Templates"))}function o(e){var t=$(r).data("label",e);t.find(".name").text(e.Name||"Untitled"),t.find(".options").remove(),t.on("click",n).data("label",e),c.append(t),"xtensio"==e.Token&&t.find(".new").remove();var a=$("<option></option>");a.text(e.Name||"Untitled").val(e.Token),p.append(a)}var i=$(".folios-container.templates"),s=$("#tmp-temp-sidebar"),r=$("#single-label").html(),l=$("#tmp-labels-container"),c=$("#tmp-my-labels-container");t.sort(e.templatesLabels,"Name");var d,u,m=i.find(".label-details.temp"),p=i.find(".tmp-labels-dropdown");setTimeout(function(){d=mixitup(i,{animation:{duration:900},selectors:{target:".folio-item"},callbacks:{onMixStart:function(e,t){$("#dashboard-page > .loader").show()},onMixEnd:function(e){$("#dashboard-page > .loader").hide()}},debug:{enable:!0}})},1e3),$("#tmplt-sidebar").append(s);o(e.myLabel);for(var f=0;f<e.templatesLabels.length;f++){var h=e.templatesLabels[f],g=$(r).data("label",h);h.color=e.colors[f%e.colors.length],g.find(".label").css("background-color",h.color),g.find(".name").text(h.Name||"Untitled"),g.find(".options").remove(),g.on("click",n).data("label",h),l.append(g);var v=$("<option></option>");v.text(h.Name||"Untitled").val(h.Token),p.append(v)}$("#all-temps-button").on("click",n),p.on("change",function(){var n=$(this).val(),o=t.obtain(e.templatesLabels,"Token",n);return null===o?(d.filter("all"),void m.addClass("normal")):(a(o.Token),void m.removeClass("normal"))})},app.dash.templates=function(e,t,a,n,o){function i(a,n){$.each(n.Labels,function(n,o){var i=t.obtain(e.templatesLabels,"Token",o);if(i){var s=$('<div class="label"></div>').css("background-color",i.color).text(i.Name);s.data("token",i.Token),a.addClass(i.Token),a.find(".labels").prepend(s)}})}function s(e){return function(){return a.shareLink(e),!1}}function r(t){return function(){var o=($(this),t.Token),i="Untitled";return e.userName?n.duplicateFolio({token:o,name:i,success:function(e){window.location.assign("/edit/"+e.Message+"#new")},error:function(e){5==e.StatusCode?a.plusPrompt("create",null,!0):10==e.StatusCode&&a.plusPrompt("create",null,!1,!0)},complete:function(){},fToken:!0,teamId:e.Team.Id}):a.signUp(!0),!1}}function l(e){return function(){return a.folioStats(e.Token,e.FolioName,{isTemplate:!0,UsedCount:e.UsedCount}),!1}}function c(t){return function(){return window.location=e.baseUrl+"/edit/"+t.Token,!1}}function d(e){return function(){return a.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,handleOK:function(){n.deleteUserTemplate({token:e.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),window.location.reload()},error:function(e){$("#dashboard-page > .loader").hide(),a.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})},cancelText:"Cancel",handleNo:function(){a.close()}}),!1}}function u(t,a){$.each(a.Labels,function(a,n){var o=e.myLabel;if(o){var i=$('<div class="label"></div>').css("background-color",o.color).text(o.Name);i.data("token",o.Token),t.addClass(o.Token),t.find(".labels").prepend(i)}})}function m(t,a){for(var n=0;n<t.length;n++){var o=t[n],m=a?"false":"blank slate"==o.PublicName.toLowerCase();h=$(f),h.attr("data-template",o.TemplateName).attr("data-name",o.PublicName||o.FolioName).attr("data-used",o.UsedCount).attr("data-date",o.CreatedDate),a?u(h,o):i(h,o),o.Thumbnail&&h.find(".img").removeClass("hidden").find("img").attr("src",o.Thumbnail),o.UsedCount&&!m&&h.find(".used").text("Used "+o.UsedCount+" times"),g=e.baseUrl+"/folio/"+o.FolioToken,h.find("h4").text(o.PublicName||o.FolioName),h.find(".preview, .link").attr("href",g),o.IsNew&&h.find(".new-label").removeClass("hidden"),m&&!a&&(h.find(".primary").addClass("red").text("Create New"),h.attr("data-used","9999999999").find(".preview").addClass("hidden")),h.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),a?(h.data("token",o.Token),h.data("folio",o),h.find(".link").attr("href",e.baseUrl+"/edit/"+o.Token),h.addClass("own"),h.find(".cta-buttons").remove(),h.find(".share-btn").click(s(o)),h.find(".use-template").click(r(o)),h.find(".edit-template").click(c(o)),h.find(".delete-folio").click(d(o)),h.find(".show-stats").click(l(o))):(h.find(".options").remove(),h.addClass("xtensio")),a?p.prepend(h):p.append(h)}}var p=($("#tmp-dashboard-content"),$("#templates-items-container")),f=$("#template-item").html(),h=($("#my-template-item").html(),null),g=null;m(e.templates,!1),setTimeout(function(){e.userTemplates.length>0?m(e.userTemplates,!0):o.getData(1,function(t,n,o,i){var s=$("#tmp-empty-state").html(),r=$(s),l=n&&10!=t.ST&&11!=t.ST||e.Team&&e.Team.Id>0;r.find("p.imp-folio").remove(),console.log("isTemp",l),l?(r.find("h2").html('You haven\'t saved any templates, yet. <a style="display: block;" href="https://xtensio.com/tips-tricks-saving-templates/" target="_blank">Learn how</a>'),r.find("button").remove()):(r.find("h2").text("You haven't saved any templates, yet."),r.find("p.tag").html('Save your folios as templates (requires <span style="font-family: Proxima-Bold, Helvetica, sans-serif;">Pro</span> or <span style="font-family: Proxima-Bold, Helvetica, sans-serif;">Business</span>).<br> Use privately or share with the world.'),r.find("button").html('Upgrade <span class="icon-Secure" style="vertical-align: middle;margin-left: 5px;"></span>').on("click",function(){a.billing()}),r.hide()),p.append(r)})},200),setTimeout(function(){app.plugin.tooltip(),e.Team&&0==e.Team.Id&&$(".tmp-sort.x-select").click(),$(".tmp-sort.x-select .item:eq(2)").click()},1500)},app.dash.transferFolio=function(e,t){$(" #folio-items-container").on("click",".transfer-folio-btn",function(a){return e.Team&&e.Team.Id>0?t.transferTeamFolio($(this).data("token")):t.transferFolio($(this).data("token")),!1})},app.dash.unarchiveFolio=function(e,t,a){$(".folios-container").on("click",".unarchive",function(){var e=$(this).closest(".folio-item-shell"),n=e.data("folio");return t.unarchive(n,function(){t.close(),n.Collaborators=Faltu(n.Collaborators).find({Email:a.userName}).get(),e.removeClass("archived").addClass("active").find(".edit").each(function(){$(this).attr("href",$(this).attr("href").replace("folio","edit"))}).eq(1).text("Edit Folio");var o=$("#folio-items-container");o.find(".state.empty").hide(),$("#folio-items-container").find(".collabRequest").length>0?o.find(".collabRequest").after(e):o.prepend(e),window.location.hash="active"}),!1})},app.managers.dragManager=function(e,t,a,n,o,i){var s,r,l=null,c=null,d=0,u=0,m=0,p=$("<div>"),f=$('<div style="background-color: gray;position: absolute; z-index: 9999999;">'),h=$('<div style="background-color: red;position: absolute; z-index: 99999;">'),g=$('<div style="position: absolute; height: 100%; z-index: 9999; left: 0; top: 0; width: 100%;">').hide(),v=$('<div style="position: absolute; z-index: 9990; left: 50%; top: 0; width: 1200px; margin-left: -600px;">'),b=$("#modules-edit-main").append(v).append(f).append(h),y=$("#modules-preview-main"),C=$('<div style="display: inline-block; background-color: #F5F6F7; border: 1px dotted #4a7aa2; margin: 12px 0;">&nbsp;</div>');t.append(g);var T=function(){var e,t,a,o,s,r;l&&(l.detach&&l.detach(),c&&"Canvas"!=l.Type?(c.dragEnd(l),r=l):(o=l.$editNode,s=l.$previewNode),l.$editNode.removeClass("active default-drag-bg-color").css({position:"",opacity:"",left:"",top:"","z-index":""}),o&&(t=C.closest(".edit-div").index(),p.append(s),C.before(o),e=o.index(),a=y.find('.preview-div:eq("'+t+'")'),a.find(".section-content").insertAt(e,s)),n.sync(l,"Pos",[e,t]),$("body").removeClass("disable-select"),i.saveLayout(),l=null,c=null,g.hide(),C.remove(),r&&r.resize&&r.resize())},w=function(e,t,a,n){var o=0;b.width()>1200&&(o=(b.width()-1200)/2),e.css({left:t.pageX-s-o,top:t.pageY-b.offset().top-r+14})};return e.on("touchmove mousemove",function(e){if(l){var t=Date.now();if(t-d<30)return;var a,n,s,r,p=e.pageX,f=e.pageY;d=t;var h=$(window).scrollTop();if(e.screenY>m+6&&e.clientY>window.innerHeight-140?($("html,body").animate({scrollTop:h+140},200),m=e.screenY):e.screenY<m-6&&e.clientY<140&&($("html,body").animate({scrollTop:h-140},200),m=e.screenY),w(l.$editNode,e),t-u<300)return;u=t,b.find(".edit-div").each(function(){if(n=$(this),a=n.offset(),a.bottom=a.top+n.height(),f>=a.top&&f<=a.bottom)return s=n.find("> .section-content > .module-container"),s.each(function(){if(r=$(this),a=r.offset(),a.right=a.left+r.width(),a.bottom=a.top+r.height(),p<a.right&&f<a.bottom)return l&&"Canvas"==l.Type||!o.isPointInRect(a,{x:p,y:f})||!r.hasClass("canvas-module-container")?(p<a.right-r.width()/3&&f<a.bottom-r.height()/2?r.before(C):r.after(C),c=null,!1):(c=i.getModule(r.data("key")),c.editObj.move(e),C.remove(),!1)}),s.filter(".canvas-module-container").each(function(){r=$(this);var e=i.getModule(r.data("key"));e!=c&&e.editObj.cancel()}),!1})}}),{end:T,add:function(e){var t=e.$editNode.find(".move");t.on("mousedown",function(t){var a=$(this).offset();s=t.pageX-a.left,r=t.pageY-a.top,$("body").addClass("disable-select");var n=e.$editNode;return n.addClass("active").css({position:"absolute",opacity:.6,"z-index":100}),e.Data.BgColor&&n.addClass("default-drag-bg-color"),l=e,C.css({height:n.height(),width:n.width()}),n.after(C),v.append(n),w(n,t),g.show(),!1})},move:function(e,t){if(null!==t[0]){var a,n,o,i,s,r;i=e.$editNode,s=e.$previewNode,i&&(a=t[0],n=t[1],p.append(s).append(i),o=y.find('.preview-div:eq("'+n+'")'),o.find(".section-content").insertAt(a,s),r=b.find('.edit-div:eq("'+n+'")'),r.find(".section-content").insertAt(a,i))}},remove:function(e){}}},app.managers.resizeManager=function(e,t){var a=null,n=null,o=!1,i=0,s="#modules-edit-main .grid-div",r=function(){null!==a&&(t.sync(a,"Cols",a.Data.Cols),a.$editNode.removeClass("re-sizing"),a=null,n=null,$("body").removeClass("disable-select re-sizing"))};return $(s).on("mouseenter","div",function(){if(null===a)r();else{var e=2,t=0,n=a,l=n.$editNode.position().left-n.$editNode.closest(".section-content").offset().left;l>0&&(t=Math.ceil(l/($(s).width()/(12/e))));var c=$(this).index()-t;if(c*=e,c!=i){var d=c-i;n.$editNode.removeClass("col-sm-"+n.Data.Cols),n.$previewNode.removeClass("col-sm-"+n.Data.Cols),o?(n.Data.Cols=Math.max(e,Math.min(12,n.Data.Cols-d)),i=c):c+e>0&&(n.Data.Cols=Math.max(e,Math.min(12,c+e)),i=c),n.$editNode.addClass("col-sm-"+n.Data.Cols),n.$previewNode.addClass("col-sm-"+n.Data.Cols),n.resize&&n.resize(n)}}}),{end:r,add:function(e){var t=$('<div class="resize-grip right"><div class="resize-rect"></div></div>');e.$editNode.prepend(t),t.on("mousedown touchstart",function(t){t.preventDefault(),i=e.Data.Cols-1,a=e,$("body").addClass("disable-select re-sizing"),a.$editNode.addClass("re-sizing"),o=!1}),t=$('<div class="resize-grip left"><div class="resize-rect"></div></div>'),e.$editNode.prepend(t),t.on("mousedown touchstart",function(t){t.preventDefault(),i=0,a=e,$("body").addClass("disable-select re-sizing"),
a.$editNode.addClass("re-sizing"),o=!0})},remove:function(e){e.$editNode.find(".resize-grip").remove()}}},app.modHelper.createLayoutData=function(e,t,a){var n=[],o=!0;$("#edit-sections .edit-div").each(function(i,s){var r=$(s),l={Order:i+1,Tag:r.data("Tag"),ModIds:[]};r.data("bgUrl")&&(l.BgUrl=r.data("bgUrl")),r.data("bgColor")&&(l.BgColor=r.data("bgColor")),r.find(".section-content > .module-container").each(function(n,i){var s=t.obtain(e.Modules,"Key",$(i).data("key"));if(s&&"EmptyModule"!=s.Type){if(!s.Tag)return o=!1,s.save(function(){app.modHelper.createLayoutData(e,t,a)}),!1;l.ModIds.push(s.Tag),s.editObj.saveMods&&s.editObj.saveMods()}}),n.push(l)}),o&&a(n)},app.modHelper.getGuiModules=function(e,t){for(var a=[],n=function(e){e&&$.each(e,function(e,t){t.Created=new Date(t.Created),t.Data=JSON.parse(t.Data)})},o=0;o<e.Modules.length;o++){var i=e.Modules[o];i.Key=i.Tag||t.uniqueId(),i.Data=JSON.parse(i.Data),i.lastSavedData=JSON.stringify(i.Data),n(i.Records),"DataModule"!=i.Type&&a.push(i)}return a},app.modHelper.sectionHelper=function(e,t,a,n,o,i,s,r,l,c,d,u,m){function p(){for(var e=l.Data.Sections,t=o.uniqueId(!0),n=0;n<e.length;n++)if(e[n].Tag==t||o.obtain(a.Modules,"Tag",t))return p();return t}var f=n.changeImage,h=n.setCallback,g=$("#edit-sections"),v=$("#modules-preview-main"),b=($("#modules-preview-header"),'<div class="preview-div clearfix"><div class="section-content clearfix"></div></div>'),y='<div class="edit-div clearfix"><div class="section-content clearfix"></div></div>',C=function(e){var t=$(b);return e.BgUrl&&t.css("backgroundImage","url("+e.BgUrl+")"),e.BgColor&&t.css("backgroundColor",e.BgColor),t},T=function(e,t){if("up"==e){var a=t.prev();a.length&&t.insertBefore(a)}else if("down"==e){var n=t.next();n.length&&t.insertAfter(n)}else"top"==e?t.parent().prepend(t):"bottom"==e&&t.parent().append(t)},w=function(t,l){function c(t){T(t,C),T(t,l),"move"==e.currentAction()&&$("html,body").animate({scrollTop:C.offset().top},400)}function d(e){var t=[];C.find(".module-container").each(function(e,n){var i=o.obtain(a.Modules,"Key",$(n).data("key"));if(i){var s=r[i.Type];t.push(i.ID),i.noDelete=!0,s.removeModule(i,1)}}),e||app.factory.apiHelper.deleteModules(t),C.remove(),l.remove()}function m(e){t.BgColor=e,t.BgUrl="",C.data("bgColor",e),C.data("bgUrl",""),C.css("backgroundColor",e),C.css("backgroundImage",""),l.css("backgroundColor",e),l.css("backgroundImage","")}function g(e){t.BgColor="",t.BgUrl=e;var a=C.data("bgUrl");f(a,e),C.data("bgUrl",e),C.data("bgColor",""),o.changeBg(s,C,e),l.css("backgroundImage","url("+e+")")}function v(){f(t.BgUrl,""),t.BgColor="",t.BgUrl="",C.data("bgUrl",""),C.data("bgColor",""),C.css("backgroundImage",""),C.css("backgroundColor",""),l.css("backgroundImage",""),l.css("backgroundColor","")}function b(){u.reg(t,"Sec_AddModule",function(t,a){e.addModule(a.Type,a,0,C.find(".section-content"),l.find(".section-content"))}),u.reg(t,"Sec_Move",function(e,t){c(t)}),u.reg(t,"Sec_Remove",function(){d(!0)}),u.reg(t,"Sec_Duplicate",function(a,n){t.newTag=n,e.duplicateSection(t,C,l)}),u.reg(t,"Sec_BgColor",function(e,t){m(t)}),u.reg(t,"Sec_BgURL",function(e,t){h(null),g(t)}),u.reg(t,"Sec_BgReset",v)}t.Tag=t.Tag||p();var C=$(y).data("Tag",t.Tag).data("bgUrl",t.BgUrl).data("bgColor",t.BgColor);t.BgUrl?(f("",t.BgUrl),C.css("backgroundImage","url("+t.BgUrl+")")):t.BgColor&&C.css("backgroundColor",t.BgColor),b();var w=n.sectionButtons(t,{addModule:function(){s.addModule(function(t,a){e.addModule(t,a,1,C.find(".section-content"),l.find(".section-content"))})},handleExport:function(){var t,n="",o=$("#home-page");s.exp(a,e.getExport(),{$el:l,target:"section",cb:function(a,s){t=i.isCurrent(i.pages.home),t||i.showPage(i.pages.home),o.css("width",a+"px"),setTimeout(function(){e.activatePreview();var a=$('<div><div class="container-fluid"><div class="row" id="modules-preview-main">'+$("<div>").append(l.clone()).html()+"</div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,t){n+="<style>"+t.innerHTML+"</style>"}),n+=a.html(),n+=$("#tmp-power-by-footer").get(0).outerHTML,s(n),o.css("width",""),t?e.activatePreview():i.showPage(i.pages.edit),e.saveData()},20)}})},move:function(a){e.currentAction("move"),c(a),u.sync(t,"Sec_Move",a),e.saveLayout()},del:function(a){a?(d(),u.sync(t,"Sec_Remove",""),setTimeout(e.saveLayout,1e3)):s.message({heading:"Delete section?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:function(){d(),u.sync(t,"Sec_Remove",""),setTimeout(e.saveLayout,1e3)}})},dup:function(){e.currentAction("dup");var a=e.duplicateSection(t,C,l);u.sync(t,"Sec_Duplicate",a.Tag),e.saveLayout()},bgColor:function(a){m(a),u.sync(t,"Sec_BgColor",a),e.saveLayout()},bgUrl:function(a){g(a),u.sync(t,"Sec_BgURL",a),e.saveLayout()},resetBg:function(){v(),u.sync(t,"Sec_BgReset",""),e.saveLayout()}});return C.prepend(w.$node),C};return{createSection:function(e){var t,a=e||{},n=C(a);return v.append(n),d&&(t=w(a,n),g.append(t)),[t,n]},init:function(){$.each(l.Data.Sections,function(a,n){if(!(1==t.IsMod&&n.ModIds.length<=0)){var i,s,l,u;for(u=C(n),v.append(u),d&&(l=w(n,u),g.append(l),l=l.find(".section-content")),u=u.find(".section-content"),a=0;a<n.ModIds.length;a++){var m=e.getModule(n.ModIds[a]);m&&m.Tag&&(s=o.obtain(c,"Tag",m.Tag),s&&(i=r[s.Type],i.initModule(s,1,u,l)))}e.addModule("EmptyModule")}})}}},app.managers.main=function(e,t,a,n,o){var i,s,r=this;return i=r.getModManager(e,t,a,n,o),s=r.getRddm(e,t,a,i),{modManager:i,rddm:s}},app.managers.getModManager=function(e,t,a,n,o){function i(e){Date.now()-1e3<=f||b.createLayoutData(t,y,function(e){k.Data.Sections=e,f=Date.now(),k.save()})}function s(e){var a=[];$.each(t.Modules,function(e,t){"EmptyModule"!=t.Type&&a.push({Tag:t.Tag||0,ModType:t.Type,ModId:t.ID||0,Data:JSON.stringify(t.Data)})}),T.saveFolioSnapShot({data:JSON.stringify(a),success:function(t){"Success"==t.Status&&e()},error:function(e){console.log("error",e)}})}function r(){var e=t;$.each(e.Collaborators,function(t,a){T.changeCollaborator({data:{verb:"drop",role:a.Privilege,token:e.Token,email:a.Email},success:function(e){console.log(e.Message),window.location="/"},error:function(e){5==e.StatusCode&&o.error(e.Message)}})})}function l(){return Math.max.apply(null,v)}function c(){T.getTagStore({success:function(e){"Success"==e.Status&&(v=e.Data.TagStore)}})}function d(e){e=parseInt(e)||l();var a=e+1,n=a<l()||y.obtain(t.Modules,"Tag",a)||y.obtain(k.Data.Sections,"Tag",a);return n?d(a):(clearTimeout(h),h=setTimeout(c,1e4),v.push(a),parseInt(a))}function u(e,a,n,o,i,s){var r,l,c=g[e];r=a?$.extend(a,{Key:y.uniqueId()}):{Key:y.uniqueId(),Type:e,Data:{Type:e}},s&&(r.ID=s.ID,r.Tag=s.Tag),t.Modules.push(r);var d="Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e,u="Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e;return d&&(r.Data.Head=1),u&&(r.Data.Titlehide=1),"Scale"==e&&(r.Data.Header="Scale Chart"),"Bar"==e&&(r.Data.Header="Bar Graph"),"DonutChart"==e&&(r.Data.Header="Pie Chart"),"DataCollection"==e&&(r.Data.Header="This is a form field to collect emails."),o||($("#modules-preview-main .preview-div:last-child").find(".section-content").length||p.createSection(),o=$("#edit-sections .edit-div:last-child").find(".section-content"),i=$("#modules-preview-main .preview-div:last-child").find(".section-content")),c.initModule(r,a,i,o,l,u),n&&r.bringInView(),r}function m(e,t){C.sync({Tag:t||e.$editNode.closest(".edit-div").data("Tag")},"Sec_AddModule",{Syncd:!0,Tag:e.Tag,Type:e.Type,Data:e.Data})}var p,f,h,g={},v=t.TagStore,b=app.modHelper,y=a.utility,C=a.appHub,T=a.apiHelper,w=a.eventManager,x=a.pageManager,k=y.obtain(t.Modules,"Type","DataModule"),D=b.getGuiModules(t,y);return w.addListener("beforeunload",s),w.addListener("removeCollabs",r),p={getNewTag:d,removeMod:function(e){return y.removeFromList(t.Modules,y.obtain(t.Modules,"Tag",e.Tag))},currentAction:function(){var e,t=Date.now();return function(a){return a&&(e=a,t=Date.now()),e&&Date.now()-t<=3e3?e:""}}(),getModule:function(e){return y.obtain(t.Modules,"Tag",e,"Key","ID")},getFactory:function(e){return g[e.Type]},registerFactory:function(e){if(!e.type||g[e.type])throw console.log(e),{name:e.type+" is invalid."};g[e.type]=e},addModule:function(e,a,n,o,s,r){if("Canvas"==e&&a&&a.Data.Mods){$.each(a.Data.Mods,function(e,n){var o=d(),i={Key:o,Tag:o,Type:n.Type,Data:$.extend(!0,{},n.Data)};n.Tag=o,i.Syncd=a.Syncd,t.Modules.push(i)});var l=a.Tag;v.indexOf(l)<0?v.push(l):l=d(),a.Tag=l}var c=u(e,a,"EmptyModule"!=e&&void 0==n?1:n,o,s,r);return"EmptyModule"!=e&&(c.Syncd||c.CanvasMod?c.Tag=c.Tag:(c.Tag=l||d(),v.indexOf(c.Tag)<0&&v.push(c.Tag),c.factory.renderPreview(c),m(c)),c.factory.renderPreview(c),c.save(i)),c},copyModule:function(e,a){var n=(g[e.Type],$.extend(!0,{},e.Data)),o=d(e.Tag),s={Key:o,Tag:o,Type:e.Type,Data:n};return t.Modules.push(s),"Canvas"==e.Type&&$.each(n.Mods,function(e,a){var n=d(a.Tag),o=p.getModule(a.Tag);if(o){var i={Key:n,Tag:n,Type:o.Type,Data:$.extend(!0,{},o.Data)};a.Tag=n,t.Modules.push(i),C.saveMod(i)}}),a&&a(s),C.saveMod(s,i),s},duplicateModule:function(e){console.log("dubplicate",e);var t=g[e.Type],a=e.$editNode.closest(".section-content"),n=e.$previewNode.closest(".section-content"),o=p.copyModule(e,function(i){var s=o||i;t.initModule(s,0,n,a,e),t.renderPreview(s),"dup"==p.currentAction()&&s.bringInView()});return o},getExport:function(){return k.Data.Exports||(k.Data.Exports={}),k.Data.Exports},getDonutData:function(){return k.Data.Donut||(k.Data.Donut={showError:!0}),k.Data.Donut},saveData:function(e){k.save()},saveLayout:i,activatePreview:function(t){if(t&&t.modId){var a=p.getModule(t.modId);a.factory.renderPreview(a)}else $.each(k.Data.Sections,function(t,a){$.each(a.ModIds,function(t,a){var n=p.getModule(a);n&&"Videos"==n.Type?e.editMode||n.factory.renderPreview(n):n.factory.renderPreview(n)})})},duplicateSection:function(e,a,n){e=$.extend(!0,{},e),e.Tag=e.newTag,delete e.newTag;var o=p.createSection(e),i=o[0].find(".section-content"),s=o[1].find(".section-content");return p.addModule("EmptyModule"),a.find(".section-content > .module-container").each(function(e,a){var n,o,r=y.obtain(t.Modules,"Key",$(a).data("key"));r&&"EmptyModule"!=r.Type&&(o=g[r.Type],n=p.copyModule(r),o.initModule(n,0,s,i))}),a.after(o[0]),n.after(o[1]),"dup"==p.currentAction()&&$("html,body").animate({scrollTop:i.offset().top},400),e}},k.save=function(e){C.saveMod(k,e)},p=$.extend(p,b.sectionHelper(p,e,t,n,y,x,o,g,k,D,e.editMode,C,T))},app.managers.getRddm=function(e,t,a,n){var o=a.appHub,i=a.utility,s={},r=$(document),l=$("body"),c=app.managers.resizeManager(r,o),d=app.managers.dragManager(r,l,s,o,i,n);return r.on("touchend mouseup touchcancel mouseleave",function(){c.end(),d.end()}),{addModule:function(e){s[e.Key]=e,e.noResize||c.add(e),e.noDrag||(d.add(e),o.reg(e,"Pos",function(t,a){d.move(e,a)}))},removeModule:function(e){c.remove(e),d.remove(e),delete s[e.Key]},dragManager:d}},app.factory.bgColor=function(e,t,a){e.$editNode&&e.$editNode.css("backgroundImage",""),e.$previewNode.css("backgroundImage",""),delete e.Data.BgUrl,e.$editNode&&e.$editNode.css("backgroundColor",t),e.$previewNode.css("backgroundColor",t),e.Data.BgColor=t,a||this.appHub.sync(e,"BgColor",t)},app.factory.bgUrl=function(e,t,a){var n=this;e.$editNode&&n.utility.changeBg(n.popup,e.$editNode,t),e.$previewNode.css("backgroundImage","url("+t+")"),n.changeImage(e.Data.BgUrl,t),delete e.Data.BgColor,e.Data.BgUrl=t,a||n.appHub.sync(e,"BgUrl",t)},app.factory.resetBg=function(e,t){var a=this;delete e.Data.BgColor,delete e.Data.BgUrl,"Canvas"==e.Type?(e.$editNode&&e.$editNode.css("backgroundColor","rgba(0,0,0,0)"),e.$previewNode.css("backgroundColor","rgba(0,0,0,0)"),e.Data.BgColor="rgba(0,0,0,0)"):(e.$editNode&&e.$editNode.css("backgroundColor",""),e.$previewNode.css("backgroundColor","")),e.$editNode&&e.$editNode.css("backgroundImage",""),e.$previewNode.css("backgroundImage",""),t||a.appHub.sync(e,"ResetBg","")},app.factory.createStyle=function(e,t,a,n){var o="",i="#ed-"+e+" ",s=",#pr-"+e+" ",r=n||["h1","h2","h3","h4",".title > *:not(.fr-wrapper):first-child",".title .fr-view > *:first-child"],l="<style id=style"+e+' type="text/css" class="module-style">';t&&($.each(r,function(e,t){o+=i+t,o+=s+t+","}),o=o.slice(0,-1),o+="{ color: "+t+";}"),o+=i+s+"{ border-color:"+t+";border-style:solid;border-width:0;}",$.each(a,function(e,t){$.each(t.selectors,function(e,t){o+=i+t,o+=s+t+","}),o=o.slice(0,-1),o+="{"+t.prop+":"+t.value+";}"}),l+=o+"</style>",$("head #style"+e).remove(),$("#folio-style").before(l);var c,d=$("#folio-style").text().split("}"),u=d.length,m="<style id=stylefs"+e+' type="text/css" class="module-style">';for(c=0;c<u;c++)if(d[c].length){d[c]=$.trim(d[c])+"}";var p="#ed-"+e+d[c].replace(/,(\s)*./g,",#ed-"+e+"."),f="#ed-"+e+" "+d[c].replace(/,(\s)*./g,",#ed-"+e+"."),h="#pr-"+e+d[c].replace(/,(\s)*./g,",#pr-"+e+"."),g="#pr-"+e+" "+d[c].replace(/,(\s)*./g,",#pr-"+e+".");m+=p+f+h+g}m+="</style>",$("head #stylefs"+e).remove(),$("#folio-style").before(m)},app.factory.createDOMNodes=function(e,t,a,n){var o,i,s='<div class="header-container"><div class="header fr-view"></div></div>',r=e.Data,l=this,c=e.previewObj,d=e.editObj,u=e.Data.Theme||"#4C7BA0",m="module-container col-xs-12 col-sm-"+r.Cols+" "+(r.CssClass||r.FormatClass||"");e.containerClassName&&(m+=" "+e.containerClassName),o=e.$previewNode=$('<div id="pr-'+e.Key+'"></div>'),o.addClass(m),r.BgColor&&o.css("backgroundColor",r.BgColor),r.BgUrl&&o.css("backgroundImage","url("+r.BgUrl+")"),n?o.insertAfter(n.$previewNode):t&&t.append(o),o.append(c.$node),"EmptyModule"!=e.Type&&c.$node.prepend(s),c.mount&&c.mount(),l.config.editMode&&(i=e.$editNode=$('<div data-key="'+e.Key+'" id="ed-'+e.Key+'"></div>'),i.append('<div class="others"></div>'),i.css({borderWidth:1==r.Border?"1px":"0"}),i.addClass(m),r.BgColor&&i.css("backgroundColor",r.BgColor),r.BgUrl&&(i.css("backgroundImage","url("+r.BgUrl+")"),l.changeImage("",r.BgUrl)),n?i.insertAfter(n.$editNode):a&&a.append(i),"EmptyModule"!=e.Type&&d.$node.prepend(s),i.append(l.menu.modButtons(l,e,d).$node),i.append(d.$node),d.$node.find("> .header-container").css({display:1==r.Head?"":"none"}).find(".header").editor(e,r,"Header",{allowEnter:!0,cleanPTags:!0}),l.rddm.addModule(e),d.mount&&d.mount(),e.Data.Titlehide&&e.$editNode.addClass("remove-title")),e.Data.Titlehide&&e.$previewNode.addClass("remove-title"),e.applyStyle&&(e.applyStyle(u),e.editObj&&e.editObj.applyStyle&&e.editObj.applyStyle(u))},app.factory.handleExport=function(e,t){var a=this;e.$editNode.addClass("keep-open");var n,o="",i="modules-preview-main",s=$("#home-page");e.Data.Exports||(e.Data.Exports={}),a.popup.exp(a.folio,e.Data.Exports,{$el:e.$previewNode,isMod:!0,target:"module",cb:function(t,r){n=a.pageManager.isCurrent(a.pageManager.pages.home),n||a.pageManager.showPage(a.pageManager.pages.home),s.css("width",t+"px"),setTimeout(function(){a.modManager.activatePreview();var t=$('<div><div class="container-fluid"><div class="row" id="'+i+'"><div class="preview-div clearfix"><div class="section-content clearfix">'+$("<div>").append(e.$previewNode.clone()).html()+"</div></div></div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,t){o+="<style>"+t.innerHTML+"</style>"}),o+=t.html(),o+=$("#tmp-power-by-footer").get(0).outerHTML,r(o),s.css("width",""),n?a.modManager.activatePreview():a.pageManager.showPage(a.pageManager.pages.edit),e.save(),e.$editNode.removeClass("keep-open")},200)}})},app.factory.fixData=function(e){var t=this;$.each(e,function(e,a){$.each(a,function(e,n){"Items"==e?t.fixData(n):a[e]=t.$div.html(n).html()})})},app.factory.initModule=function(e,t,a,n,o,i){var s=this,r=e.Data;t&&$.each(r,function(e,t){t&&("Items"==e?s.fixData(t):r[e]=s.decoder&&s.decoder(s.$div,e,t)||t)}),e.factory=s,r.Cols=r.Cols||s.cols,e.save=function(t){s.appHub.saveMod(e,t)},s.setupModule&&s.setupModule(e),e.previewObj=s.getPreview(e),s.config.editMode&&(e.editObj=s.getEdit(e),e.listEditors=function(){var t,a=s.config.currentlyEditing,n=e.$editNode.find(".others");n.empty();for(var o in a)if(t=a[o],t.active&&t.module.Tag==e.Tag){$('.module-container .user[data-email="'+o+'"]').remove();var i=$('<span class="user" data-email="'+o+'" data-tip="'+t.name+'">'+app.core.utility().getInitials(t.name)+"</span>");n.append(i)}}),s.createDOMNodes(e,a,n,o),s.modules[e.Key]=e,e.showSpinner=function(){e.$editNode.prepend($("#spinner-container > .loading-animation").clone())},e.hideSpinner=function(){e.$editNode.find(".loading-animation").remove()},e.bringInView=function(){var t=$("#ed-"+e.Key),a=$("#pr-"+e.Key),n=t.length>0?t:a,o=n.offset();n.addClass("active"),o&&$("html,body").animate({scrollTop:o.top-100},600,function(){setTimeout(function(){n.removeClass("active")},2e3)})}},app.factory.main=function(e,t,a,n,o,i,s){var r=this;r.config=e,r.folio=t,r.$div=$("<div>"),r.$store=$("<div>"),r.$modItemsDiv=$("#module-items"),r.apiHelper=a.apiHelper,r.appHub=a.appHub,r.eventManager=a.eventManager,r.pageManager=a.pageManager,r.store=a.store,r.utility=a.utility,r.modStore=a.modStore,r.menu=n,r.modManager=i,r.popup=o,r.rddm=s,r.changeImage=n.changeImage,r.editBase=app.mods.getEditBase(e,a.appHub,a.eventManager),r.renderPreview=function(e){var t=e.Data,a=t.Theme||"#4C7BA0";e.$previewNode.css({border:1==t.Border?"1px solid "+a:""}),e.$previewNode.find("> .module .header-container").css({display:1==t.Head?"":"none"}).find(".header").html(t.Header),e.renderPreview()};var l=function(e){var t=$.extend({},r,{modules:{},type:e.type,options:e,cols:e.cols||12});return i.registerFactory(t),t},c=app.mods;c.dataCollectionFactory(l),c.textFactory(l),c.donutFactory(e,l),c.canvasFactory(l),c.rowBreakFactory(l),c.plainHtmlFactory(l),c.emptyModuleFactory(l),c.imagesFactory(l),c.videosFactory(l,i,o),c.barFactory(l),c.scaleFactory(l),c.tagFactory(l),c.socialFactory(l),i.init()},app.factory.shareModule=function(e,t){var a=this;a.popup.shareLink(e,[t.ID],t.Type)},app.factory.removeModule=function(e,t,a){var n=this,o=function(){if(n.rddm.removeModule(e),n.menu.detach(),e.$editNode.remove(),e.$previewNode.remove(),n.modManager.removeMod(e),e.noDelete||n.apiHelper.deleteModule(e),"Canvas"==e.Type){var t=[];$.each(e.Data.Mods,function(e,a){var o=n.modManager.getModule(a.Tag);o&&(t.push(o.ID),n.modManager.removeMod(o))}),n.apiHelper.deleteModules(t)}delete n.modules[e.Key],n.modManager.saveLayout(),a&&a()};if(t)o();else{var i="Canvas"==e.Type?"canvas":"module";n.popup.message({heading:"Delete "+i+"?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:o})}},app.mods.barFactory=function(e){var t={type:"Bar",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Head=t.Head||2,t.Txt=t.Txt||1,t.Title=t.Title||"<p>Bar Graph</p>",t.Items=t.Items||[{Name:"<p>Bar 1</p>",Val:50},{Name:"<p>Bar 2</p>",Val:75},{Name:"<p>Bar 3</p>",Val:25}],e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".slider-bar"]},{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.barPreview(a),a.config.editMode&&(a.getEdit=app.mods.barEdit(a,app.mods.sliderBaseFunc(a.appHub,"width")))},app.mods.canvasFactory=function(e){function t(e,a){var i=e.Data,s=1,r=[];$.each(i.Mods,function(a,i){var l=n.modManager.getModule(i.Tag);return l.Tag?(r.indexOf(l.Tag)<0&&r.push(l.Tag),i.Tag=l.Tag,void l.save()):(clearTimeout(o),o=setTimeout(function(){t(e)},1e3),s=0,!1)}),s&&r.length==i.Mods.length&&n.appHub.saveMod(e,function(){a&&a(),e.saved&&e.saved()})}var a={type:"Canvas",cols:12},n=e(a),o=(n.utility,Date.now(),null);n.decoder=function(e,t,a){return a},n.include=function(e,a,o){var i=e.Data;o||(e.editObj.saveMods(),t(e)),a.detach=function(){a.Data.Theme=i.Theme,a.editObj.applyStyle&&(a.editObj.applyStyle(i.Theme),n.appHub.sync(a,"Theme",i.Theme));var t=n.utility.obtain(i.Mods,"Tag",a.Tag||a.Key);t&&(n.utility.removeFromList(i.Mods,t),a.detach=null,a.clone=null,n.appHub.sync(e,"Mods",i.Mods))},a.clone=function(){e.editObj.clone(a)}},n.setupModule=function(e){function a(a){e.editObj.saveMods(),t(e,a)}var o=e.Data;e.noResize=!0,e.containerClassName="canvas-module-container",o.Header=o.Header||"Title",o.Theme=o.Theme||"#4C7BA0",o.BgColor=o.BgColor||"#FFF",o.Mods=o.Mods||[],o.Arr=o.Arr||[4,4,4],o.Head=o.Head||2,o.Border=o.Border||2;var i=function(t){t.Sync=!e.New,n.modManager.addModule(t.Type,t,!1)};$.each(o.Mods,function(t,a){var o=n.modManager.getModule(a.Tag);if(o){var s=n.modManager.getFactory(o);s&&(s.initModule(o,1),n.include(e,o,!0))}else a.Module&&i(a.Module)}),e.save=a,e.applyStyle=function(t){n.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".canvas-module > .header-container"]},{prop:"background-color",value:t,selectors:[".canvas-module  .quote"]},{prop:"color",value:t,selectors:[".text-module .name"]},{prop:"margin",value:"0 auto",selectors:[""]}],[".nope"])},n.editBase(e,{})},n.getPreview=app.mods.canvasPreview(n),n.config.editMode&&(n.getEdit=app.mods.canvasEdit(n))},app.mods.dataCollectionFactory=function(e){var t={type:"DataCollection",cols:12},a=e(t);a.decoder=function(e,t,a){return"ButtonText"==t?e.html(a).text():a},a.setupModule=function(e){e.Data.ButtonText=e.Data.ButtonText||"Join Us!",e.Data.Message=e.Data.Message||"<h3>Give them a good reason.</h3>",e.applyStyle=function(t){a.createStyle(e.Key,0,[{prop:"background-color",value:t,selectors:[".module-info-inner",".dc-join-us"]},{prop:"background-color",value:d3.rgb(t).darker(.2).toString(),selectors:[".module-info-inner:hover",".dc-join-us:hover"]},{prop:"color",value:t,selectors:[".header"]}])}},a.getPreview=app.mods.dataCollectionPreview(a),a.config.editMode&&(a.getEdit=app.mods.dataCollectionEdit(a))},app.mods.donutFactory=function(e,t){var a={type:"DonutChart",cols:8},n=$("<div>"),o=t(a);o.createColorFunc=function(e,t){var a=d3.rgb(t).brighter(3.7).toString();if(a.length<7)for(var n=7-a.length,o=0;o<n;o++)a=a.replace("#","#0");var i={colorStart:t,colorEnd:a},s=d3.interpolateRgb(i.colorStart,i.colorEnd);return function(t){var a=t/e;return s(a)}},o.decoder=function(e,t,a){return a};var i=app.mods.donutBaseFunc(e,o);o.setupModule=function(e){var t,a=e.Data;if(e.breakup=[],a.Title=a.Title||"<p>Pie Chart</p>",a.Label=a.Label||"<h2>Click to edit label</h2>",a.Theme=a.Theme||"",!a.Items)for(a.Items=[],t=1;t<=5;t++)a.Items.push({Val:"<p>20% &nbsp;Segment "+t+"</p>"});$.each(a.Items,function(t,a){var o=parseInt(n.html($.trim(a.Val)).text());isNaN(o)||e.breakup.push(o)}),e.applyStyle=function(t){e.colorFunc=o.createColorFunc(a.Items.length,t),o.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header",".donut-label"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},o.getPreview=app.mods.donutPreview(o,i),o.config.editMode&&(o.getEdit=app.mods.donutEdit(o,i))},app.mods.emptyModuleFactory=function(e){var t={type:"EmptyModule",cols:12},a=e(t);a.setupModule=function(e){e.noResize=!0,e.noDrag=!0,e.Data.Cols=12,e.containerClassName="empty-module-container"},a.getPreview=function(e){return e.renderPreview=function(){},{$node:$('<div class="module empty-module"></div>')}},a.config.editMode&&(a.getEdit=function(e){var t=$('<button class="btn add-btn blue-btn">+ Add</button>');return t.on("click",function(){t.closest(".edit-div").find(".add-mod-btn").trigger("click")}),{$node:$('<div class="module empty-module"><p>No modules added yet.</p></div>').append(t)}})},app.mods.imagesFactory=function(e){var t={type:"Images",cols:2},a=e(t),n="/img/fakecrow-logo-lgrey.png";a.defImg=n,a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Html=t.Html||"Images",t.Items=t.Items||[{Url:n,Val:100}],t.Head=t.Head||2,t.Txt=t.Txt||2,e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.imagesPreview(a),a.config.editMode&&(a.getEdit=app.mods.imagesEdit(a))},app.mods.plainHtmlFactory=function(e){var t=$("#tmp-edit-plainhtml").html(),a=$("#tmp-prev-plainhtml").html(),n={type:"PlainHtml",cols:6},o=e(n);o.setupModule=function(e){e.Data.Html=e.Data.Html||"<p>Write your HTML and style it anyway you want!</p><p>You can also use Twitter Bootstrap classes to style your HTML!</p>"},o.getPreview=function(e){var t=$(a),n=t.find(".content-box");return e.renderPreview=function(){n.html(e.Data.Html)},{$node:t}},o.config.editMode&&(o.getEdit=function(e){var a=$(t),n=a.find(".text-area"),o="normal",i=Date.now(),s=a.find(".edit-btn");return n.val(e.Data.Html),n.on("keydown",function(){var t=Date.now();t-i>8e3&&(e.Data.Html=n.val(),e.save(),i=t)}),n.on("blur",function(){e.Data.Html=$(this).val(),o="normal",a.removeClass("edit").addClass("normal"),e.save()}),s.on("click",function(){o="edit",a.removeClass("normal").addClass("edit"),n.focus()}),{$node:a}})},app.mods.rowBreakFactory=function(e){var t=$("#tmp-edit-row-break").html(),a=$("#tmp-prev-row-break").html(),n={type:"RowBreak",cols:12},o=e(n);o.setupModule=function(e){e.noResize=!0,e.Data.Cols=12,e.containerClassName="row-break-module"},o.getPreview=function(e){return e.renderPreview=function(){},{$node:$(a)}},o.config.editMode&&(o.getEdit=function(e){var a=$(t);return o.editBase(e,{}),{$node:a}})},app.mods.scaleFactory=function(e){var t={type:"Scale",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Head=t.Head||2,t.Txt=t.Txt||1,t.Title=t.Title||"<p>Scale Chart</p>",t.Items=t.Items||[{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:30},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:70},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50}],e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".slider-bar"]},{prop:"color",value:t,selectors:[".header-container .header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.scalePreview(a),a.config.editMode&&(a.getEdit=app.mods.scaleEdit(a,app.mods.sliderBaseFunc(a.appHub,"left")))},app.mods.socialFactory=function(e){var t={type:"Social",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Align=t.Align||"center",e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.socialPreview(a),a.config.editMode&&(a.getEdit=app.mods.socialEdit(a))},app.mods.tagFactory=function(e){var t={type:"Tag",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Items=t.Items||[{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"}],e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".tag-inner"]},{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.tagPreview(a),a.config.editMode&&(a.getEdit=app.mods.tagEdit(a))},app.mods.textFactory=function(e){var t=$("#tmp-edit-text").html(),a=$("#tmp-prev-text").html(),n={type:"Text",cols:4},o=e(n);o.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Theme=t.Theme||"#000",t.Html=t.Html||"<h2>Text Module</h2><h4>Point. Click. Type.</h4><p>This is a pretty straightforward text editor. You can even place images, videos, tables, and links.</p>",e.applyStyle=function(t){o.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},o.getPreview=function(e){var t=e.Data,n=$(a),o=n.find(".text-content");return e.renderPreview=function(){o.html(t.Html).css("text-align",t.Align)},{$node:n}},o.config.editMode&&(o.getEdit=function(e){var a=e.Data,n=$(t).css("text-align",a.Align),i=n.find(".editor");return o.editBase(e,{}),i.editor(e,a,"Html",{allowEnter:!0}),{changeTheme:function(){i.unstyle()},align:function(){n.css("text-align",a.Align)},$node:n}})},app.mods.videosFactory=function(e,t,a){var n={type:"Videos",cols:2},o=e(n),i="/img/fakecrow-logo-lgrey.png";o.defImg=i,o.decoder=function(e,t,a){return a},o.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Html=t.Html||"Videos",t.Items=t.Items||[{Url:i,Val:100}],t.Head=t.Head||2,t.Txt=t.Txt||2,t.VideoUrl=t.VideoUrl||"",t.VideoUrl,e.applyStyle=function(t){o.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}};var s=function(e){for(var t,a=$.FE.VIDEO_PROVIDERS,n=0;n<a.length;n++)if(a[n].test_regex.lastIndex=0,a[n].test_regex.test(e)){var o=a[n].url_text;a[n].url_regex.lastIndex=0;var i=a[n].url_regex.exec(e)[1];o=o.replace("$1",i),t=a[n].html.replace("{url}",o)}return t};o.getPreview=app.mods.videosPreview(o,s),o.config.editMode&&(o.getEdit=app.mods.videosEdit(o,s,t,a))},app.mods.donutBaseFunc=function(e,t){return{pie:app.charts.pie(),mount:function(){var e=this;t.eventManager.addListener("resize",function(){e.drawPie()})},updateLabel:function(){var e=this,t=e.$pieDiv.height()/2||e.getVal(e.$pieDiv,0)/2;if(t){var a=e.$pieDiv.closest(".donut-module").find(".donut-label");a.css("font-size",Math.max(12,t/2)+"%"),e.stack||(t=Math.max(t,e.$breakup.height()/2)),a.css({top:t-a.height()/2})}},drawChart:function(e){e.pie.draw({$el:e.$pieDiv,items:e.module.breakup,colorFunc:e.module.colorFunc}),e.updateLabel()},getVal:function(e,t){var a,n=e.height();return e.parents(".module-container").hasClass("col-sm-2")?(n=n||170,a=!0):e.parents(".module-container").hasClass("col-sm-4")?(n=n||170,a=!1):e.parents(".module-container").hasClass("col-sm-6")?(n=n||270,a=!1):e.parents(".module-container").hasClass("col-sm-8")?(n=n||370,a=!1):e.parents(".module-container").hasClass("col-sm-10")?(n=n||390,a=!1):e.parents(".module-container").hasClass("col-sm-12")&&(n=n||390,a=!1),0==t?n:1==t?a:2==t?n:void 0},drawPie:function(){var e,a,n=this,o=n.$pieDiv.parent(),i=n.$breakup.parent(),s=n.parentPage==t.pageManager.pages.edit?".edit-content":".module";if(n.stack=n.$pieDiv.closest(s).width()<400,e=n.$pieDiv.height(),a=n.$breakup.height(),a=a||200,n.stack=n.$pieDiv.closest(s).width()<400,n.$pieDiv.parents(".module-container").hasClass("col-sm-2")?(e=e||170,n.stack=!0):n.$pieDiv.parents(".module-container").hasClass("col-sm-4")?(e=e||170,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-6")?(e=e||270,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-8")?(e=e||370,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-10")?(e=e||390,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-12")&&(e=e||390,n.stack=!1),0!=n.$pieDiv.width(),n.stack)o.add(i).css({width:"100%","max-width":"100%"}),i.css({"padding-left":"10px"}),n.$pieDiv.add(n.$breakup).css("margin-top",""),n.drawChart(n);else{o.add(i).css({width:"","max-width":"","padding-left":""}),n.drawChart(n);var r=e/2,l=0,c=n.$pieDiv.closest(".donut-module").find(".donut-label");if(r){n.stack||(r=Math.max(r,a/2));var d=n.$breakup.find(".breakup-row").length,u=n.$breakup.find(".breakup-row").height()||40,m=0;d%2?m=(d-1)*u/2:(m=d*u/2,m=(d-1)*u/2),l=r-c.height()/2-m-3}}}}},app.mods.getEditBase=function(e,t,a){return function(n,o){function i(){n.factory.renderPreview(n),n.factory.folio.Role<2&&n.save()}var s=n.Data;o.align&&t.reg(n,"Align",function(e,t){s.Align=t,n.menuCb("Align"),o.align(),i()}),t.reg(n,"Cols",function(e,t){var a=s.Cols;s.Cols=t,n.$editNode.removeClass("col-sm-"+a).addClass("col-sm-"+t),n.$previewNode.removeClass("col-sm-"+a).addClass("col-sm-"+t),"DonutChart"==n.Type&&n.factory.eventManager.raiseEvent("resize")}),t.reg(n,"Head",function(e,t){s.Head=t,n.menuCb("Head"),i()}),o.txt&&t.reg(n,"Txt",function(e,t){s.Txt=t,n.menuCb("Txt"),o.txt()}),t.reg(n,"Theme",function(e,t){s.Theme=t,n.menuCb("Theme"),o.theme&&o.theme(),i()}),o.itemVal&&t.reg(n,"Items",function(e,t){s.Items.length==t.length?$.each(t,function(e,t){s.Items[e].Val=t.Val,s.Items[e].Url=t.Url,console.log(n),"Videos"==n.Type?(s.Items[e]=t,
o.itemVal(e,t)):o.itemVal(e,t.Val,t.Url)}):(o.$items.empty(),s.Items=t,$.each(t,o.addItem)),i()}),t.reg(n,"BgColor",function(e,t){s.BgColor=t,n.menuCb("BgColor")}),t.reg(n,"BgUrl",function(e,t){s.BgUrl=t,n.menuCb("BgUrl")}),t.reg(n,"ResetBg",function(e,t){n.menuCb("ResetBg")}),t.reg(n,"Border",function(e,t){s.Border=t,n.menuCb("Border"),i()}),t.reg(n,"DuplicateModule",function(e,t){n.menuCb("DuplicateModule")}),t.reg(n,"RemoveModule",function(e,t){n.menuCb("RemoveModule")}),t.reg(n,"Editor",function(t,o){e.currentlyEditing[o]={time:Date.now(),active:!0,module:n},a.raiseEvent("editorStatus",{email:o,status:1})}),setTimeout(function(){e.editMode&&n.$editNode.on("keydown click",function(){if("Canvas"!=n.Type){var a=e.currentlyEditing[e.userEmail];(!a||a.module.Tag!=n.Tag||Date.now()-a.time>=5e3)&&(t.sync(n,"Editor",e.userEmail),e.currentlyEditing[e.userEmail]={time:Date.now(),module:n})}})},50)}},app.mods.sliderBaseFunc=function(e,t){return function(e,a,n,o){var i=e.Data;e.factory.editBase(e,{addItem:a,$items:n,itemVal:function(e,a){n.find("> div:eq("+e+")").find(".slider-bar").css(t,a+"%")},txt:function(){o.css("display",1==i.Txt?"":"none")},theme:function(){o.unstyle()}})}},app.mods.barEdit=function(e,t){var a=$("#tmp-edit-bar").html(),n=$("#tmp-edit-bar-row").html();return function(o){function i(t){e.appHub.sync(o,t,s[t])}var s=o.Data,r=$(a),l=r.find(".title").css("display",1==s.Txt?"":"none"),c=r.find(".pairs");l.editor(o,s,"Title",{allowEnter:!0});var d=function(t,a){var r=$(n),l=r.find(".name"),d=r.find(".slider-container"),u=r.find(".item-close-btn");l.editor(o,a,"Name",{index:t,cleanPTags:!0}),d.percentSlider({obj:a,sync:i}),u.on("click",function(){e.utility.removeFromList(s.Items,a),l.unMount(),r.remove(),i("Items")}),c.append(r)};return $.each(s.Items,function(e,t){d(e,t)}),t(o,d,c,l),{$node:r,addItem:function(){var e={Name:"<p>Bar "+(s.Items.length+1)+"</p>",Val:50};d(s.Items.length,e),s.Items.push(e)},changeTheme:function(e){l.unstyle()},toggleTxt:function(){l.css("display",1==s.Txt?"":"none")},unMount:function(){l.unMount(),r.find(".name").unMount()}}}},app.mods.canvasEdit=function(e){function t(e){$.each(e.Data.Mods,function(e,t){var a=c.getModule(t.Tag);a&&a.resize&&a.resize()})}function a(){if(n){var e,a=n.Data,i=0,s=a.Arr[o],r=a.Arr[o+1],c=s+r,d=$(this).index();for(e=0;e<o;e++)i+=a.Arr[e];return s=1+d-i,r=c-s,s>0&&r>0&&(a.Arr[o]=s,a.Arr[o+1]=r,n.editObj.setLayout(),n.save()),t(n),l.sync(n,"CanvasColResize",{col:o,first:s,second:r}),!1}}var n,o,i="col col-sm-",s=$("#tmp-edit-canvas").html(),r=$("#tmp-canvas-resize-col").html(),l=e.appHub,c=e.modManager,d=e.utility;return function(u){function m(e){var t,a=h.Arr.length;if(a!=e){var n,o,i,s;if(a>e)for(i=b.find(".col:eq("+(e-1)+")"),n=e;n<a;n++)h.Arr[e-1]+=h.Arr[n],o=b.find(".col:eq("+n+")"),s=o.find(".module-container"),i.append(s),o.remove();else{for(n=a;n<e;n++)b.append($("<div>")),h.Arr[n]=1;t=e-a,n=-1;do n<0&&(n=a-1),h.Arr[n]>1&&(h.Arr[n]-=1,t-=1),n--;while(t>0)}h.Arr.length=e}}function p(t,a,n){var o=0,a=c.addModule(t,a,0,$("<div>"),$("<div>"));b.find(".col").length>1&&(o=1),b.find(".col:eq("+o+")").insertAt(0,a.$editNode),a.resize&&a.resize(),k.saveMods(),e.include(u,a),a.save(),n&&n(a)}var f,h=u.Data,g=$(s),v=g.find(".edit-content"),b=v.find(".mods-inner"),y=v.find(".resize-bars"),C=g.find(".grid-div-wrapper"),T=g.find(".grid-div"),w=$('<div class="empty" style="min-height: 100px; border: 1px dotted blue; margin-top: 12px;">');for(y.on("mousedown",".resize-grip",function(){n=u,o=$(this).index(),$("body").addClass("disable-select"),C.show()}),f=0;f<h.Arr.length;f++)b.append($("<div>"));for(g.on("mouseup mouseleave",function(){n&&(n=null,$("body").removeClass("disable-select"),C.hide())}),f=0;f<12;f++){var x=$('<div class="col col-xs-1"></div>)');x.on("mouseenter",a),T.append(x)}u.drag=function(e,t){t=t-g.find(".header").height()-30,b.find(".module-container").each(function(a,n){var o=$(n),i=o.closest(".col").position(),s=o.position();if(s.left+=i.left,s.top+=i.top,s.right=s.left+o.width(),s.bottom=s.top+o.height(),d.isPointInRect(s,{x:e,y:t}))return t>s.bottom/2?w.insertAfter(o):w.insertBefore(o),!1})},u.dragCancel=function(){w.remove()},u.dragEnd=function(t){var a,n;n=w.closest(".col").index(),n<0&&(n=0,b.find(".col:eq(0)").prepend(w)),a=w.index(),l.sync(u,"CanvasModPos",{col:n,index:a,Tag:t.Tag}),b.find(".col:eq("+n+")").insertAt(a,t.$editNode),$(".empty").remove(),t.editObj.applyStyle&&(t.Data.Theme=h.Theme,t.editObj.applyStyle(h.Theme),l.sync(t,"Theme",h.Theme)),t.Data.Theme=h.Theme,t.applyStyle(h.Theme),e.include(u,t),l.sync(u,"Mods",h.Mods)},l.reg(u,"CanvasCol",function(e,t){m(t),k.setLayout()}),l.reg(u,"CanvasModPos",function(e,t){var a=$("#ed-"+t.Tag).parent(".col").index(),n=$("#ed-"+t.Tag).index();a==t.col&&n<t.index&&(t.index+=1);var o=c.getModule(t.Tag);b.find(".col:eq("+t.col+")").insertAt(t.index,o.$editNode)}),l.reg(u,"CanvasColResize",function(e,a){var n=u.Data;n.Arr[a.col]=a.first,n.Arr[a.col+1]=a.second,t(u),u.editObj.setLayout()}),l.reg(u,"CanvasAddMod",function(e,t){t.Syncd=!0,p(t.Type,t)});var k={$node:g,mount:function(){$.each(h.Mods,function(e,t){var a=c.getModule(t.Tag)||t.Module;a&&b.find(".col:eq("+t.Col+")").insertAt(t.Row,a.$editNode)})},applyStyle:function(t,a){b.css({border:1==h.Border?"":"1px dashed "+t}),a&&$.each(h.Mods,function(a,n){var o=c.getModule(n.Tag);o&&(o.Data.ThemeOverride&&(o.Data[o.Data.ThemeOverride]=t,"BgColor"==o.Data.ThemeOverride&&e.bgColor(o,t,!0)),o.Data.Theme=t,o.applyStyle(t),o.editObj&&o.editObj.applyStyle&&o.editObj.applyStyle(t),o.save())})},addModule:function(){e.popup.addModule(function(e){p(e,{Type:e,Data:{Type:e,Theme:h.Theme}},function(t){l.sync(u,"CanvasAddMod",{Tag:t.Tag,Type:e,Data:t.Data,CanvasMod:!0})})},1)},clone:function(e){var t=c.copyModule(e),a=c.getFactory(t);a.initModule(t),e.$editNode.after(t.$editNode),u.factory.include(u,t),t.save(),u.save()},setLayout:function(){var e,t=0,a="0px";y.empty(),$.each(h.Arr,function(n,o){b.find(">div:eq("+n+")").attr("class",i+o),n>0&&(t+=8.33*h.Arr[n-1],e=$(r).css("left","calc("+t+"% - "+a+")"),y.append(e))})},saveMods:function(){h.Mods=[],b.find(".col").each(function(e,t){$(t).find(".module-container:not(.empty-module-container)").each(function(t,a){a=c.getModule($(a).data("key")),a&&h.Mods.push({Tag:a.Tag||a.Key,Col:e,Row:t})})})},changeColumns:function(e){m(e),k.setLayout(),u.save(),l.sync(u,"CanvasCol",e)},move:function(e){var t,a,n,o,i=e.pageX,s=e.pageY,r={x:i,y:s};b.find("> .col").each(function(e,i){if(a=$(i),o=a.width(),t=a.offset(),t.top-=150,t.right=t.left+a.width()+10,t.bottom=t.top+b.height()+100,d.isPointInRect(t,r))return a.prepend(w),a.find(".module-container").each(function(e,a){if(n=$(a),t.top=n.offset().top,t.bottom=t.top+n.height(),s>t.top&&s<t.bottom)return s<t.top+n.height()/2?n.before(w):n.after(w),!1}),!1}),w.index()<0&&b.find(".col:eq(0)").append(w)},cancel:function(){w.remove()}};return k.setLayout(),setTimeout(t,0,u),k}},app.mods.dataCollectionEdit=function(e){var t=$("#tmp-edit-dc").html();return function(a){function n(e,t){s+=e,l+=t,m.text(s+" RESPONSE"+(1==s?"":"S")),p.text(l+" New")}function o(){a.ID?e.popup.signupPerformance.reg(a.ID,a.Records,{n:e.folio.FolioName,t:e.folio.Token}):setTimeout(o,500)}var i,s,r=a.Data,l=0,c=$(t),d=c.find(".module-info-inner"),u=c.find(".dc-join-us"),m=c.find(".total"),p=c.find(".new-items"),f=c.find(".msg");return a.Records=a.Records||[],a.Store=JSON.parse(a.Store||"{}"),a.Store.viewed=a.Store.viewed||JSON.stringify(new Date(2016,4,30).getTime()),i=new Date(JSON.parse(a.Store.viewed)),s=a.Records.length,$.each(a.Records,function(e,t){return!(t.Created<i)&&void l++}),m.text(s+" RESPONSE"+(1==s?"":"S")),p.text(l+" New"),d.on("click",function(){n(0,-l),e.popup.signupPerformance(a.ID,a.Records,{n:e.folio.FolioName,t:e.folio.Token})}),f.editor(a,r,"Message",{allowEnter:!0}),u.editor(a,r,"ButtonText",{noHtml:!0}),e.modStore.reg(a.ID,a.Store),e.eventManager.addListener("newSignUp",function(e){e.Data.ModId==a.ID&&n(1,1)}),n(0,0),o(),e.editBase(a,{}),{$node:c}}},app.mods.donutEdit=function(e,t){var a=$("#tmp-edit-donut-main").html(),n=$("#tmp-edit-donut-row").html(),o=$("<div>"),i=function(t,a,n){var i=0,s=!0,r=e.modManager.getDonutData();t.breakup=[];for(var l=0;l<a.length;l++){var c=parseInt(o.html($.trim(a[l].Val)).text());isNaN(c)||(i+=c,t.breakup.push(c))}r.showError&&(s=100==i),n.closest(".breakup-col").find(".item-close-btn").toggleClass("hidden",1==t.breakup.length),n.toggleClass("hidden",s)},s=function(t,a){var n=t.module,o=n.Data;a&&(n.colorFunc=e.createColorFunc(o.Items.length,a)),i(n,o.Items,t.$error),t.$breakup.find(".breakup-row").each(function(e){$(this).find(".color").css("background-color",n.colorFunc(e))}),t.drawPie(),n.factory.renderPreview(n)},r=function(e,t,a){var o=e.module,i=$(n),r=i.find(".value");r.editor(o,t,"Val",{index:a,onSave:function(){s(e)},changed:function(){var a=$("<div>"+t.Val+"</div>").find("p").length;a>1&&(t.Val="<p>"+$(t.Val).text()+"</p>",r.find(".fr-view").html(t.Val)),setTimeout(function(){s(e)},500)}}),e.$breakup.append(i)};return function(n){var o=n.Data,l=o.Theme||"#4C7BA0",c=o.Items,d=$(a),u=d.find(".title"),m=d.find(".donut-pie-container"),p=d.find(".donut-label"),f=d.find(".donut-breakup"),h=d.find(".invalid-100"),g=$.extend({parentPage:e.pageManager.pages.edit,$node:d,$pieDiv:m,$breakup:f,$error:h,module:n,data:o,breakup:c,changeTheme:function(e){u.unstyle(),n.applyStyle(e),g.applyStyle(e)},applyStyle:function(e){l=e,s(g)},addItem:function(){v(),e.appHub.sync(n,"PieItems",-1)},render:function(){s(g)}},t);$.each(c,function(e,t){r(g,t,e)});var v=function(){var e={Val:"<p>10% &nbsp;Segment  "+(c.length+1)+"</p>"};r(g,e,c.push(e)-1),s(g,l)};return e.appHub.reg(n,"PieItems",function(e,t){t<0?v():(f.find(".breakup-row").eq(t).remove(),c.splice(t,1),s(g,l))}),f.on("click",".item-close-btn",function(){var t=$(this),a=t.closest(".breakup-row");e.appHub.sync(n,"PieItems",a.index()),c.splice(a.index(),1),a.remove(),s(g,l),n.save()}),h.find(".item-close-btn").on("click",function(){e.modManager.getDonutData().showError=!1,i(n,c,h),h.find(".error-check").get(0).checked&&(e.eventManager.raiseEvent("donutError"),e.modManager.saveData())}),e.eventManager.addListener("donutError",function(){i(n,c,h)}),u.editor(n,o,"Title",{allowEnter:!0}),p.editor(n,o,"Label",{allowEnter:!0,changed:function(){g.updateLabel()}}),n.resize=function(){g.drawPie()},e.editBase(n,{}),g}},app.mods.imagesEdit=function(e){var t=e.appHub,a=$("#tmp-edit-images").html(),n=$("#tmp-edit-image-item").html();return function(o){function i(){if(r){$("body").removeClass("disable-select");var e=f.width();r.Val=Math.round(100*l.width()/e),l.css("width",r.Val+"%"),r=null,t.sync(o,"Items",u.Items)}}function s(a,i){var s=Math.min(100,i.Val||33)+"%",m=$(n),p=m.find("img"),h=m.find(".edit-btn"),g=m.find(".link-btn"),v=m.find(".logo-resize-handle"),b=m.find(".close-btn");m.css("width",s),b.on("click",function(){e.utility.removeFromList(u.Items,i),o.save(),t.sync(o,"Items",u.Items),m.remove()}),v.on("mousedown touchstart",function(e){r=i,l=m,d=m.width(),c=e.clientX,$("body").addClass("disable-select")}),h.uploader({module:o,custom:"imgMod",success:function(e){var a=e.Message;i.Url=a,p.attr("src",a),t.sync(o,"Items",u.Items)}}),g.click(function(){e.popup.message({input:i.Url,enterAsOK:!0,emptyError:"Please provide a valid URL.",heading:"Enter Image Url",cancelText:"Cancel",handleOK:function(e){i.Url=e,p.attr("src",i.Url)}})}),p.attr("src",i.Url),f.append(m)}var r,l,c,d,u=o.Data,m=$(a),p=m.find(".title").css("display",1==u.Txt?"":"none"),f=m.find(".image-outer").css("text-align",u.Align);return p.editor(o,u,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",i),$(document).on("touchmove mousemove",function(e){if(r){var t=f.width();l.css("width",Math.max(50,Math.min(t,d+e.clientX-c))+"px")}}),$.each(u.Items,s),e.editBase(o,{addItem:s,$items:f,itemVal:function(e,t,a){f.find("> div:eq("+e+")").css("width",t+"%").find("img").attr("src",a)},align:function(){f.css("text-align",u.Align)},txt:function(){p.css("display",1==u.Txt?"":"none")},theme:function(){p.unstyle()}}),{$node:m,changeTheme:function(e){p.unstyle()},addItem:function(){var t={Url:e.defImg,Val:100};s(u.Items.length,t),u.Items.push(t)},align:function(){f.css("text-align",u.Align)},toggleTxt:function(){p.css("display",1==u.Txt?"":"none")},unMount:function(){p.unMount()}}}},app.mods.scaleEdit=function(e,t){var a=$("#tmp-edit-scale").html(),n=$("#tmp-edit-scale-row").html();return function(o){function i(t){e.appHub.sync(o,t,s[t])}var s=o.Data,r=$(a),l=r.find(".title").css("display",1==s.Txt?"":"none"),c=r.find(".pairs");l.editor(o,s,"Title",{allowEnter:!0});var d=function(t,a){var r=$(n),l=r.find(".name-1"),d=r.find(".name-2"),u=r.find(".slider-container"),m=r.find(".item-close-btn");l.editor(o,a,"Name1",{index:t,cleanPTags:!0}),d.editor(o,a,"Name2",{index:t,cleanPTags:!0}),u.thumbSlider({obj:a,sync:i}),m.on("click",function(){e.utility.removeFromList(s.Items,a),o.save(),l.unMount(),d.unMount(),r.remove(),i("Items")}),c.append(r)};return $.each(s.Items,d),t(o,d,c,l),$.extend({$node:r,changeTheme:function(e){l.unstyle()},addItem:function(){var e={Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50};d(s.Items.length,e),s.Items.push(e),i("Items")},toggleTxt:function(){l.css("display",1==s.Txt?"":"none"),o.save()},unMount:function(){l.unMount(),r.find(".name-1, name-2").unMount()}})}},app.mods.socialEdit=function(e){var t=new Image,a=new Image;t.src="url(/img/instagramdark.png)",a.src="url(/img/instagramhover.png)";var n=$("#tmp-edit-social").html(),o=function(e,t,a,n,o,i,s){t.toggleClass("active",!!e.FacebookUrl),a.toggleClass("active",!!e.TwitterUrl),n.toggleClass("active",!!e.LinkedInUrl),o.toggleClass("active",!!e.GplusUrl),i.toggleClass("active",!!e.InstagramUrl),s.toggleClass("active",!!e.CustomUrl)},i=function(e,t,a,n,o,i,s){t.closest(".field-items").toggleClass("active",!!e.FacebookUrl),a.closest(".field-items").toggleClass("active",!!e.TwitterUrl),n.closest(".field-items").toggleClass("active",!!e.LinkedInUrl),o.closest(".field-items").toggleClass("active",!!e.GplusUrl),i.closest(".field-items").toggleClass("active",!!e.InstagramUrl),s.closest(".field-items").toggleClass("active",!!e.CustomUrl)};return function(t){var a=t.Data,s=$(n).css("text-align",a.Align),r=s.find(".social-info-box"),l=s.find(".social-info"),c=l.find(".edit-btn"),d=r.find(".social-info-close"),u=r.find(".facebook input, .twitter input, .linkedin input, .gplus input, .instagram input, .custom-link input"),m=r.find(".facebook input"),p=r.find(".twitter input"),f=r.find(".linkedin input"),h=r.find(".gplus input"),g=r.find(".instagram input"),v=r.find(".custom-link input"),b=l.find(".facebook"),y=l.find(".twitter"),C=l.find(".linkedin"),T=l.find(".gplus"),w=l.find(".instagram"),x=l.find(".custom");return o(a,b,y,C,T,w,x),i(a,m,p,f,h,g,v),m.val(a.FacebookUrl),p.val(a.TwitterUrl),f.val(a.LinkedInUrl),h.val(a.GplusUrl),g.val(a.InstagramUrl),v.val(a.CustomUrl),u.on("blur",function(){var e=$(this),n=$(this).data("name");a[n]=e.val(),o(a,b,y,C,T,w,x),i(a,m,p,f,h,g,v),t.save()}),d.add(c).on("click",function(){return $(".top-comp").removeClass("top-comp"),s.closest(".module").toggleClass("no-resize"),s.closest(".module-container").toggleClass("top-comp"),s.closest(".edit-div").toggleClass("top-comp"),r.slideToggle(150),$(".social-info-box").not(r).hide(),!1}),s.click(function(){return!1}),e.editBase(t,{}),{$node:s,align:function(){s.css("text-align",a.Align)}}}},app.mods.tagEdit=function(e){var t=$("#tmp-edit-tag").html(),a=$("#tmp-edit-tag-item").html();return function(n){function o(t){e.appHub.sync(n,t,i[t])}var i=n.Data,s=$(t),r=s.find(".tag-container").css("text-align",i.Align);i.Theme=i.Theme||"#F2F2F3";var l=function(t,s){var l=$(a),c=l.find(".tag-inner"),d=l.find(".tag-close");c.editor(n,s,"Name",{index:t,allowEnter:!1}),r.append(l),d.on("click",function(){c.unMount(),l.remove(),e.utility.removeFromList(i.Items,s),o("Items"),n.save()})};return $.each(i.Items,l),e.editBase(n,{$items:r,itemVal:function(e,t){},align:function(){r.css("text-align",i.Align)},addItem:l}),{$node:s,addItem:function(){var e={Name:"<p>Tag</p>"};l(i.Items.push(e)-1,e),o("Items")},align:function(){r.css("text-align",i.Align)},unMount:function(){r.find(".tag-inner").unMount()}}}},app.mods.videosEdit=function(e,t,a,n){var o=e.appHub,i=$("#tmp-edit-videos").html(),s=$("#tmp-edit-video-item").html();return function(r){function l(){if(d){$("body").removeClass("disable-select");var e=y.width();y.height();d.width=Math.round(100*u.width()/e),d.height=u.height(),u.css("width",d.width+"%"),d=null,o.sync(r,"Items",g.Items),a.activatePreview({modId:r.Tag}),u.removeClass("video-disable")}}function c(i,c){var v="100%",b=$(s),C=b.find(".edit-btn"),T=b.find(".link-btn"),w=b.find(".logo-resize-handle"),x=b.find(".close-btn"),k=b.find(".fr-video");b.css("width",v),x.on("click",function(){e.utility.removeFromList(g.Items,c),r.save(),o.sync(r,"Items",g.Items),b.remove(),a.activatePreview({modId:r.Tag})}),w.on("mousedown touchstart",function(e){c.$videoContainer=b,d=c,u=b,f=b.width(),h=b.height(),m=e.clientX,p=e.clientY,$("body").addClass("disable-select")}),C.uploader({module:r,custom:"videoMod",success:function(e){var n=e.Message;c.VideoUrl=n,k.html(t(n)),o.sync(r,"Items",g.Items),a.activatePreview({modId:r.Tag})}}),T.click(function(){e.popup.message({input:c.VideoUrl||" ",enterAsOK:!0,emptyError:"Please provide a valid URL.",heading:"Enter Video Url",cancelText:"Cancel",handleOK:function(e){e.length>0?k.html(t(e)):k.html(""),c.VideoUrl=e,r.VideoUrl=e,c.VideoUrl&&y.find(".video-inner").css({"background-image":""}),o.sync(r,"Items",g.Items),a.activatePreview({modId:r.Tag}),y.find(".loading-animation").show(),setTimeout(function(){y.find(".loading-animation").hide()},3e3),l()}})}),k.html(t(c.VideoUrl)),c.VideoUrl&&y.find(".video-inner").css({"background-image":""}),b.css("width",c.width+"%"),y.append(b),y.find(".loading-animation").html(n.spinner),setTimeout(function(){a.activatePreview({modId:r.Tag})},1e3),setTimeout(function(){y.find(".loading-animation").hide()},3e3)}var d,u,m,p,f,h,g=r.Data,v=$(i),b=v.find(".title").css("display",1==g.Txt?"":"none"),y=v.find(".video-outer").css("text-align",g.Align);return b.editor(r,g,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",l),$(document).on("touchmove mousemove",function(e){if(d){u.addClass("video-disable");var t=y.width(),a=Math.max(50,Math.min(t,f+e.clientX-m));u.css("width",a+"px")}}),$.each(g.Items,c),e.editBase(r,{addItem:c,$items:y,itemVal:function(e,n){y.find("> div:eq("+e+")").css({width:n.width+"%"}),n.VideoUrl&&y.find(".video-inner").css({"background-image":""}),r.Data.Items[e].VideoUrl!=n.VideoUrl&&(y.find(".loading-animation").show(),setTimeout(function(){y.find(".loading-animation").hide()},3e3),y.find("> div:eq("+e+")").find(".fr-video").html(t(n.VideoUrl))),a.activatePreview({modId:r.Tag})},align:function(){y.css("text-align",g.Align),a.activatePreview({modId:r.Tag})},txt:function(){b.css("display",1==g.Txt?"":"none"),a.activatePreview({modId:r.Tag})},theme:function(){b.unstyle(),a.activatePreview({modId:r.Tag})}}),{$node:v,changeTheme:function(e){b.unstyle(),a.activatePreview({modId:r.Tag})},align:function(){y.css("text-align",g.Align),a.activatePreview({modId:r.Tag})},toggleTxt:function(){b.css("display",1==g.Txt?"":"none"),a.activatePreview({modId:r.Tag})},unMount:function(){b.unMount(),a.activatePreview({modId:r.Tag})}}}},app.mods.barPreview=function(e){var t=$("#tmp-prev-bar").html(),a=$("#tmp-prev-bar-row").html();return function(e){var n=$(t),o=n.find(".title"),i=n.find(".pairs"),s=e.Data;return e.renderPreview=function(){o.html(s.Title).css("display",1==s.Txt?"":"none"),i.empty(),$.each(s.Items,function(e,t){var n=$(a);n.find(".name").html(t.Name),n.find(".slider-bar").css({width:Math.ceil(t.Val)+"%"}),i.append(n)})},{$node:n}}},app.mods.canvasPreview=function(e){var t=$("#tmp-prev-canvas").html();return function(a){var n=a.Data,o="col col-sm-",i=$(t),s=i.find(".mods-inner");return a.renderPreview=function(){s.empty();for(var t=0;t<n.Arr.length;t++){var a=$("<div>").attr("class",o+n.Arr[t]);s.append(a)}$.each(n.Mods,function(t,a){var n=e.modManager.getModule(a.Tag);n&&(s.find(".col:eq("+a.Col+")").insertAt(a.Row,n.$previewNode),e.renderPreview(n))})},{$node:i}}},app.mods.dataCollectionPreview=function(e){var t=$("#tmp-prev-dc").html(),a=$("#spinner-container > .loading-animation");return function(n){var o=$(t),i=a.clone().addClass("small").hide(),s=o.find(".msg"),r=o.find(".dc-join-us"),l=o.find(".dc-email-input");return r.prepend(i),r.on("click",function(){var t=l.val();t&&validator.isEmail(t)?(r.prop("disabled",!0),l.removeClass("email-invalid"),i.show(),e.apiHelper.saveModuleRecord({moduleId:n.ID,dataObj:{email:t},success:function(){i.hide(),l.val(""),r.text("Submitted")},error:function(){i.hide(),r.text("Error. Try again."),r.prop("disabled",!1),setTimeout(function(){r.text(n.Data.ButtonText)},3e3)}})):l.addClass("email-invalid")}),n.renderPreview=function(){s.html(n.Data.Message);var e=$("<div></div>").html(n.Data.ButtonText).text();r.text(e)},{$node:o}}},app.mods.donutPreview=function(e,t){var a=$("#tmp-prev-donut-main").html(),n=$("#tmp-prev-donut-row").html();return function(o){var i=o.Data,s=i.Items,r=$(a),l=r.find(".title"),c=r.find(".donut-pie-container"),d=r.find(".donut-label"),u=r.find(".donut-breakup"),m=$.extend({$node:r,parentPage:e.pageManager.pages.home,$pieDiv:c,$breakup:u,module:o},t);return o.renderPreview=function(){l.html(i.Title),d.html(i.Label),u.empty(),$.each(s,function(e,t){var a=$(n);a.find(".value").html(t.Val),a.find(".color").css("background-color",o.colorFunc(e)),u.append(a)}),m.drawPie()},m}},app.mods.imagesPreview=function(e){var t=$("#tmp-prev-images").html();return function(e){var a=$(t),n=e.Data,o=a.find(".title"),i=a.find(".image-outer");return e.renderPreview=function(){o.html(n.Html).css("display",1==n.Txt?"":"none"),i.empty().css("text-align",n.Align),$.each(n.Items,function(e,t){var a=$('<div class="image-inner"><img src="'+t.Url+'"></img></div>');a.css({width:Math.min(100,t.Val||33)+"%"}),i.append(a)})},{$node:a}}},app.mods.scalePreview=function(e){var t=$("#tmp-prev-scale").html(),a=$("#tmp-prev-scale-row").html();return function(e){var n=e.Data,o=$(t),i=o.find(".title"),s=o.find(".pairs");return e.renderPreview=function(){i.html(n.Title).css("display",1==n.Txt?"":"none"),s.empty(),$.each(n.Items,function(e,t){var n=$(a);n.find(".name-1").html(t.Name1),n.find(".name-2").html(t.Name2),n.find(".slider-bar").css({left:Math.round(t.Val)+"%"}),s.append(n)})},{$node:o}}},app.mods.socialPreview=function(e){var t=$("#tmp-prev-social").html();return function(e){var a=e.Data,n=$(t),o=n.find(".social-info-static");return e.renderPreview=function(){if(n.find(".header-container .header").html(a.Header),n.css("text-align",a.Align).addClass("module"),o.empty(),a.FacebookUrl&&o.append('<a target="_blank" class="facebook active" href="'+a.FacebookUrl+'"><i class="icon-SocialFacebook"></i></a>'),a.TwitterUrl&&o.append('<a target="_blank" class="twitter active" href="'+a.TwitterUrl+'"><i class="icon-SocialTwitter"></i></a>'),a.LinkedInUrl&&o.append('<a target="_blank" class="linkedin active" href="'+a.LinkedInUrl+'"><i class="icon-SocialLinkedin"></i></a>'),a.GplusUrl&&o.append('<a target="_blank" class="gplus active" href="'+a.GplusUrl+'"><i class="icon-SocialGooglePlus"></i></a>'),a.InstagramUrl&&o.append('<a target="_blank" class="instagram active" href="'+a.InstagramUrl+'"><i class="img-instagram"></i></a>'),a.CustomUrl){var e=$.trim(a.CustomUrl);a.CustomUrl.indexOf("http")<0&&(e="http://"+e),o.append('<a target="_blank" class="custom active" href="'+e+'"><i class="icon-SocialLink"></i></a>')}},{$node:n}}},app.mods.tagPreview=function(e){var t=$("#tmp-prev-tag").html(),a=$("#tmp-prev-tag-item").html();return function(e){var n=$(t),o=n.find(".tag-container"),i=e.Data;return e.renderPreview=function(){o.empty().css("text-align",i.Align),$.each(i.Items,function(e,t){var n=$(a);n.find(".tag-inner").html(t.Name),o.append(n)})},{$node:n}}},app.mods.videosPreview=function(e,t){var a=$("#tmp-prev-videos").html(),n=$("#tmp-edit-video-item").html();return function(e){var o=$(a),i=e.Data,s=o.find(".title"),r=o.find(".video-outer");return e.renderPreview=function(){s.html(i.Html).css("display",1==i.Txt?"":"none"),r.empty().css("text-align",i.Align),$.each(i.Items,function(e,a){var o=$(n);o.removeClass("edit"),o.find(".edit-btn").remove(),o.find(".link-btn").remove(),o.find(".logo-resize-handle").remove(),o.find(".loading-animation").remove(),o.find(".close-btn").remove();var i=o.find(".fr-video");o.css("width",a.width+"%"),i.html(t(a.VideoUrl)),r.append(o),console.log("preview",e,a)})},{$node:o}}};var logger=function(){try{var e=null,t={};t.enableLogger=function(){null!=e&&(window.console.log=e)},t.disableLogger=function(){e=console.log,window.console.log=function(){}}}catch(a){}return t}(),consologs=function(e){var t=[];return function(a){t.push(a),("localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||e.isAdmin)&&console.log(a)}},isConsoleAllow=function(e){return function(t){return"localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||e.isAdmin}};app.plugin.froalaSetup=function(e,t,a,n){function o(e){return u.html(e).html()}var i={__RequestVerificationToken:e.verificationToken,type:"froala",token:e.token},s=e.colors;!e.isHome&&s.push("REMOVE");var r;r="live"==e.Environment?"dejznrklH3fij==":"1mbrvjstG3iH-8G-7h==",$.FroalaEditor.DEFAULTS=$.extend($.FroalaEditor.DEFAULTS,{key:r,colorsText:s,colorsBackground:s,keepFormatOnDelete:!0,imageResizeWithPercent:!0,fontSize:["8","9","10","11","12","14","16","18","24","30","36","48","60","72","96"],imageAllowedTypes:["jpeg","jpg","png","gif"],htmlAllowedAttrs:$.FroalaEditor.DEFAULTS.htmlAllowedAttrs.concat(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"])});var l={toolbarInline:!0,toolbarVisibleWithoutSelection:!0,theme:"custom",tabSpaces:!1,placeholderText:null,toolbarButtons:[],imageUploadURL:"/Apiv1/UploadImage",fileUploadURL:"",linkAlwaysNoFollow:!1,htmlRemoveTags:["script"],spellcheck:!0,toolbarContainer:"#toolbarContainer",htmlUntouched:!0,htmlSimpleAmpersand:!0,videoInsertButtons:["videoBack","|","videoByURL","videoEmbed"],fontFamily:{"proxima-nova,Helvetica,sans-serif":"Proxima Nova","proxima-light,Helvetica,sans-serif":"Proxima Light","proxima-bold,Helvetica,sans-serif":"Proxima Bold","Arial,Helvetica,sans-serif":"Arial2","Georgia,serif":"Georgia","Impact,Charcoal,sans-serif":"Impact","Tahoma,Geneva,sans-serif":"Tahoma","'Times New Roman',Times,serif":"Times New Roman","Verdana,Geneva,sans-serif":"Verdana"},imageMaxSize:n?e.FreeUserLimitPerImage:e.PaidUserLimitPerImage};e.fontFamily&&(l.fontFamily=$.extend(l.fontFamily,e.fontFamily));var c=$.extend({},l,{plainPaste:!0,multiLine:!1}),d=$.extend({},l,{imageUploadParams:i,toolbarButtons:["bold","italic","underline","paragraphFormat","fontFamily","fontSize","insertImage","insertVideo","color","insertLink","insertTable","formatOL","formatUL","insertHR","align","html","outdent","indent","clearFormatting","undo","redo"]}),u=$("<div>");$.fn.editor=function(s,r,l,u){function m(){var e=h.text(),t=!e&&!h.find("img, video, audio, iframe,table").length;t?(h.froalaEditor("html.set",g),e=g):e=y(),r[l]!=e&&(r[l]=e,s.save(),u.onSave&&u.onSave(e),C())}function p(e){if(!u.cleanPTags)return e;var t=$("<div>"+e+"</div>").find("p").length;if(t>1){var a="<p>"+$(e).text()+"</p>";return a}return e}function f(){var e=p(y());if(e=o(e),console.log(e.length),!(e.length>55e3)){var t=v.patch_make(r[l],v.diff_main(r[l],e,!0));s.Data[l]&&(s.Data[l]=e),r[l]=e,a.sync(s,l+(u.index||""),t)}}var h=this,g="Edit me",v=new diff_match_patch;u=u||{},r[l]=r[l]||g,u.url&&(u.noHtml=!0);var b=u.noHtml?c:$.extend({},d);b.multiLine=!!u.allowEnter;var y=function(){var e=h.froalaEditor("html.get");return u.noHtml&&(e=$("<div>").html(e).text()),e},C=function(){s.renderPreview(),s.factory.folio.Role<2&&s.save(),u.changed&&u.changed()};return h.unstyle=function(){var e=y(),t="h1, h2, h3, h4, h5, h6";e=$("<div>").html(e),"Title"==l&&(t+=", > p:first-child"),e.find(t).removeAttr("style").find("*").removeAttr("style"),h.froalaEditor("html.set",e.html()),m()},h.html(r[l]||g).froalaEditor(b).on("froalaEditor.contentChanged",function(){f(),C()}).on("froalaEditor.blur",m).on("froalaEditor.image.error",function(e,t,a,o){if(5==a.code){var i=t.popups.get("image.insert"),s=i.find(".fr-image-progress-bar-layer");n?s.find("h3").text("File size exceeds the 1MB limit,  but if you upgrade to a premium plan you can upload images up to 5MB."):s.find("h3").text("The image is too big.Maximum size for uploads is 5MB.")}}).on("froalaEditor.image.beforeUpload",function(e,t,a){}),a.reg(s,l+(u.index||""),function(e,t){var a=y(),n=p(v.patch_apply(t,a)[0]);n=o(n),r[l]=n,h.froalaEditor("html.set",n),C()}),t.addListener("tokenRenewed",function(){i.__RequestVerificationToken=e.verificationToken,h.froalaEditor("option","imageUploadParams",i)}),h.data("unMountCb",function(){h.froalaEditor("destroy")}),h}},app.plugin.lockedTip=function(e,t){var a=function(e,t,a){var n=a;e.tooltip({container:"body",html:!0,trigger:"manual",placement:t,title:function(){return n}})},n=function(e,t,n){e.addClass("locked"),e.find(".fa-lock").remove(),e.append('<i class="fa fa-lock" data-html="true"></i>'),a(e.find(".fa-lock"),"bottom auto",t),setTimeout(function(){var t=null;e.mouseenter(function(){clearTimeout(t),e.tooltip("hide"),e.find(".fa-lock").tooltip("hide"),$(this).find(".fa-lock").tooltip("show")}).mouseleave(function(){$this=$(this),t=setTimeout(function(){$this.find(".fa-lock").tooltip("hide")},n)})},10),setTimeout(function(){app.plugin.tooltip()},100)};return{add:function(e,t,a){n(e,t,a)},remove:function(e){e.removeClass("locked"),e.find(".fa-lock").remove(),setTimeout(function(){app.plugin.tooltip()},100)}}},app.plugin.main=function(e,t,a,n){var o=this,i=t.apiHelper,s=t.appHub,r=t.eventManager,l=!0;e.Team&&0!=e.Team.Id?l=!1:e.plusInfo&&e.plusInfo.End&&(l=Date.now()>e.plusInfo.End),o.froalaSetup(e,r,s,l),o.sliders(),o.uploader(e,i,n),o.misc(),o.social(),o.tooltip()},app.plugin.misc=function(){$.fn.unMount=function(){var e=this.data("unMountCb");e&&e()},$.fn.copier=function(){var e=this;return e.click(function(){e.select()}),e},$.fn.insertAt=function(e,t){var a=this;return e=Math.min(e,a.children().length),e<1?a.prepend(t):a.find("> :eq("+(e-1)+")").after(t),a}},!function(e){"use strict";var t=null,a=null,n=null;!function(){var t=["webkit","moz","o","ms"],a=e.document.createElement("div"),n=-1;for(n=0;n<t.length&&!e.requestAnimationFrame;n++)e.requestAnimationFrame=e[t[n]+"RequestAnimationFrame"];"undefined"==typeof a.nextElementSibling&&Object.defineProperty(e.Element.prototype,"nextElementSibling",{get:function(){for(var e=this.nextSibling;e;){if(1===e.nodeType)return e;e=e.nextSibling}return null}}),function(e){e.matches=e.matches||e.machesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){return Array.prototype.indexOf.call(this.parentElement.querySelectorAll(e),this)>-1}}(e.Element.prototype),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!1,a=[],n=-1;return t=!{toString:null}.propertyIsEnumerable("toString"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=a.length,function(o){var i=[],s="",r=-1;if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");for(s in o)e.call(o,s)&&i.push(s);if(t)for(r=0;r<n;r++)e.call(o,a[r])&&i.push(a[r]);return i}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return function(a,n){if(a!==Object(a)&&null!==a)throw TypeError("Argument must be an object, or null");
t.prototype=a||{};var o=new t;return t.prototype=null,n!==e&&Object.defineProperties(o,n),null===a&&(o.__proto__=null),o}}()),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t,a,n,o;if(null===this)throw new TypeError;if(n=Object(this),o=n.length>>>0,0===o)return-1;if(t=0,arguments.length>1&&(t=Number(arguments[1]),t!==t?t=0:0!==t&&t!==1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=o)return-1;for(a=t>=0?t:Math.max(o-Math.abs(t),0);a<o;a++)if(a in n&&n[a]===e)return a;return-1}),Function.prototype.bind||(Function.prototype.bind=function(e){var t,a,n,o;if("function"!=typeof this)throw new TypeError;return t=Array.prototype.slice.call(arguments,1),a=this,n=function(){},o=function(){return a.apply(this instanceof n?this:e,t.concat(Array.prototype.slice.call(arguments)))},this.prototype&&(n.prototype=this.prototype),o.prototype=new n,o}),e.Element.prototype.dispatchEvent||(e.Element.prototype.dispatchEvent=function(e){try{return this.fireEvent("on"+e.type,e)}catch(t){}})}(),t=function(n,o,i){var s=null,r=!1,l=null,c=null,d=null,u=null,m=[],p="",f=[],h=-1;if(d=i||e.document,(r=arguments[3])&&(r="boolean"==typeof r),"string"==typeof n)f=d.querySelectorAll(n);else if(n&&"object"==typeof n&&a.isElement(n,d))f=[n];else{if(!n||"object"!=typeof n||!n.length)throw new Error(t.messages.errorFactoryInvalidContainer());f=n}if(f.length<1)throw new Error(t.messages.errorFactoryContainerNotFound());for(h=0;(s=f[h])&&(!(h>0)||r);h++)s.id?p=s.id:(p="MixItUp"+a.randomHex(),s.id=p),t.instances[p]instanceof t.Mixer?(l=t.instances[p],(!o||o&&o.debug&&o.debug.showWarnings!==!1)&&console.warn(t.messages.warningFactoryPreexistingInstance())):(l=new t.Mixer,l.attach(s,d,p,o),t.instances[p]=l),c=new t.Facade(l),o&&o.debug&&o.debug.enable?m.push(l):m.push(c);return u=r?new t.Collection(m):m[0]},t.use=function(e){t.Base.prototype.callActions.call(t,"beforeUse",arguments),"function"==typeof e&&"mixitup-extension"===e.TYPE?"undefined"==typeof t.extensions[e.NAME]&&(e(t),t.extensions[e.NAME]=e):e.fn&&e.fn.jquery&&(t.libraries.$=e,t.registerJqPlugin(e)),t.Base.prototype.callActions.call(t,"afterUse",arguments)},t.registerJqPlugin=function(e){e.fn.mixItUp=function(){var e=arguments[0],a=arguments[1],n=Array.prototype.slice.call(arguments,1),o=[],i=[];return i=this.each(function(){var i=null,s=null;e&&"string"==typeof e?(i=t.instances[this.id],s=i[e].apply(i,n),"undefined"!=typeof s&&null!==s&&"function"!=typeof s.then&&o.push(s)):t(this,a)}),o.length?o.length>1?o:o[0]:i}},t.instances={},t.extensions={},t.libraries={},a={hasClass:function(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=e.className?" "+t:t)},removeClass:function(e,t){if(this.hasClass(e,t)){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(a," ").trim()}},extend:function(e,t,a,n){var o=[],i="",s=-1;a=a||!1,n=n||!1;try{if(Array.isArray(t))for(s=0;s<t.length;s++)o.push(s);else t&&(o=Object.keys(t));for(s=0;s<o.length;s++)i=o[s],!a||"object"!=typeof t[i]||this.isElement(t[i])?e[i]=t[i]:Array.isArray(t[i])?(e[i]||(e[i]=[]),this.extend(e[i],t[i],a,n)):(e[i]||(e[i]={}),this.extend(e[i],t[i],a,n))}catch(r){if(!n)throw r;this.handleExtendError(r,e)}return e},handleExtendError:function(e,a){var n=/property "?(\w*)"?[,:] object/i,o=null,i="",s="",r="",l="",c="",d=-1,u=-1;if(e instanceof TypeError&&(o=n.exec(e.message))){i=o[1];for(c in a){for(u=0;u<i.length&&i.charAt(u)===c.charAt(u);)u++;u>d&&(d=u,l=c)}throw d>1&&(r=t.messages.errorConfigInvalidPropertySuggestion({probableMatch:l})),s=t.messages.errorConfigInvalidProperty({erroneous:i,suggestion:r}),new TypeError(s)}throw e},template:function(e){for(var t=/\${([\w]*)}/g,a={},n=null;n=t.exec(e);)a[n[1]]=new RegExp("\\${"+n[1]+"}","g");return function(t){var n="",o=e;t=t||{};for(n in a)o=o.replace(a[n],"undefined"!=typeof t[n]?t[n]:"");return o}},on:function(t,a,n,o){t&&(t.addEventListener?t.addEventListener(a,n,o):t.attachEvent&&(t["e"+a+n]=n,t[a+n]=function(){t["e"+a+n](e.event)},t.attachEvent("on"+a,t[a+n])))},off:function(e,t,a){e&&(e.removeEventListener?e.removeEventListener(t,a,!1):e.detachEvent&&(e.detachEvent("on"+t,e[t+a]),e[t+a]=null))},getCustomEvent:function(t,a,n){var o=null;return n=n||e.document,"function"==typeof e.CustomEvent?o=new e.CustomEvent(t,{detail:a,bubbles:!0,cancelable:!0}):"function"==typeof n.createEvent?(o=n.createEvent("CustomEvent"),o.initCustomEvent(t,!0,!0,a)):(o=n.createEventObject(),o.type=t,o.returnValue=!1,o.cancelBubble=!1,o.detail=a),o},getOriginalEvent:function(e){return e.touches&&e.touches.length?e.touches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e},index:function(e,t){for(var a=0;null!==(e=e.previousElementSibling);)t&&!e.matches(t)||++a;return a},camelCase:function(e){return e.toLowerCase().replace(/([_-][a-z])/g,function(e){return e.toUpperCase().replace(/[_-]/,"")})},pascalCase:function(e){return(e=this.camelCase(e)).charAt(0).toUpperCase()+e.slice(1)},dashCase:function(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()},isElement:function(t,a){return a=a||e.document,!!(e.HTMLElement&&t instanceof e.HTMLElement)||!!(a.defaultView&&a.defaultView.HTMLElement&&t instanceof a.defaultView.HTMLElement)||null!==t&&1===t.nodeType&&"string"==typeof t.nodeName},createElement:function(t,a){var n=null,o=null;for(a=a||e.document,n=a.createDocumentFragment(),o=a.createElement("div"),o.innerHTML=t;o.firstChild;)n.appendChild(o.firstChild);return n},removeWhitespace:function(e){for(var t;e&&"#text"===e.nodeName;)t=e,e=e.previousSibling,t.parentElement&&t.parentElement.removeChild(t)},isEqualArray:function(e,t){var a=e.length;if(a!==t.length)return!1;for(;a--;)if(e[a]!==t[a])return!1;return!0},deepEquals:function(e,t){var a;if("object"==typeof e&&e&&"object"==typeof t&&t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(a in e)if(!t.hasOwnProperty(a)||!this.deepEquals(e[a],t[a]))return!1}else if(e!==t)return!1;return!0},arrayShuffle:function(e){for(var t=e.slice(),a=t.length,n=a,o=-1,i=[];n--;)o=~~(Math.random()*a),i=t[n],t[n]=t[o],t[o]=i;return t},arrayFromList:function(e){var t,a;try{return Array.prototype.slice.call(e)}catch(n){for(t=[],a=0;a<e.length;a++)t.push(e[a]);return t}},debounce:function(e,t,a){var n;return function(){var o=this,i=arguments,s=a&&!n,r=null;r=function(){n=null,a||e.apply(o,i)},clearTimeout(n),n=setTimeout(r,t),s&&e.apply(o,i)}},position:function(e){for(var t=0,a=0,n=e;e;)t-=e.scrollLeft,a-=e.scrollTop,e===n&&(t+=e.offsetLeft,a+=e.offsetTop,n=e.offsetParent),e=e.parentElement;return{x:t,y:a}},getHypotenuse:function(e,t){var a=e.x-t.x,n=e.y-t.y;return a=a<0?a*-1:a,n=n<0?n*-1:n,Math.sqrt(Math.pow(a,2)+Math.pow(n,2))},getIntersectionRatio:function(e,t){var a=e.width*e.height,n=-1,o=-1,i=-1,s=-1;return n=Math.max(0,Math.min(e.left+e.width,t.left+t.width)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.top+e.height,t.top+t.height)-Math.max(e.top,t.top)),i=o*n,s=i/a},closestParent:function(t,a,n,o){var i=t.parentNode;if(o=o||e.document,n&&t.matches(a))return t;for(;i&&i!=o.body;){if(i.matches&&i.matches(a))return i;if(!i.parentNode)return null;i=i.parentNode}return null},children:function(t,a,n){var o=[],i="";return n=n||e.doc,t&&(t.id||(i="Temp"+this.randomHexKey(),t.id=i),o=n.querySelectorAll("#"+t.id+" > "+a),i&&t.removeAttribute("id")),o},clean:function(e){var t=[],a=-1;for(a=0;a<e.length;a++)""!==e[a]&&t.push(e[a]);return t},defer:function(a){var n=null,o=null,i=null;return o=new this.Deferred,t.features.has.promises?o.promise=new Promise(function(e,t){o.resolve=e,o.reject=t}):(i=e.jQuery||a.$)&&"function"==typeof i.Deferred?(n=i.Deferred(),o.promise=n.promise(),o.resolve=n.resolve,o.reject=n.reject):e.console&&console.warn(t.messages.warningNoPromiseImplementation()),o},all:function(a,n){var o=null;return t.features.has.promises?Promise.all(a):(o=e.jQuery||n.$)&&"function"==typeof o.when?o.when.apply(o,a).done(function(){return arguments}):(e.console&&console.warn(t.messages.warningNoPromiseImplementation()),[])},getPrefix:function(e,t,n){var o=-1,i="";if(a.dashCase(t)in e.style)return"";for(o=0;i=n[o];o++)if(i+t in e.style)return i.toLowerCase();return"unsupported"},randomHex:function(){return("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase()},getDocumentState:function(t){return t="object"==typeof t.body?t:e.document,{scrollTop:e.pageYOffset,scrollLeft:e.pageXOffset,docHeight:t.documentElement.scrollHeight}},bind:function(e,t){return function(){return t.apply(e,arguments)}},isVisible:function(t){var a=null;return!!t.offsetParent||(a=e.getComputedStyle(t),"fixed"===a.position&&"hidden"!==a.visibility&&"0"!==a.opacity)},seal:function(e){"function"==typeof Object.seal&&Object.seal(e)},freeze:function(e){"function"==typeof Object.freeze&&Object.freeze(e)},compareVersions:function(e,t){var a=e.split("."),n=t.split("."),o=-1,i=-1,s=-1;for(s=0;s<a.length;s++){if(o=parseInt(a[s].replace(/[^\d.]/g,"")),i=parseInt(n[s].replace(/[^\d.]/g,"")||0),i<o)return!1;if(i>o)return!0}return!0},Deferred:function(){this.promise=null,this.resolve=null,this.reject=null,this.id=a.randomHex()},isEmptyObject:function(e){var t="";if("function"==typeof Object.keys)return 0===Object.keys(e).length;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},getClassname:function(e,t,a){var n="";return n+=e.block,n.length&&(n+=e.delineatorElement),n+=e["element"+this.pascalCase(t)],a?(n.length&&(n+=e.delineatorModifier),n+=a):n},getProperty:function(e,t){var a=t.split("."),n=null,o="",i=0;if(!t)return e;for(n=function(e){return e?e[o]:null};i<a.length;)o=a[i],e=n(e),i++;return"undefined"!=typeof e?e:null}},t.h=a,t.Base=function(){},t.Base.prototype={constructor:t.Base,callActions:function(e,t){var n=this,o=n.constructor.actions[e],i="";if(o&&!a.isEmptyObject(o))for(i in o)o[i].apply(n,t)},callFilters:function(e,t,n){var o=this,i=o.constructor.filters[e],s=t,r="";if(!i||a.isEmptyObject(i))return s;n=n||[];for(r in i)n=a.arrayFromList(n),n.unshift(s),s=i[r].apply(o,n);return s}},t.BaseStatic=function(){this.actions={},this.filters={},this.extend=function(e){a.extend(this.prototype,e)},this.registerAction=function(e,t,a){(this.actions[e]=this.actions[e]||{})[t]=a},this.registerFilter=function(e,t,a){(this.filters[e]=this.filters[e]||{})[t]=a}},t.Features=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.boxSizingPrefix="",this.transformPrefix="",this.transitionPrefix="",this.boxSizingPrefix="",this.transformProp="",this.transformRule="",this.transitionProp="",this.perspectiveProp="",this.perspectiveOriginProp="",this.has=new t.Has,this.canary=null,this.BOX_SIZING_PROP="boxSizing",this.TRANSITION_PROP="transition",this.TRANSFORM_PROP="transform",this.PERSPECTIVE_PROP="perspective",this.PERSPECTIVE_ORIGIN_PROP="perspectiveOrigin",this.VENDORS=["Webkit","moz","O","ms"],this.TWEENABLE=["opacity","width","height","marginRight","marginBottom","x","y","scale","translateX","translateY","translateZ","rotateX","rotateY","rotateZ"],this.callActions("afterConstruct")},t.BaseStatic.call(t.Features),t.Features.prototype=Object.create(t.Base.prototype),a.extend(t.Features.prototype,{constructor:t.Features,init:function(){var e=this;e.callActions("beforeInit",arguments),e.canary=document.createElement("div"),e.setPrefixes(),e.runTests(),e.callActions("beforeInit",arguments)},runTests:function(){var t=this;t.callActions("beforeRunTests",arguments),t.has.promises="function"==typeof e.Promise,t.has.transitions="unsupported"!==t.transitionPrefix,t.callActions("afterRunTests",arguments),a.freeze(t.has)},setPrefixes:function(){var e=this;e.callActions("beforeSetPrefixes",arguments),e.transitionPrefix=a.getPrefix(e.canary,"Transition",e.VENDORS),e.transformPrefix=a.getPrefix(e.canary,"Transform",e.VENDORS),e.boxSizingPrefix=a.getPrefix(e.canary,"BoxSizing",e.VENDORS),e.boxSizingProp=e.boxSizingPrefix?e.boxSizingPrefix+a.pascalCase(e.BOX_SIZING_PROP):e.BOX_SIZING_PROP,e.transitionProp=e.transitionPrefix?e.transitionPrefix+a.pascalCase(e.TRANSITION_PROP):e.TRANSITION_PROP,e.transformProp=e.transformPrefix?e.transformPrefix+a.pascalCase(e.TRANSFORM_PROP):e.TRANSFORM_PROP,e.transformRule=e.transformPrefix?"-"+e.transformPrefix+"-"+e.TRANSFORM_PROP:e.TRANSFORM_PROP,e.perspectiveProp=e.transformPrefix?e.transformPrefix+a.pascalCase(e.PERSPECTIVE_PROP):e.PERSPECTIVE_PROP,e.perspectiveOriginProp=e.transformPrefix?e.transformPrefix+a.pascalCase(e.PERSPECTIVE_ORIGIN_PROP):e.PERSPECTIVE_ORIGIN_PROP,e.callActions("afterSetPrefixes",arguments)}}),t.Has=function(){this.transitions=!1,this.promises=!1,a.seal(this)},t.features=new t.Features,t.features.init(),t.ConfigAnimation=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.enable=!0,this.effects="fade scale",this.effectsIn="",this.effectsOut="",this.duration=600,this.easing="ease",this.applyPerspective=!0,this.perspectiveDistance="3000px",this.perspectiveOrigin="50% 50%",this.queue=!0,this.queueLimit=3,this.animateResizeContainer=!0,this.animateResizeTargets=!1,this.staggerSequence=null,this.reverseOut=!1,this.nudge=!0,this.clampHeight=!0,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigAnimation),t.ConfigAnimation.prototype=Object.create(t.Base.prototype),t.ConfigAnimation.prototype.constructor=t.ConfigAnimation,t.ConfigCallbacks=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.onMixStart=null,this.onMixBusy=null,this.onMixEnd=null,this.onMixFail=null,this.onMixClick=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigCallbacks),t.ConfigCallbacks.prototype=Object.create(t.Base.prototype),t.ConfigCallbacks.prototype.constructor=t.ConfigCallbacks,t.ConfigControls=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.enable=!0,this.live=!1,this.scope="global",this.toggleLogic="or",this.toggleDefault="all",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigControls),t.ConfigControls.prototype=Object.create(t.Base.prototype),t.ConfigControls.prototype.constructor=t.ConfigControls,t.ConfigClassNames=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.block="mixitup",this.elementContainer="container",this.elementFilter="control",this.elementSort="control",this.elementMultimix="control",this.elementToggle="control",this.modifierActive="active",this.modifierDisabled="disabled",this.modifierFailed="failed",this.delineatorElement="-",this.delineatorModifier="-",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigClassNames),t.ConfigClassNames.prototype=Object.create(t.Base.prototype),t.ConfigClassNames.prototype.constructor=t.ConfigClassNames,t.ConfigData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.uidKey="",this.dirtyCheck=!1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigData),t.ConfigData.prototype=Object.create(t.Base.prototype),t.ConfigData.prototype.constructor=t.ConfigData,t.ConfigDebug=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.enable=!1,this.showWarnings=!0,this.fauxAsync=!1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigDebug),t.ConfigDebug.prototype=Object.create(t.Base.prototype),t.ConfigDebug.prototype.constructor=t.ConfigDebug,t.ConfigLayout=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.allowNestedTargets=!0,this.containerClassName="",this.siblingBefore=null,this.siblingAfter=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigLayout),t.ConfigLayout.prototype=Object.create(t.Base.prototype),t.ConfigLayout.prototype.constructor=t.ConfigLayout,t.ConfigLoad=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.filter="all",this.sort="default:asc",this.dataset=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigLoad),t.ConfigLoad.prototype=Object.create(t.Base.prototype),t.ConfigLoad.prototype.constructor=t.ConfigLoad,t.ConfigSelectors=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.target=".mix",this.control="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigSelectors),t.ConfigSelectors.prototype=Object.create(t.Base.prototype),t.ConfigSelectors.prototype.constructor=t.ConfigSelectors,t.ConfigRender=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.target=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigRender),t.ConfigRender.prototype=Object.create(t.Base.prototype),t.ConfigRender.prototype.constructor=t.ConfigRender,t.ConfigTemplates=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigTemplates),t.ConfigTemplates.prototype=Object.create(t.Base.prototype),t.ConfigTemplates.prototype.constructor=t.ConfigTemplates,t.Config=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.animation=new t.ConfigAnimation,this.callbacks=new t.ConfigCallbacks,this.controls=new t.ConfigControls,this.classNames=new t.ConfigClassNames,this.data=new t.ConfigData,this.debug=new t.ConfigDebug,this.layout=new t.ConfigLayout,this.load=new t.ConfigLoad,this.selectors=new t.ConfigSelectors,this.render=new t.ConfigRender,this.templates=new t.ConfigTemplates,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Config),t.Config.prototype=Object.create(t.Base.prototype),t.Config.prototype.constructor=t.Config,t.MixerDom=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.document=null,this.body=null,this.container=null,this.parent=null,this.targets=[],this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.MixerDom),t.MixerDom.prototype=Object.create(t.Base.prototype),t.MixerDom.prototype.constructor=t.MixerDom,t.UiClassNames=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.base="",this.active="",this.disabled="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.UiClassNames),t.UiClassNames.prototype=Object.create(t.Base.prototype),t.UiClassNames.prototype.constructor=t.UiClassNames,t.CommandDataset=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.dataset=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandDataset),t.CommandDataset.prototype=Object.create(t.Base.prototype),t.CommandDataset.prototype.constructor=t.CommandDataset,t.CommandMultimix=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.filter=null,this.sort=null,this.insert=null,this.remove=null,this.changeLayout=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandMultimix),t.CommandMultimix.prototype=Object.create(t.Base.prototype),t.CommandMultimix.prototype.constructor=t.CommandMultimix,t.CommandFilter=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.selector="",this.collection=null,this.action="show",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandFilter),t.CommandFilter.prototype=Object.create(t.Base.prototype),t.CommandFilter.prototype.constructor=t.CommandFilter,t.CommandSort=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.sortString="",this.attribute="",this.order="asc",this.collection=null,this.next=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandSort),t.CommandSort.prototype=Object.create(t.Base.prototype),t.CommandSort.prototype.constructor=t.CommandSort,t.CommandInsert=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.index=0,this.collection=[],this.position="before",this.sibling=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandInsert),t.CommandInsert.prototype=Object.create(t.Base.prototype),t.CommandInsert.prototype.constructor=t.CommandInsert,t.CommandRemove=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.targets=[],this.collection=[],this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandRemove),t.CommandRemove.prototype=Object.create(t.Base.prototype),t.CommandRemove.prototype.constructor=t.CommandRemove,t.CommandChangeLayout=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.containerClassName="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandChangeLayout),t.CommandChangeLayout.prototype=Object.create(t.Base.prototype),t.CommandChangeLayout.prototype.constructor=t.CommandChangeLayout,t.ControlDefinition=function(e,n,o,i){t.Base.call(this),this.callActions("beforeConstruct"),this.type=e,this.selector=n,this.live=o||!1,this.parent=i||"",this.callActions("afterConstruct"),a.freeze(this),a.seal(this)},t.BaseStatic.call(t.ControlDefinition),t.ControlDefinition.prototype=Object.create(t.Base.prototype),t.ControlDefinition.prototype.constructor=t.ControlDefinition,t.controlDefinitions=[],t.controlDefinitions.push(new t.ControlDefinition("multimix","[data-filter][data-sort]")),t.controlDefinitions.push(new t.ControlDefinition("filter","[data-filter]")),t.controlDefinitions.push(new t.ControlDefinition("sort","[data-sort]")),t.controlDefinitions.push(new t.ControlDefinition("toggle","[data-toggle]")),t.Control=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.el=null,this.selector="",this.bound=[],this.pending=-1,this.type="",this.status="inactive",this.filter="",this.sort="",this.canDisable=!1,this.handler=null,this.classNames=new t.UiClassNames,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Control),t.Control.prototype=Object.create(t.Base.prototype),a.extend(t.Control.prototype,{constructor:t.Control,init:function(e,a,n){var o=this;if(this.callActions("beforeInit",arguments),o.el=e,o.type=a,o.selector=n,o.selector)o.status="live";else switch(o.canDisable="boolean"==typeof o.el.disable,o.type){case"filter":o.filter=o.el.getAttribute("data-filter");break;case"toggle":o.filter=o.el.getAttribute("data-toggle");break;case"sort":o.sort=o.el.getAttribute("data-sort");break;case"multimix":o.filter=o.el.getAttribute("data-filter"),o.sort=o.el.getAttribute("data-sort")}o.bindClick(),t.controls.push(o),this.callActions("afterInit",arguments)},isBound:function(e){var t=this,a=!1;return this.callActions("beforeIsBound",arguments),a=t.bound.indexOf(e)>-1,t.callFilters("afterIsBound",a,arguments)},addBinding:function(e){var t=this;this.callActions("beforeAddBinding",arguments),t.isBound()||t.bound.push(e),this.callActions("afterAddBinding",arguments)},removeBinding:function(e){var a=this,n=-1;this.callActions("beforeRemoveBinding",arguments),(n=a.bound.indexOf(e))>-1&&a.bound.splice(n,1),a.bound.length<1&&(a.unbindClick(),n=t.controls.indexOf(a),t.controls.splice(n,1),"active"===a.status&&a.renderStatus(a.el,"inactive")),this.callActions("afterRemoveBinding",arguments)},bindClick:function(){var e=this;this.callActions("beforeBindClick",arguments),e.handler=function(t){e.handleClick(t)},a.on(e.el,"click",e.handler),this.callActions("afterBindClick",arguments)},unbindClick:function(){var e=this;this.callActions("beforeUnbindClick",arguments),a.off(e.el,"click",e.handler),e.handler=null,this.callActions("afterUnbindClick",arguments)},handleClick:function(e){var n=this,o=null,i=null,s=!1,r=void 0,l={},c=null,d=[],u=-1;if(this.callActions("beforeHandleClick",arguments),this.pending=0,i=n.bound[0],o=n.selector?a.closestParent(e.target,i.config.selectors.control+n.selector,!0,i.dom.document):n.el,!o)return void n.callActions("afterHandleClick",arguments);switch(n.type){case"filter":l.filter=n.filter||o.getAttribute("data-filter");break;case"sort":l.sort=n.sort||o.getAttribute("data-sort");break;case"multimix":l.filter=n.filter||o.getAttribute("data-filter"),l.sort=n.sort||o.getAttribute("data-sort");break;case"toggle":l.filter=n.filter||o.getAttribute("data-toggle"),s="live"===n.status?a.hasClass(o,n.classNames.active):"active"===n.status}for(u=0;u<n.bound.length;u++)c=new t.CommandMultimix,a.extend(c,l),d.push(c);for(d=n.callFilters("commandsHandleClick",d,arguments),n.pending=n.bound.length,u=0;i=n.bound[u];u++)l=d[u],l&&(i.lastClicked||(i.lastClicked=o),t.events.fire("mixClick",i.dom.container,{state:i.state,instance:i,originalEvent:e,control:i.lastClicked},i.dom.document),"function"==typeof i.config.callbacks.onMixClick&&(r=i.config.callbacks.onMixClick.call(i.lastClicked,i.state,e,i),r===!1)||("toggle"===n.type?s?i.toggleOff(l.filter):i.toggleOn(l.filter):i.multimix(l)));this.callActions("afterHandleClick",arguments)},update:function(e,a){var n=this,o=new t.CommandMultimix;n.callActions("beforeUpdate",arguments),n.pending--,n.pending=Math.max(0,n.pending),n.pending>0||("live"===n.status?n.updateLive(e,a):(o.sort=n.sort,o.filter=n.filter,n.callFilters("actionsUpdate",o,arguments),n.parseStatusChange(n.el,e,o,a)),n.callActions("afterUpdate",arguments))},updateLive:function(e,a){var n=this,o=null,i=null,s=null,r=-1;if(n.callActions("beforeUpdateLive",arguments),n.el){for(o=n.el.querySelectorAll(n.selector),r=0;s=o[r];r++){switch(i=new t.CommandMultimix,n.type){case"filter":i.filter=s.getAttribute("data-filter");break;case"sort":i.sort=s.getAttribute("data-sort");break;case"multimix":i.filter=s.getAttribute("data-filter"),i.sort=s.getAttribute("data-sort");break;case"toggle":i.filter=s.getAttribute("data-toggle")}i=n.callFilters("actionsUpdateLive",i,arguments),n.parseStatusChange(s,e,i,a)}n.callActions("afterUpdateLive",arguments)}},parseStatusChange:function(e,t,a,n){var o=this,i="",s="",r=-1;switch(o.callActions("beforeParseStatusChange",arguments),o.type){case"filter":t.filter===a.filter?o.renderStatus(e,"active"):o.renderStatus(e,"inactive");break;case"multimix":t.sort===a.sort&&t.filter===a.filter?o.renderStatus(e,"active"):o.renderStatus(e,"inactive");break;case"sort":t.sort.match(/:asc/g)&&(i=t.sort.replace(/:asc/g,"")),t.sort===a.sort||i===a.sort?o.renderStatus(e,"active"):o.renderStatus(e,"inactive");break;case"toggle":for(n.length<1&&o.renderStatus(e,"inactive"),t.filter===a.filter&&o.renderStatus(e,"active"),r=0;r<n.length;r++){if(s=n[r],s===a.filter){o.renderStatus(e,"active");break}o.renderStatus(e,"inactive")}}o.callActions("afterParseStatusChange",arguments)},renderStatus:function(e,t){var n=this;switch(n.callActions("beforeRenderStatus",arguments),t){case"active":a.addClass(e,n.classNames.active),a.removeClass(e,n.classNames.disabled),n.canDisable&&(n.el.disabled=!1);break;case"inactive":a.removeClass(e,n.classNames.active),a.removeClass(e,n.classNames.disabled),n.canDisable&&(n.el.disabled=!1);break;case"disabled":n.canDisable&&(n.el.disabled=!0),a.addClass(e,n.classNames.disabled),a.removeClass(e,n.classNames.active)}"live"!==n.status&&(n.status=t),n.callActions("afterRenderStatus",arguments)}}),t.controls=[],t.StyleData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.x=0,this.y=0,this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.marginRight=0,this.marginBottom=0,this.opacity=0,this.scale=new t.TransformData,this.translateX=new t.TransformData,this.translateY=new t.TransformData,this.translateZ=new t.TransformData,this.rotateX=new t.TransformData,this.rotateY=new t.TransformData,this.rotateZ=new t.TransformData,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.StyleData),t.StyleData.prototype=Object.create(t.Base.prototype),t.StyleData.prototype.constructor=t.StyleData,t.TransformData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.value=0,this.unit="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.TransformData),t.TransformData.prototype=Object.create(t.Base.prototype),t.TransformData.prototype.constructor=t.TransformData,t.TransformDefaults=function(){t.StyleData.apply(this),this.callActions("beforeConstruct"),this.scale.value=.01,this.scale.unit="",this.translateX.value=20,this.translateX.unit="px",this.translateY.value=20,this.translateY.unit="px",this.translateZ.value=20,this.translateZ.unit="px",this.rotateX.value=90,this.rotateX.unit="deg",this.rotateY.value=90,this.rotateY.unit="deg",this.rotateX.value=90,this.rotateX.unit="deg",this.rotateZ.value=180,this.rotateZ.unit="deg",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.TransformDefaults),t.TransformDefaults.prototype=Object.create(t.StyleData.prototype),t.TransformDefaults.prototype.constructor=t.TransformDefaults,t.transformDefaults=new t.TransformDefaults,t.EventDetail=function(){this.state=null,this.futureState=null,this.instance=null,this.originalEvent=null},t.Events=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.mixStart=null,this.mixBusy=null,this.mixEnd=null,this.mixFail=null,this.mixClick=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Events),t.Events.prototype=Object.create(t.Base.prototype),t.Events.prototype.constructor=t.Events,t.Events.prototype.fire=function(e,n,o,i){var s=this,r=null,l=new t.EventDetail;if(s.callActions("beforeFire",arguments),"undefined"==typeof s[e])throw new Error('Event type "'+e+'" not found.');l.state=new t.State,a.extend(l.state,o.state),o.futureState&&(l.futureState=new t.State,a.extend(l.futureState,o.futureState)),l.instance=o.instance,o.originalEvent&&(l.originalEvent=o.originalEvent),r=a.getCustomEvent(e,l,i),s.callFilters("eventFire",r,arguments),n.dispatchEvent(r)},t.events=new t.Events,t.QueueItem=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.args=[],this.instruction=null,this.triggerElement=null,this.deferred=null,this.isToggling=!1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.QueueItem),t.QueueItem.prototype=Object.create(t.Base.prototype),t.QueueItem.prototype.constructor=t.QueueItem,t.Mixer=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.config=new t.Config,this.id="",this.isBusy=!1,this.isToggling=!1,this.incPadding=!0,this.controls=[],this.targets=[],this.origOrder=[],this.cache={},this.toggleArray=[],this.targetsMoved=0,this.targetsImmovable=0,this.targetsBound=0,this.targetsDone=0,this.staggerDuration=0,this.effectsIn=null,this.effectsOut=null,this.transformIn=[],this.transformOut=[],this.queue=[],this.state=null,this.lastOperation=null,this.lastClicked=null,this.userCallback=null,this.userDeferred=null,this.dom=new t.MixerDom,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Mixer),t.Mixer.prototype=Object.create(t.Base.prototype),a.extend(t.Mixer.prototype,{constructor:t.Mixer,attach:function(n,o,i,s){var r=this,l=null,c=-1;for(r.callActions("beforeAttach",arguments),r.id=i,s&&a.extend(r.config,s,!0,!0),r.sanitizeConfig(),r.cacheDom(n,o),r.config.layout.containerClassName&&a.addClass(r.dom.container,r.config.layout.containerClassName),t.features.has.transitions||(r.config.animation.enable=!1),"undefined"==typeof e.console&&(r.config.debug.showWarnings=!1),r.config.data.uidKey&&(r.config.controls.enable=!1),r.indexTargets(),r.state=r.getInitialState(),c=0;l=r.lastOperation.toHide[c];c++)l.hide();r.config.controls.enable&&(r.initControls(),r.updateControls({filter:r.state.activeFilter,sort:r.state.activeSort}),r.buildToggleArray(null,r.state)),r.parseEffects(),r.callActions("afterAttach",arguments)},sanitizeConfig:function(){var e=this;e.callActions("beforeSanitizeConfig",arguments),e.config.controls.scope=e.config.controls.scope.toLowerCase().trim(),e.config.controls.toggleLogic=e.config.controls.toggleLogic.toLowerCase().trim(),e.config.controls.toggleDefault=e.config.controls.toggleDefault.toLowerCase().trim(),e.config.animation.effects=e.config.animation.effects.trim(),e.callActions("afterSanitizeConfig",arguments)},getInitialState:function(){var e=this,a=new t.State,n=new t.Operation;if(e.callActions("beforeGetInitialState",arguments),a.activeContainerClassName=e.config.layout.containerClassName,
e.config.load.dataset){if(!e.config.data.uidKey||"string"!=typeof e.config.data.uidKey)throw new TypeError(t.messages.errorConfigDataUidKeyNotSet());n.startDataset=n.newDataset=a.activeDataset=e.config.load.dataset.slice(),n.startContainerClassName=n.newContainerClassName=a.activeContainerClassName,n.show=e.targets.slice(),a=e.callFilters("stateGetInitialState",a,arguments)}else a.activeFilter=e.parseFilterArgs([e.config.load.filter]).command,a.activeSort=e.parseSortArgs([e.config.load.sort]).command,a.totalTargets=e.targets.length,a=e.callFilters("stateGetInitialState",a,arguments),a.activeSort.collection||a.activeSort.attribute||"random"===a.activeSort.order||"desc"===a.activeSort.order?(n.newSort=a.activeSort,e.sortOperation(n),e.printSort(!1,n),e.targets=n.newOrder):n.startOrder=n.newOrder=e.targets,n.startFilter=n.newFilter=a.activeFilter,n.startSort=n.newSort=a.activeSort,n.startContainerClassName=n.newContainerClassName=a.activeContainerClassName,"all"===n.newFilter.selector?n.newFilter.selector=e.config.selectors.target:"none"===n.newFilter.selector&&(n.newFilter.selector="");return n=e.callFilters("operationGetInitialState",n,[a]),e.lastOperation=n,n.newFilter&&e.filterOperation(n),a=e.buildState(n)},cacheDom:function(e,t){var a=this;a.callActions("beforeCacheDom",arguments),a.dom.document=t,a.dom.body=a.dom.document.querySelector("body"),a.dom.container=e,a.dom.parent=e,a.callActions("afterCacheDom",arguments)},indexTargets:function(){var e=this,n=null,o=null,i=null,s=-1;if(e.callActions("beforeIndexTargets",arguments),e.dom.targets=e.config.layout.allowNestedTargets?e.dom.container.querySelectorAll(e.config.selectors.target):a.children(e.dom.container,e.config.selectors.target,e.dom.document),e.dom.targets=a.arrayFromList(e.dom.targets),e.targets=[],(i=e.config.load.dataset)&&i.length!==e.dom.targets.length)throw new Error(t.messages.errorDatasetPrerenderedMismatch());if(e.dom.targets.length){for(s=0;o=e.dom.targets[s];s++)n=new t.Target,n.init(o,e,i?i[s]:void 0),n.isInDom=!0,e.targets.push(n);e.dom.parent=e.dom.targets[0].parentElement===e.dom.container?e.dom.container:e.dom.targets[0].parentElement}e.origOrder=e.targets,e.callActions("afterIndexTargets",arguments)},initControls:function(){var e=this,a="",n=null,o=null,i=null,s=null,r=null,l=-1,c=-1;switch(e.callActions("beforeInitControls",arguments),e.config.controls.scope){case"local":i=e.dom.container;break;case"global":i=e.dom.document;break;default:throw new Error(t.messages.errorConfigInvalidControlsScope())}for(l=0;a=t.controlDefinitions[l];l++)if(e.config.controls.live||a.live){if(a.parent){if(s=e.dom[a.parent],!s||s.length<0)continue;"number"!=typeof s.length&&(s=[s])}else s=[i];for(c=0;o=s[c];c++)r=e.getControl(o,a.type,a.selector),e.controls.push(r)}else for(n=i.querySelectorAll(e.config.selectors.control+a.selector),c=0;o=n[c];c++)r=e.getControl(o,a.type,""),r&&e.controls.push(r);e.callActions("afterInitControls",arguments)},getControl:function(e,n,o){var i=this,s=null,r=-1;if(i.callActions("beforeGetControl",arguments),!o)for(r=0;s=t.controls[r];r++){if(s.el===e&&s.isBound(i))return i.callFilters("controlGetControl",null,arguments);if(s.el===e&&s.type===n&&s.selector===o)return s.addBinding(i),i.callFilters("controlGetControl",s,arguments)}return s=new t.Control,s.init(e,n,o),s.classNames.base=a.getClassname(i.config.classNames,n),s.classNames.active=a.getClassname(i.config.classNames,n,i.config.classNames.modifierActive),s.classNames.disabled=a.getClassname(i.config.classNames,n,i.config.classNames.modifierDisabled),s.addBinding(i),i.callFilters("controlGetControl",s,arguments)},getToggleSelector:function(){var e=this,t="or"===e.config.controls.toggleLogic?", ":"",n="";return e.callActions("beforeGetToggleSelector",arguments),e.toggleArray=a.clean(e.toggleArray),n=e.toggleArray.join(t),""===n&&(n=e.config.controls.toggleDefault),e.callFilters("selectorGetToggleSelector",n,arguments)},buildToggleArray:function(e,t){var n=this,o="";if(n.callActions("beforeBuildToggleArray",arguments),e&&e.filter)o=e.filter.selector.replace(/\s/g,"");else{if(!t)return;o=t.activeFilter.selector.replace(/\s/g,"")}o!==n.config.selectors.target&&"all"!==o||(o=""),"or"===n.config.controls.toggleLogic?n.toggleArray=o.split(","):n.toggleArray=n.splitCompoundSelector(o),n.toggleArray=a.clean(n.toggleArray),n.callActions("afterBuildToggleArray",arguments)},splitCompoundSelector:function(e){var t=e.split(/([\.\[])/g),a=[],n="",o=-1;for(""===t[0]&&t.shift(),o=0;o<t.length;o++)o%2===0&&(n=""),n+=t[o],o%2!==0&&a.push(n);return a},updateControls:function(e){var n=this,o=null,i=new t.CommandMultimix,s=-1;for(n.callActions("beforeUpdateControls",arguments),e.filter?i.filter=e.filter.selector:i.filter=n.state.activeFilter.selector,e.sort?i.sort=n.buildSortString(e.sort):i.sort=n.buildSortString(n.state.activeSort),i.filter===n.config.selectors.target&&(i.filter="all"),""===i.filter&&(i.filter="none"),a.freeze(i),s=0;o=n.controls[s];s++)o.update(i,n.toggleArray);n.callActions("afterUpdateControls",arguments)},buildSortString:function(e){var t=this,a="";return a+=e.sortString,e.next&&(a+=" "+t.buildSortString(e.next)),a},insertTargets:function(e,n){var o=this,i=null,s=-1,r=null,l=null,c=null,d=-1;if(o.callActions("beforeInsertTargets",arguments),"undefined"==typeof e.index&&(e.index=0),i=o.getNextSibling(e.index,e.sibling,e.position),r=o.dom.document.createDocumentFragment(),s=i?a.index(i,o.config.selectors.target):o.targets.length,e.collection){for(d=0;c=e.collection[d];d++){if(o.dom.targets.indexOf(c)>-1)throw new Error(t.messages.errorInsertPreexistingElement());c.style.display="none",r.appendChild(c),r.appendChild(o.dom.document.createTextNode(" ")),a.isElement(c,o.dom.document)&&c.matches(o.config.selectors.target)&&(l=new t.Target,l.init(c,o),l.isInDom=!0,o.targets.splice(s,0,l),s++)}o.dom.parent.insertBefore(r,i)}n.startOrder=o.origOrder=o.targets,o.callActions("afterInsertTargets",arguments)},getNextSibling:function(e,t,a){var n=this,o=null;return e=Math.max(e,0),t&&"before"===a?o=t:t&&"after"===a?o=t.nextElementSibling||null:n.targets.length>0&&"undefined"!=typeof e?o=e<n.targets.length||!n.targets.length?n.targets[e].dom.el:n.targets[n.targets.length-1].dom.el.nextElementSibling:0===n.targets.length&&n.dom.parent.children.length>0&&(n.config.layout.siblingAfter?o=n.config.layout.siblingAfter:n.config.layout.siblingBefore?o=n.config.layout.siblingBefore.nextElementSibling:n.dom.parent.children[0]),n.callFilters("elementGetNextSibling",o,arguments)},filterOperation:function(e){var t=this,a=!1,n=-1,o="",i=null,s=-1;for(t.callActions("beforeFilterOperation",arguments),o=e.newFilter.action,s=0;i=e.newOrder[s];s++)a=e.newFilter.collection?e.newFilter.collection.indexOf(i.dom.el)>-1:""!==e.newFilter.selector&&i.dom.el.matches(e.newFilter.selector),t.evaluateHideShow(a,i,o,e);if(e.toRemove.length)for(s=0;i=e.show[s];s++)e.toRemove.indexOf(i)>-1&&(e.show.splice(s,1),(n=e.toShow.indexOf(i))>-1&&e.toShow.splice(n,1),e.toHide.push(i),e.hide.push(i),s--);e.matching=e.show.slice(),0===e.show.length&&""!==e.newFilter.selector&&0!==t.targets.length&&(e.hasFailed=!0),t.callActions("afterFilterOperation",arguments)},evaluateHideShow:function(e,t,a,n){var o=this;o.callActions("beforeEvaluateHideShow",arguments),e===!0&&"show"===a||e===!1&&"hide"===a?(n.show.push(t),!t.isShown&&n.toShow.push(t)):(n.hide.push(t),t.isShown&&n.toHide.push(t)),o.callActions("afterEvaluateHideShow",arguments)},sortOperation:function(e){var t=this;t.callActions("beforeSortOperation",arguments),e.startOrder=t.targets,e.newSort.collection?e.newOrder=e.newSort.collection:"random"===e.newSort.order?e.newOrder=a.arrayShuffle(e.startOrder):""===e.newSort.attribute?(e.newOrder=t.origOrder.slice(),"desc"===e.newSort.order&&e.newOrder.reverse()):(e.newOrder=e.startOrder.slice(),e.newOrder.sort(function(a,n){return t.compare(a,n,e.newSort)})),a.isEqualArray(e.newOrder,e.startOrder)&&(e.willSort=!1),t.callActions("afterSortOperation",arguments)},compare:function(e,t,a){var n=this,o=a.order,i=n.getAttributeValue(e,a.attribute),s=n.getAttributeValue(t,a.attribute);return isNaN(1*i)||isNaN(1*s)?(i=i.toLowerCase(),s=s.toLowerCase()):(i=1*i,s=1*s),i<s?"asc"===o?-1:1:i>s?"asc"===o?1:-1:i===s&&a.next?n.compare(e,t,a.next):0},getAttributeValue:function(e,a){var n=this,o="";return o=e.dom.el.getAttribute("data-"+a),null===o&&n.config.debug.showWarnings&&console.warn(t.messages.warningInconsistentSortingAttributes({attribute:"data-"+a})),n.callFilters("valueGetAttributeValue",o||0,arguments)},printSort:function(t,n){var o=this,i=t?n.newOrder:n.startOrder,s=t?n.startOrder:n.newOrder,r=i.length?i[i.length-1].dom.el.nextElementSibling:null,l=e.document.createDocumentFragment(),c=null,d=null,u=null,m=-1;for(o.callActions("beforePrintSort",arguments),m=0;d=i[m];m++)u=d.dom.el,"absolute"!==u.style.position&&(a.removeWhitespace(u.previousSibling),u.parentElement.removeChild(u));for(c=r?r.previousSibling:o.dom.parent.lastChild,c&&"#text"===c.nodeName&&a.removeWhitespace(c),m=0;d=s[m];m++)u=d.dom.el,a.isElement(l.lastChild)&&l.appendChild(e.document.createTextNode(" ")),l.appendChild(u);o.dom.parent.firstChild&&o.dom.parent.firstChild!==r&&l.insertBefore(e.document.createTextNode(" "),l.childNodes[0]),r?(l.appendChild(e.document.createTextNode(" ")),o.dom.parent.insertBefore(l,r)):o.dom.parent.appendChild(l),o.callActions("afterPrintSort",arguments)},parseSortString:function(e,n){var o=this,i=e.split(" "),s=n,r=[],l=-1;for(l=0;l<i.length;l++){switch(r=i[l].split(":"),s.sortString=i[l],s.attribute=a.dashCase(r[0]),s.order=r[1]||"asc",s.attribute){case"default":s.attribute="";break;case"random":s.attribute="",s.order="random"}if(!s.attribute||"random"===s.order)break;l<i.length-1&&(s.next=new t.CommandSort,a.freeze(s),s=s.next)}return o.callFilters("commandsParseSort",n,arguments)},parseEffects:function(){var e=this,a="",n=e.config.animation.effectsIn||e.config.animation.effects,o=e.config.animation.effectsOut||e.config.animation.effects;e.callActions("beforeParseEffects",arguments),e.effectsIn=new t.StyleData,e.effectsOut=new t.StyleData,e.transformIn=[],e.transformOut=[],e.effectsIn.opacity=e.effectsOut.opacity=1,e.parseEffect("fade",n,e.effectsIn,e.transformIn),e.parseEffect("fade",o,e.effectsOut,e.transformOut,!0);for(a in t.transformDefaults)t.transformDefaults[a]instanceof t.TransformData&&(e.parseEffect(a,n,e.effectsIn,e.transformIn),e.parseEffect(a,o,e.effectsOut,e.transformOut,!0));e.parseEffect("stagger",n,e.effectsIn,e.transformIn),e.parseEffect("stagger",o,e.effectsOut,e.transformOut,!0),e.callActions("afterParseEffects",arguments)},parseEffect:function(e,a,n,o,i){var s=this,r=/\(([^)]+)\)/,l=-1,c="",d=[],u="",m=["%","px","em","rem","vh","vw","deg"],p="",f=-1;if(s.callActions("beforeParseEffect",arguments),"string"!=typeof a)throw new TypeError(t.messages.errorConfigInvalidAnimationEffects());if(a.indexOf(e)<0)return void("stagger"===e&&(s.staggerDuration=0));switch(l=a.indexOf(e+"("),l>-1&&(c=a.substring(l),d=r.exec(c),u=d[1]),e){case"fade":n.opacity=u?parseFloat(u):0;break;case"stagger":s.staggerDuration=u?parseFloat(u):100;break;default:if(i&&s.config.animation.reverseOut&&"scale"!==e?n[e].value=(u?parseFloat(u):t.transformDefaults[e].value)*-1:n[e].value=u?parseFloat(u):t.transformDefaults[e].value,u){for(f=0;p=m[f];f++)if(u.indexOf(p)>-1){n[e].unit=p;break}}else n[e].unit=t.transformDefaults[e].unit;o.push(e+"("+n[e].value+n[e].unit+")")}s.callActions("afterParseEffect",arguments)},buildState:function(e){var a=this,n=new t.State,o=null,i=-1;for(a.callActions("beforeBuildState",arguments),i=0;o=a.targets[i];i++)(!e.toRemove.length||e.toRemove.indexOf(o)<0)&&n.targets.push(o.dom.el);for(i=0;o=e.matching[i];i++)n.matching.push(o.dom.el);for(i=0;o=e.show[i];i++)n.show.push(o.dom.el);for(i=0;o=e.hide[i];i++)(!e.toRemove.length||e.toRemove.indexOf(o)<0)&&n.hide.push(o.dom.el);return n.id=a.id,n.container=a.dom.container,n.activeFilter=e.newFilter,n.activeSort=e.newSort,n.activeDataset=e.newDataset,n.activeContainerClassName=e.newContainerClassName,n.hasFailed=e.hasFailed,n.totalTargets=a.targets.length,n.totalShow=e.show.length,n.totalHide=e.hide.length,n.totalMatching=e.matching.length,n.triggerElement=e.triggerElement,a.callFilters("stateBuildState",n,arguments)},goMix:function(n,o){var i=this,s=null;return i.callActions("beforeGoMix",arguments),i.config.animation.duration&&i.config.animation.effects&&a.isVisible(i.dom.container)||(n=!1),o.toShow.length||o.toHide.length||o.willSort||o.willChangeLayout||(n=!1),o.startState.show.length||o.show.length||(n=!1),t.events.fire("mixStart",i.dom.container,{state:o.startState,futureState:o.newState,instance:i},i.dom.document),"function"==typeof i.config.callbacks.onMixStart&&i.config.callbacks.onMixStart.call(i.dom.container,o.startState,o.newState,i),a.removeClass(i.dom.container,a.getClassname(i.config.classNames,"container",i.config.classNames.modifierFailed)),s=i.userDeferred?i.userDeferred:i.userDeferred=a.defer(t.libraries),i.isBusy=!0,n&&t.features.has.transitions?(e.pageYOffset!==o.docState.scrollTop&&e.scrollTo(o.docState.scrollLeft,o.docState.scrollTop),i.config.animation.applyPerspective&&(i.dom.parent.style[t.features.perspectiveProp]=i.config.animation.perspectiveDistance,i.dom.parent.style[t.features.perspectiveOriginProp]=i.config.animation.perspectiveOrigin),(i.config.animation.animateResizeContainer||o.startHeight===o.newHeight)&&(i.dom.parent.style.height=o.startHeight+"px"),(i.config.animation.animateResizeContainer||o.startWidth===o.newWidth)&&(i.dom.parent.style.width=o.startWidth+"px"),requestAnimationFrame(function(){i.moveTargets(o)}),i.callFilters("promiseGoMix",s.promise,arguments)):(i.config.debug.fauxAsync?setTimeout(function(){i.cleanUp(o)},i.config.animation.duration):i.cleanUp(o),i.callFilters("promiseGoMix",s.promise,arguments))},getStartMixData:function(a){var n=this,o=e.getComputedStyle(n.dom.parent),i=n.dom.parent.getBoundingClientRect(),s=null,r={},l=-1,c=o[t.features.boxSizingProp];for(n.incPadding="border-box"===c,n.callActions("beforeGetStartMixData",arguments),l=0;s=a.show[l];l++)r=s.getPosData(),a.showPosData[l]={startPosData:r};for(l=0;s=a.toHide[l];l++)r=s.getPosData(),a.toHidePosData[l]={startPosData:r};a.startX=i.left,a.startY=i.top,a.startHeight=n.incPadding?i.height:i.height-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)-parseFloat(o.borderTop)-parseFloat(o.borderBottom),a.startWidth=n.incPadding?i.width:i.width-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)-parseFloat(o.borderLeft)-parseFloat(o.borderRight),n.callActions("afterGetStartMixData",arguments)},setInter:function(e){var t=this,n=null,o=-1;for(t.callActions("beforeSetInter",arguments),t.config.animation.clampHeight&&(t.dom.parent.style.height=e.startHeight+"px",t.dom.parent.style.overflow="hidden"),o=0;n=e.toShow[o];o++)n.show();e.willChangeLayout&&(a.removeClass(t.dom.container,e.startContainerClassName),a.addClass(t.dom.container,e.newContainerClassName)),t.callActions("afterSetInter",arguments)},getInterMixData:function(e){var t=this,a=null,n=-1;for(t.callActions("beforeGetInterMixData",arguments),n=0;a=e.show[n];n++)e.showPosData[n].interPosData=a.getPosData();for(n=0;a=e.toHide[n];n++)e.toHidePosData[n].interPosData=a.getPosData();t.callActions("afterGetInterMixData",arguments)},setFinal:function(e){var t=this,a=null,n=-1;for(t.callActions("beforeSetFinal",arguments),t.config.animation.clampHeight&&(t.dom.parent.style.height=t.dom.parent.style.overflow=""),e.willSort&&t.printSort(!1,e),n=0;a=e.toHide[n];n++)a.hide();t.callActions("afterSetFinal",arguments)},getFinalMixData:function(t){var n=this,o=null,i=n.dom.parent.getBoundingClientRect(),s=null,r=-1;for(n.incPadding||(o=e.getComputedStyle(n.dom.parent)),n.callActions("beforeGetFinalMixData",arguments),r=0;s=t.show[r];r++)t.showPosData[r].finalPosData=s.getPosData();for(r=0;s=t.toHide[r];r++)t.toHidePosData[r].finalPosData=s.getPosData();for(t.newX=i.left,t.newY=i.top,t.newHeight=n.incPadding?i.height:i.height-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)-parseFloat(o.borderTop)-parseFloat(o.borderBottom),t.newWidth=n.incPadding?i.width:i.width-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)-parseFloat(o.borderLeft)-parseFloat(o.borderRight),t.willSort&&n.printSort(!0,t),r=0;s=t.toShow[r];r++)s.hide();for(r=0;s=t.toHide[r];r++)s.show();t.willChangeLayout&&(a.removeClass(n.dom.container,t.newContainerClassName),a.addClass(n.dom.container,n.config.layout.containerClassName)),n.callActions("afterGetFinalMixData",arguments)},getTweenData:function(e){var a=this,n=null,o=null,i=Object.getOwnPropertyNames(a.effectsIn),s="",r=null,l=-1,c=-1,d=-1,u=-1;for(a.callActions("beforeGetTweenData",arguments),d=0;n=e.show[d];d++)for(o=e.showPosData[d],o.posIn=new t.StyleData,o.posOut=new t.StyleData,o.tweenData=new t.StyleData,n.isShown?(o.posIn.x=o.startPosData.x-o.interPosData.x,o.posIn.y=o.startPosData.y-o.interPosData.y):o.posIn.x=o.posIn.y=0,o.posOut.x=o.finalPosData.x-o.interPosData.x,o.posOut.y=o.finalPosData.y-o.interPosData.y,o.posIn.opacity=n.isShown?1:a.effectsIn.opacity,o.posOut.opacity=1,o.tweenData.opacity=o.posOut.opacity-o.posIn.opacity,n.isShown||a.config.animation.nudge||(o.posIn.x=o.posOut.x,o.posIn.y=o.posOut.y),o.tweenData.x=o.posOut.x-o.posIn.x,o.tweenData.y=o.posOut.y-o.posIn.y,a.config.animation.animateResizeTargets&&(o.posIn.width=o.startPosData.width,o.posIn.height=o.startPosData.height,l=(o.startPosData.width||o.finalPosData.width)-o.interPosData.width,o.posIn.marginRight=o.startPosData.marginRight-l,c=(o.startPosData.height||o.finalPosData.height)-o.interPosData.height,o.posIn.marginBottom=o.startPosData.marginBottom-c,o.posOut.width=o.finalPosData.width,o.posOut.height=o.finalPosData.height,l=(o.finalPosData.width||o.startPosData.width)-o.interPosData.width,o.posOut.marginRight=o.finalPosData.marginRight-l,c=(o.finalPosData.height||o.startPosData.height)-o.interPosData.height,o.posOut.marginBottom=o.finalPosData.marginBottom-c,o.tweenData.width=o.posOut.width-o.posIn.width,o.tweenData.height=o.posOut.height-o.posIn.height,o.tweenData.marginRight=o.posOut.marginRight-o.posIn.marginRight,o.tweenData.marginBottom=o.posOut.marginBottom-o.posIn.marginBottom),u=0;s=i[u];u++)r=a.effectsIn[s],r instanceof t.TransformData&&r.value&&(o.posIn[s].value=r.value,o.posOut[s].value=0,o.tweenData[s].value=o.posOut[s].value-o.posIn[s].value,o.posIn[s].unit=o.posOut[s].unit=o.tweenData[s].unit=r.unit);for(d=0;n=e.toHide[d];d++)for(o=e.toHidePosData[d],o.posIn=new t.StyleData,o.posOut=new t.StyleData,o.tweenData=new t.StyleData,o.posIn.x=n.isShown?o.startPosData.x-o.interPosData.x:0,o.posIn.y=n.isShown?o.startPosData.y-o.interPosData.y:0,o.posOut.x=a.config.animation.nudge?0:o.posIn.x,o.posOut.y=a.config.animation.nudge?0:o.posIn.y,o.tweenData.x=o.posOut.x-o.posIn.x,o.tweenData.y=o.posOut.y-o.posIn.y,a.config.animation.animateResizeTargets&&(o.posIn.width=o.startPosData.width,o.posIn.height=o.startPosData.height,l=o.startPosData.width-o.interPosData.width,o.posIn.marginRight=o.startPosData.marginRight-l,c=o.startPosData.height-o.interPosData.height,o.posIn.marginBottom=o.startPosData.marginBottom-c),o.posIn.opacity=1,o.posOut.opacity=a.effectsOut.opacity,o.tweenData.opacity=o.posOut.opacity-o.posIn.opacity,u=0;s=i[u];u++)r=a.effectsOut[s],r instanceof t.TransformData&&r.value&&(o.posIn[s].value=0,o.posOut[s].value=r.value,o.tweenData[s].value=o.posOut[s].value-o.posIn[s].value,o.posIn[s].unit=o.posOut[s].unit=o.tweenData[s].unit=r.unit);a.callActions("afterGetTweenData",arguments)},moveTargets:function(e){var n=this,o=null,i=null,s=null,r="",l=!1,c=-1,d=-1,u=n.checkProgress.bind(n);for(n.callActions("beforeMoveTargets",arguments),d=0;o=e.show[d];d++)i=new t.IMoveData,s=e.showPosData[d],r=o.isShown?"none":"show",l=n.willTransition(r,e.hasEffect,s.posIn,s.posOut),l&&c++,o.show(),i.posIn=s.posIn,i.posOut=s.posOut,i.statusChange=r,i.staggerIndex=c,i.operation=e,i.callback=l?u:null,o.move(i);for(d=0;o=e.toHide[d];d++)s=e.toHidePosData[d],i=new t.IMoveData,r="hide",l=n.willTransition(r,s.posIn,s.posOut),i.posIn=s.posIn,i.posOut=s.posOut,i.statusChange=r,i.staggerIndex=d,i.operation=e,i.callback=l?u:null,o.move(i);n.config.animation.animateResizeContainer&&(n.dom.parent.style[t.features.transitionProp]="height "+n.config.animation.duration+"ms ease, width "+n.config.animation.duration+"ms ease ",requestAnimationFrame(function(){n.dom.parent.style.height=e.newHeight+"px",n.dom.parent.style.width=e.newWidth+"px"})),e.willChangeLayout&&(a.removeClass(n.dom.container,n.config.layout.ContainerClassName),a.addClass(n.dom.container,e.newContainerClassName)),n.callActions("afterMoveTargets",arguments)},hasEffect:function(){var e=this,t=["scale","translateX","translateY","translateZ","rotateX","rotateY","rotateZ"],a="",n=null,o=!1,i=-1,s=-1;if(1!==e.effectsIn.opacity)return e.callFilters("resultHasEffect",!0,arguments);for(s=0;a=t[s];s++)if(n=e.effectsIn[a],i="undefined"!==n.value?n.value:n,0!==i){o=!0;break}return e.callFilters("resultHasEffect",o,arguments)},willTransition:function(e,t,n,o){var i=this,s=!1;return s=!(!a.isVisible(i.dom.container)||!("none"!==e&&t||n.x!==o.x||n.y!==o.y)&&(!i.config.animation.animateResizeTargets||n.width===o.width&&n.height===o.height&&n.marginRight===o.marginRight&&n.marginTop===o.marginTop)),i.callFilters("resultWillTransition",s,arguments)},checkProgress:function(e){var t=this;t.targetsDone++,t.targetsBound===t.targetsDone&&t.cleanUp(e)},cleanUp:function(e){var n=this,o=null,i=null,s=null,r=null,l=-1;for(n.callActions("beforeCleanUp",arguments),n.targetsMoved=n.targetsImmovable=n.targetsBound=n.targetsDone=0,l=0;o=e.show[l];l++)o.cleanUp(),o.show();for(l=0;o=e.toHide[l];l++)o.cleanUp(),o.hide();if(e.willSort&&n.printSort(!1,e),n.dom.parent.style[t.features.transitionProp]=n.dom.parent.style.height=n.dom.parent.style.width=n.dom.parent.style[t.features.perspectiveProp]=n.dom.parent.style[t.features.perspectiveOriginProp]="",e.willChangeLayout&&(a.removeClass(n.dom.container,e.startContainerClassName),a.addClass(n.dom.container,e.newContainerClassName)),e.toRemove.length){for(l=0;o=n.targets[l];l++)e.toRemove.indexOf(o)>-1&&((i=o.dom.el.previousSibling)&&"#text"===i.nodeName&&(s=o.dom.el.nextSibling)&&"#text"===s.nodeName&&a.removeWhitespace(i),e.willSort||n.dom.parent.removeChild(o.dom.el),n.targets.splice(l,1),o.isInDom=!1,l--);n.origOrder=n.targets}e.willSort&&(n.targets=e.newOrder),n.state=e.newState,n.lastOperation=e,n.dom.targets=n.state.targets,t.events.fire("mixEnd",n.dom.container,{state:n.state,instance:n},n.dom.document),"function"==typeof n.config.callbacks.onMixEnd&&n.config.callbacks.onMixEnd.call(n.dom.container,n.state,n),e.hasFailed&&(t.events.fire("mixFail",n.dom.container,{state:n.state,instance:n},n.dom.document),"function"==typeof n.config.callbacks.onMixFail&&n.config.callbacks.onMixFail.call(n.dom.container,n.state,n),a.addClass(n.dom.container,a.getClassname(n.config.classNames,"container",n.config.classNames.modifierFailed))),"function"==typeof n.userCallback&&n.userCallback.call(n.dom.container,n.state,n),"function"==typeof n.userDeferred.resolve&&n.userDeferred.resolve(n.state),n.userCallback=null,n.userDeferred=null,n.lastClicked=null,n.isToggling=!1,n.isBusy=!1,n.queue.length&&(n.callActions("beforeReadQueueCleanUp",arguments),r=n.queue.shift(),n.userDeferred=r.deferred,n.isToggling=r.isToggling,n.lastClicked=r.triggerElement,r.instruction.command instanceof t.CommandMultimix?n.multimix.apply(n,r.args):n.dataset.apply(n,r.args)),n.callActions("afterCleanUp",arguments)},parseMultimixArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandMultimix,s=0;s<e.length;s++)i=e[s],null!==i&&("object"==typeof i?a.extend(o.command,i):"boolean"==typeof i?o.animate=i:"function"==typeof i&&(o.callback=i));return!o.command.insert||o.command.insert instanceof t.CommandInsert||(o.command.insert=n.parseInsertArgs([o.command.insert]).command),!o.command.remove||o.command.remove instanceof t.CommandRemove||(o.command.remove=n.parseRemoveArgs([o.command.remove]).command),!o.command.filter||o.command.filter instanceof t.CommandFilter||(o.command.filter=n.parseFilterArgs([o.command.filter]).command),!o.command.sort||o.command.sort instanceof t.CommandSort||(o.command.sort=n.parseSortArgs([o.command.sort]).command),!o.command.changeLayout||o.command.changeLayout instanceof t.CommandChangeLayout||(o.command.changeLayout=n.parseChangeLayoutArgs([o.command.changeLayout]).command),o=n.callFilters("instructionParseMultimixArgs",o,arguments),a.freeze(o),o},parseFilterArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandFilter,s=0;s<e.length;s++)i=e[s],"string"==typeof i?o.command.selector=i:null===i?o.command.collection=[]:"object"==typeof i&&a.isElement(i,n.dom.document)?o.command.collection=[i]:"object"==typeof i&&"undefined"!=typeof i.length?o.command.collection=a.arrayFromList(i):"object"==typeof i?a.extend(o.command,i):"boolean"==typeof i?o.animate=i:"function"==typeof i&&(o.callback=i);if(o.command.selector&&o.command.collection)throw new Error(t.messages.errorFilterInvalidArguments());return o=n.callFilters("instructionParseFilterArgs",o,arguments),a.freeze(o),o},parseSortArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s="",r=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandSort,r=0;r<e.length;r++)if(i=e[r],null!==i)switch(typeof i){case"string":s=i;break;case"object":i.length&&(o.command.collection=a.arrayFromList(i));break;case"boolean":o.animate=i;break;case"function":o.callback=i}return s&&(o.command=n.parseSortString(s,o.command)),o=n.callFilters("instructionParseSortArgs",o,arguments),a.freeze(o),o},parseInsertArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandInsert,s=0;s<e.length;s++)i=e[s],null!==i&&("number"==typeof i?o.command.index=i:"string"==typeof i&&["before","after"].indexOf(i)>-1?o.command.position=i:"string"==typeof i?o.command.collection=a.arrayFromList(a.createElement(i).childNodes):"object"==typeof i&&a.isElement(i,n.dom.document)?o.command.collection.length?o.command.sibling=i:o.command.collection=[i]:"object"==typeof i&&i.length?o.command.collection.length?o.command.sibling=i[0]:o.command.collection=i:"object"==typeof i&&i.childNodes&&i.childNodes.length?o.command.collection.length?o.command.sibling=i.childNodes[0]:o.command.collection=a.arrayFromList(i.childNodes):"object"==typeof i?a.extend(o.command,i):"boolean"==typeof i?o.animate=i:"function"==typeof i&&(o.callback=i));if(o.command.index&&o.command.sibling)throw new Error(t.messages.errorInsertInvalidArguments());return!o.command.collection.length&&n.config.debug.showWarnings&&console.warn(t.messages.warningInsertNoElements()),o=n.callFilters("instructionParseInsertArgs",o,arguments),a.freeze(o),o},parseRemoveArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=null,r=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandRemove,r=0;r<e.length;r++)if(s=e[r],null!==s)switch(typeof s){case"number":n.targets[s]&&(o.command.targets[0]=n.targets[s]);break;case"string":o.command.collection=a.arrayFromList(n.dom.parent.querySelectorAll(s));break;case"object":s&&s.length?o.command.collection=s:a.isElement(s,n.dom.document)?o.command.collection=[s]:a.extend(o.command,s);break;case"boolean":o.animate=s;break;case"function":o.callback=s}if(o.command.collection.length)for(r=0;i=n.targets[r];r++)o.command.collection.indexOf(i.dom.el)>-1&&o.command.targets.push(i);return!o.command.targets.length&&n.config.debug.showWarnings&&console.warn(t.messages.warningRemoveNoElements()),a.freeze(o),o},parseDatasetArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandDataset,s=0;s<e.length;s++)if(i=e[s],null!==i)switch(typeof i){case"object":Array.isArray(i)||"number"==typeof i.length?o.command.dataset=i:a.extend(o.command,i);break;case"boolean":o.animate=i;break;case"function":o.callback=i}return a.freeze(o),o},parseChangeLayoutArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandChangeLayout,s=0;s<e.length;s++)if(i=e[s],null!==i)switch(typeof i){case"string":o.command.containerClassName=i;break;case"object":a.extend(o.command,i);break;case"boolean":o.animate=i;break;case"function":o.callback=i}return a.freeze(o),o},queueMix:function(e){var n=this,o=null,i="";return n.callActions("beforeQueueMix",arguments),o=a.defer(t.libraries),n.config.animation.queue&&n.queue.length<n.config.animation.queueLimit?(e.deferred=o,n.queue.push(e),n.config.controls.enable&&(n.isToggling?(n.buildToggleArray(e.instruction.command),i=n.getToggleSelector(),n.updateControls({filter:{selector:i}})):n.updateControls(e.instruction.command))):(n.config.debug.showWarnings&&console.warn(t.messages.warningMultimixInstanceQueueFull()),o.resolve(n.state),t.events.fire("mixBusy",n.dom.container,{state:n.state,instance:n},n.dom.document),"function"==typeof n.config.callbacks.onMixBusy&&n.config.callbacks.onMixBusy.call(n.dom.container,n.state,n)),n.callFilters("promiseQueueMix",o.promise,arguments)},getDataOperation:function(e){var n=this,o=new t.Operation,i=[];if(o=n.callFilters("operationUnmappedGetDataOperation",o,arguments),n.dom.targets.length&&!(i=n.state.activeDataset||[]).length)throw new Error(t.messages.errorDatasetNotSet());return o.id=a.randomHex(),o.startState=n.state,o.startDataset=i,o.newDataset=e.slice(),n.diffDatasets(o),o.startOrder=n.targets,o.newOrder=o.show,n.config.animation.enable&&(n.getStartMixData(o),n.setInter(o),o.docState=a.getDocumentState(n.dom.document),n.getInterMixData(o),n.setFinal(o),n.getFinalMixData(o),n.parseEffects(),o.hasEffect=n.hasEffect(),n.getTweenData(o)),n.targets=o.show.slice(),o.newState=n.buildState(o),Array.prototype.push.apply(n.targets,o.toRemove),o=n.callFilters("operationMappedGetDataOperation",o,arguments)},diffDatasets:function(e){var n=this,o=[],i=[],s=[],r=null,l=null,c=null,d=null,u=null,m={},p="",f=-1;for(n.callActions("beforeDiffDatasets",arguments),f=0;r=e.newDataset[f];f++){if("undefined"==typeof(p=r[n.config.data.uidKey])||p.toString().length<1)throw new TypeError(t.messages.errorDatasetInvalidUidKey({uidKey:n.config.data.uidKey}));if(m[p])throw new Error(t.messages.errorDatasetDuplicateUid({uid:p}));m[p]=!0,(l=n.cache[p])instanceof t.Target?(n.config.data.dirtyCheck&&!a.deepEquals(r,l.data)&&(c=l.render(r),l.data=r,c!==l.dom.el&&(l.isInDom&&(l.unbindEvents(),n.dom.parent.replaceChild(c,l.dom.el)),l.isShown||(c.style.display="none"),l.dom.el=c,l.isInDom&&l.bindEvents())),c=l.dom.el):(l=new t.Target,l.init(null,n,r),l.hide()),l.isInDom?(u=l.dom.el.nextElementSibling,i.push(p),d&&(d.lastElementChild&&d.appendChild(n.dom.document.createTextNode(" ")),n.insertDatasetFrag(d,l.dom.el,n.targets.indexOf(l),s),d=null)):(d||(d=n.dom.document.createDocumentFragment()),d.lastElementChild&&d.appendChild(n.dom.document.createTextNode(" ")),d.appendChild(l.dom.el),l.isInDom=!0,l.unbindEvents(),l.bindEvents(),l.hide(),e.toShow.push(l),s.push(l)),e.show.push(l)}for(d&&(u=u||n.config.layout.siblingAfter,u&&d.appendChild(n.dom.document.createTextNode(" ")),n.insertDatasetFrag(d,u,n.dom.targets.length,s)),f=0;r=e.startDataset[f];f++)p=r[n.config.data.uidKey],l=n.cache[p],e.show.indexOf(l)<0?(e.hide.push(l),e.toHide.push(l),e.toRemove.push(l)):o.push(p);a.isEqualArray(o,i)||(e.willSort=!0),n.callActions("afterDiffDatasets",arguments)},insertDatasetFrag:function(e,t,a,n){var o=this;for(o.dom.parent.insertBefore(e,t);n.length;)o.targets.splice(a,0,n.shift()),a++},willSort:function(e,t){var a=this,n=!1;return n=!!("random"===e.order||e.attribute!==t.attribute||e.order!==t.order||e.collection!==t.collection||null===e.next&&t.next||e.next&&null===t.next)||!(!e.next||!t.next)&&a.willSort(e.next,t.next),
a.callFilters("resultWillSort",n,arguments)},show:function(){var e=this;return e.filter("all")},hide:function(){var e=this;return e.filter("none")},isMixing:function(){var e=this;return e.isBusy},filter:function(){var e=this,t=e.parseFilterArgs(arguments);return e.multimix({filter:t.command},t.animate,t.callback)},toggleOn:function(){var e=this,t=e.parseFilterArgs(arguments),a=t.command.selector,n="";return e.isToggling=!0,e.toggleArray.indexOf(a)<0&&e.toggleArray.push(a),n=e.getToggleSelector(),e.multimix({filter:n},t.animate,t.callback)},toggleOff:function(){var e=this,t=e.parseFilterArgs(arguments),a=t.command.selector,n="";return e.isToggling=!0,e.toggleArray.splice(e.toggleArray.indexOf(a),1),n=e.getToggleSelector(),e.multimix({filter:n},t.animate,t.callback)},sort:function(){var e=this,t=e.parseSortArgs(arguments);return e.multimix({sort:t.command},t.animate,t.callback)},changeLayout:function(){var e=this,t=e.parseChangeLayoutArgs(arguments);return e.multimix({changeLayout:t.command},t.animate,t.callback)},dataset:function(){var e=this,a=e.parseDatasetArgs(arguments),n=null,o=null,i=!1;return e.callActions("beforeDataset",arguments),e.isBusy?(o=new t.QueueItem,o.args=arguments,o.instruction=a,e.queueMix(o)):(a.callback&&(e.userCallback=a.callback),i=a.animate^e.config.animation.enable?a.animate:e.config.animation.enable,n=e.getDataOperation(a.command.dataset),e.goMix(i,n))},multimix:function(){var e=this,a=null,n=!1,o=null,i=e.parseMultimixArgs(arguments);return e.callActions("beforeMultimix",arguments),e.isBusy?(o=new t.QueueItem,o.args=arguments,o.instruction=i,o.triggerElement=e.lastClicked,o.isToggling=e.isToggling,e.queueMix(o)):(a=e.getOperation(i.command),e.config.controls.enable&&(i.command.filter&&!e.isToggling&&(e.toggleArray.length=0,e.buildToggleArray(a.command)),e.queue.length<1&&e.updateControls(a.command)),i.callback&&(e.userCallback=i.callback),n=i.animate^e.config.animation.enable?i.animate:e.config.animation.enable,e.callFilters("operationMultimix",a,arguments),e.goMix(n,a))},getOperation:function(e){var n=this,o=e.sort,i=e.filter,s=e.changeLayout,r=e.remove,l=e.insert,c=new t.Operation;return c=n.callFilters("operationUnmappedGetOperation",c,arguments),c.id=a.randomHex(),c.command=e,c.startState=n.state,c.triggerElement=n.lastClicked,n.isBusy?(n.config.debug.showWarnings&&console.warn(t.messages.warningGetOperationInstanceBusy()),null):(l&&n.insertTargets(l,c),r&&(c.toRemove=r.targets),c.startSort=c.newSort=c.startState.activeSort,c.startOrder=c.newOrder=n.targets,o&&(c.startSort=c.startState.activeSort,c.newSort=o,c.willSort=n.willSort(o,c.startState.activeSort),c.willSort&&n.sortOperation(c)),c.startFilter=c.startState.activeFilter,i?c.newFilter=i:c.newFilter=a.extend(new t.CommandFilter,c.startFilter),"all"===c.newFilter.selector?c.newFilter.selector=n.config.selectors.target:"none"===c.newFilter.selector&&(c.newFilter.selector=""),n.filterOperation(c),s&&(c.startContainerClassName=c.startState.activeContainerClassName,c.newContainerClassName=s.containerClassName,c.newContainerClassName!==c.startContainerClassName&&(c.willChangeLayout=!0)),n.config.animation.enable&&(n.getStartMixData(c),n.setInter(c),c.docState=a.getDocumentState(n.dom.document),n.getInterMixData(c),n.setFinal(c),n.getFinalMixData(c),n.parseEffects(),c.hasEffect=n.hasEffect(),n.getTweenData(c)),c.newState=n.buildState(c),n.callFilters("operationMappedGetOperation",c,arguments))},tween:function(e,t){var a=null,n=null,o=-1,i=-1;for(t=Math.min(t,1),t=Math.max(t,0),i=0;a=e.show[i];i++)n=e.showPosData[i],a.applyTween(n,t);for(i=0;a=e.hide[i];i++)a.isShown&&a.hide(),(o=e.toHide.indexOf(a))>-1&&(n=e.toHidePosData[o],a.isShown||a.show(),a.applyTween(n,t))},insert:function(){var e=this,t=e.parseInsertArgs(arguments);return e.multimix({insert:t.command},t.animate,t.callback)},insertBefore:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(t.command.collection,"before",t.command.sibling,t.animate,t.callback)},insertAfter:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(t.command.collection,"after",t.command.sibling,t.animate,t.callback)},prepend:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(0,t.command.collection,t.animate,t.callback)},append:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(e.state.totalTargets,t.command.collection,t.animate,t.callback)},remove:function(){var e=this,t=e.parseRemoveArgs(arguments);return e.multimix({remove:t.command},t.animate,t.callback)},getConfig:function(e){var t=this,n=null;return n=e?a.getProperty(t.config,e):t.config,t.callFilters("valueGetConfig",n,arguments)},configure:function(e){var t=this;t.callActions("beforeConfigure",arguments),a.extend(t.config,e,!0,!0),t.callActions("afterConfigure",arguments)},getState:function(){var e=this,n=null;return n=new t.State,a.extend(n,e.state),a.freeze(n),e.callFilters("stateGetState",n,arguments)},forceRefresh:function(){var e=this;e.indexTargets()},destroy:function(e){var a=this,n=null,o=null,i=0;for(a.callActions("beforeDestroy",arguments),i=0;n=a.controls[i];i++)n.removeBinding(a);for(i=0;o=a.targets[i];i++)e&&o.show(),o.unbindEvents();a.dom.container.id.match(/^MixItUp/)&&a.dom.container.removeAttribute("id"),delete t.instances[a.id],a.callActions("afterDestroy",arguments)}}),t.IMoveData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.posIn=null,this.posOut=null,this.operation=null,this.callback=null,this.statusChange="",this.duration=-1,this.staggerIndex=-1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.IMoveData),t.IMoveData.prototype=Object.create(t.Base.prototype),t.IMoveData.prototype.constructor=t.IMoveData,t.TargetDom=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.el=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.TargetDom),t.TargetDom.prototype=Object.create(t.Base.prototype),t.TargetDom.prototype.constructor=t.TargetDom,t.Target=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.sortString="",this.mixer=null,this.callback=null,this.isShown=!1,this.isBound=!1,this.isExcluded=!1,this.isInDom=!1,this.handler=null,this.operation=null,this.data=null,this.dom=new t.TargetDom,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Target),t.Target.prototype=Object.create(t.Base.prototype),a.extend(t.Target.prototype,{constructor:t.Target,init:function(e,a,n){var o=this,i="";if(o.callActions("beforeInit",arguments),o.mixer=a,e||(e=o.render(n)),o.cacheDom(e),o.bindEvents(),"none"!==o.dom.el.style.display&&(o.isShown=!0),n&&a.config.data.uidKey){if("undefined"==typeof(i=n[a.config.data.uidKey])||i.toString().length<1)throw new TypeError(t.messages.errorDatasetInvalidUidKey({uidKey:a.config.data.uidKey}));o.id=i,o.data=n,a.cache[i]=o}o.callActions("afterInit",arguments)},render:function(e){var n=this,o=null,i=null,s=null,r="";if(n.callActions("beforeRender",arguments),o=n.callFilters("renderRender",n.mixer.config.render.target,arguments),"function"!=typeof o)throw new TypeError(t.messages.errorDatasetRendererNotSet());return r=o(e),r&&"object"==typeof r&&a.isElement(r)?i=r:"string"==typeof r&&(s=document.createElement("div"),s.innerHTML=r,i=s.firstElementChild),n.callFilters("elRender",i,arguments)},cacheDom:function(e){var t=this;t.callActions("beforeCacheDom",arguments),t.dom.el=e,t.callActions("afterCacheDom",arguments)},getSortString:function(e){var t=this,a=t.dom.el.getAttribute("data-"+e)||"";t.callActions("beforeGetSortString",arguments),a=isNaN(1*a)?a.toLowerCase():1*a,t.sortString=a,t.callActions("afterGetSortString",arguments)},show:function(){var e=this;e.callActions("beforeShow",arguments),e.isShown||(e.dom.el.style.display="",e.isShown=!0),e.callActions("afterShow",arguments)},hide:function(){var e=this;e.callActions("beforeHide",arguments),e.isShown&&(e.dom.el.style.display="none",e.isShown=!1),e.callActions("afterHide",arguments)},move:function(e){var t=this;t.callActions("beforeMove",arguments),t.isExcluded||t.mixer.targetsMoved++,t.applyStylesIn(e),requestAnimationFrame(function(){t.applyStylesOut(e)}),t.callActions("afterMove",arguments)},applyTween:function(e,a){var n=this,o="",i=null,s=e.posIn,r=[],l=new t.StyleData,c=-1;for(n.callActions("beforeApplyTween",arguments),l.x=s.x,l.y=s.y,0===a?n.hide():n.isShown||n.show(),c=0;o=t.features.TWEENABLE[c];c++)if(i=e.tweenData[o],"x"===o){if(!i)continue;l.x=s.x+i*a}else if("y"===o){if(!i)continue;l.y=s.y+i*a}else if(i instanceof t.TransformData){if(!i.value)continue;l[o].value=s[o].value+i.value*a,l[o].unit=i.unit,r.push(o+"("+l[o].value+i.unit+")")}else{if(!i)continue;l[o]=s[o]+i*a,n.dom.el.style[o]=l[o]}(l.x||l.y)&&r.unshift("translate("+l.x+"px, "+l.y+"px)"),r.length&&(n.dom.el.style[t.features.transformProp]=r.join(" ")),n.callActions("afterApplyTween",arguments)},applyStylesIn:function(e){var a=this,n=e.posIn,o=1!==a.mixer.effectsIn.opacity,i=[];a.callActions("beforeApplyStylesIn",arguments),i.push("translate("+n.x+"px, "+n.y+"px)"),a.mixer.config.animation.animateResizeTargets&&("show"!==e.statusChange&&(a.dom.el.style.width=n.width+"px",a.dom.el.style.height=n.height+"px"),a.dom.el.style.marginRight=n.marginRight+"px",a.dom.el.style.marginBottom=n.marginBottom+"px"),o&&(a.dom.el.style.opacity=n.opacity),"show"===e.statusChange&&(i=i.concat(a.mixer.transformIn)),a.dom.el.style[t.features.transformProp]=i.join(" "),a.callActions("afterApplyStylesIn",arguments)},applyStylesOut:function(e){var a=this,n=[],o=[],i=a.mixer.config.animation.animateResizeTargets,s="undefined"!=typeof a.mixer.effectsIn.opacity;if(a.callActions("beforeApplyStylesOut",arguments),n.push(a.writeTransitionRule(t.features.transformRule,e.staggerIndex)),"none"!==e.statusChange&&n.push(a.writeTransitionRule("opacity",e.staggerIndex,e.duration)),i&&(n.push(a.writeTransitionRule("width",e.staggerIndex,e.duration)),n.push(a.writeTransitionRule("height",e.staggerIndex,e.duration)),n.push(a.writeTransitionRule("margin",e.staggerIndex,e.duration))),!e.callback)return a.mixer.targetsImmovable++,void(a.mixer.targetsMoved===a.mixer.targetsImmovable&&a.mixer.cleanUp(e.operation));switch(a.operation=e.operation,a.callback=e.callback,!a.isExcluded&&a.mixer.targetsBound++,a.isBound=!0,a.applyTransition(n),i&&e.posOut.width>0&&e.posOut.height>0&&(a.dom.el.style.width=e.posOut.width+"px",a.dom.el.style.height=e.posOut.height+"px",a.dom.el.style.marginRight=e.posOut.marginRight+"px",a.dom.el.style.marginBottom=e.posOut.marginBottom+"px"),a.mixer.config.animation.nudge||"hide"!==e.statusChange||o.push("translate("+e.posOut.x+"px, "+e.posOut.y+"px)"),e.statusChange){case"hide":s&&(a.dom.el.style.opacity=a.mixer.effectsOut.opacity),o=o.concat(a.mixer.transformOut);break;case"show":s&&(a.dom.el.style.opacity=1)}(a.mixer.config.animation.nudge||!a.mixer.config.animation.nudge&&"hide"!==e.statusChange)&&o.push("translate("+e.posOut.x+"px, "+e.posOut.y+"px)"),a.dom.el.style[t.features.transformProp]=o.join(" "),a.callActions("afterApplyStylesOut",arguments)},writeTransitionRule:function(e,t,a){var n=this,o=n.getDelay(t),i="";return i=e+" "+(a>0?a:n.mixer.config.animation.duration)+"ms "+o+"ms "+("opacity"===e?"linear":n.mixer.config.animation.easing),n.callFilters("ruleWriteTransitionRule",i,arguments)},getDelay:function(e){var t=this,a=-1;return"function"==typeof t.mixer.config.animation.staggerSequence&&(e=t.mixer.config.animation.staggerSequence.call(t,e,t.state)),a=t.mixer.staggerDuration?e*t.mixer.staggerDuration:0,t.callFilters("delayGetDelay",a,arguments)},applyTransition:function(e){var a=this,n=e.join(", ");a.callActions("beforeApplyTransition",arguments),a.dom.el.style[t.features.transitionProp]=n,a.callActions("afterApplyTransition",arguments)},handleTransitionEnd:function(e){var t=this,a=e.propertyName,n=t.mixer.config.animation.animateResizeTargets;t.callActions("beforeHandleTransitionEnd",arguments),t.isBound&&e.target.matches(t.mixer.config.selectors.target)&&(a.indexOf("transform")>-1||a.indexOf("opacity")>-1||n&&a.indexOf("height")>-1||n&&a.indexOf("width")>-1||n&&a.indexOf("margin")>-1)&&(t.callback.call(t,t.operation),t.isBound=!1,t.callback=null,t.operation=null),t.callActions("afterHandleTransitionEnd",arguments)},eventBus:function(e){var t=this;switch(t.callActions("beforeEventBus",arguments),e.type){case"webkitTransitionEnd":case"transitionend":t.handleTransitionEnd(e)}t.callActions("afterEventBus",arguments)},unbindEvents:function(){var e=this;e.callActions("beforeUnbindEvents",arguments),a.off(e.dom.el,"webkitTransitionEnd",e.handler),a.off(e.dom.el,"transitionend",e.handler),e.callActions("afterUnbindEvents",arguments)},bindEvents:function(){var e=this,n="";e.callActions("beforeBindEvents",arguments),n="webkit"===t.features.transitionPrefix?"webkitTransitionEnd":"transitionend",e.handler=function(t){return e.eventBus(t)},a.on(e.dom.el,n,e.handler),e.callActions("afterBindEvents",arguments)},getPosData:function(a){var n=this,o={},i=null,s=new t.StyleData;return n.callActions("beforeGetPosData",arguments),s.x=n.dom.el.offsetLeft,s.y=n.dom.el.offsetTop,(n.mixer.config.animation.animateResizeTargets||a)&&(i=n.dom.el.getBoundingClientRect(),s.top=i.top,s.right=i.right,s.bottom=i.bottom,s.left=i.left,s.width=i.width,s.height=i.height),n.mixer.config.animation.animateResizeTargets&&(o=e.getComputedStyle(n.dom.el),s.marginBottom=parseFloat(o.marginBottom),s.marginRight=parseFloat(o.marginRight)),n.callFilters("posDataGetPosData",s,arguments)},cleanUp:function(){var e=this;e.callActions("beforeCleanUp",arguments),e.dom.el.style[t.features.transformProp]="",e.dom.el.style[t.features.transitionProp]="",e.dom.el.style.opacity="",e.mixer.config.animation.animateResizeTargets&&(e.dom.el.style.width="",e.dom.el.style.height="",e.dom.el.style.marginRight="",e.dom.el.style.marginBottom=""),e.callActions("afterCleanUp",arguments)}}),t.Collection=function(e){var t=null,n=-1;for(this.callActions("beforeConstruct"),n=0;t=e[n];n++)this[n]=t;this.length=e.length,this.callActions("afterConstruct"),a.freeze(this)},t.BaseStatic.call(t.Collection),t.Collection.prototype=Object.create(t.Base.prototype),a.extend(t.Collection.prototype,{constructor:t.Collection,mixitup:function(e){var n=this,o=null,i=Array.prototype.slice.call(arguments),s=[],r=-1;for(this.callActions("beforeMixitup"),i.shift(),r=0;o=n[r];r++)s.push(o[e].apply(o,i));return n.callFilters("promiseMixitup",a.all(s,t.libraries),arguments)}}),t.Operation=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.args=[],this.command=null,this.showPosData=[],this.toHidePosData=[],this.startState=null,this.newState=null,this.docState=null,this.willSort=!1,this.willChangeLayout=!1,this.hasEffect=!1,this.hasFailed=!1,this.triggerElement=null,this.show=[],this.hide=[],this.matching=[],this.toShow=[],this.toHide=[],this.toMove=[],this.toRemove=[],this.startOrder=[],this.newOrder=[],this.startSort=null,this.newSort=null,this.startFilter=null,this.newFilter=null,this.startDataset=null,this.newDataset=null,this.startX=0,this.startY=0,this.startHeight=0,this.startWidth=0,this.newX=0,this.newY=0,this.newHeight=0,this.newWidth=0,this.startContainerClassName="",this.startDisplay="",this.newContainerClassName="",this.newDisplay="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Operation),t.Operation.prototype=Object.create(t.Base.prototype),t.Operation.prototype.constructor=t.Operation,t.State=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.activeFilter=null,this.activeSort=null,this.activeContainerClassName="",this.container=null,this.targets=[],this.hide=[],this.show=[],this.matching=[],this.totalTargets=-1,this.totalShow=-1,this.totalHide=-1,this.totalMatching=-1,this.hasFailed=!1,this.triggerElement=null,this.activeDataset=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.State),t.State.prototype=Object.create(t.Base.prototype),t.State.prototype.constructor=t.State,t.UserInstruction=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.command={},this.animate=!1,this.callback=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.UserInstruction),t.UserInstruction.prototype=Object.create(t.Base.prototype),t.UserInstruction.prototype.constructor=t.UserInstruction,t.Messages=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.ERROR_FACTORY_INVALID_CONTAINER="[MixItUp] An invalid selector or element reference was passed to the mixitup factory function",this.ERROR_FACTORY_CONTAINER_NOT_FOUND="[MixItUp] The provided selector yielded no container element",this.ERROR_CONFIG_INVALID_ANIMATION_EFFECTS="[MixItUp] Invalid value for `animation.effects`",this.ERROR_CONFIG_INVALID_CONTROLS_SCOPE="[MixItUp] Invalid value for `controls.scope`",this.ERROR_CONFIG_INVALID_PROPERTY='[MixitUp] Invalid configuration object property "${erroneous}"${suggestion}',this.ERROR_CONFIG_INVALID_PROPERTY_SUGGESTION='. Did you mean "${probableMatch}"?',this.ERROR_CONFIG_DATA_UID_KEY_NOT_SET="[MixItUp] To use the dataset API, a UID key must be specified using `data.uidKey`",this.ERROR_DATASET_INVALID_UID_KEY='[MixItUp] The specified UID key "${uidKey}" is not present on one or more dataset items',this.ERROR_DATASET_DUPLICATE_UID='[MixItUp] The UID "${uid}" was found on two or more dataset items. UIDs must be unique.',this.ERROR_INSERT_INVALID_ARGUMENTS="[MixItUp] Please provider either an index or a sibling and position to insert, not both",this.ERROR_INSERT_PREEXISTING_ELEMENT="[MixItUp] An element to be inserted already exists in the container",this.ERROR_FILTER_INVALID_ARGUMENTS="[MixItUp] Please provide either a selector or collection `.filter()`, not both",this.ERROR_DATASET_NOT_SET="[MixItUp] To use the dataset API with pre-rendered targets, a starting dataset must be set using `load.dataset`",this.ERROR_DATASET_PRERENDERED_MISMATCH="[MixItUp] `load.dataset` does not match pre-rendered targets",this.ERROR_DATASET_RENDERER_NOT_SET="[MixItUp] To insert an element via the dataset API, a target renderer function must be provided to `render.target`",this.WARNING_FACTORY_PREEXISTING_INSTANCE="[MixItUp] WARNING: This element already has an active MixItUp instance. The provided configuration object will be ignored. If you wish to perform additional methods on this instance, please create a reference.",this.WARNING_INSERT_NO_ELEMENTS="[MixItUp] WARNING: No valid elements were passed to `.insert()`",this.WARNING_REMOVE_NO_ELEMENTS="[MixItUp] WARNING: No valid elements were passed to `.remove()`",this.WARNING_MULTIMIX_INSTANCE_QUEUE_FULL="[MixItUp] WARNING: An operation was requested but the MixItUp instance was busy. The operation was rejected because the queue is full or queuing is disabled.",this.WARNING_GET_OPERATION_INSTANCE_BUSY="[MixItUp] WARNING: Operations can be be created while the MixItUp instance is busy.",this.WARNING_NO_PROMISE_IMPLEMENTATION="[MixItUp] WARNING: No Promise implementations could be found. If you wish to use promises with MixItUp please install an ES6 Promise polyfill.",this.WARNING_INCONSISTENT_SORTING_ATTRIBUTES='[MixItUp] WARNING: The requested sorting data attribute "${attribute}" was not present on one or more target elements which may product unexpected sort output',this.callActions("afterConstruct"),this.compileTemplates(),a.seal(this)},t.BaseStatic.call(t.Messages),t.Messages.prototype=Object.create(t.Base.prototype),t.Messages.prototype.constructor=t.Messages,t.Messages.prototype.compileTemplates=function(){var e="",t="";for(e in this)"string"==typeof(t=this[e])&&(this[a.camelCase(e)]=a.template(t))},t.messages=new t.Messages,t.Facade=function(e){t.Base.call(this),this.callActions("beforeConstruct",arguments),this.configure=e.configure.bind(e),this.show=e.show.bind(e),this.hide=e.hide.bind(e),this.filter=e.filter.bind(e),this.toggleOn=e.toggleOn.bind(e),this.toggleOff=e.toggleOff.bind(e),this.sort=e.sort.bind(e),this.changeLayout=e.changeLayout.bind(e),this.multimix=e.multimix.bind(e),this.multiMix=e.multimix.bind(e),this.dataset=e.dataset.bind(e),this.tween=e.tween.bind(e),this.insert=e.insert.bind(e),this.insertBefore=e.insertBefore.bind(e),this.insertAfter=e.insertAfter.bind(e),this.prepend=e.prepend.bind(e),this.append=e.append.bind(e),this.remove=e.remove.bind(e),this.destroy=e.destroy.bind(e),this.forceRefresh=e.forceRefresh.bind(e),this.isMixing=e.isMixing.bind(e),this.getOperation=e.getOperation.bind(e),this.getConfig=e.getConfig.bind(e),this.getState=e.getState.bind(e),this.callActions("afterConstruct",arguments),a.freeze(this),a.seal(this)},t.BaseStatic.call(t.Facade),t.Facade.prototype=Object.create(t.Base.prototype),t.Facade.prototype.constructor=t.Facade,"object"==typeof exports&&"object"==typeof module?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof e.mixitup&&"function"==typeof e.mixitup||(e.mixitup=e.mixItUp=t),(n=e.$||e.jQuery)&&n.fn.jquery&&t.registerJqPlugin(n),t.BaseStatic.call(t.constructor),t.NAME="mixitup",t.CORE_VERSION="3.1.9"}(window),app.plugin.popupMenu=function(e,t,a){function n(){o.slideToggle(200),i.toggleClass("menu-active")}var o=t.jquery?t:$(t),i=e.jquery?e:$(e);return $(document).mouseup(function(e){var t=i;t.is(e.target)||0!==t.has(e.target).length||(o.slideUp(300),i.removeClass("menu-active"))}),o.on("mouseenter.popupMenu",function(){i.addClass("over")}),o.on("mouseleave.popupMenu",function(){i.removeClass("over")}),i.off("click.popupMenu"),a?n:void i.on("click.popupMenu",n)},app.plugin.sliders=function(){var e,t,a=null,n=0,o=null,i=function(o,i){null!==a&&(e=a.offset(),n=o.pageX-e.left,t=Math.ceil(n/a.width()*100),a.find("> .slider-bar").css("width",t+"%"),i.obj.Val=t,i.sync("Items"))},s=function(a,i,s){null!==o&&(e=i.offset(),t=o.width(),n=a.pageX-e.left-t/2,t=Math.min(100-t/i.width()*100,Math.max(0,Math.ceil(n/(i.width()-t/2)*100))),o.css("left",t+"%"),s.obj.Val=t,s.sync("Items"))};$.fn.percentSlider=function(e){var t=this;return t.find(".slider-bar").css({width:Math.ceil(e.obj.Val)+"%"}),t.on("touchstart mousedown",function(n){$("body").addClass("disable-select"),a=t,i(n,e)}).on("touchmove mousemove",function(t){null!==a&&a.get(0)===this&&i(t,e)}).on("touchend mouseup touchcancel mouseleave",function(e){a=null,$("body").removeClass("disable-select")}),this},$.fn.thumbSlider=function(e){var t=this,a=t.find(".slider-bar");return a.css({left:e.obj.Val+"%"}),e.thumb&&t.css("cursor","auto"),t.on("touchstart mousedown",function(n){o=a,$("body").addClass("disable-select"),e.thumb||s(n,t,e)}).on("touchend mouseup touchcancel mouseleave",function(e){o=null}).on("touchmove mousemove",function(a){s(a,t,e)}),t},$(document).on("touchend mouseup touchcancel mouseleave",function(e){a=null,o=null,$("body").removeClass("disable-select")})},app.plugin.social=function(){$.fn.gPlus=function(e){var t=this;return t.on("click",function(){window.open("https://plus.google.com/share?url="+encodeURIComponent(e),"height=300,width=600")}),t},$.fn.facebook=function(e){var t=this;return t.on("click",function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),"facebook-share-dialog","width=626,height=436")}),t},$.fn.twitter=function(e,t){var a=this;return a.on("click",function(){window.open("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t),"height=300,width=600")}),a},$.fn.twitterVia=function(e){var t=this;return t.on("click",function(){window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(e+" @xtensio_com"),"height=300,width=600")}),t},$.fn.linkedIn=function(e,t,a){var n=this;return n.on("click",function(){window.open("https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(e)+"&title="+encodeURIComponent(t),"&summary="+encodeURIComponent(a),"height=300,width=600")}),n},$.fn.emailto=function(e){var t=this,a="mailto:?subject=Here's an invite for a free month of Xtensio Plus! Create one pagers, personas, lean canvases and more!&body=Hey there,%0D%0A%0D%0AI wanted to reach out to you because I just discovered Xtensio - a toolbox for smart and beautiful business documents. It comes with FREE tools to help you build one-pagers, user personas, lean canvases, and more.%0D%0A%0D%0AXtensio has been super helpful for my work, so I thought you might want to give it a try. You can sign up here:%0D%0A%0D%0A"+e+"%0D%0A%0D%0AIf you sign up with my link above, we'll both get a free month of premium features with Xtensio Plus!%0D%0A%0D%0ACheers,";t.attr("href",a)},$.socialLinks=function(e,t,a,n,o,i,s){t.find(a).gPlus(e),t.find(n).facebook(e),t.find(o).twitter(e,"I've got invites for a FREE month of Xtensio Plus. Create one pagers, personas, lean canvases for your #startup"),t.find(i).linkedIn(e,"Create an Xtensio account","Invitation to unlock a FREE month of Xtensio Plus. Looking to start a new company or restructure your business? Create dynamic one pagers, lite investor decks, lean canvases, user personas, and more."),t.find(s).emailto(e)},$.shareLinks=function(e,t,a,n,o,i,s,r){t.find(o).gPlus(e),t.find(i).facebook(e),t.find(s).twitter(e,n),t.find(r).linkedIn(e,a,n)}},app.plugin.tooltip=function(){$("[data-tip]").tooltip({delay:150,trigger:"hover",container:"body",placement:"bottom auto",title:function(){return $(this).data("tip")}}).click(function(){$(this).tooltip("hide")})},app.plugin.uploader=function(e,t,a){$.fn.uploader=function(n){var o=this,i=n.module,s=n.success,r=n.imageLoaded,l=$('<input type="file" name="file" accept="image/*"/>'),c=$('<label class="file-label"></label>').append(l),d=$('<form encType="multipart/form-data" class="image-form"></form>').append(c),u=l[0],m=d[0];return n.imageLoaded=function(e){i&&i.hideSpinner(),r&&r(e)},n.success=function(e){s&&s(e),m.reset()},n.error=function(){i&&i.hideSpinner(),m.reset()},l.on("change",function(){var o=u.files&&u.files[0];o&&(i&&i.showSpinner(),a.getData(1,function(a,i,s,r){isfree=0==a.ST,isfree&&!i&&0==e.Team.Id?t.uploadImage(m,o,n,!0):t.uploadImage(m,o,n,!1)},!0))}),o.append(d)}},app.popup.main=function(e,t,a,n,o,i,s,r,l,c){var d=this,u=$('<div id="popup-container"></div>'),m=[],p=app.plugin.lockedTip(e,t);$("body").append(u),$("body").append($("#notify-popup")),d.spinner=$("#spinner-container > .loading-animation").html(),d.upgrade=$("#tmp-upgrade-panel").html(),$(document).on("keydown",function(e){var t=u.find(".show");if(t.length)if(27!=(e.keyCode||e.which)||t.hasClass("no-close")){var a=t.data("keydownCb");a&&a(e)}else{var n=t.data("closeCb");d.close(),n&&n()}}),d.reg=function(e,t,a,n){e.data("closeCb",a),e.data("keydownCb",n),u.append(e),t&&(e.find(".popup-content").click(function(e){e.stopPropagation()}),e.find(".popup-wrapper").add(t).click(function(){var e=u.find(".show");e.hasClass("no-close")||(d.close(),a&&a())}))},d.push=function(e){m.push(e)},d.pop=function(){m.pop()},d.signIn=app.popup.getSignIn(d,e,a,n),d.signUp=app.popup.getSignUp(d,e,a,n,e.campaignHandle,e.campaignSettings,t),d.signUpTeam=app.popup.getSignUpTeam(d,e,n,i),d.signUpDone=app.popup.getSignUpDone(d,a,n),d.forgotPass=app.popup.getForgotPass(d,e,a,n),d.settings=app.popup.getSettings(d,e,t,a,n),d.emailSettings=app.popup.getEmailSettings(d,e,t,a,n),d.billing=app.popup.getBilling(d,e,a,n,i,t),d.payment=app.popup.getPayment(d,e,a,n,i),d.discPayment=app.popup.getDiscPayment(d,e,a,n,i),d.message=app.popup.getMessage(d,a),d.busy=app.popup.getBusyPopup(d),d.usermenu=app.popup.getUserMenu(e,d,t,i),d.plusPrompt=app.popup.getPlusPrompt(d,e,i),d.plusInfo=app.popup.getPlusInfo(d,e,a,i,t),d.signupPerformance=app.popup.getSignUpPerformance(e,d,a,n,t,s),d.transferFolio=app.popup.getTransferFolio(e,d,a,n,t),d.labels=app.popup.getLabelsPopup(e,d,a,n,t,s),d.collaborators=app.popup.getCollaboratorsPopup(e,d,a,n,t),d.archive=app.popup.getArchivePopup(e,d,n),d.unarchive=app.popup.getUnarchivePopup(d,n),d.shareLink=app.popup.getShareLink(n,d,e,i,p,t),d.folioVersion=app.popup.getFolioVersion(n,d,t,l),d.expiredBlocker=app.popup.getExpiredBlocker(e,d),d.folioStats=app.popup.getFolioStatsPopup(e,d,n),d.copySectionPopup=app.popup.getCopySectionPopup(e,d,a,l,n),d.importFolioPopup=app.popup.getImportFolioPopup(e,d,n),d.addFolioToSpace=app.popup.getAddFolioToSpace(e,d,n,t),d.transferFolioToSpace=app.popup.getTransferFolioToSpace(e,d,n,t),e.Team&&(d.teamSettingPopup=app.popup.getTeamSettingPopup(e,d,n),d.teamManagePopup=app.popup.getTeamManagePopup(e,d,n),d.addTeamMemberPopup=app.popup.getAddTeamMemberPopup(e,d,n),d.setupTeamPopup=app.popup.getSetupTeamPopup(e,d),d.choosePlanPopup=app.popup.getChoosePlanPopup(e,d,n,i),d.teamUserActionBlocked=app.popup.getTeamUserActionBlocked(e,d),d.addTeamMember=app.popup.getAddMembers(e,d,n),d.transferTeamFolio=app.popup.getTransferTeamFolio(e,d,a,n,t)),e.editMode&&(d.addModule=d.getAddModule(d,n,e,c),d.exp=app.popup.getExport(e,d,a,n,t,i),d.expOption=app.popup.getExpOption(d,a,r)),d.error=function(e,t){d.message({heading:t||"Error",message:e||"There was an error, please try again.",btnText:"Close"})};var f=u.find(".app-popup");return d.close=function(){u.hide(),o.restore();var e=m.pop();e&&d.show(e),location.hash&&history.pushState("","",location.pathname)},d.show=function(e,t){f.filter(".show").removeClass("show"),e.addClass("show"),e.hasClass("normal")&&o.hideCurrent(),u.show().toggleClass("normal",e.hasClass("normal")),u.show().toggleClass("solid",e.hasClass("solid")),u.show().toggleClass("dark",e.hasClass("dark")),t&&history[location.hash?"replaceState":"pushState"]("","","#"+t)},d},app.popup.getAddFolioToSpace=function(e,t,a,n){function o(e,n,o){a.duplicateFolio({token:d,name:u,success:function(e){window.location.assign(o+"/edit/"+e.Message+"#new")},error:function(e){5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode&&t.plusPrompt("create",null,!1,!0)},complete:function(){},fToken:!0,teamId:e})}function i(e,t,a){return function(){o(e,t,a)}}var s=$("#tmp-add-folio-to-space"),r=s.find(".no-show"),l=s.find(".cancel, .icon-Close"),c=s.find(".teams"),d=null,u=null;if(s.find(".loading-animation").html(t.spinner),e.UserTeams&&e.Team&&0!=e.Team){var m=$(r.html());m.find("h3").text("Personal Account"),m.on("click",i(0,"Personal Account","")),c.append(m);for(var p=0;p<e.UserTeams.length;p++)5!=e.UserTeams[p].Role&&(m=$(r.html()),m.find("h3").text(e.UserTeams[p].Name),m.on("click",i(e.UserTeams[p].Id,e.UserTeams[p].Name,e.UserTeams[p].TeamUrl)),c.append(m))}return t.reg(s,l),function(a,n){console.log(a,n),u=n,d=a,e.UserTeams.length>1?t.show(s):o(0,"","")}},app.popup.getArchivePopup=function(e,t,a){function n(){r.removeClass("sfg-leave");var t=0;m.empty(),$.each(i.Collaborators,function(a,n){if(n.Privilege>0&&n.Privilege<3&&n.Accepted){var i=$("<option></option>");if(i.val(n.Email).text(n.FullName),e.Team&&e.Team.Id>0){var s=o(n.Email);s<4&&m.append(i)}else m.append(i);t++}}),t>0?(l.hasClass("single")&&l.removeClass("single"),e.Team&&e.Team.Id>0&&5==e.Team.Role?(console.log("in team"),l.addClass(i.Role<3?"single":"").removeClass("archive leave"),r.addClass("sfg-leave"),r.find(".leave-sfg-section").find(".msg .team").text(e.Team.Name)):l.addClass("leave "+(i.Role<3?"single":"")).removeClass("archive")):l.addClass("archive").removeClass("leave single"),f.prop("checked",""),p.prop("disabled",!0).text("Leave Folio")}function o(e){if(v)for(var t=0;t<v.length;t++)if(v[t].Email==e)return v[t].Role;return 0}var i,s,r=$("#tmp-leave-popup"),l=r.find(".popup-content"),c=r.find(".loading-animation"),d=r.find(".archive-section"),u=r.find(".leave-section"),m=u.find("select"),p=u.find(".btn.ok"),f=u.find("input"),h=r.find(".leave-single-section .btn.ok"),g=r.find(".leave-sfg-section .btn.ok"),v=null;return c.html(t.spinner),d.find(".btn.ok").click(function(){t.busy(),a.deleteFolio({data:{token:i.Token},success:s,error:function(e){t.error("There was an error. Please refresh page and try again.")}})}),m.on("change",function(){$(this).closest("label").find("input").click()}),f.click(function(){p.prop("disabled","").text("archive"==$(this).val()?"Delete Folio":"Transfer Folio");
}),p.click(function(){if("archive"==u.find("input:checked").val())d.find(".btn.ok").click();else{c.show();var e=m.find("option:checked"),n=e.val(),o=e.text();a.transfer({data:{token:i.Token,name:o,email:n},success:function(){c.hide(),t.message({heading:"Transfer Requested",message:"Folio transfer request has been sent to "+o+".<br/>Folio will be transfered once they accept.",btnText:"OK",handleOK:function(){t.close()}})},error:function(e){t.error(e.Message||"There was an error. Please try later.")}})}}),g.click(function(){a.removeSingleFolioGuest({data:{userEmail:e.userEmail,teamId:e.Team.Id},success:function(){var t="";"live"==e.Environment?t="https://app.xtensio.com/#dashboard":"dev"==e.Environment?t="https://app.xtensio.tech/#dashboard":"local"==e.Environment&&(t="https://www.localhost.com:44301/#dashboard"),window.location=t},error:function(e){showStatus(e.Message,"error")}})}),h.click(function(){c.show(),a.changeCollaborator({data:{verb:"drop",role:i.Role,token:i.Token,email:e.userEmail},success:function(){window.location.href="/"},error:function(e){c.hide(),t.error(e.Message)}})}),t.reg(r,r.find(".icon-Close, .btn.no")),function(o,l){v=null,e.Team&&e.Team.Id>0?(c.show(),a.listTeamMembers({data:{teamId:e.Team.Id},success:function(e){c.hide(),v=e.Data.Data,i=o,s=l,n(),t.show(r)},error:function(e){c.hide()}})):(i=o,s=l,n(),t.show(r))}},app.popup.getBusyPopup=function(e){var t=$("#tmp-busy");t.find(".busy, .anim").html(e.spinner);var a,n,o=t.find(".message"),i=t.find("h1"),s=t.find(".msg"),r=t.find(".anim"),l=function(){a?(r.hide(),o.show(),i.text(a),s.text(n).show()):(o.hide(),r.show())};return e.reg(t),function(o,i){a=o||"",n=i||"",l(),e.show(t)}},app.popup.getCollaboratorsPopup=function(e,t,a,n,o){function i(a,n,o,i){switch(E.removeClass("belong-to-team"),W=n?n.email:"",B.find(".acc-lvl-txt").show(),B.removeClass("not-user"),E.removeClass("team-deny-non-xtensio add-paidmem add-guest"),B.find(".not-user input.email").attr("readonly",!1),a){case M.main:U.removeClass("selected");break;case M.notUser:if(U.addClass("selected"),e.Team&&0!=e.Team.Id&&!o.teamMember){if(console.log("alshdfkjasfl",e.Team.Role),e.Team.Role>2)return void t.teamUserActionBlocked("invite-member","Team Members");i?(E.addClass(i),B.find(".username").text(J)):E.addClass("add-mem"),Y.text(e.Team.Name),_.text(n.email),K.find(".email").text(n.email),K.find(".team").text(e.Team.Name),B.find(".email").val(J),B.addClass("not-user").removeClass("a-user pending-user"),B.find(".not-user input.email").attr("readonly",!0)}else B.find(".email").val(n.email),B.addClass("not-user").removeClass("a-user pending-user");break;case M.aUser:U.addClass("selected"),e.Team&&0!=e.Team.Id&&!o.teamMember?(i?(E.addClass(i),B.find(".username").text(J)):E.addClass("add-mem"),Y.text(e.Team.Name),_.text(n.email),K.find(".email").text(n.email),K.find(".team").text(e.Team.Name),U.addClass("selected"),B.find(".email").val(J),B.addClass("a-user").removeClass("not-user pending-user"),B.find(".a-user input.email").attr("readonly",!0)):(e.Team&&0!=e.Team.Id&&o.teamMember&&(E.addClass("belong-to-team"),B.find(".team-role").text(" ("+o.RoleName+")"),B.find(".acc-lvl-txt").hide()),B.data("email",n.email).find(".username").text(n.name||n.email),B.find(".email").val(n.email),B.addClass("a-user").removeClass("not-user pending-user"));break;case M.pendingUser:U.addClass("selected"),B.data("email",n.email).find(".username").text(n.name),B.addClass("pending-user").removeClass("not-user a-user")}}function s(e){B.addClass(e),r("",{email:J},e)}function r(a,o,s){q.find("input").val(""),E.removeClass("add-mem add-sfg contact-supp non-user-add"),e.Team&&o&&0!=e.Team.Id?n.findUser({email:o.email,success:function(r){if(r.Message)a=f(o.email)?M.pendingUser:M.aUser,n.listTeamMembers({data:{teamId:e.Team.Id},success:function(n){var r={};r.isXUser=!0,r.teamMember=!1;for(var c=0;c<n.Data.Data.length;c++)n.Data.Data[c].Email==o.email&&(r.teamMember=!0,r.RoleName=n.Data.Data[c].RoleName,r.Role=n.Data.Data[c].Role);e.Team&&4==e.Team.Role&&!r.teamMember&&t.teamUserActionBlocked("non-team-member","Premium Guests"),5==r.Role?l("This user is already a Single Folio User on this team.","error"):5==r.Role?l("This user is already a Single Folio User on this team.","error"):i(a,o,r,s),E.find(".loading-animation").hide()},error:function(e){E.find(".loading-animation").hide()}});else{a=M.notUser;var c={};c.teamMember=!1,c.RoleName="",c.Role=0,c.isXUser=!1,i(a,o,c,s)}},error:function(e){l(e.Message,"error")}}):i(a,o,null,s)}function l(e,t,a){t=t||"success",j.hide(),a||r(M.main),F.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){F.addClass("hidden")},3e3)}function c(e){for(var t=0;t<I.Collaborators.length;t++)if(I.Collaborators[t].Email==e)return I.Collaborators[t];return null}function d(e,t){n.addMembers({data:{teamMembers:e},success:t,error:function(e){l(e.Message,"error")}})}function u(e,t){n.addSingleFolioGuest({data:e,success:t,error:function(e){l(e.Message,"error")}})}function m(e,t){n.addCollaborator({data:e,success:t,error:function(e){l(e.Message,"error")}})}function p(t,a,n,o){if(E.hasClass("belong-to-team"))m({name:a,token:I.Token,role:n,email:t,message:o},function(e){j.hide(),l("A request has been sent to "+a),g({Email:t,Accepted:null,FullName:a,Privilege:parseInt(n)})});else if(E.hasClass("add-guest")){var i=[],s={email:t,fullName:a,teamId:e.Team.Id,message:o,folioToken:I.Token,accessType:n,role:5};i.push(s),u(i,function(e){j.hide(),l(t+" has been added as a Single Folio Guest."),g({Email:t,Accepted:null,FullName:a,Privilege:parseInt(n)})})}else if(E.hasClass("add-paidmem")||E.hasClass("add-pg")){var r;E.hasClass("add-paidmem")?r=3:E.hasClass("add-pg")&&(r=4);var i=[],s={email:t,fullName:a,teamId:e.Team.Id,message:o,folioToken:I.Token,accessType:n,role:r};i.push(s),d(i,function(e){j.hide(),E.find(".success-panel .list-mems span").text(J),E.addClass("success"),g({Email:t,Accepted:null,FullName:a,Privilege:parseInt(n)})})}}function f(e){for(var t=0;t<I.Collaborators.length;t++)if(I.Collaborators[t].Email==e&&null===I.Collaborators[t].Accepted&&I.Collaborators[t].Privilege>0)return!0;return!1}function h(e){for(var t=0;t<I.Collaborators.length;t++)if(I.Collaborators[t].Email==e.Email&&I.Collaborators[t].Privilege>0&&1==I.Collaborators[t].Accepted)return!0;return!1}function g(e){var t=Faltu(I.Collaborators).find({Email:e.Email}).count();if(t)$.each(I.Collaborators,function(t,a){a&&a.Email==e.Email&&(I.Collaborators[t].Privilege=e.Privilege,I.Collaborators[t].Accepted=e.Accepted||null)});else{var a=e;I.Collaborators.push(a)}o.raiseEvent("collabChange",I)}function v(e){$.each(I.Collaborators,function(t,a){a&&a.Email==e.Email&&(I.Collaborators[t].Privilege=0,I.Collaborators[t].Accepted=null)}),o.raiseEvent("collabChange",I),te()}function b(t,a){n.removeSingleFolioGuest({data:{userEmail:t.Email,teamId:e.Team.Id},success:function(){j.hide(),a.remove(),v(t),l((t.FullName||t.Email)+" has been removed from folio.")},error:function(e){l(e.Message,"error")}})}function y(a,o){var i=a.Email==e.userEmail;return i?void(e.isHome?$(".folio-item-shell[data-token="+I.Token+"]").find(".delete-folio").click():t.archive(I,function(){window.location.href="/"})):(j.show(),void n.changeCollaborator({data:{verb:"drop",role:a.Privilege,token:I.Token,email:a.Email},success:function(){j.hide(),o.remove(),v(a),l(a.Accepted?(a.FullName||a.Email)+" has been removed from folio.":"Invitation for "+(a.FullName||a.Email)+" has been cancelled.")},error:function(e){l(e.Message,"error")}}))}function C(a){return function(){var o=!1,i=$(this).closest(".person");return e.Team&&e.Team.Id?(j.show(),void n.listTeamMembers({data:{teamId:e.Team.Id},success:function(n){for(var s=0;s<n.Data.Data.length;s++)n.Data.Data[s].Email==a.Email&&5==n.Data.Data[s].Role&&(b(a,i),o=!0);!o&&e.Team&&5==e.Team.Role?(t.teamUserActionBlocked("collab"),j.hide()):o||y(a,i)},error:function(e){j.hide(),l(err.Message,"error")}})):void y(a,i)}}function T(a){return function(){if(e.Team&&5==e.Team.Role)return t.teamUserActionBlocked("collab"),!1;var o=$(this);n.changeCollaborator({data:{role:o.data("value"),token:I.Token,email:a.Email},success:function(){a.Privilege=o.data("value"),l((a.FullName||a.Email)+" can "+(1==a.Privilege?"now view only.":"view and edit now."))},error:function(e){l(e.Message,"error")}})}}function w(e){if(Z)for(var t=0;t<Z.length;t++)if(Z[t].Email==e)return Z[t].Role;return 0}function x(t){var a=9;if(e.Team&&e.Team.Id>0&&(a=w(t.Email)),0!==t.Privilege&&t.Accepted!==!1){var n=t.Privilege<3&&t.Email==e.userEmail,o=$(P.html());o.data("person",t).addClass(t.Privilege>2||n?"owner":"collabo").find(".isOnwer").text(n?"You":"Owner"),o.addClass(null===t.Accepted&&t.Privilege>0?"pending":""),o.addClass("team-role-"+a).attr("team-role",a),o.find(".name").text(t.FullName||t.Email),o.find(".email").text(t.Email||t.FullName),setTimeout(function(){o.find(".role").trigger("val",["value",t.Privilege]).on("change",T(t))},500),o.find(".remove").on("click",C(t)).attr("data-tip",t.Accepted?t.Privilege>2||n?"Leave Folio":"Remove Collaborator":"Cancel Invitation"),t.Email!=e.userEmail&&t.Privilege>2&&o.find(".remove").remove(),R.append(o)}}function k(t){var a=0;R.empty(),$.each(t.Collaborators,function(e,t){t.Privilege>0&&t.Accepted&&a++,t.Privilege=void 0===t.Privilege?1:t.Privilege,x(t)}),a>(e.isHome?0:1)&&R.addClass("hasCollabs"),app.plugin.tooltip(),app.menu.xSelect()}function D(e){return function(){J=e.Email||e.FullName,r(M.aUser,{name:e.FullName,email:e.Email})}}function S(e){k(e),te()}var I,M={main:1,notUser:2,aUser:3,pendingUser:4},P=$("#tmp-single-person"),E=$("#tmp-collaborators-popup"),A=E.find(".toggle"),F=E.find(".changes-applied"),N=$("#tmp-single-recent"),O=$(".recently-added"),U=E.find(".popup-content"),R=U.find(".list"),B=U.find(".selected"),L=B.find(".a-user"),H=B.find(".not-user"),j=E.find(".loading-animation"),q=E.find("#collab-search"),Y=E.find(".popup-header h1.am-h .team"),_=E.find(".popup-header p.am-h .email"),K=E.find(".team-add"),V=E.find(".add-team-member"),G=E.find(".add-team-member"),z=G.find(".custom-msg"),X=G.find(".msg-content .icon-Close"),W="",J="",Q=0,Z=null;if(z.click(function(){G.find(".msg-content").show("slow")}),X.click(function(){G.find(".msg-content").hide("slow")}),V.find(".invite-confirm").click(function(){var e=V.find(".block:eq(1) .left input").val(),t=V.find(".block:eq(1) .right input").val(),a=V.find(".block:eq(2) .role .popup-menu .item.active").data("value"),n=V.find(".opts .msg-content textarea").val();return validator.isEmail(e)?(j.show(),void p(e,t,a,n)):void l("Please provide an valid email address.","error",1)}),e.recentCollaborators)for(var ee=0;ee<e.recentCollaborators.length;ee++)!e.recentCollaborators[ee].Email&&e.recentCollaborators[ee].FullName&&(e.recentCollaborators[ee].Email=e.recentCollaborators[ee].FullName);j.html(t.spinner),K.find(".get-in-touch").click(function(){window.Intercom&&window.Intercom("showNewMessage","I would like to add a new team member.")}),K.find(".add-single-folio-guest").click(function(){s("add-guest")}),K.find(".add-member").click(function(){t.teamManagePopup(!0)}),U.on("click",".pending-user .btn.yes",function(){var e=c(B.data("email"));m({name:e.FullName,email:e.Email,role:e.Privilege,token:I.Token},function(){l("An invitation has been sent again to "+e.FullName)})}),U.on("click",".pending-actions .b",function(){var e=$(this),t=e.closest(".person"),a=t.data("person");j.show(),e.text("Sending ...").css("cursor","default"),m({name:a.FullName,email:a.Email,role:a.Privilege,token:I.Token},function(){j.hide(),e.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){e.text("Resend Invitation").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)})}),B.find(".cancel").click(function(){r(M.main)}),H.find(".add-collab").on("click",function(){var t=H.find(".full-name").val(),a=H.find(".email").val(),n=H.find(".role").data("value")?H.find(".role").data("value"):2,o=H.find(".msg-area.open").length?H.find("textarea").val():"";return validator.isEmail(a)?!t&&H.find(".full-name").is(":visible")?void l("Please provide a name.","error",1):(j.show(),e.Team&&e.Team.Id>0?void p(a,t,n,o):void m({name:t,token:I.Token,role:n,email:a,message:o},function(e){j.hide(),l("A request has been sent to "+t),g({Email:a,Accepted:null,FullName:t,Privilege:parseInt(n)})})):void l("Please provide an valid email address.","error",1)}),L.find(".add-collab").on("click",function(){j.show();var t=L.find(".username").text(),a=L.find(".role").data("value")?L.find(".role").data("value"):2,n=B.data("email")||J,o=L.find(".msg-area.open").length?H.find("textarea").val():"";return e.Team&&e.Team.Id>0?void p(n,t,a,o):void m({token:I.Token,role:a,email:n,message:L.find(".msg-area.open").length?L.find("textarea").val():""},function(e){l("A request has been sent to "+t),g({Email:n,Accepted:null,FullName:t,Privilege:parseInt(a)})})}),q.on("submit",function(a){if(J=q.find("input").val(),e.Team&&5==e.Team.Role)return t.teamUserActionBlocked("collab"),!1;var o=$(a.target[0]).val();return j.show(),validator.isEmail(o)?n.findUser({email:o,success:function(e){j.hide(),r(e.Message?f(o)?M.pendingUser:M.aUser:M.notUser,{name:e.Message,email:o})},error:function(e){l(e.Message,"error")}}):l("Please provide a valid email address.","error"),!1});var te=function(){O.empty(),q.removeClass("hasRecent");var t=0;$.each(e.recentCollaborators,function(e,a){if(!(t>=3||h(a)||f(a.Email))){var n=$(N.html());n.find(".name").text(a.FullName||a.Email),n.find(".email").text(a.Email||a.FullName),n.on("click",D(a)),O.append(n),q.addClass("hasRecent"),t++}})};return U.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var t=$(this),a=t.closest(".person"),o=a.data("person");j.show(),t.text("Sending ...").css("cursor","default"),n.resendSFGEmailNotification({data:{userEmail:o.Email,teamId:e.Team.Id,folioToken:I.Token,accessType:o.Privilege},success:function(e){j.hide(),t.text("Invitation Sent!"),a.find(".actions").addClass("active"),setTimeout(function(){t.text("Remind").css("cursor","pointer"),a.find(".actions").removeClass("active")},3e3)},error:function(e){t.text("Remind").css("cursor","pointer"),a.find(".actions").removeClass("active"),l(e.Message,"error")}})}),K.find(".r1").click(function(){4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(E.find(".popup-header h1.am-h .mem").text("Team Member "),E.find(".popup-header p.am-h").addClass("hidden"),e.Team&&e.Team.ST&&14==e.Team.ST?(V.find(".block:eq(1) .left input").val(J),Q=3,s("add-paidmem")):E.addClass("contact-supp"))}),K.find(".r2").click(function(){4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(E.find(".popup-header h1.am-h .mem").text("Premium Guest "),E.find(".popup-header p.am-h").addClass("hidden"),e.Team&&e.Team.ST&&14==e.Team.ST?(V.find(".block:eq(1) .left input").val(J),Q=4,s("add-paidmem")):E.addClass("add-pg"))}),K.find(".r3").click(function(){4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(E.find(".popup-header h1.am-h .mem").text("Single Folio Guest "),K.find(".add-single-folio-guest").trigger("click"))}),t.reg(E,E.find(".popup-close, .btn-close, .back-to"),function(){A.off("click"),o.removeListener("collabChange",S)}),function(a){E.removeClass("success"),Z=null,E.find(".loading-animation").show(),I=a,j.show();for(var i=0;i<I.Collaborators.length;i++)!I.Collaborators[i].Email&&I.Collaborators[i].FullName&&(I.Collaborators[i].Email=I.Collaborators[i].FullName);E.find(".popup-header h1.am-h .mem").text(""),E.find(".popup-header p.am-h").removeClass("hidden"),e.Team&&e.Team.Id>0?n.listTeamMembers({data:{teamId:e.Team.Id},success:function(e){E.find(".loading-animation").hide(),Z=e.Data.Data,r(1),k(a),te(),o.addListener("collabChange",S),A.parent().removeClass("open"),A.on("click",function(){$(this).parent().toggleClass("open")}),j.hide()},error:function(e){E.find(".loading-animation").hide()}}):(E.find(".loading-animation").hide(),r(1),k(a),te(),o.addListener("collabChange",S),A.parent().removeClass("open"),A.on("click",function(){$(this).parent().toggleClass("open")}),j.hide()),t.show(E)}},app.popup.getEmailSettings=function(e,t,a,n,o){function i(){s&&$.each(s,function(e,t){d.find("."+n.valToProp(r,t.eType)).val(t.sType)})}var s,r,l,c=$("#tmp-email-settings"),d=c.find(".paper"),u=c.find(".yes"),m=c.find(".icon-Close , .no");return d.find(".loading-animation").html(e.spinner),e.reg(c,m),i(),u.on("click",function(){d.addClass("busy");var t={Digest:d.find(".digest").val(),PlusExtended:d.find(".plusExtended").val(),PlusReminder:d.find(".plusReminder").val(),FormResponse:d.find(".formResponse").val(),TransferRequest:d.find(".transferRequest").val(),TransferResult:d.find(".transferResult").val(),CollaboratorRequest:d.find(".collaboratorRequest").val(),CollaboratorResult:d.find(".collaboratorResult").val(),CollaboratorRevoke:d.find(".collaboratorRevoke").val(),OwnerLeave:d.find(".ownerLeave").val()};o.emailSettings({data:{verb:"set",pairs:JSON.stringify(t)},success:function(t){d.removeClass("busy"),e.close()},error:function(){e.error(),d.removeClass("busy")}})}),function(){s||o.emailSettings({success:function(e){s=e.Data.Settings,r=e.Data.EmailTypes,l=e.Data.SettingTypes,i(),d.removeClass("busy")},error:function(){e.error()}}),e.show(c,"manage-notifications")}},app.popup.getExpiredBlocker=function(e,t){var a=$("#tmp-expired-blocker-popup"),n=a.find(".loading-animation"),o=a.find(".upgrade"),i=a.find(".downgrade");return n.html(t.spinner),o.click(function(){t.payment(t.expiredBlocker,!0)}),i.click(function(){t.close(),e.isHome||(location.href="/")}),t.reg(a,a.find(".close-popup-btn, .no")),function(e){e&&e.limit&&e.currUser&&(a.find(".left .plan").text(e.currUser),a.find(".left .limit").text(e.limit)),n.hide(),t.show(a)}},app.popup.getFolioVersion=function(e,t,a,n){function o(){g&&d>h&&S.removeClass("hidden"),!g&&d>h-1&&(k.find("a").on("click",i),C.append(x.removeClass("hidden").append(k))),v||C.find(".v-table-row:eq(0)").removeClass("previous").addClass("current").find(".actions").text("Currently Live"),I()}function i(){return t.plusPrompt("create",null,!0),!1}function s(n){var o=function(){D.show(),e.folioVersion({data:{id:n.Id,token:c,verb:"revert"},success:function(e){t.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){a.raiseEvent("removeCollabs")}})},error:function(e){t.error(e.Message)}})};return"Last revision before update"==n.Notes?function(){t.message({heading:"Warning",message:"You are going to revert folio to older version so your collaborators would be removed.",btnText:"Go ahead",cancelText:"Cancel",handleOK:o})}:function(){D.show(),e.folioVersion({data:{id:n.Id,token:c,verb:"revert"},success:function(e){t.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){t.error(e.Message)}})}}function r(){$.each(f.splice(0,h),function(e,t){var a,o;a=$(w),o=moment(t.Time),a.data("item",t),a.find(".date").text(o.format("MM/DD/YY")),a.find(".time").text(o.format("h:mm a")),a.find(".note-container input").val(t.Notes||""),t.IsCurrent&&(v=!0,a.removeClass("previous").find(".actions").text("Currently Live")),!g&&e>3?(a.find(".preview-btn, .revert-btn").click(i),"Last revision before update"==t.Notes&&n.Role<3||x.append(a)):(a.find(".preview-btn").prop("href","/version-preview/"+c+"/"+t.Id),a.find(".revert-btn").on("click",s(t)),"Last revision before update"==t.Notes&&n.Role<3||C.append(a))}),0===f.length&&S.addClass("hidden"),I()}function l(){r(),o()}var c,d,u,m,p,f,h=6,g=!1,v=!1,b=$("#tmp-folio-version"),y=b.find(".icon-Close"),C=b.find(".v-table"),T=$("#tmp-folio-version-table"),w=T.html(),x=$('<div class="nonplus hidden"></div>'),k=$('<div class="overlay"></div>'),D=b.find(".loading-animation"),S=b.find(".showmore");D.html(t.spinner);var I=function(){u=b.find(".note-edit"),m=b.find(".note-save"),p=b.find(".note-container input"),u.click(function(){$(this).parent().addClass("editable"),p=$(this).parent().find("input"),p.prop("readonly",!1).focus()}),m.click(function(){var t=$(this).closest(".v-table-row").data("item").Id;$(this).parent().removeClass("editable"),p=$(this).parent().find("input"),p.prop("readonly",!0),e.folioVersion({data:{id:t,verb:"note",note:p.val(),token:c},success:function(){},error:function(){}})}),p.on("keydown",function(e){13==(e.which||e.keyCode)&&m.click()})};return S.click(r),k.append("<p class='plus-note'>You need <a href='https://www.xtensio.com/plus'>Xtensio Plus</a> to revert to an older version.</p>"),t.reg(b,y),function(a,n){D.show(),c=n,g=a.plusExpireTime>=Date.now(),C.find(".v-table-row").remove(),x.empty(),e.folioVersion({data:{token:c},success:function(e){f=JSON.parse(e.Message),d=f.length,l(),D.hide()}}),t.show(b)}},app.popup.getFolioStatsPopup=function(e,t,a){function n(e){var t=JSON.parse(e),a=moment.utc(t.Created).format("L").replace(new RegExp("/","g"),".");c.find(".dp-created").text(a),d>-1?c.find(".dp-used").text(d).parent().show():c.find(".dp-used").parent().hide();var n=m(t.LastEdited);c.find(".dp-lastEdited").text(n);var o=m(t.LastViewed);c.find(".dp-lastViewed").text(o),c.find(".dp-edits").text(t.Edits),u?c.find(".dp-collaborators").parent().hide():c.find(".dp-collaborators").text(t.Collaborators).parent().show(),c.find(".dp-revisions").text(t.Revisions),c.find(".dp-exports").text(t.Exports),c.find(".dp-private").text(t.Private),c.find(".dp-views").text(t.Views),c.find(".dp-password").text(t.Password),setTimeout(function(){i.find(".loading-animation").hide(),s.find(".folio-stats-section").css({opacity:1})},500)}function o(e){s.find(".folio-stats-section").css({opacity:0}),i.find(".loading-animation").show(),a.getFolioDataPoints({token:e,success:function(e){null!=e.Data&&n(e.Data)},error:function(e){console.log("error stats: ",e)}})}var i=$("#tmp-folio-stats-popup"),s=i.find(".paper"),r=i.find(".popup-cta.cancel"),l=i.find(".icon-Close"),c=s.find(".folio-stats-section"),d=-1,u=!1;t.reg(i,r),t.reg(i,l);var m=function(e){if(""==e)return"never";var t=moment().valueOf();e=moment.utc(e).valueOf(),e=moment(e).local().valueOf(),console.log(e,t,t-e);var a=Math.round((t-e)/36e5),n=Math.round(a/24),o=Math.round(n/7),i=Math.round(n/30),s=Math.round(i/12);return a<1?"Less than an hour ago":a<24?a+" hour"+(a<2?"":"s")+" ago":n<7?n+" day"+(n<2?"":"s")+" ago":o<5?o+" week"+(o<2?"":"s")+" ago":i<12?i+" month"+(i<2?"":"s")+" ago":s<12?s+" year"+(s<2?"":"s")+" ago":void 0};return i.find(".loading-animation").html(t.spinner),function(e,a,n){n&&(d=n.UsedCount,u=n.isTemplate),o(e),i.find(".popup-header h1").text(a),t.show(i)}},app.popup.getImportFolioPopup=function(e,t,a){var n=$("#tmp-import-folios"),o=(n.find(".paper"),n.find(".popup-header")),i=n.find(".list-of-folios"),s=n.find(".select-all"),r=n.find(".select-folios .ok"),l=n.find(".team-name"),c=[],d=!1,u=n.find(".error"),m=n.find(".confirm-move .back"),p=n.find(".confirm-move .ok"),f=n.find(".confirm-move .team-url"),h=n.find(".loading-animation");h.html(t.spinner),s.click(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),i.find(".select").removeClass("selected")):($(this).addClass("selected"),i.find(".select").addClass("selected"))});var g=function(e){u.text(e).show("slow"),setTimeout(function(){u.hide("slow")},3e3)};r.click(function(){if(c=[],d){if($moveables=i.find(".selected"),$moveables.length<1)return void g("Please Select a Folio to move.");for(var a=0;a<$moveables.length;a++)c.push($moveables[a].getAttribute("data-token"));console.log(c),o.find("h3 .number").text(c.length),o.find("h3 .verb").text(c.length>1?"folios":"folio"),f.attr("href","https://"+e.Team.TeamUrl).text(e.Team.TeamUrl),v("confirmation")}else t.close()}),m.click(function(){v("")}),p.click(function(){h.show(),a.moveUserFolios({userEmail:e.userEmail,source:0,destination:e.Team.Id,folios:c,success:function(e){n.find(".succ .message").text(e.Message),h.hide(),v("complete"),$("#folio-items-container").find(".empty").remove(),$("#folio-items-container").find(".my-empty").remove()},error:function(e){g(e.Message),h.hide()}})});var v=function(e){n.removeClass("no-folio"),n.removeClass("complete"),n.removeClass("confirmation"),n.addClass(e)};return t.reg(n,n.find(".icon-Close , .cancel, .succ .ok")),function(){v(""),console.log(l,e.Team.Name),l.text(e.Team.Name),h.show(),t.show(n),a.getUserOwnFolios({success:function(t){i.empty();var a=JSON.parse(t.Data);if(a.length>0){d=!0,console.log("folio list",a);for(var o=0;o<a.length;o++){var s='<a href="#" class="select" data-token="'+a[o].Token+'"><span class="check"></span><span class="name">'+a[o].FolioName+"</span></a>";i.append(s),i.find(".select:last-child").click(function(e){$(this).toggleClass("selected"),e.preventDefault()})}r.text("Move to "+e.Team.Name)}else d=!1,v("no-folio"),n.find(".msg .cancel").text("Cancel");h.hide()},error:function(e){h.hide()}})}},app.popup.getLabelsPopup=function(e,t,a,n,o,i){function s(){g.addClass("hidden");var e=l.Labels.join();e!=l.lastSaved&&(l.lastSaved=e,n.changeLabels({token:l.Token,list:e,success:function(){g.removeClass("hidden"),c(),setTimeout(function(){g.addClass("hidden")},3e3)},error:function(e){t.error(e.Message)}}))}function r(e){g.addClass("hidden"),n.removeFromLabels({token:l.Token,id:e,success:function(){g.removeClass("hidden"),c(),setTimeout(function(){g.addClass("hidden")},3e3)},error:function(e){t.error(e.Message)}})}var l,c,d,u,m,p=$("#tmp-label-item").html(),f=$("#tmp-labels"),h=f.find(".labels"),g=$(".changes-applied"),v=$(".add-missing-label");f.find(".loading-animation").html(t.spinner),t.reg(f,f.find(".icon-Close"),s),h.on("click",".label-check",function(){clearTimeout(d);var e=$(this),t=e.data("id");e[0].checked?(a.pushUnique(l.Labels,t),d=setTimeout(s,800)):(m.removeClass(a.removeFromList(l.Labels,t)),d=setTimeout(r(t),800))});var b=function(e){if(13==(e.which||e.keyCode))return void v.click();var t=$.trim($(this).val()).replace(/ +/g," ").toLowerCase(),a=u.show().filter(function(){var e=$(this).text().replace(/\s+/g," ").toLowerCase();return!~e.indexOf(t)}).hide();a.length==u.length?(v.removeClass("hidden").find("span").text($(this).val()),h.hide()):(v.addClass("hidden"),h.show())};return function(n,o,i){if(e.Team&&e.Team.Id>0&&5==e.Team.Role)return void t.teamUserActionBlocked("label");l=n,m=o,c=i,l.lastSaved=l.Labels.join(),h.empty().show();for(var s=0;s<e.labels.length;s++){var r=e.labels[s],d=$(p),g=d.find(".label-check").data("id",r.Token);d.find(".label-name").css("background-color",r.color).text(r.Name);var y=a.indexOf(l.Labels,r.Token);y>=0&&(g[0].checked=!0),h.append(d)}u=h.find("label"),$("#labels-search").keyup(b).val(""),v.on("click",function(){$(this).off("click"),$("#add-label-from-popup").data("suggestedName",$(this).find("span").text()).click()}).addClass("hidden"),t.show(f)}},app.popup.getMessage=function(e,t){var a,n,o,i,s,r,l,c,d,u,m,p,f,h,g,v,b,y=$("#tmp-message"),C=!1,T=y.find("h1"),w=y.find(".msg"),x=y.find(".text-area"),k=y.find(".input"),D=y.find(".ok"),S=y.find(".no"),I=y.find(".popup-content"),M=y.find(".icon-Close"),P=y.find(".cta-btns"),E=function(){y.toggleClass("no-close",d),T.html(a),S.toggleClass("hidden",!l&&!r).text(l),M.toggleClass("hidden",d),k.toggleClass("hidden",!u).val(o),D.text(i).attr("href",c||"#"),w.removeClass("error").html(n),x.toggleClass("hidden",!h),I.toggleClass("mini",!b)};return D.on("click",function(){if(s){var t=!0,a=k.val(),n=x.val();v&&!a?w.addClass("error").html(v):"email"==m&&(t=validator.isEmail(a),t||w.addClass("error").html("Invalid email. Please provide a valid email address.")),t&&(e.close(),f&&e.busy(),s(a,n))}else e.close();return!!c}),e.reg(y,S.add(M),0,function(e){C&&13==(e.keyCode||e.which)&&D.click()}),S.click(function(){r&&r()}),function(t){a=t.heading,n=t.message||"",o=t.input,i=t.btnText||"Save",h=t.showArea,s=t.handleOK,l=t.cancelText,c=t.url,d=!!t.noClose,m=t.validateFor,f=t.showBusy,r=t.handleNo,u=t.showInput||o,C=t.enterAsOK,p=t.defaultInputValue,v=t.emptyError,g=t.handleError,b=t.notMini,D.addClass(t.okClass),t.isSwitchCta?P.addClass("is-switch"):P.removeClass("is-switch"),k.attr("placeholder",t.inputPlaceholder||""),x.val(t.areaText||"").attr({rows:t.rows||3,placeholder:t.areaPlaceholder||"Message (Optional)"}),y.attr("class","app-popup "+(t.namespace||"")),E(),e.show(y)}},app.popup.getPlusInfo=function(e,t,a,n,o){var i=$(e.spinner),s=$("#tmp-xtensio-plus"),r=s.find(".icon-Close"),l=(s.find(".ends-text"),s.find(".earned"),s.find(".percent-inner"),s.find(".joined"),s.find("input"));s.find(".unlock-head");return l.val(t.sharePlusLink).copier(),s.find(".loading-animation").append(i),$.socialLinks(t.sharePlusLink,s,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),s.find(".invite-link").attr("href",t.sharePlusLink),e.reg(s,r),s.find(".upgrade-btn").click(function(){e.payment(function(){e.plusInfo()})}),function(){e.message({heading:"Sorry",message:"This campaign is no longer available.",btnText:"OK"})}},app.popup.getPlusPrompt=function(e,t,a){t.plusInfo?t.plusExpireTime=t.plusInfo.End:t.plusExpireTime=Date.now();var n=$("#tmp-plus-prompt"),o=n.find(".msg");return n.find(".upgrade-panel").html(e.upgrade),n.find(".invite-link").val(t.sharePlusLink).copier(),$.socialLinks(t.sharePlusLink,n,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),e.reg(n,n.find(".icon-Close")),n.find(".ok").click(function(){e.payment()}),function(i,s,r,l){var c=Date.now();if("pass"==i){a.getData(1,function(t,a,n,o){a?10==t.ST||11==t.ST||3==t.ST||16==t.ST?e.billing():s():e.payment()})}else if((t.autoRenew||c<t.plusExpireTime)&&s)s();else{if(r)return void("create"==i?a.getData(1,function(t,a,n,o){var i=1,s="Free Forever";(a&&10==t.ST||11==t.ST)&&(i=5,s="Xtensio Plus"),(a&&16==t.ST||3==t.ST)&&(i=5,s="Free Plus"),e.message({heading:"Upgrade for more!",message:"The "+s+" plan has a limit of "+i+" active folio"+(i>1?"s":"")+".  To work on more folios, please delete/leave some old folios or upgrade to premium plans.",btnText:"See Plans",cancelText:"Nevermind",notMini:!0,handleOK:function(){10==t.ST||11==t.ST?e.billing():e.payment()}})}):e.payment());if(l)return void e.billing();var d='Unlock <a class="x-plus" target="_blank" href="//xtensio.com/plus">Xtensio Plus</a> ',u="Xtensio Plus allows you to export your folio as PDF or PNG";o.show(),"export"==i?d+="to export this folio":"export-mod"==i?d+="to export this module":"export-sec"==i?d+="to export this section":"pass"==i?(d+="for password protection",u="Xtensio Plus enables you to password protect any of your folios"):"create"==i?(d+="to create more folios",u="With a free account, you're limited to 1 folio"):(d+="to access this feature",o.hide()),n.find("h1").html(d),n.find(".desc").text(u),e.show(n)}}},app.popup.getSignUpPerformance=function(e,t,a,n,o,i){function s(t,a,n){var o="viewed";i.get(t,o,function(s){var r=0;s=new Date(JSON.parse(s||JSON.stringify(new Date(2016,4,30).getTime()))),b.removeClass("busy"),n.t!=e.token?(g.text(n.n).attr("href","/edit/"+n.t),h.show()):h.hide(),p.html(a.length+(1==a.length?" Response":" Total Responses")),v.empty(),$.each(a,function(e,t){var a="</td><td>";t.Created>s&&(a="<span></span></td><td>",r++);var n=t.Created.getMonth()+1;n=n<10?"0"+n:n;var o=t.Created.getDate();o=o<10?"0"+o:o,v.append("<tr><td>"+a+n+"/"+o+"/"+t.Created.getFullYear()+"</td><td>"+t.Data.email+"</td></tr>")}),f.html(r+" New"),r&&i.set(t,o,JSON.stringify(new Date))})}function r(e,a,o){l=e;var u=c[l];u?s(l,u.list,u.data):a?(c[l]={list:a,data:o},r(l,a,o)):(b.addClass("busy"),n.getRecords({id:l,success:function(t){a=JSON.parse(t.Message),$.each(a,function(e,t){t.Created=new Date(t.Created),t.Data=JSON.parse(t.Data)}),i.reg(e,JSON.parse(t.Data.s)),r(l,a,t.Data)},error:function(e){t.error()}})),t.show(d,u?"res-"+e:"");
}var l,c={},d=$("#tmp-sign-up-performance"),u=d.find(".icon-Close"),m=d.find(".export"),p=d.find(".total-count"),f=d.find(".new-items"),h=d.find(".f-name"),g=h.find("a"),v=d.find(".performance-table tbody"),b=d.find(".paper");return b.find(".loading-animation").html(t.spinner),t.reg(d,u),m.on("click",function(){var e=c[l];if(e){e=e.list;var t="data:text/csv;charset=utf-8,Date,Email\n",a=e.length;$.each(e,function(e,n){var o=1+n.Created.getMonth()+"/"+n.Created.getDate()+"/"+n.Created.getFullYear()+","+n.Data.email;t+=e<a?o+"\n":o});var n=encodeURI(t);window.open(n)}}),o.addListener("newSignUp",function(e){var t=c[e.Data.ModId];t&&t.list.unshift({ID:e.Data.RecId,Created:new Date(e.Time),Data:e.Data.Data})}),r.reg=function(e,t,a){c[e]={list:t,data:a}},r},app.popup.getTransferFolio=function(e,t,a,n,o){function i(e){var t=m.height()+16;switch(r=e,f.prop("readonly",!0),m.css("min-height",""),m.removeClass("busy search sent found not-found"),r){case d.busy:m.css("min-height",t).addClass("busy");break;case d.found:m.addClass("found"),T.text(l),D.text("Transfer");break;case d.notFound:m.addClass("not-found"),x.text(c),D.text("Invite & Transfer");break;case d.sent:m.addClass("sent"),D.addClass("no").removeClass("yes").text("Close"),S.find(".name").text(l||I.val()+" signs up and");break;default:m.addClass("search"),f.prop("readonly",!1),D.text("Search")}}function s(){i(d.busy),n.transfer({data:{token:P,name:l||I.val(),email:c,message:g.val(),AllowOutside:!0},success:function(e){i(d.sent)},error:function(e){i(d.search),y.show().text(e.Message||"There was an error. Please try later.")}})}var r,l,c,d={search:1,busy:2,found:3,notFound:4,sent:5},u=$("#tmp-transfer"),m=u.find(".paper"),p=u.find(".popup-header h1"),f=m.find(".email").val(""),h=m.find(".msg-box"),g=h.find(".msg"),v=h.find(".msg-content"),b=h.find(".close-msg-btn"),y=m.find(".error"),C=m.find(".found"),T=C.find(".name"),w=m.find(".not-found"),x=w.find(".name"),k=m.find(".add-msg"),D=m.find(".popup-cta"),S=m.find(".result"),I=m.find(".full-name").val(""),M=m.find(".back-btn"),P=e.token,E=!1;return m.find(".loading-animation").html(t.spinner),k.click(function(){k.hide(),v.show()}),b.click(function(){k.show(),v.hide(),g.val("")}),M.click(function(){f.val(""),i(d.search)}),D.click(function(){switch(r){case d.search:c=$.trim(f.val());var a=validator.isEmail(c);a&&c==e.userEmail&&e.Team&&e.Team.Id>0&&1==e.Team.Role?t.transferFolioToSpace({sameUser:!0,Data:{Token:P,TeamID:e.Team.Id,Owner:c}}):a&&c==e.userEmail&&e.Team&&0==e.Team.Id?y.show().text("You can not transfer to yourself!"):a?(y.hide(),i(d.busy),n.findUser({email:c,success:function(a){e.Team&&e.Team.Id>0&&e.Team.Role<4&&a.Message&&(E?i(d.found):n.listTeamMembers({data:{teamId:e.Team.Id},success:function(e){for(var a=!1,n=!1,o=0;o<e.Data.Data.length;o++)e.Data.Data[o].Email==c&&(a=!0,l=e.Data.Data[o].UserName,5==e.Data.Data[o].Role&&(a=!1,i(d.search),y.show().text(e.Message||"This user is a Single Folio User on this team."),n=!0));a?i(d.found):t.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){y.show().text(e.Message||"There was an error. Please try later.")}})),e.Team&&e.Team.Id>0&&e.Team.Role<4&&!a.Message?t.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(l=a.Message||l,i(a.Message?d.found:d.notFound))},error:function(){i(d.search),y.show().text("There was an error. Please try later.")}})):y.show().text("Invalid Email");break;case d.found:s();break;case d.notFound:l=I.val(),w.toggleClass("no-name",!l),l&&s();break;default:t.close()}}),u.find(".is-team-admin").click(function(){t.transferTeamFolio(P,{allowOutside:!0})}),t.reg(u,u.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(a,n){return E=!1,n&&(E=n.allowOutside||!1),E?p.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>'):p.html("Transfer Ownership"),e.Team&&e.Team.Id>0&&5==e.Team.Role?void t.teamUserActionBlocked("transfer"):e.Team&&e.Team.Id>0&&4==e.Team.Role?void t.teamUserActionBlocked("transfer","Premium Guests"):(e.Team&&e.Team.Id>0&&(1==e.Team.Role||2==e.Team.Role)&&!E?u.addClass("team-allow-out"):u.removeClass("team-allow-out"),P=a||P,y.hide(),i(d.search),f.val(""),D.addClass("yes"),b.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&D.click()}),void t.show(u))}},app.popup.getUnarchivePopup=function(e,t){return function(a,n){e.message({heading:"Are you sure you want to recover?",message:"This folio will return to your dashboard as an active folio. You will be able to edit and share this folio again.",btnText:"Yes, Recover This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){e.busy(),t.deleteFolio({data:{op:"undo",token:a.Token},success:n,error:function(t){5==t.StatusCode?e.plusPrompt("create",null,!0):10==t.StatusCode?e.plusPrompt("create",null,!1,!0):e.error("There was an error. Please refresh page and try again.")}})}})}},app.popup.getUserMenu=function(e,t,a,n){function o(){n.getData(0,function(a,n,o,i){console.log(o,n,e.everPlus,a);var s=!1;if(e.UserTeams)for(var r=0;r<e.UserTeams.length;r++)1==e.UserTeams[r].Role&&(s=!0);1==a.ST||2==a.ST||9==a.ST||10==a.ST||11==a.ST||e.everPlus||n||s?t.billing():t.payment()})}function i(){(s||e.everPlus)&&d.text("Billing")}var s=Date.now()<e.plusExpireTime,r=$("#top-bar .user-menu-popup"),l=r.find(".e-settings"),c=r.find(".logout"),d=r.find(".billing"),u=r.find(".plus"),m=r.find(".help"),p=r.find(".settings");r.find(".nav-setmenu li");i(),a.addListener("plusUnlocked",i),p.click(function(){t.settings()}),u.click(function(){t.plusInfo()}),m.click(function(){window.Intercom?window.Intercom("show"):t.message({heading:"Please wait",message:"Please wait a few moments while the help window loads and try again.",btnText:"OK"})}),l.click(function(){t.emailSettings()}),c.click(function(){$("#logoutForm").submit()}),d.click(o)},app.popup.getBilling=function(e,t,a,n,o,i){function s(e){e=e||"Error - Please review the highlighted fields.",f.text(e).addClass("show")}function r(t,a){p.addClass("busy"),n.changePlan({data:{plan:t,renew:t?1:0},success:function(e){o.refresh(),Z(1),a(e)},error:function(t){e.push(p),e.error(t.Message||"There was an error. Please try later.")},complete:function(){p.removeClass("busy")}})}function l(e){for(var a=0;a<t.TeamRoles.length;a++)if(t.TeamRoles[a].Id==e)return t.TeamRoles[a].Name}var c,d,u=!1,m="selected",p=$("#tmp-billing"),f=p.find(".error-msg"),h=p.find(".save-card"),g=p.find(".save-plan"),v=p.find(".paper"),b=p.find(".status-tab"),y=(b.find(".expire"),b.find(".date")),C=(b.find(".upgrade-panel"),b.find(".user-plan"),b.find(".discount")),T=(C.find(".claim-offer"),b.find(".unlock"),p.find(".pay-tab")),w=T.find(".credit-card"),x=p.find(".invoice-tab"),k=(b.find(".right"),b.find(".details")),D=T.find(".month"),S=T.find(".year"),I=T.find(".existing"),M=T.find(".change-card"),P=T.find(".change-plan"),E=p.find(".radios a"),A=T.find(".change-renew"),F=T.find("input, select"),N=x.find(".history"),O=p.find(".tabs span"),U=p.find(".card-change-status"),R=p.find(".plan-change-status"),B=w.find(".num"),L=w.find(".cvc"),H=w.find(".name"),j=!1,q=!1,Y=!1,_=!1,K=!0,V=p.find(".choose-plan"),G=p.find(".circular-switch"),z=0,X=p.find("section .plan-cont"),W=p.find(".success-panel");W.find(".no").click(function(){p.find(".popup-content").removeClass("success"),e.close()});var J=function(e){e?(G.attr("title","Yearly"),G.toggleClass("off",!e),K=1):(G.attr("title",K?"Yearly":"Monthly"),G.toggleClass("off",!K),G.find(".button-switch").text("Monthly")),G.find(".button-switch").text(K?"Yearly":"Monthly"),K?G.addClass("off"):G.removeClass("off"),$("#tmp-billing .paper section .button p").removeClass("selected"),$("#tmp-billing .paper section .button p:eq("+(K?0:1)+")").addClass("selected"),K?($("#tmp-billing .plan-block:eq(0) .plan-body .num").text("5"),$("#tmp-billing .plan-block:eq(1) .plan-body .num").text("10"),$("#tmp-billing .plan-block:eq(2) .plan-body h3").html('$<span class="num">50</span><span class="small">/mo</span>')):($("#tmp-billing .plan-block:eq(0) .plan-body .num").text("7"),$("#tmp-billing .plan-block:eq(1) .plan-body .num").text("14"),$("#tmp-billing .plan-block:eq(2) .plan-body h3").html('<span class="small">Not available in monthly</span>')),K?(X.addClass("yearly"),X.removeClass("monthly")):(X.addClass("monthly"),X.removeClass("yearly"))};G.on("click",function(){K=!K,J()}),J();var Q={Plusmonthly:7,Plusyearly:5,Promonthly:14,Proyearly:10};for(V.click(function(){var a="",s="",l=$(this).attr("data-plan");if("Team"!=l){var c=(Q[l+(K?"yearly":"monthly")],("Pro"==l?"":"Plus")+(K?"Year":"Month"));o.getData(1,function(d,u,m,f){if(!m){var h={planName:l,isYearly:K};return void e.payment(null,null,h)}s="Are you sure you want to change your current plan to <b>Xtensio ",s+="Pro"==l?"Pro ":"Plus ",s+=K?"Yearly":"Monthly",s+="</b>?",1==z&&"Pro"==l?a="Upgrade Plan":2==z&&"Plus"==l?(a='<span style="font-size: 26px;">Are you sure you want to downgrade?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',s="By downgrading your plan, you'll no longer have unlimited folios and exports.</br></br>Are you sure you want to change your current plan?"):a="Change Plan";var g="Xtensio ";g+="Pro"==l?"Pro ":"Plus ",g+=K?"Yearly":"Monthly",p.addClass("busy"),n.getUserActiveFoliosCount({success:function(d){p.removeClass("busy");var u=d.Data;n.getUserTemplateCount({success:function(n){var d=n.Data,m=u>5||d>0;if(2==z&&"Plus"==l&&m){var f,h;u>5&&d<1?(f="Uh oh - You have more than 5 folios!",h="The Xtensio Plus plan has a limit of 5 folios. In order to downgrade your account, please delete extra folios on your dashboard."):u>5&&d>0?(f="Uh oh - You have more than 5 folios and saved templates",h="The Xtensio Plus plan has a limit of 5 folios and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):u<6&&d>0&&(f="Uh oh - You have saved templates!",h="The Xtensio Plus plan does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard."),e.push(p),e.message({heading:f,message:h,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){window.location=t.baseUrl}})}else e.push(p),e.message({heading:a,message:s,btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){r(c,function(){Z(0),o.refresh(),i.raiseEvent("plusCancelled"),p.find(".popup-content").addClass("success"),p.find(".success-panel").addClass("plan-changed"),p.find(".success-panel .plan-change .plan-name").text(g),p.find(".success-panel .plan-change h3 span").text(g)})}})},error:function(e){p.removeClass("busy"),console.log("error: ",e)}})},error:function(e){p.removeClass("busy"),console.log("error: ",e)}})},!0)}}),p.find(".expire .not-charged").hide(),p.find(".expire .prox-bold").text(""),p.find(".loading-animation").html(e.spinner),e.reg(p,p.find(".icon-Close")),h.find(".loading-animation").html(e.spinner),g.find(".loading-animation").html(e.spinner),d=1;d<=12;d++)D.append('<option value="'+d+'">'+d+"</option>");for(d=2017;d<=2030;d++)S.append('<option value="'+d+'">'+d+"</option>");var Z=function(a,n){b.find(".right").show(),p.find("section .plan-cont .plan-block").removeClass("selected"),t.hasDiscount&&b.css({visibility:"hidden"});var i="Xtensio ";b.removeClass("paying").find(">div").hide(),T.find(".left, .right").removeClass("edit"),p.addClass("busy"),P.add(M).removeClass("cancel"),T.find(".right, .left").removeClass("edit"),o.getData(0,function(o,s,r,l){u&&b.find("section.team-owner .date").text(l),p.removeClass("busy"),p.find(".existing").toggleClass("yearly",2==o.ST);var d=":eq("+a+")",m="selected";if(O.removeClass(m).filter(d).addClass(m),v.removeClass(m).filter(d).addClass(m),p.find(".tabs span:eq(1)").toggleClass("disable",!r),p.find(".tabs span:eq(2)").toggleClass("disable",!r&&!t.everPlus),(r||o.Count)&&ee(),T.find(".auto-on, .auto-off").hide(),H.val(o.Name),N.empty(),$.each(o.Invoices,function(e,t){N.append('<p class="clearfix"><span class="time">'+moment(t.Time).format("MMMM DD, YYYY")+'</span><span class="gray">$'+t.Price+'</span><a target="_blank" href="/billing/invoice/'+t.Id+'">PDF</a></p>')}),o.Invoices.length<1&&N.append('<p class="clearfix">No invoices yet.</p>'),s){if(c.text("Add Billing Information"),i+="Plus ",1==o.ST||2==o.ST||9==o.ST||10==o.ST||11==o.ST){T.find(".left .existing").html("<h3>"+o.Brand+'</h3><p><span class="stars">**** **** **** </span>'+o.Last4+"</p>");var f=b.addClass("paying").find(".user-plan").show(),h=2==o.ST||11==o.ST||9==o.ST?"year":"month";f.find(".type").text(h+"ly"),f.find(".time").text(h),T.find(".date").text(l),b.find(".plan-verb").text("will renew on"),p.find("section .date").text(l),9==o.ST?T.find(".package").text("Student"):1==o.ST||2==o.ST?T.find(".package").text("Pro"):10==o.ST||11==o.ST?T.find(".package").text("Plus"):T.find(".package").text("Free"),T.find(".period").text(2==o.ST||9==o.ST||11==o.ST?"Yearly":"Monthly"),o.AR?T.find(".auto-on").show():T.find(".auto-off").show(),p.find("section .plan-cont .plan-block:eq(0) button").text("Upgrade to Plus"),p.find("section .plan-cont .plan-block:eq(0) .plan-bot").removeClass("downgrade"),p.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro");var g="Xtensio ";9==o.ST?g+="Student ":1==o.ST||2==o.ST?(g+="Pro ",p.find("section .plan-cont .plan-block:eq(1)").addClass("selected"),p.find("section .plan-cont .plan-block:eq(0) button").text("Downgrade to Plus"),p.find("section .plan-cont .plan-block:eq(0) .plan-bot").addClass("downgrade"),z=2):10!=o.ST&&11!=o.ST||(g+="Plus ",p.find("section .plan-cont .plan-block:eq(0)").addClass("selected"),z=1),1==o.ST||10==o.ST?(g+="monthly ",K=!0,p.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),p.find("section .plan-cont .plan-block.selected").addClass("monthly"),p.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Yearly"),p.find("section .plan-cont .plan-block.selected .plan-bot button").removeClass("gray")):2!=o.ST&&9!=o.ST&&11!=o.ST||(g+="yearly ",K=!1,p.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),p.find("section .plan-cont .plan-block.selected").addClass("yearly"),p.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Monthly"),p.find("section .plan-cont .plan-block.selected .plan-bot button").addClass("gray")),J(n),p.find("section .plan-name").text(g)}else b.find(".expire").show().find(".verb").text("will expire"),b.find(".upgrade-panel").show(),T.find(".auto-off").show().find(".date").text(l);p.find(".no-charge").toggleClass("hidden",o.CST<3)}else c.text("Upgrade"),b.find(".upgrade-panel").show(),(o.Count||o.Referrals.length)&&(b.find(".expire").show().find(".verb").text("expired"),p.find(".expire .prox-bold").text("Upgrade to regain access to Plus features."));j=1==o.ST||10==o.ST,1==o.ST||10==o.ST||2==o.ST||11==o.ST||9==o.ST||(b.find(".right").hide(),p.find(".plan-block .plan-bot").removeClass("downgrade"),p.find(".plan-block").removeClass("yearly"),p.find(".plan-block").removeClass("monthly"),p.find("section .plan-cont .plan-block:eq(0) button").text("Upgrade to Plus"),p.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro"),i="Xtensio (Free)",p.find(".upgrade-panel .right").css({marginTop:"0"}),p.find("section p .plan-name").text("Xtensio Pro (Free)"),b.find(".plan-verb").text("has expired on"),s?(p.find(".expire .prox-bold").text("Add billing information to retain access to Plus features."),p.find(".expire .not-charged").show(),p.find(".upgrade-panel .right").css({marginTop:"20px"}),i="Xtensio Pro (Free)",Y=!0,p.find("section p .plan-name").text("free Xtensio"),b.find(".plan-verb").text("will expire on")):o.Count||o.Referrals.length||(p.find(".expire .prox-bold").text("Unlock more features with Xtensio Plus."),p.find(".expire").show(),p.find(".expire .exp-txt").hide(),i="Xtensio (Free)",_=!0,q||t.everPlus||!t.Team||0!=t.Team.Id||e.payment()),p.find("section h3 .plan-name").text(i),s&&4==o.ST?(p.find("section p .plan-name").text("Free Pro"),p.find("section h3 .plan-name").text("Free Pro")):!s||16!=o.ST&&3!=o.ST||(p.find("section p .plan-name").text("Free Plus"),p.find("section h3 .plan-name").text("Free Plus"))),b.find(".plan").text(i),0!=o.ST||s?y.text(l):y.text(moment(Date(t.planCancel)).format("MMMM Do, YYYY")),b.css({visibility:"visible"})})};O.click(function(){var e=$(this);return e.hasClass("disable")||Z(e.index()),!1}),c=p.find(".upgrade-panel").html(e.upgrade).find(".ok"),p.find(".invite-link").val(t.sharePlusLink).copier(),$.socialLinks(t.sharePlusLink,p,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),c.click(function(){e.payment()}),h.click(function(e){var t=0,a=B.val(),i=L.val(),r=D.val(),l=S.val(),c=H.val();F.removeClass("error"),f.removeClass("show"),Stripe.card.validateCardNumber(a)||(t=1,B.addClass("error")),Stripe.card.validateCVC(i)||(t=1,L.addClass("error")),Stripe.card.validateExpiry(r,l)||(t=1,D.add(S).addClass("error")),c||(t=1,H.addClass("error")),t?s():(h.find(".loading-animation").removeClass("hidden"),h.find("span").text("Saving .."),h.prop("disabled",!0),Stripe.card.createToken({number:a,cvc:i,exp_month:r,exp_year:l,name:c},function(e,t){if(t.error)s(t.error.message);else{var a=t.card,i=t.id;n.card({data:{Token:i,CardId:a.id,Last4:a.last4,Brand:a.brand,Name:c},success:function(e){o.refresh(),M.trigger("click"),B.val(""),h.find(".loading-animation").addClass("hidden"),h.find("span").text("Save"),h.prop("disabled",!1),U.html('<i class="fi-check"></i> Credit card changed successfuly.').removeClass("hidden"),setTimeout(function(){U.html("").addClass("hidden")},3e3)},error:function(e){s(e.Message)},complete:function(){p.removeClass("busy")}})}}))}),g.click(function(){var e=E.filter("."+m).data("time"),t=$(this);t.find(".loading-animation").removeClass("hidden"),t.find("span").text("Saving .."),t.prop("disabled",!0),r(e,function(){I.toggleClass("yearly","Year"==e),T.find(".period").text(e+"ly"),P.trigger("click"),g.find(".loading-animation").addClass("hidden"),g.find("span").text("Save"),g.prop("disabled",!1),R.html('<i class="fi-check"></i> Plan changed successfuly.').removeClass("hidden"),setTimeout(function(){R.html("").addClass("hidden")},3e3)})}),M.click(function(){$(this).toggleClass("cancel"),T.find(".left").toggleClass("edit")}),P.click(function(){$(this).toggleClass("cancel"),T.find(".right").toggleClass("edit")}),b.find(".plus-btn").click(function(){e.plusInfo()});var ee=function(){n.getStripInvoiceData({success:function(e){if("Success"==e.Status){$("#billingUserInvoices").html(""),data=JSON.parse(e.Data);var t=AccountDock.configure({key:data.AccountDockKey,customer:data.StripeCustomerId});$(function(){t.open({container:"#billingUserInvoices"})})}}})};b.find(".cancel-plan-btn").click(function(){return o.getData(1,function(a,s,l,c){e.push(p),n.getUserActiveFoliosCount({success:function(a){var s=a.Data;n.getUserTemplateCount({success:function(a){var n,l,c=a.Data,d=s>1||c>0;if(d&&(s>1&&c<1?(n="Uh oh - You have more than 1 folio!",l="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):s>1&&c>0?(n="Uh oh - You have more than 1 folio and saved templates",l="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):s<2&&c>0&&(n="Uh oh - You have saved templates!",l="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),d)e.push(p),e.message({heading:n,message:l,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){window.location=t.baseUrl}});else{var u="";2==z?u="Pro":1==z&&(u="Plus"),e.message({heading:'<span style="font-size: 26px;">Are you sure you want to cancel?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio and 8 exports per month.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){r(0,function(){o.refresh(),p.find(".success-panel").removeClass("plan-changed"),p.find(".popup-content").addClass("success"),i.raiseEvent("plusCancelled")})}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),k.click(function(){Z(1)}),E.click(function(e){e.preventDefault();var t="selected";$(this).hasClass(t)||E.toggleClass(t)}),A.click(function(){$(this).toggleClass("selected")});if(t.UserTeams&&t.UserTeams.length>0){for(var te=0;te<t.UserTeams.length;te++)p.find(".team-list").append('<span class="bold">'+t.UserTeams[te].Name+" ("+l(t.UserTeams[te].Role)+")</span><br>");b.find(".button span.team-mem").css("display","inline-block")}else p.find(".team-list").remove(),b.find("button span.team-mem").hide();if(t.UserTeams)for(var te=0;te<t.UserTeams.length;te++)1==t.UserTeams[te].Role&&(u=!0);return u?b.find("section.team-member").remove():b.find("section.team-owner").remove(),b.find("section.team-owner .see-payment").click(function(){Z(2)}),b.find("section.team-owner .contact span").click(function(){window.Intercom&&window.Intercom("showNewMessage","I would like to DELETE my team.")}),function(t,a){G.hasClass("off")||G.trigger("click"),$("#tmp-billing").find(".status-tab").find(".discount").css({display:"none"}),p.find(".popup-content").removeClass("success"),p.addClass("busy"),q=a||0,o.loadStripe(function(){Z(t||0,!0)}),e.show(p,"billing")}},app.popup.getDiscPayment=function(e,t,a,n,o){function i(e){e=e||"Error - Please review the highlighted fields.",d.text(e).addClass("show")}function s(t,a){c.addClass("busy"),n.changePlan({data:{plan:t,renew:t?1:0},success:function(e){o.refresh(),o.getData(0,function(e,t,a,n){y.find(".time").text(n)}),c.find(".popup-content").addClass("success"),y.find(".period").text("year"),y.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Discount Applied!"),y.find(".msg-plus").hide(),y.find(".msg-free .act").text("updated")):(T.text("Welcome to Xtensio Plus"),y.find(".msg-free").hide()),a(e)},error:function(t){e.push(c),e.error(t.Message||"There was an error. Please try later.")},complete:function(){c.removeClass("busy")}})}var r,l,c=$("#tmp-disc-payment"),d=c.find(".error-msg"),u=c.find(".checkout-btn"),m=c.find(".card-num"),p=c.find(".cvc"),f=c.find(".user-name"),h=(c.find(".radios a"),c.find(".month")),g=c.find(".year"),v=c.find("input, select"),b=c.find(".detail-btn"),y=c.find(".success-panel"),C=u.find(".txt"),T=c.find("h1"),w=!1;for(l=1;l<=12;l++)h.find(".filter-popup-menu").append('<div class="item" data-value="'+l+'">'+l+"</div>");for(l=2017;l<=2030;l++)g.find(".filter-popup-menu").append('<div class="item" data-value="'+l+'">'+l+"</div>");c.find(".loading-animation").html(e.spinner),e.reg(c,c.find(".icon-Close, .no"),function(){r&&r()}),b.click(function(){e.billing(1,!0)});var x=function(){c.addClass("busy");var e="DiscountYearly",t=$(this);t.find(".loading-animation").removeClass("hidden"),s(e,function(){setTimeout(function(){t.find(".loading-animation").removeClass("hidden")},3e3)})};return u.click(function(e){if(w)return void x();var t=0,a=m.val(),s=p.val(),r=parseInt(h.find(".item.active").attr("data-value")),l=parseInt(g.find(".item.active").attr("data-value")),u=f.val(),b="DiscountYearly";console.log(r+" y "+l),v.removeClass("error"),d.removeClass("show"),Stripe.card.validateCardNumber(a)||(t=1,m.addClass("error")),Stripe.card.validateCVC(s)||(t=1,p.addClass("error")),Stripe.card.validateExpiry(r,l)||(t=1,h.add(g).addClass("error")),u||(t=1,f.addClass("error")),t?i():(c.addClass("busy"),Stripe.card.createToken({number:a,cvc:s,exp_month:r,exp_year:l,name:u},function(e,t){if(t.error)c.removeClass("busy"),i(t.error.message);else{var a=t.card,s=t.id;b.toLowerCase();n.buy({data:{Token:s,CardId:a.id,Last4:a.last4,Brand:a.brand,Plan:b,Name:u},success:function(e){o.refresh(),c.removeClass("busy"),c.find(".popup-content").addClass("success"),y.find(".time").text(moment(+e.Message).format("MMMM Do, YYYY")),y.find(".period").text("year"),y.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Billing Information Saved!"),y.find(".msg-plus").hide()):(T.text("Welcome to Xtensio Plus"),y.find(".msg-free").hide()),console.log(w+"sd ")},error:function(e){c.removeClass("busy"),i(e.Message)}})}}))}),$("#billing-link").click(function(){e.payment(null,!0)}),function(a){c.find(".filter-popup-menu").hide();var n=t.hasDiscount;n?(r=a,c.addClass("busy").find(".popup-content").removeClass("success"),T.text("Students and Faculty, Save 50%"),C.text("Upgrade"),o.loadStripe(function(){o.getData(1,function(e,t,a,n){c.removeClass("busy"),c.find(".msg").toggleClass("hidden",!t).find(".time").text(n),T.data("plus",t),T.data("end",n),a||e.Referrals.length||!t||C.text("Add Billing Information"),1==e.ST&&(C.text("Upgrade to Yearly"),c.find(".card-box").hide(),c.find(".item").hide(),w=!0,u.css({marginTop:0}),$(".total  ul li:nth-child(3)").hide())})}),e.show(c,"studentbilling")):e.payment()}},app.popup.getForgotPass=function(e,t,a,n){var o,i,s,r=$("#tmp-fpass"),l=r.find(".email"),c=(r.find(".popup-cta"),r.find(".msg")),d=function(){c.attr("class","msg"+(i?" error":"")).text(s)},u=function(){o=l.val(),i=!validator.isEmail(o),s=i?"Please provide a valid email address.":"Sending Email. Please wait.",d(),i||n.forgotPassword({email:o,success:function(e){i=!1,s=e.Message,d()},error:function(e){i=!0,s=e.Message||"There was an error. Please try again.",d()}})};return r.find(".sign-in").on("click",function(){e.signIn()}),l.on("keyup",function(e){13==e.which&&u(),d()}),r.find(".popup-cta").on("click",u),e.reg(r),function(t){o=t,l.val(o),d(),e.show(r)}},app.popup.getPayment=function(e,t,a,n,o){function i(){C.text(".")}function s(e){e=e||"Error - Please review the highlighted fields.",d.text(e).addClass("show")}var r,l,c=$("#tmp-payment"),d=c.find(".error-msg"),u=c.find(".checkout-btn"),m=c.find(".card-num"),p=c.find(".cvc"),f=(c.find(".month-radio"),c.find(".year-radio"),c.find(".user-name")),h=(c.find(".radios a"),c.find(".month")),g=c.find(".year"),v=c.find("input, select"),b=c.find(".detail-btn"),y=c.find(".charged"),C=c.find(".msg-end"),T=c.find(".success-panel"),w=u.find(".txt"),x=c.find(".popup-header h1"),k=!1,D=c.find(".circular-switch"),S=(D.find(".button-out"),D.find(".button-in"),!0),I=c.find(".choose-plan"),M="",P=function(){D.attr("title",S?"Yearly":"Monthly"),D.toggleClass("off",!S),S?(D.addClass("off"),$("#tmp-payment .card-panel .paper").removeClass("monthly"),D.find(".button-switch").text("Yearly")):(D.removeClass("off"),$("#tmp-payment .card-panel .paper").addClass("monthly"),D.find(".button-switch").text("Monthly")),$("#tmp-payment .card-panel .popup-header p").removeClass("selected"),$("#tmp-payment .card-panel .popup-header p:eq("+(S?0:1)+")").addClass("selected"),S?($("#tmp-payment .plan-cont:eq(1) .plan-bot .num").text("5"),$("#tmp-payment .plan-cont:eq(2) .plan-bot .num").text("10"),$("#tmp-payment .plan-cont:eq(3) .plan-bot h1").html('$<span class="num">50</span><span class="small">/mo</span>')):($("#tmp-payment .plan-cont:eq(1) .plan-bot .num").text("7"),$("#tmp-payment .plan-cont:eq(2) .plan-bot .num").text("14"),$("#tmp-payment .plan-cont:eq(3) .plan-bot h1").html('<span class="small">Not available in monthly</span>'))};D.on("click",function(){S=!S,P()}),P();var E={Plusmonthly:7,Plusyearly:5,Promonthly:14,Proyearly:10};I.click(function(){var e=$(this).attr("data-plan");if("Team"!=e){c.find(".plan-cont , .feat-cont, .popup-header p, .popup-header div").hide();var t=E[e+(S?"yearly":"monthly")];F(e,t),c.find(".card-details").show(),x.text("Let's finish up!")}});var A=function(e){c.find(".plan-cont , .feat-cont, .popup-header p, .popup-header div").hide();var t=E[e+(S?"yearly":"monthly")];F(e,t),c.find(".card-details").show(),x.text("Let's finish up!")},F=function(e){var t=E[e+(S?"yearly":"monthly")];c.find(".plan-det .div-l h3:eq(0)").text("Xtenio "+e),c.find(".plan-det .div-l h3:eq(1)").text("Billed "+(S?"Yearly":"Monthly")),S?c.find(".plan-det .div-r h1").html("$"+12*t+"<span>/year</span>"):c.find(".plan-det .div-r h1").html("$"+t+"<span>/mo</span>");var a=0,n=0;S?(a="$"+12*t+"/year",n="$"+12*t+" every year"):(a="$"+t+"/month",n="$"+t+" every month"),c.find(".plan-det .div-r p span").text("("+a+")"),y.text(n),"Pro"==e?(M="",u.find(".txt").text("Upgrade to Pro")):"Plus"==e&&(M="Plus",u.find(".txt").text("Upgrade to Plus"))};for(l=1;l<=12;l++)h.find(".filter-popup-menu").append('<div class="item" data-value="'+l+'">'+l+"</div>");for(l=2017;l<=2030;l++)g.find(".filter-popup-menu").append('<div class="item" data-value="'+l+'">'+l+"</div>");c.find(".loading-animation").html(e.spinner),e.reg(c,c.find(".icon-Close, .no"),function(){r&&r()}),b.click(function(){e.billing(1)}),u.click(function(e){var t=0,a=m.val(),i=p.val(),r=parseInt(h.find(".item.active").attr("data-value"))||1,l=parseInt(g.find(".item.active").attr("data-value"))||(new Date).getFullYear(),u=f.val(),b=M+(S?"Year":"Month");v.removeClass("error"),d.removeClass("show"),Stripe.card.validateCardNumber(a)||(t=1,m.addClass("error")),Stripe.card.validateCVC(i)||(t=1,p.addClass("error")),Stripe.card.validateExpiry(r,l)||(t=1,h.add(g).addClass("error")),u||(t=1,f.addClass("error")),t?s():(c.addClass("busy"),Stripe.card.createToken({number:a,cvc:i,exp_month:r,exp_year:l,name:u},function(e,t){if(t.error)c.removeClass("busy"),s(t.error.message);else{var a=t.card,i=t.id,r="";r=""==M?"xtensio pro":"xtensio plus",n.buy({data:{Token:i,CardId:a.id,Last4:a.last4,Brand:a.brand,Plan:b,Name:u},success:function(e){o.refresh(),c.removeClass("busy"),c.find(".popup-content").addClass("success");var t="plusyear"==b.toLowerCase()||"year"==b.toLowerCase()?"Year":"Month";T.find(".plan-name").text(""==M?"Pro":"Plus"),T.find(".time").text(moment(+e.Message).format("MMMM Do, YYYY")),T.find(".period").text(t.toLowerCase()),T.find(".plan-time").text(t+"ly"),x.data("plus")?(x.text("Billing Information Saved!"),T.find(".msg-plus").hide()):(x.text("Welcome to Xtensio Plus"),T.find(".msg-free").hide()),T.find(".msg-free").hide(),T.find(".msg-plus").show(),""==M?x.text("Welcome to Xtensio Pro"):x.text("Welcome to Xtensio Plus")},error:function(e){c.removeClass("busy"),s(e.Message)}})}}))});return function(t,a,n){S=!0,r=t,c.addClass("busy").find(".popup-content").removeClass("success"),x.text("Upgrade your Xtensio account"),w.text("Upgrade"),k=a||!1,c.find(".filter-popup-menu").hide(),o.loadStripe(function(){o.getData(1,function(e,t,a,o){c.removeClass("busy"),c.find(".msg").toggleClass("hidden",!t).find(".time").text(o),x.data("plus",t),x.data("end",o),t&&(x.text("Add Billing Information"),w.text("Save")),c.find(".plan-cont").removeClass("selected"),t||a?!a||10!=e.ST&&11!=e.ST?!a||1!=e.ST&&2!=e.ST||c.find(".plan-cont:eq(2)").addClass("selected"):c.find(".plan-cont:eq(1)").addClass("selected"):c.find(".plan-cont:eq(0)").addClass("selected"),2==e.ST||11==e.ST||9==e.ST?S=!0:0!=e.ST&&(S=!1),c.find(".plan-cont , .feat-cont, .popup-header p, .popup-header div").show(),c.find(".card-details").hide(),i(),n&&(S=n.isYearly,A(n.planName)),P()})}),e.show(c,"billing")}},app.popup.getSettings=function(e,t,a,n,o){function i(e,t){t=t||"success",b.text(e).addClass(t),setTimeout(function(){b.removeClass("success error")},3e3)}function s(){var e=$.trim(p.val());e?e!=t.userEmail?validator.isEmail(e)?o.changeEmail({
email:e,success:function(){i("Email saved."),t.userEmail=e},error:function(e){i(e.Message,"error")}}):i("Invalid email.","error"):i("Email saved"):i("Email cannot be empty.","error")}var r=0,l=$("#tmp-settings"),c=l.find(".tabs > span"),d=l.find(".tab"),u=l.find(".save"),m=l.find(".icon-Close , .cancel"),p=l.find(".email-text").val(t.userEmail),f=l.find(".full-n").val(t.fullName),h=l.find(".current-pass"),g=l.find(".new-pass"),v=l.find(".repeat-pass"),b=l.find(".msg"),y=function(){var e=$.trim(f.val());e?e!=t.fullName?o.changeFullName({fullName:e,success:function(){t.fullName=e,i("Name saved."),a.raiseEvent("nameChanged")},error:function(e){i(e,"error")}}):i("Name saved"):i("Name cannot be empty.","error")},C=function(){var e=h.val(),t=g.val(),a=v.val(),n="";e||(n+="<p>Please provide your current password.</p>"),(!t||t.length<8)&&(n+="<p>New Password must be at least 8 characters long.</p>"),t!=a&&(n+="<p>New password and password confirm do not match</p>"),n?b.addClass("error").html(n):o.changePassword({oldPassword:e,newPassword:t,confirmPassword:a,success:function(){i("Password saved")},error:function(e){i(e.Message,"error")}})},T=function(){switch(b.text("Saving ...").attr("class","msg"),r){case 1:s();break;case 2:C();break;default:y()}};return c.on("click",function(){var e=$(this).addClass("selected");c.not(e).removeClass("selected"),r=e.index(),b.text(""),d.removeClass("selected").filter(":eq("+r+")").addClass("selected")}),u.on("click",T),e.reg(l,m),function(){b.removeClass("error success"),e.show(l)}},app.popup.getSignIn=function(e,t,a,n){var o=null,i=$("#tmp-sign-in"),s=i.find(".popup-header"),r=i.find(".sign-up"),l=i.find(".forgot-btn"),c=i.find(".msg"),d=i.find(".sign-in"),u=i.find("form"),m=u.find(".email"),p=u.find(".pass"),f=i.find(".actions"),h=i.find(".select"),g=!1;return h.on("click",function(){$(this).toggleClass("selected").parent().toggleClass("selected")}),c.on("click",".resend",function(e){return c.html("Resending verification email. Please wait.").attr("class","msg"),n.resendEmail({email:m.val(),success:function(){c.html("Verification email was resent.").attr("class","msg success")},error:function(){c.html("There was an error. Check your connection and try again.").attr("class","msg error")}}),!1}),"EmailConfirm"==t.loginState?(s.html('<h1>Email address confirmed.</h1><h3 class="message" style="font-size: 20px;">Please sign in to pick up where you left off.</h3>'),f.remove()):"PassReset"==t.loginState?(s.html('<h1>Password was reset.</h1><h3 class="message" style="font-size: 20px;">Please sign in to continue.</h3>'),f.remove()):s.html("<h1>Sign In</h1>"),r.on("click",function(){window.history.pushState("","","/account/signup"),e.signUp()}),l.on("click",function(){return e.forgotPass(m.val()),!1}),u.submit(function(e){var a=m.val(),o=p.val(),i=(validator.isEmail(a)?0:1)|(o&&o.length>7?0:2),s="";return g&&(s=t.token),c.toggleClass("error",i>0),1==i?c.html("Please provide a valid email."):2==i?c.html("Password is not valid. At least 8 characters expected."):3==i?c.html("Please provide a valid email and password."):(d.prop("disabled",!0),n.signIn(a,o,h.hasClass("selected"),function(e){window.location=e.Message||"/"},function(e){d.prop("disabled",!1),c.attr("class","msg error"),3==e.StatusCode?c.html('Please first verify your email address. <a href="#" class="resend">Resend verification email.</a>'):c.html("Email or password was not valid. Please try again.")},s)),!1}),t.Team&&0!=t.Team.Id&&(s.html("<h1>Sign in to "+t.Team.Name+"</h1><p>"+t.Team.TeamUrl+"</p>"),i.addClass("is-team")),e.reg(i),function(t,a,n){o=a,g=!!n,e.show(i)}},app.popup.getSignUp=function(e,t,a,n,o,i,s){var r=$("#xtensio-refer-info"),l=r.length,c=$("#tmp-sign-up"),d=c.find(".sign-in"),u=c.find(".msg"),m=c.find(".popup-cta"),p=c.find("form"),f=p.find(".email").val(t.userEmail),h=p.find(".name").val(t.fullName),g=p.find(".pass"),v=p.find(".coupon"),b=c.find(".popup-header"),y=!1;if((l||o)&&c.find(".sign-in-container").hide(),l&&(c.find(".xtensio-agreement").append(r.find(".agreement")),c.find(".xtensio-refer-info").append(r.find("> a, .list")),b.after(b.find("h2")),b.append(r.find(".name-sender"))),o){var C=c.find(".popup-content");b.html(i.PopupTitle).css("padding-top","35px"),m.text(i.SubmitText),C.before(i.Header),C.after(i.Footer),$("head").append('<style type="text/css">'+i.Css+"</style>")}return t.getCoupon&&v.removeClass("hidden"),d.on("click",function(){window.history.pushState("","","/account/signin"),"true"==t.EditTemplate?e.signIn(!1,null,!0):e.signIn()}),p.submit(function(a){var i=g.val(),s=f.val(),r=h.val(),l=v.val(),c="";if(y&&(c=t.token),!i||i.length<8)u.html("Password must be at least 8 characters long.").addClass("error");else if(s&&validator.isEmail(s))if(r)if(t.getCoupon&&!l)u.html("Please provide activation code.").addClass("error");else{m.prop("disabled",!0);var d={Email:s,Password:i,FullName:r,coupon:l,campaign:o,FolioToken:c},p=document.location.href;p=p.toLowerCase(),t.isTeam?n.TeamSignUp(d,function(){e.message({heading:"Done!</h3>",message:"Your team account is successfully created. Please login to proceed to your team dashboard.",btnText:"Login",noClose:!0,notMini:!0,handleOK:function(){t.Team&&(window.location=t.baseUrl)}})},function(e){m.prop("disabled",!1),u.html(e.Message).addClass("error")}):n.signUp(d,function(){e.signUpDone(s)},function(e){m.prop("disabled",!1),u.html(e.Message).addClass("error")})}else u.html("Please provide your full name.").addClass("error");else u.html("Please provide a valid email.").addClass("error");return!1}),e.reg(c),function(t){v.val("");var a=new URL(location.href);f.val(a.searchParams.get("email")),y=!!t,e.show(c)}},app.popup.getSignUpDone=function(e,t,a){var n=$("#tmp-sign-up-done"),o=n.find(".msg"),i=n.find(".email"),s=n.find(".popup-cta");return s.on("click",function(){s.attr("disabled",!0),o.html("Re-sending verification email. Please wait ...").removeClass("success error"),a.resendEmail({email:i.text(),success:function(){s.attr("disabled",!1),o.html("The verification email was re-sent.").addClass("success")},error:function(){s.attr("disabled",!1),o.html("Could not connect to the server. Please try again.").addClass("error")}})}),e.reg(n),function(t){i.text($.trim(t)),e.show(n)}},app.popup.getSignUpTeam=function(e,t,a,n){function o(e,t){t.siblings().removeClass("active"),t.addClass("active");var a=t.data("name")||t.text(),n=t.data("value"),o=n||a;e.data("value",o).find(".text").text(a)}var i,s=$("#tmp-sign-up-team"),r=s.find(".btn-next"),l=1,c=$("#team-progress-bar .fill"),d=s.find(".paper"),u=s.find(".btn-upload"),m=s.find(".addmem-btn"),p=$("#tmp-sign-up-teammember"),f=s.find(".members"),h=s.find(".step5"),g=h.find(".month"),v=h.find(".year"),b=s.find(".btn-pay"),y=s.find("#uploadimage-form")[0],C=s.find("p.error"),T=$("#tsu-back-button"),w="",x="",k="",D=[],S=s.find(".x-select");for("www.localhost.com"==window.location.hostname,$.each(S,function(e,t){var a=$(t),n=a.find(".popup-menu");a.on("click",".item",function(e){var t=$(this);a.hasClass("no-select")||t.hasClass("active")||(o(a,t),a.trigger("change"))}),a.on("val",function(e,t,n){o(a,a.find(".item[data-"+t+'="'+n+'"]'))}),n.length&&app.plugin.popupMenu(a,n)}),index=1;index<=12;index++)g.find(".popup-menu").append('<div class="item'+(1==index?" active":"")+'" data-value="'+index+'">'+index+"</div>");for(index=2017;index<=2030;index++)v.find(".popup-menu").append('<div class="item'+(2017==index?" active":"")+'" data-value="'+index+'">'+index+"</div>");m.click(function(){p.find("span").text(f.find(".each-mem").length+1+".");var e=$("#tmp-sign-up-teammember").html();f.append(e),s.find(".members .each-mem:last-child button").click(function(){M($(this).parent(".each-mem"))}),s.find(".members .each-mem:last-child .icon-Close").click(function(){$(this).parent(".each-mem").removeClass("added"),I()})}),s.find(".loading-animation").html(e.spinner),s.find(".btn-add-mem").click(function(){M($(this).parent(".each-mem"))}),s.find(".each-mem .icon-Close").click(function(){$(this).parent(".each-mem").removeClass("added"),I()});var I=function(){var e=s.find(".add-options .price .money"),t=s.find(".add-options .price .duration"),a=s.find(".each-mem.removeable.added"),n=s.find('.add-options .plan[data-plan="yearly"]').hasClass("selected")?"Year":"Month",o=s.find('.add-options .plan[data-plan="yearly"]').hasClass("selected")?120:25;e.text(600+a.length*o+"$"),s.find(".step5 .charge span").text(600+a.length*o+"$"),t.text(n)},M=function(e){s.addClass("busy");var a=/.+\@.+\..+/,n=e.find("input").val();if(n)if(n.match(a)){if(n==t.SignedInEmail)return void F("You can not add yourself.");for(var o=s.find(".each-mem.added"),i=0;i<o.length;i++)if(console.log(s.find(".each-mem.added:eq("+i+")").find("p").text(),n),s.find(".each-mem.added:eq("+i+")").find("p").text()==n)return void F("User already Added.");e.find("p").text(n),e.addClass("added"),I(),s.removeClass("busy")}else F("Invalid email address.");else F("Add a valid Email.")};s.find(".skip").click(function(){E(!0)}),T.click(function(){P()});var P=function(){s.addClass("busy");for(var e=$("#tmp-sign-up-team .paper")[0].className.split(/\s+/),t=0;t<e.length;t++)if(e[t].indexOf("checkpoint")>-1){var a=parseInt(e[1].substr(10,11));l=a-1,setTimeout(function(){s.removeClass("busy");var e=100*(a-1)/6;c.css({width:e+"%"}),d.removeClass("checkpoint"+a),d.addClass("checkpoint"+(a-1)),a>2?T.show():T.hide()},1e3)}},E=function(e){s.addClass("busy");for(var t=$("#tmp-sign-up-team .paper")[0].className.split(/\s+/),a=0;a<t.length;a++)if(t[a].indexOf("checkpoint")>-1){var n=parseInt(t[1].substr(10,11));l=n+1,setTimeout(function(){s.removeClass("busy");var t=100*(n+1)/6;c.css({width:t+"%"}),d.removeClass("checkpoint"+n),d.addClass("checkpoint"+(n+1)),n>0&&n<5?T.show():T.hide(),4==n&&e&&(s.find(".each-mem.added").removeClass("added"),s.find(".each-mem.self").addClass("added"),I()),s.find(".paper >div:visible input:visible:first").focus()},1e3)}};s.find(".add-options .plan").click(function(){s.find(".add-options .plan").removeClass("selected"),$(this).addClass("selected"),I()}),s.find(".uploader").change(function(){var e=this,t=e.files&&e.files[0];t&&(s.addClass("busy"),y=s.find("#uploadimage-form")[0],a.uploadTeamImage(y,t,{type:"logo",isProgress:!1,success:function(e){console.log("res",e),k=e.Message,i=e.Data,$(".team-signup .top-section img").attr("src",k).prop("title",w),$(".team-signup .top-section a").css({pointerEvents:"none"}),r.click()},error:F}))}),u.click(function(){s.find(".uploader").click()}),b.click(function(){s.addClass("busy");var e,n,o,r,l,c=!1;if(e=h.find(".name").val(),n=h.find(".code").val(),o=h.find(".number").val(),l=parseInt(h.find(".month .item.active").attr("data-value")),r=parseInt(h.find(".year .item.active").attr("data-value")),Stripe.card.validateCardNumber(o)?h.find(".number").removeClass("error"):(h.find(".number").addClass("error"),c=!0),Stripe.card.validateCVC(n)?h.find(".code").removeClass("error"):(h.find(".code").addClass("error"),c=!0),Stripe.card.validateExpiry(l,r)?(h.find(".month").removeClass("error"),h.find(".year").removeClass("error")):(h.find(".month").addClass("error"),h.find(".year").addClass("error"),c=!0),h.find(".name").toggleClass("error",!e),c||!e)return void F("Kindly make sure you added correct values.");for(var d=s.find(".each-mem.added.removeable"),u=0;u<d.length;u++)D.push(s.find(".each-mem.added.removeable:eq("+u+") input").val());for(var m=[],u=0;u<D.length;u++)m.push({email:D[u],Role:parseInt(t.DefautTeamRoleId),name:""});Stripe.card.createToken({number:o,cvc:n,exp_month:l,exp_year:r,name:e},function(t,n){if(n.error)s.removeClass("busy"),F(n.error.message);else{var o=n.card,r=n.id;a.purchaseTeam({data:{teamInfo:{Id:0,Name:w,LogoUrl:k,TeamUrl:x,Status:1,OwnerEmail:"",TeamMembers:m,ImageID:i},billingInfo:{Token:r,CardId:o.id,Last4:o.last4,Brand:o.brand,Name:e,MembersCount:m.length}},success:function(e){console.log(e),s.find(".goto-dashboard").attr("href","https://"+x),E()},error:function(e){F(e.Message)}})}})});var A=null,F=function(e){C.stop(!0,!0),s.removeClass("busy"),C.text(e).show(),clearTimeout(A),A=setTimeout(function(){C.hide("slow")},1e4)};return r.click(function(){if(console.log(w,x,k,D,l),C.hide(),s.addClass("busy"),d.hasClass("checkpoint1")){w=s.find(".step1 input").val();var e=s.find(".step1 input").val().toLowerCase(),n=/^\w+(\s\w+)*$/;e.length<3?F("Name has to be atleast 3 characters long."):e.match(n)?E():F("Name can only consist of alphabets or numeric values only"),s.removeClass("busy")}else if(d.hasClass("checkpoint2")){var o=s.find(".step2 input").val().toLowerCase(),n=/^[0-9a-zA-Z]+$/;o.length<3?(s.removeClass("busy"),F("A url has to be 3 characters long.")):o.match(n)?a.checkTeamURL({data:{teamUrl:o},success:function(e){1==e.Data?(F("This url is already taken. Please choose another Url."),s.removeClass("busy")):("live"==t.Environment?x=o+".xtensio.com":"dev"==t.Environment?x=o+".xtensio.tech":"local"==t.Environment&&(x=o+".localhost.com:44301"),E())},error:function(e){console.log("error: ",e)}}):(s.removeClass("busy"),F("A url can only consist of alphabets or numeric values only"))}else d.hasClass("checkpoint3")?E():d.hasClass("checkpoint4")&&E()}),e.reg(s),function(){s.find(".each-mem.self p").text(t.SignedInUserName+" (you)"),n.loadStripe(function(){e.show(s)})}},app.popup.folioPass=function(e){var t,a=$("#tmp-get-fpass"),n=a.find(".pass"),o=a.find(".agree-box"),i=a.find(".agree"),s=a.find(".folio-msg"),r=a.find(".project-msg"),l=a.find("form"),c=a.find(".error-msg").text(e.passError),d=a.find("button");a.find(".token").val(e.verificationToken),e.isProject&&(s.hide(),r.removeClass("hidden"),i.prop("checked",!e.disclaimer),e.disclaimer&&o.removeClass("hidden")),n.on("keyup",function(e){t=!n.val(),d.prop("disabled",t)}),l.submit(function(){return n.val()?e.isProject&&i[0].checked!==!0?(c.text("You must agree with the Disclaimer first."),!1):void 0:(c.text("No password given."),!1)}),$("body").append(a.addClass("show"))},app.popup.getAddModule=function(e,t,a,n){var o,i,s=(app.wType,$("#tmp-add-module-popup")),r=(s.find("input"),s.find("h1")),l=s.find(".icon-Close"),c=s.find(".addModule-moduleblock"),d=s.find(".addModule-canvasblock"),u=(s.find(".addModule-importblock"),s.find(".addModule-eachfoliocont"),s.find("#addModule-select-folio-dropdown")),m=s.find("#addModule-select-folio-dropdown  li"),p=s.find("#addModule-select-folio-dropdown .addModule-textholder"),f=s.find(".tabs span"),h=s.find(".paper"),g=$("#tmp-add-mod-item").html(),v="app.xtensio.tech"==location.hostname?1:0,b=a.token,y=function(){var t=$(this).data("item");i(t.name),e.close()},C=function(){var o,s=$(this).data("item"),r=[],l=[],c={};if(s.template)t.templateMods({name:s.template,token:b,success:function(t){$.each(t.Data,function(s,d){if(d.Data=JSON.parse(d.Data),"DataModule"==d.Type)r=d.Data.Sections[0].ModIds;else if(r.indexOf(d.Tag)>-1){if(l.push(d),d.Store){var u=JSON.parse(d.Store).style;if(v&&console.log(u),u!=o){$("#folio-style").append(u),o=u;var m=n.get("style")||"";m=m.indexOf(u)>-1?m:m+u,n.set("style",m)}}}else c[d.Tag]=d;s==t.Data.length-1&&$.each(l,function(e,t){t.Data.Mods&&$.each(t.Data.Mods,function(e,t){var a=c[t.Tag];t.Type=a.Type,t.Data=a.Data}),t.New=!0,i(t.Type,t)}),app.editor.addWatermark(a,e)})},error:function(t){e.error(t.Message)}});else{var d=[{Col:0,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 1</h3><p>Just like the rest of your folio, you can add and remove modules to your canvas, drag them in and out.</p>',Head:2}},{Col:1,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 2</h3><p>You can even change the number of columns and adjust their widths.</p>',Head:2}},{Col:2,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 3</h3><p>Changing the color scheme updates all modules within this canvas.</p>',Head:2}}],u={Tag:0,New:!0,Type:"Canvas",Data:{BgColor:"rgba(0,0,0,0)",Cols:"12",Type:"Canvas",Mods:d}};i(s.name,u)}e.close()},T=function(e,t,a){$.each(t,function(t,n){o=$(g),o.data("item",n),n.img&&o.find("i").addClass(n.img),"Videos"==n.name&&(o.prepend('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.55 27.68"><defs><style>.cls-av-1{fill:none;stroke-width: 0;}.cls-av-1,.cls-av-2{fill-rule:evenodd;}.cls-av-2{fill:#fff;}</style></defs><title>0Asset 36</title><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-av-1" d="M0,26.42c0,1.1.79,1.57,1.75,1L24.83,14.8c1-.53,1-1.39,0-1.92L1.75.22C.79-.31,0,.16,0,1.26Z"/><polygon class="cls-av-2" points="2.24 24.81 22.24 13.84 2.24 2.87 2.24 24.81"/></g></g></svg>'),o.find("i").remove()),o.find("p").text(n.text),o.click(a).addClass(t<4?"r-1":"").addClass(3==t||7==t?"c-last":""),e.append(o)})},w=[{name:"Text",text:"Text",img:"text"},{name:"Images",text:"Image",img:"img"},{name:"Videos",text:"Video",img:"img"},{name:"DonutChart",text:"Pie Chart",img:"pie"},{name:"Scale",text:"Scale Chart",img:"scale"},{name:"Bar",text:"Bar Graph",img:"bar"},{name:"Tag",text:"Tags",img:"tags"},{name:"DataCollection",text:"Email Form",img:"form"},{name:"Social",text:"Social",img:"social"},{name:"RowBreak",text:"Row Break",img:"row"}],x=[{name:"Canvas",text:"Blank",img:"blank",template:"blank-canvas"},{name:"Persona",text:"Persona",img:"persona",template:"user-persona"},{name:"Business",text:"Business Canvas",img:"canvas",template:"business-model-canvas"},{name:"Lean",text:"Lean Canvas",img:"canvas",template:"lean-canvas"},{name:"SWOT",text:"SWOT Analysis",img:"swot",template:"swot-analysis"}];T(c,w,y),T(d,x,C),c.append($("#tmp-new-mod-req"));var k=function(e){h.add(f).removeClass("selected"),f.filter(":eq("+e+")").addClass("selected"),h.filter(":eq("+e+")").addClass("selected")};return f.click(function(){k($(this).index())}),u.click(function(){$(this).toggleClass("active")}),m.click(function(){p.text($(this).text())}),e.reg(s,l),function(t,a){i=t,a?(k(0),f.css("visibility","hidden"),c.find("> div:eq(8)").hide(),r.text("Add Module")):(r.text("Add"),c.find("> div:eq(8)").show(),f.css("visibility","")),e.show(s)}},app.popup.getCopySectionPopup=function(e,t,a,n,o){var i=$("#tmp-copy-move-section"),s=i.find(".destination .filter-popup-menu"),r=s.find(".item"),l=i.find(".order .filter-popup-menu"),c=i.find(".popup-cta.ok"),d=i.find(".destination .x-select .text"),u=0,m=null,p=null,f=i.find(".go-to-folio"),h=f.find(".gotofolio"),g=f.find(".name"),v=f.find(".verb"),b=!1;i.find(".loading-animation").html(t.spinner);var y=function(e){l.html("");for(var t=1;t<=e+1;t++)l.append('<div class="item" data-count="'+t+'">'+t+"</div>");l.find(".item:eq(0)").addClass("active")},C=function(t,a){console.log(a),s.html("");for(var n=0;n<a.length;n++)e.token!=a[n].Token&&(itemHtml='<div class="item" data-totalsec = "'+a[n].TotalSections+'" data-token="'+a[n].Token+'">'+a[n].FolioName+"</div>",s.append(itemHtml));r=s.find(".item"),r.click(function(){$this=$(this),y($this.data("totalsec")),c.removeClass("disabled")})};return c.click(function(){i.addClass("busy"),o.getCopySections({sourceToken:e.token,destinationToken:s.find(".active").data("token"),sectionTag:u,order:l.find(".active").data("count"),action:p,success:function(t){i.removeClass("busy"),h.attr("href",e.baseUrl+"/edit/"+s.find(".active").data("token")),g.text(s.find(".active").text());var a=b?"copied":"moved";v.text(a),i.addClass("success"),m&&m()},error:function(e){i.removeClass("busy"),t.message({heading:"Error",message:e.Message,btnText:"Ok"})}})}),t.reg(i,i.find(".icon-Close, .popup-cta.cancel")),function(r,l,f){s.html(""),i.removeClass("success"),p=l.indexOf("Move")>-1?"move":"copy",b=!(l.indexOf("Move")>-1),m=f?f:null,i.addClass("busy"),i.find(".popup-header h1").text(l),d.html("<span>Copy Section</span> To:"),d.find("span").text(l),c.text(l),c.addClass("disabled");var h=a.obtain(n.Modules,"Type","DataModule").Data.Sections;o.getUserFolios({teamId:e.Team.Id,success:function(e){i.removeClass("busy");var t=JSON.parse(e.Data);t.length>0&&C(h[r].Tag,t),u=h[r].Tag},error:function(e){i.removeClass("busy"),t.message({heading:"Error",message:e.Message,btnText:"Ok"})}}),t.show(i)}},app.popup.getExpOption=function(e,t,a){var n,o=$("#tmp-exp-option"),i=o.find(".ok"),s=o.find(".scale"),r=o.find(".page-margin"),l=o.find(".sec-margin"),c=o.find(".mod-margin"),d=o.find(".msg");return i.on("click",function(){var t,i,u,m,p=0,f=n.expOpt;return t=s.val(),i=r.val(),u=l.val(),m=c.val(),o.find(".error").removeClass("error"),validator.isInt(i)||(r.addClass("error"),p=1),validator.isInt(u)||(l.addClass("error"),p=1),validator.isInt(m)||(c.addClass("error"),p=1),d.toggleClass("error",p>0),!p&&(f.Scale=t,f.Margin=i,f.SecMargin=u,f.ModMargin=m,a.set("exp-opt-"+n.Token,JSON.stringify(f)),void e.close())}),e.reg(o,o.find(".icon-Close, .no")),function(t){n=t;var i={Scale:1,Margin:15,SecMargin:12,ModMargin:12},d=a.get("exp-opt-"+n.Token);if(d)try{i=JSON.parse(d)}catch(u){}n.expOpt=i,s.val(i.Scale),r.val(i.Margin),l.val(i.SecMargin),c.val(i.ModMargin),e.show(o)}},app.popup.getExport=function(e,t,a,n,o,i){var s,r,l,c,d,u,m,p=$("#tmp-export"),f=p.find(".popup-header"),h=f.find("h1"),g=f.find(".tabs"),v=g.find("span"),b=v.filter(".pdf"),y=v.filter(".png"),C=p.find(".js-pdf"),T=p.find(".no, .icon-Close"),w=p.find(".yes"),x=p.find(".loading-animation").html(t.spinner),k=p.find(".exp-option"),D=p.find(".msg"),S=p.find(".popup-header-note"),I=!1,M=function(e,t){S.find("h2 span").text(e+" credits"),S.find("p").text("Monthly credits: "+t)};o.addListener("plusUnlocked",function(){F()}),o.addListener("plusCancelled",function(){F()}),p.find(".see-plans-btn").click(function(){t.billing()}),v.click(function(){d||(r.format=$(this).hasClass("png")?"PNG":"PDF",E())}),k.click(function(){t.push(p),t.expOption(s)});var P=function(e){p.find(".x-select span"),p.find(".x-select .item").removeClass("active");var t=p.find('.x-select .item[data-value="'+e+'"]').addClass("active").text();p.find(".x-select .text").text(t)},E=function(){return r.format=r.format||"PDF",v.removeClass("selected"),p.find(".paper").hasClass("hide-cancel")||w.attr("href","#").html("Export "+r.format).removeClass("download"),h.text("Export "+r.format),l.target?p.find(".break").hide():p.find(".break").show(),"PNG"==r.format?(C.hide(),y.addClass("selected"),D.text("Export your "+(l.target||"folio")+" as a single PNG").show()):(r.orient=r.orient||"landscape",C.show(),D.hide(),b.addClass("selected"),p.find(".selection, .select, .radio").removeClass("selected"),p.find(".for-"+(r.mode||"screen")).addClass("selected").find(".change-mode").addClass("selected"),p.find(".break .sec").addClass(r.sec?"selected":""),p.find(".break .rb").addClass(r.rb?"selected":""),p.find('.radio[data-val="'+(r.orient||"landscape")+'"]').addClass("selected"),P(r.paper||"612x792")),!1};p.find(".change-mode").on("click",function(){return r.mode=$(this).data("mode"),E()}),p.find(".orientation .radio").on("click",function(){return r.orient=$(this).data("val"),r.mode="print",E()}),p.find(".break .select").on("click",function(){var e=$(this).data("val");return r[e]=!r[e],r.mode="print",E()}),p.find(".dropdown").on("change",function(){return r.paper=this.value,r.mode="print",E()}),p.find(".x-select .item").on("click",function(){return r.paper=$(this).attr("data-value"),r.mode="print",p.find(".x-select .text").text($(this).text()),E(),!0});var A=function(e){var t=T.add(w);d=!0,t.css("visibility","hidden"),n.exportFolio({format:r.format,html:e,settings:c,success:function(e){D.text("Your "+r.format+" is ready to download."),x.hide(),w.attr("href",e.Message).html('<i class="fi-download"></i> Download').addClass("download"),t.css("visibility","visible")},error:function(e){D.text("There was an error. Please try again."),x.hide(),t.css("visibility","visible")},complete:function(){d=!1}})};w.on("click",function(){if(!w.hasClass("billing")){if(!w.hasClass("download")){var a=$.extend({paper:"612x792"},r);c=s.expOpt||{},u=c.Scale||1,m=c.Margin||0;$(window).width()>1367?$(window).width():1367;if(null==a.paper&&(a.paper="612x792"),"print"==a.mode&&"PDF"==a.format){var n=a.paper.split("x");c.Landscape="landscape"==a.orient,c.Width=n[0],c.Height=n[1],c.Breaks=a.sec?1:0,c.Breaks|=a.pers?2:0,c.Breaks|=a.rb?4:0,c.BrowserWidth=1276*u,c.Landscape||"421x595"!=a.paper||(c.BrowserWidth=1250*u)}else c.OnePage=!0,c.Fit=!0,c.BrowserWidth=$(window).width(),c.Width=$(window).width(),c.Height=l.$el.height()>0?l.$el.height():0;return c.IsFreeUser=!(e.Team.Id>0)&&I,console.log(c.IsFreeUser),console.log("settings",c),C.hide(),D.text("Please wait ...").show(),x.show(),l.cb(c.BrowserWidth,function(e){c.Height=Math.min(14400,c.Height||Math.round(.75*l.$el.height())),A(e)}),!1}setTimeout(function(){t.close(p)},300)}}),t.reg(p,T);var F=function(){n.getExportCreditsLeft({success:function(e){var a=JSON.parse(e.Data);console.log(a),1==a.LimitsImposed?(p.find(".icon-Close").css({top:"110px"}),S.show(),M(a.CreditsLeft,a.MaxCredits),0===a.CreditsLeft?(w.addClass("billing"),p.find(".paper").addClass("hide-cancel"),w.text("See Plans and Upgrade"),w.removeAttr("download"),p.find(".yes.billing").one("click",function(){t.billing()})):(w.attr({download:!0}),w.removeClass("billing"),p.find(".paper").removeClass("hide-cancel"),r?w.text("Export "+(r.format||"PDF")):w.text("Export PDF"))):(S.hide(),p.find(".icon-Close").css({top:"15px"}))},error:function(e){console.log("error: ",e)},complete:function(){d=!1}})};return function(e,a,n){s=e,l=n,r=a,S.hide(),p.find(".icon-Close").css({top:"15px"}),i.getData(1,function(e,a,n,o){isfree=0==e.ST,I=!(!isfree||a),E(),x.hide(),F(),t.show(p)},!0)}},app.popup.getShareLink=function(e,t,a,n,o,i){function s(e,t){c.toggleClass("mod-share",e>0),c.find(".modh1 .mod-type").text("Canvas"==t?"Canvas":"Module"),c.find(".modp .mod-type").text("Canvas"==t?"canvas":"module")}var r={},l=!1,c=$("#tmp-popup-folio-share-link"),d=(c.find(".copy-field"),c.find(".copy-field.folio-link").copier()),u=c.find(".embed-url").copier(),m=c.find(".popup-content"),p=c.find(".tabs span"),f=c.find(".tab"),h=c.find(".button-bg"),g=h.find(".button-out"),v=h.find(".button-in"),b=c.find(".msg-content").hide(),y=c.find(".email-link"),C=b.find(".close-msg-btn"),T=b.find(".email-msg").val(""),w=c.find(".add-msg"),x=c.find(".input-pass-dot"),k=c.find(".input-pass-visible"),D=c.find(".icon-Preview"),S=c.find(".send-email"),I=c.find(".btn-save-pass"),M=c.find(".pass-section"),P=M.find(".error"),E=c.find(".busy .msg"),A=(c.find(".loading-animation").html(t.spinner),c.find(".pass-protect")),F=c.find(".change-indexed"),N=c.find(".change-present"),O=c.find(".email-result"),U=c.find("h1"),R=$("#spinner-container > .loading-animation").clone().addClass("size-30"),B=c.find(".share-url-desc-up.desc-btn"),L=c.find(".label-footer"),H=c.find(".labelnam"),j=L.find(".save-label-detail"),q=L.find(".no"),Y=(c.find(".header-desc"),c.find(".preview")),_=0,K=function(){if(a.userName&&0==a.Team.Id&&(a.editMode||a.isDashboard)){var e,t,i=c.find(".pass-select"),s="https://xtensio.com/pricing/",r='<div><a href="'+s+'" target="_blank">Requires Xtensio Pro</a></div>';n.getData(1,function(a,n,s,l){e=0==a.ST&&n,t=n&&(10==a.ST||11==a.ST||3==a.ST||16==a.ST),console.log(e,t,(e||t)&&!n),e||t?o.add(i,r,1e3):o.remove(i)},!0)}};K(),i.addListener("plusUnlocked",function(){K()}),i.addListener("plusCancelled",function(){K()}),j.click(function(){G("Saving"),r.Title=c.find(".title").val(),r.Description=c.find(".desc").val(),e.changeLabelProps(r,{success:function(){j.find("i").removeClass("hidden"),j.find("span").text("Saved"),q.text("Close"),setTimeout(function(){j.find("i").addClass("hidden"),j.find("span").text("Save"),q.click()},2e3)},error:function(e){t.error(e.Message)},complete:function(){G()}})});var V=function(){r.isLabel?(U.text("Link Sharing"),h.attr("title","Link Sharing is "+(r.Private?"Off":"On")),r.Private?(g.text(""),v.text("Off")):(g.text("On"),v.text(""))):(U.text("Link Sharing is "+(r.Private?"Off":"On")),h.attr("title","Link Sharing is "+(r.Private?"Off":"On"))),c.find(".title").val(r.Title),c.find(".desc").val(r.Description)};I.find(".loading-animation").html(t.spinner);var G=function(e){l=!!e,E.text(e),m.toggleClass("busy",l)},z=function(){e.updatePrivacy(r,{success:function(){},error:function(e){t.error(e.Message)},complete:function(){G(),m.toggleClass("private",r.Private),F.prop("checked",r.Indexed)}})};h.on("click",function(){return a.Team&&a.Team.Id&&5==a.Team.Role?void t.teamUserActionBlocked("link"):(G(r.IsUserTemplate?"Making template "+(r.Private?"public.":"private."):r.isLabel?"Making Label "+(r.Private?"public.":"private."):"Making folio "+(r.Private?"public.":"private.")),r.Private=!r.Private,r.Private&&(r.Indexed=!1),z(),void V())}),F.on("click",function(){r.Indexed=$(this).is(":checked"),z()}),N.on("click",function(){var a=r.PresentationMode=$(this).is(":checked");e.changePresentMode({token:r.Token,present:a,error:function(e){t.error(e.Message)}})}),A.on("click",function(){if(a.Team&&a.Team.Id&&5==a.Team.Role)return void t.teamUserActionBlocked("link");var n=$(this);t.push(c),P.hide(),t.plusPrompt("pass",function(){t.pop(),n.toggleClass("selected"),n.hasClass("selected")?M.show():(M.hide(),G("Removing folio password."),e.removeObjPass({isLabel:r.isLabel,token:r.Token,success:function(){r.HasPass=!1},error:function(e){t.push(c),t.error(e.Message)},complete:function(){G()}}))},!0)}),I.click(function(){t.push(c);var a;a=M.hasClass("show-pass")?k.val():x.val(),a?(P.hide(),t.plusPrompt("pass",function(){t.pop(),I.find(".loading-animation").removeClass("hidden"),I.find("span").text("Saving"),e.setObjPass({isLabel:r.isLabel,token:r.Token,pass:a,success:function(){r.HasPass=!0},error:function(e){t.push(c),t.error(e.Message)},complete:function(){I.find(".loading-animation").addClass("hidden"),I.find("img").removeClass("hidden"),I.find("span").text("Saved"),setTimeout(function(){I.find("img").addClass("hidden"),I.find("span").text("Save")},3e3)}})},!0)):P.show()}),w.on("click",function(){b.show(),w.hide()}),C.on("click",function(){b.hide(),T.val(""),w.show()}),p.on("click",function(){p.removeClass("selected"),f.removeClass("selected").filter(":eq("+$(this).addClass("selected").index()+")").addClass("selected")}),S.click(function(){if(!l){var t=$.trim(y.val()),a=T.val();if(O.removeClass("error success").hide(),t&&t.length>0){var n=t.split(","),o=[];if($.each(n,function(e,t){validator.isEmail($.trim(t))||o.push(t)}),o.length)1==o.length?O.text('"'+o[0]+'" is not a valid email.').addClass("error").show():O.text(o.map(function(e){return'"'+e+'"'}).join(", ")+" are not valid email addresses.").addClass("error").show();else{S.find("span").text("Sending"),S.prepend(R),l=!0;var i={token:r.Token,addresses:t,message:a,modId:_,success:function(){S.addClass("sent").find("span").text("Sent"),setTimeout(function(){S.removeClass("sent").find("span").text("Send Email")},3e3)},error:function(e){O.text(e.Message).addClass("error").show(),S.find("span").text("Send Email")},complete:function(){l=!1,R.remove()}};r.isLabel?e.sendLabelEmail(i):e.sendShareEmail(i)}}else O.text("Please type one or more valid emails addresses to send message.").addClass("error").show()}}),D.on("click",function(){M.toggleClass("show-pass"),M.hasClass("show-pass")?k.val(x.val()):x.val(k.val())});var X=function(){r.isLabel?(B.show(),L.hide(),(r.Title||r.Description)&&B.text("Edit page title and description")):(B.hide(),L.hide())};B.on("click",function(){B.hide(),L.show()}),q.on("click",function(){r.Title||r.Description?B.text("Edit page title and description"):B.text("Add page title and description"),B.show(),L.hide()});var W=function(e){var t,a;r.isLabel?(t=r.Title||r.Name,a=r.Description||'All my folios labelled "'+r.Name+'" on Xtensio. #'+r.Name.replace(/ /g,"")):(t=r.FolioName,a='My folio "'+r.FolioName+'" on Xtensio.'),$.shareLinks(e,c,t,a,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin")};return t.reg(c,c.find(".icon-Close")),function(e,n,o){r=e,m=c.find(".popup-content").toggleClass("private",r.Private),
M=c.find(".pass-section").toggle(r.HasPass),A=c.find(".pass-protect").toggleClass("selected",r.HasPass),F.prop("checked",r.Indexed),N.prop("checked",r.PresentationMode),$(".input-pass").val(""),M.removeClass("show-pass"),c.find(".popup-wrapper").toggleClass("all-label",!!r.isLabel),c.find(".tab, .tabs span").removeClass("selected"),c.find(".tabs span:eq(0), .url-content").addClass("selected");var i;r.Role<2&&c.addClass("user-cannot-edit"),r.IsUserTemplate?(c.find(".header-message .private .f-t").text("This template is set to private, only you (and your collaborators) can view/use it."),c.find(".header-message .public .f-t").text("Anyone with the link can use your template."),c.find(".header-pass-desc.f-t").text("Password protect your template"),c.find(".url-content h3.f-t").text("Template share URL"),c.find(".email-content h3.f-t").text("Send template via email"),c.find(".embed-content h3.f-t").text("Embed your template")):(c.find(".header-message .private .f-t").text("This folio is set to private, only you can view it."),c.find(".header-message .public .f-t").text("Anyone with the link can view your folio."),c.find(".header-pass-desc.f-t").text("Password protect your folio"),c.find(".url-content h3.f-t").text("Folio share URL"),c.find(".url-content h3.f-t").text("Send folio via email"),c.find(".embed-content h3.f-t").text("Embed your folio")),r.isLabel?(H.text(r.Name),i=a.baseUrl+"/project/"+r.Token,d.val(i),Y.attr({href:i}),u.val('<iframe width="100%" height="100%" src="'+i+'"></iframe>'),V()):(n=n||0,_=n,i=a.baseUrl+"/folio/"+r.Token+(n>0?"/"+n:""),d.val(i),Y.attr({href:i}),u.val('<iframe width="100%" height="100%" src="'+i+'"></iframe>'),s(n,o)),V(),W(i),X(),t.show(c)}},app.popup.getAddMembers=function(e,t,a){var n=$("#tmp-add-member"),o=n.find(".no, .icon-Close"),i=n.find(".ok"),s=n.find("input");return n.find(".loading-animation").html(t.spinner),i.click(function(){console.log(s.val())}),t.reg(n,o),function(e){t.show(n)}},app.popup.getTeamUserActionBlocked=function(e,t){var a,n;return a="You can not perform this action.",function(e,o){n='<div style="text-align:center;font-size: 16px;"><b>Sorry, '+(o||"Single Folio Guests")+" are not allowed to ","pwd"==e?n+="edit password of this folio.</b>":"collab"==e?n+="modify the Collaborators.</b>":"dupicate"==e?n+="duplicate folios.</b>":"create"==e?n+="create folios.</b>":"link"==e?n+="modify link sharing settings.</b>":"transfer"==e?n+="transfer folio.</b>":"label"==e?n+="create new channels.</b>":"non-team-member"==e?"Premium Guests"==o?n='<div style="text-align:center;font-size: 16px;"><b>Sorry, Premium Guests can only invite existing team members':n+="invite non team members.</b>":n+="invite-member"==e?"add new members to the team.":"perform this action.</b>",n+='<p style="margin-top: 15px;margin-bottom: -5px;">Please contact your admin for more access.</p></div>',t.message({heading:a,message:n,btnText:"Ok",notMini:!0})}},app.popup.getTransferFolioToSpace=function(e,t,a,n){function o(n,o){g=!0,l.find(".loading-animation").show(),a.moveUserFolios({userEmail:e.userEmail,source:v,destination:n,folios:f,success:function(a){g=!1,l.find(".loading-animation").hide(),t.message({heading:"Success",message:"Folio Has been transfered successfully.",btnText:"OK",handleOK:function(){window.location.href.indexOf(f)>1&&(window.location=e.baseUrl)}});var n=$("#folio-items-container").find(".folio-item-shell[data-token='"+f+"']");n.animate({width:0,opacity:0,padding:0},500,"linear",function(){n.remove()})},error:function(e){g=!1,l.find(".loading-animation").hide(),5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}})}function i(n,o){g||(g=!0,l.find(".loading-animation").show(),a.setUserDefinedTeam({notificationId:p,teamId:n,success:function(){a.processTransfer({data:{verb:"accept",secret:h,teamId:n},success:function(){if(l.find(".loading-animation").hide(),g=!1,t.message({heading:"Success",message:"Folio Has been transfered successfully.",btnText:"OK"}),e.Team&&e.Team.Id==n&&(window.location="/"),0==n&&e.Team.Id==v&&b==e.userName&&e.isHome){var a=$("#folio-items-container").find(".folio-item-shell[data-token='"+f+"']");a.animate({width:0,opacity:0,padding:0},500,"linear",function(){a.remove()})}},error:function(e){g=!1,l.find(".loading-animation").hide(),5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}})},error:function(e){t.error(e.Message)}}))}function s(e,t){return function(){y?o(e,t):i(e,t)}}function r(){if(e.UserTeams&&e.Team&&0!=e.Team){u.empty();var t=$(c.html());t.find("h3").text("Personal Account"),t.on("click",s(0,"")),u.append(t);for(var a=0;a<e.UserTeams.length;a++){var n=!1;5!=e.UserTeams[a].Role&&(console.log(y,e.UserTeams[a].Id,e.Team.Id),y&&e.UserTeams[a].Id==e.Team.Id&&(n=!0),n||(t=$(c.html()),t.find("h3").text(e.UserTeams[a].Name),t.on("click",s(e.UserTeams[a].Id,e.UserTeams[a].TeamUrl)),u.append(t)))}}}var l=$("#tmp-transfer-folio-to-space"),c=l.find(".no-show"),d=l.find(".cancel, .icon-Close"),u=l.find(".teams"),m=l.find(".btn-decline"),p=0,f=null,h=null,g=!1,v=0,b="",y=!1;return l.find(".loading-animation").html(t.spinner),m.click(function(){a.processTransfer({data:{verb:"reject",secret:h},success:function(){location.reload()},error:function(e){t.error(e.Message)}})}),t.reg(l,d),function(e){e&&e.sameUser?(y=e.sameUser,f=e.Data.Token,v=e.Data.TeamID,b=e.Owner,r(),t.show(l)):e&&(p=e.Id,f=e.Data.Token,h=e.Data.Code,v=e.Data.TeamID,b=e.Owner,r(),t.show(l))}},app.popup.getTransferTeamFolio=function(e,t,a,n,o){function i(e){var t=m.height()+16;switch(r=e,f.prop("readonly",!0),m.css("min-height",""),m.removeClass("busy search sent found not-found"),r){case d.busy:m.css("min-height",t).addClass("busy");break;case d.found:m.addClass("found"),T.text(l),D.text("Transfer");break;case d.notFound:m.addClass("not-found"),x.text(c),D.text("Invite & Transfer");break;case d.sent:m.addClass("sent"),D.addClass("no").removeClass("yes").text("Close"),S.find(".name").text(l||I.val()+" signs up and");break;default:m.addClass("search"),f.prop("readonly",!1),D.text("Search")}}function s(){i(d.busy),n.transfer({data:{token:E,name:l||I.val(),email:c,message:g.val(),AllowOutside:A},success:function(e){i(d.sent)},error:function(e){i(d.search),y.show().text(e.Message||"There was an error. Please try later.")}})}var r,l,c,d={search:1,busy:2,found:3,notFound:4,sent:5},u=$("#tmp-team-transfer"),m=u.find(".paper"),p=u.find(".popup-header h1"),f=m.find(".email").val(""),h=m.find(".msg-box"),g=h.find(".msg"),v=h.find(".msg-content"),b=h.find(".close-msg-btn"),y=m.find(".error"),C=m.find(".found"),T=C.find(".name"),w=m.find(".not-found"),x=w.find(".name"),k=m.find(".add-msg"),D=m.find(".popup-cta"),S=m.find(".result"),I=m.find(".full-name").val(""),M=m.find(".back-btn"),P=u.find(".team-select"),E=e.token,A=!1;return m.find(".loading-animation").html(t.spinner),k.click(function(){k.hide(),v.show()}),b.click(function(){k.show(),v.hide(),g.val("")}),M.click(function(){f.val(""),i(d.search)}),D.click(function(){switch(r){case d.search:c=$.trim(f.val()),""==c&&(c=P.find(".item.active").data("value"),c&&f.val(c));var a=validator.isEmail(c);a&&c==e.userEmail&&e.Team&&e.Team.Id>0&&1==e.Team.Role?t.transferFolioToSpace({sameUser:!0,Data:{Token:E,TeamID:e.Team.Id,Owner:c}}):a?(y.hide(),i(d.busy),n.findUser({email:c,success:function(a){e.Team&&e.Team.Id>0&&e.Team.Role<4&&a.Message&&(A?i(d.found):n.listTeamMembers({data:{teamId:e.Team.Id},success:function(e){for(var a=!1,n=!1,o=0;o<e.Data.Data.length;o++)e.Data.Data[o].Email==c&&(a=!0,l=e.Data.Data[o].UserName,5==e.Data.Data[o].Role&&(a=!1,i(d.search),y.show().text(e.Message||"This user is a Single Folio User on this team."),n=!0));a?(console.log("states.found"),i(d.found)):t.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){y.show().text(e.Message||"There was an error. Please try later.")}})),e.Team&&e.Team.Id>0&&e.Team.Role<4&&!a.Message?t.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(l=a.Message||l,i(a.Message?d.found:d.notFound))},error:function(){i(d.search),y.show().text("There was an error. Please try later.")}})):y.show().text("Invalid Email");break;case d.found:s();break;case d.notFound:l=I.val(),w.toggleClass("no-name",!l),l&&s();break;default:t.close()}}),u.find(".is-team-admin").click(function(){t.transferTeamFolio(E,{allowOutside:!0})}),t.reg(u,u.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(a,o){return m.addClass("busy"),A=!1,o&&(A=o.allowOutside||!1),A?(u.addClass("is-outside"),p.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>')):(u.removeClass("is-outside"),p.html("Transfer Ownership")),console.log(o),e.Team&&e.Team.Id>0&&5==e.Team.Role?void t.teamUserActionBlocked("transfer"):e.Team&&e.Team.Id>0&&4==e.Team.Role?void t.teamUserActionBlocked("transfer","Premium Guests"):(e.Team&&e.Team.Id>0&&(1==e.Team.Role||2==e.Team.Role)&&!A?u.addClass("team-allow-out"):u.removeClass("team-allow-out"),E=a||E,y.hide(),i(d.search),f.val(""),D.addClass("yes"),b.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&D.click()}),n.listTeamMembers({data:{teamId:e.Team.Id},success:function(t){P.find(".filter-popup-menu .item").remove();for(var a=0;a<t.Data.Data.length;a++)4!=t.Data.Data[a].Role&&5!=t.Data.Data[a].Role&&t.Data.Data[a].Email!=e.userEmail&&P.find(".filter-popup-menu").append('<div class="item" data-value="'+t.Data.Data[a].Email+'">'+(t.Data.Data[a].FullName||t.Data.Data[a].Email)+"</div>");m.removeClass("busy")},error:function(e){y.show().text(e.Message||"There was an error. Please try later."),m.removeClass("busy")}}),void t.show(u))}},app.popup.getAddTeamMemberPopup=function(e,t,a){var n=$("#tmp-add-team-member"),o=n.find(".cancel, .icon-Close"),i=n.find(".loading-animation"),s=n.find("#member-search");n.find(".loading-animation").html(t.spinner);var r=function(e,t){};return s.on("submit",function(e){var t=$(e.target[0]).val();return i.show(),validator.isEmail(t)?a.findUser({email:t,success:function(e){i.hide(),console.log(e)},error:function(e){r(e.Message,"error")}}):r("Please provide a valid email address.","error"),!1}),t.reg(n,o),function(){t.show(n),i.hide()}},app.popup.getChoosePlanPopup=function(e,t,a,n){var o=$("#tmp-choose-plan"),i=o.find(".select"),s=o.find(".ok");return t.reg(o,o.find(".icon-Close")),i.click(function(e){$(this).toggleClass("selected"),s.toggleClass("disabled",!(o.find(".select.selected").length>0)),e.preventDefault()}),function(e){e?t.push(o):t.show(o)}},app.popup.getSetupTeamPopup=function(e,t){var a=function(){t.message({heading:"Welcome to "+e.Team.Name+"!<br><h3>Let's finalize your setup.</h3>",message:'<div style="margin: 0 -20px; text-align: center;"><h3 style="margin-bottom: 10px;">Would you like to import any folios from your personal dashboard?</h3><span style="font-family: Proxima-Bold;">Tip:</span> This option is also available under your profile menu.</div>',btnText:"Import Folios",cancelText:"Skip",noClose:!0,notMini:!0,isSwitchCta:!0,okClass:"ok-blue",handleOK:function(){t.importFolioPopup()},handleNo:function(){t.close()}})};return function(){e.isFirstTime,a()}},app.popup.getTeamManagePopup=function(e,t,a){function n(){console.log("currstep",U),R?U<2?h.hide():h.show():0==U?h.hide():h.show(),0==U?m.removeClass("add-mem"):1==U&&(m.addClass("add-mem"),m.removeClass("find-mem"),T.removeClass("mem-block"),T.removeClass("pg-block"),T.removeClass("guest-block"))}function o(e){for(var t=0;t<u.length;t++)if(u[t].Email==e)return!0;return!1}function i(){for(var e=0;e<3;e++){var t=$(x.html());T.find(".blocks").append(t)}}function s(t,n,o,i,s,r){var l=r.closest(".each");l.addClass("loading"),m.find(".team-det").addClass("disabled"),a.changeMemberAccess({userEmail:t,userRole:n,teamId:e.Team.Id,folioToken:o,accessType:i,success:function(e){l.removeClass("loading"),l.addClass("done"),setTimeout(function(){l.removeClass("done");for(var e=0;e<u.length;e++)u[e].Email==t&&(u[e].Role=n,u[e].RoleName=H(n));j(u),m.find(".team-det").removeClass("disabled")},3e3)},error:function(e){m.find(".team-det").removeClass("disabled"),l.removeClass("loading"),E.hide(),B(e.Message,"error")}})}function r(e,a,n,o){return function(){var i=$(this),r=i.data("value"),l="",c=i.closest(".each"),d="";if(m.find(".team-det .each:eq("+a+"1) .action .role .text").text(H(r)),c.removeClass("show-sfg"),console.log(i.data("value"),e,a,l),o){if(r=5,l=c.find(".folios .folio .item.active").data("token"),d=c.find(".folios .access .item.active").data("value"),!l)return void t.error("Please Select a folio to add Single Folio Guest to.")}else c.find(".action .item").removeClass("active"),i.addClass("active");if(r==n);else if(5!=r||o){var u="";5==r||5==n?(5==n?u="<br><b>You will be charged 120$ minus any credit on your account.</b>":5==r&&(u="<br><b>You will be credited a prorated amount on your account.</b>"),t.push(m),t.message({heading:"Change Team Member Access ",message:"Do you really want to change access for <b>"+e+"</b> to <b>"+H(r)+"</b>?"+u,btnText:"Confirm",notMini:!0,cancelText:"Cancel",handleOK:function(){s(e,r,l,d,a,i)}})):s(e,r,l,d,a,i)}else c.addClass("show-sfg")}}function l(e,n){return function(){E.show(),t.push(m),t.message({heading:"Remove Member",message:"You will be credited a prorated amount on your account.",btnText:"Confirm",notMini:!0,cancelText:"Cancel",handleOK:function(){a.removeMember({userEmail:e,success:function(a){m.find(".team .each:eq("+n+"1)").hide("slow",function(){m.find(".team .each:eq("+n+"1)").remove()}),E.hide(),t.message({heading:"Success",message:e+" has been successfully removed from your team.",btnText:"Ok",notMini:!0})},error:function(e){E.hide(),B(e.Message,"error")}})}})}}function c(){T.find(".folio-select .folio .text").text("Please choose a folio"),T.find(".folio-select .folio .popup-menu").empty();for(var e=0;e<d.length;e++)d[e].IsUserTemplate||T.find(".folio-select .folio .popup-menu").append('<div class="item" data-token="'+d[e].Token+'">'+d[e].FolioName+"</div>")}var d,u,m=$("#tmp-team-manage"),p=m.find(".add-member"),f=(m.find(".remove"),m.find(".success-panel")),h=m.find(".back-btn"),g=m.find(".status"),v=m.find(".paper .team"),b=m.find(".paper .team-h"),y=m.find(".paper .free"),C=m.find(".paper .free-h"),T=m.find(".outer-shell"),w=$("#tmp-team-manage-single .b1"),x=$("#tmp-team-manage-single .b2"),k=m.find(".cancel, .popup-close"),D=w.find(".action .popup-menu"),S=m.find(".am-h"),I=m.find(".team-add div"),M=m.find("#member-search"),P=null,E=m.find(".loading-animation.forpopup"),A=T.find(".custom-msg"),F=T.find(".msg-content .icon-Close"),N=T.find(".opts .more"),O=T.find(".invite-confirm"),U=0,R=!1;E.html(t.spinner);var B=function(e,t){E.hide(),g.text(e),g.show("slow"),"error"==t?(g.addClass("error"),g.removeClass("success")):(g.removeClass("error"),g.addClass("success")),setTimeout(function(){g.hide("slow")},1e4)};if(f.find(".back-to").click(function(){t.close()}),h.click(function(){U-=1,n()}),A.click(function(){T.find(".msg-content").show("slow")}),F.click(function(){T.find(".msg-content").hide("slow")}),N.click(function(){var e=$(x.html());T.find(".blocks").append(e)}),O.click(function(){E.show();for(var e=[],t=T.find(".block.members"),n=!1,i=0;i<t.length;i++){var s=T.find(".block.members:eq("+i+")");if(s.find(".left input").val()){var r=s.find(".left input").val();r=r.trim();var l=s.find(".right input").val();l=l.trim();var c=P,d="",u="",p=0;T.find(".msg-content:visible").length>0&&(d=T.find(".email-msg").val()),5==c&&(T.find(".folio-select .folio .popup-menu .item.active").length>0?(u=T.find(".folio-select .folio .popup-menu .item.active").data("token"),p=T.find(".folio-select .access .popup-menu .item.active").data("value")):(B("Kindly select a folio to add Single Folio Guest.","error"),n=!0)),o(r)?(s.addClass("error"),s.find(".email-err").text("User is already a member.","error"),n=!0):validator.isEmail(r)?(3==P&&(c=s.find(".right .popup-menu .item.active").data("value")),e.push({email:r,fullName:l,role:c,message:d,folioToken:u,accessType:p})):(s.addClass("error"),s.find(".email-err").text("Invalid email address.","error"),n=!0)}}if(n)return void E.hide();if(console.log("TeamMembersAdded: ",e),e.length>0)if(5==c){for(var f=[],h=[],i=0;i<e.length;i++)f.push(e[i].email),h.push(e[i].fullName);a.addSingleFolioGuest({data:e,success:function(t){m.find(".success-panel .list-mems").empty();for(var a=0;a<e.length;a++)m.find(".success-panel .list-mems").append("<span>"+e[a].email+"</span>");m.addClass("success"),T.find("input").val(""),T.find("textarea").val(""),T.find(".msg-content").hide(),E.hide()},error:function(e){B(e.Message,"error")}})}else a.addMembers({data:{teamMembers:e},success:function(t){B("This user added to team successfully!"),m.find(".success-panel .list-mems").empty();for(var a=0;a<e.length;a++)m.find(".success-panel .list-mems").append("<span>"+e[a].email+"</span>");m.addClass("success"),T.find("input").val(""),T.find("textarea").val(""),T.find(".msg-content").hide(),E.hide()},error:function(e){E.hide(),B(e.Message,"error")}});else B("Please add an Email to invite","error")}),T.find(".blocks").on("click",".delete",function(){$(this).closest(".block").remove()}),M.on("submit",function(t){var n=$(t.target[0]).val();return E.show(),validator.isEmail(n)?a.addTeamUser({userEmail:n,userRole:P,teamId:e.Team.Id,folioToken:"",accessType:"",success:function(e){},error:function(e){E.hide(),B(e.Message,"error")}}):B("Please provide a valid email address.","error"),!1}),i(),p.click(function(){U=1,n(),m.addClass("add-mem"),S.find("span").text(e.Team.Name)}),I.click(function(){var e=$(this);m.addClass("find-mem"),T.removeClass("mem-block"),T.removeClass("pg-block"),T.removeClass("guest-block"),U=2,n(),e.hasClass("r1")?(P=3,T.addClass("mem-block")):e.hasClass("r2")?(P=4,T.addClass("pg-block")):e.hasClass("r3")&&(P=5,T.addClass("guest-block"))}),e.TeamRoles)for(var L=0;L<e.TeamRoles.length-1;L++)D.prepend('<div class="item" data-value="'+e.TeamRoles[L].Id+'">'+e.TeamRoles[L].Name+"</div>");var H=function(t){if(e.TeamRoles)for(var a=0;a<e.TeamRoles.length;a++)if(t==e.TeamRoles[a].Id)return e.TeamRoles[a].Name;return"Error in Team ID"},j=function(e){console.log("memList",e),v.empty(),y.empty(),b.hide(),C.hide();for(var a=0;a<e.length;a++){var n=$(w.html());n.find(".loading-animation").html(t.spinner),n.find(".name").text(e[a].FullName),n.find(".email").text(e[a].Email),n.find(".action .popup-menu .item[data-value="+e[a].Role+"]").addClass("active"),n.find(".action .role .text").text(H(e[a].Role)),n.find(".remove").on("click",l(e[a].Email,a)),n.find(".action .popup-menu .item").on("click",r(e[a].Email,a,e[a].Role,!1));for(var o=0;o<d.length;o++)d[o].IsUserTemplate||n.find(".folios .folio .popup-menu").append('<div class="item" data-token="'+d[o].Token+'">'+d[o].FolioName+"</div>");n.find(".folios .confirm-sfg").on("click",r(e[a].Email,a,e[a].Role,!0)),1==e[a].Role?(v.prepend(n.addClass("owner")),b.show()):5==e[a].Role?(y.append(n.addClass("free-member")),C.show()):(v.append(n.addClass("team-member")),b.show())}app.menu.xSelect()};return t.reg(m,k),function(o){R=o,T.find(".block.members").removeClass("error"),v.empty(),y.empty(),m.removeClass("success"),m.removeClass("add-mem"),m.removeClass("find-mem"),T.find("input").val(""),T.find("textarea").val(""),T.find(".msg-content").hide(),E.show(),a.listTeamMembers({data:{teamId:e.Team.Id},success:function(t){u=t.Data.Data,a.getUserFolios({teamId:e.Team.Id,success:function(e){d=JSON.parse(e.Data),console.log("userFolioList",d),j(u),E.hide(),c()},error:function(e){j(u),E.hide()}})},error:function(e){console.log("listTeamMembers Error",e),E.hide()}}),R&&(U=1,n(),m.addClass("add-mem"),S.find("span").text(e.Team.Name)),t.show(m)}},app.popup.getTeamSettingPopup=function(e,t,a){var n=$("#tmp-team-settings"),o=(n.find(".btn-upload"),n.find(".right")),i=n.find(".team-logo img"),s=n.find(".team-url"),r=n.find(".left input"),l=n.find(".cta-btns"),c=n.find(".cancel, .popup-close"),d=l.find(".btn.popup-cta.update"),u=n.find(".url-info"),m=n.find(".msg"),p=null,f=null,h="",g=null;n.find(".loading-animation").html(t.spinner),t.reg(n,c);var v=function(e){m.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){m.hide("slow").removeClass("error")},5e3),n.find(".loading-animation").hide()},b=function(e){m.html(e).addClass("success").removeClass("error").show("slow"),setTimeout(function(){m.hide("slow").removeClass("success")},5e3),n.find(".loading-animation").hide()};o.click(function(){n.find(".uploader").trigger("click")}),u.click(function(e){$(e.target).is(u.find(".icon-Close"))?u.removeClass("show-info"):u.addClass("show-info")}),n.find(".uploader").change(function(){n.addClass("busy");var e=this,t=e.files&&e.files[0];t&&(form=n.find("#ts-uploadimage-form")[0],n.find(".loading-animation").show(),a.uploadTeamImage(form,t,{type:"logo",isProgress:!1,success:function(e){console.log("res",e),g=e.Data,h=e.Message,i.attr("src",h).prop("title",p),n.find(".loading-animation").hide()},error:v}))});var y=function(){g&&(n.find(".loading-animation").hide(),$("#logo-bar .app-title a").html('<img style="max-width: 80px; max-height: 40px; margin-top: -4px; max-height:calc(100% - 4px);" src="'+h+'">').css({textAlign:"center"}))};return d.click(function(){var t,o=[];t=g?h:"",p=r.val(),n.find(".loading-animation").show(),a.saveTeam({data:{email:"",teamId:e.Team.Id,imageID:g,members:o,data:{Name:p,Status:e.Team.Status,TeamUrl:"",LogoURL:t}},success:function(e){b("Updated Successfully."),y()},error:function(e){v(e.Message),n.find(".loading-animation").hide()}})}),function(){p=e.Team.Name,f=e.Team.TeamUrl,h=e.Team.LogoUrl,i.attr("src",h),s.text(f),r.val(p),t.show(n)}},app.menutcopy=function(e,t,a,n){var o=$("#tmp-copy-template-topbar"),i=o.find(".ok"),s=o.find(".present"),r=app.editor.present(a);console.log("config.EditTemplate",e.EditTemplate,e.isUserTemplate,e),"true"==e.EditTemplate||e.isUserTemplate?(e.isUserTemplate&&e.Team.Id>0&&(o.find("i.icon-Logo").remove(),o.find(".app-title a").append('<img src ="'+e.Team.LogoUrl+'" title="'+e.Team.Name+'" style="max-height:35px;margin-top: -12px;">'),o.find(".text").text(e.FolioName)),e.isUserTemplate&&i.text("Use This Template"),$(document).click(function(e){n.close()}),$("#popup-container .popup-content").click(function(e){e.stopPropagation()}),$("#antiForgeryContainer").length>0?$("#antiForgeryContainer").after(o):$("body").prepend(o),$("#home-page").css({paddingTop:"50px"})):$("body").append(s.addClass("fly")),e.presentationMode||s.hide(),"dash-explore"==e.EditTemplate&&(s.addClass("fly").css({top:"55px"}).show(),$("#tmp-dashboard-content .folios-container.explore").append(s)),s.on("click",function(){o.hide(),s.hide();var e=$("#home-page").css("paddingTop");$("#home-page").css({paddingTop:"0px"}),r.start(function(){o.show(),s.show(),$("#home-page").css({paddingTop:e})})}),e.userName||o.find(".app-title a").attr("href","https://xtensio.com"),i.on("click",function(){var o=($(this),e.token),i=e.isUserTemplate?"Untitled":e.FolioName||"Untitled";if(e.userName){var s=!!e.UserTeams&&e.UserTeams.length>0;s?e.UserTeams&&e.UserTeams.length>0&&n.addFolioToSpace(o,i):t.duplicateFolio({token:o,name:i,success:function(e){a.raiseEvent("duplicateFolio",o,e.Message,i),window.location.assign("/edit/"+e.Message+"#new")},error:function(e){5==e.StatusCode?n.plusPrompt("create",null,!0):10==e.StatusCode&&n.plusPrompt("create",null,!1,!0)},complete:function(){},fToken:!0})}else n.signUp(!0);return!1})},app.main=function(e,t){function a(e){var t=$("#tmp-power-by-footer");return t.removeClass("hidden").find("upgrade"==e?".normal":".upgrade").addClass("hidden"),t.find("."+e).removeClass("hidden"),t}app.console=consologs(e);var n=$("#notify-popup");app.isconsole="localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||e.isAdmin;var o=["#66D7C4","#FFD271","#FD9F4D","#F67157","#E95F5E","#E3E5E6","#DCBB9F","#00BD9B","#FFC437","#FC871F","#F44D2C","#DD2F2F","#B1B6B9","#C18656","#76D5E5","#6486A5","#2E5668","#D45D77","#9D557C","#7E8589","#FFF","#1AB9D2","#3C688E","#052B3E","#C93556","#862B5D","#242E34"];if(e.colors=o,app.menu.xSelect(),e.isBlocked&&(location.href="/"),window.location.hostname.indexOf("localhost")>-1||"app.xtensio.tech"==window.location.hostname||e.isAdmin||(console.log("Disabling Logs"),logger.disableLogger()),app.console(e),e.isProject)e.banner&&$("#view-project").after(a("normal")),(e.getPass||t&&t.GetPass)&&app.popup.folioPass(e);else if(e.getPass||t&&t.GetPass)app.popup.folioPass(e);else{var i,s,r,l,c,d=app.core.main(e,t),u=d.utility,m=d.apiHelper,p=d.eventManager,f=d.pageManager,h=d.store,g=d.modStore,v=d.folioStore,b=d.appHub,y=d.plusHelper,C=v.get("style")||"",T='<style id="folio-style" type="text/css">'+C+"</style>";$("head").append(T),app.plugin.main(e,d,t,y),r=app.popup.main(e,p,u,m,f,y,g,h,t,v),i=e.editMode?app.menu.main(e,t,d,r):{},s=app.managers.main(e,t,d,i,r),l=s.modManager,c=s.rddm,app.factory.main(e,t,d,i,r,l,c),e.editMode?(t.IsUserTemplate&&$("#tmp-collaborators").remove(),app.common.main(e,m,p,u,r,h,b,t,app.plugin,y),app.editor.main(e,t,m,p,f,r,u,h,l,v,y),f.setupEditPage(e,t,l),e.banner&&a("upgrade"),t.Version<1&&1!=h.get("upgrade-"+e.token)&&r.message({heading:"Upgrade Editor?",message:"This folio was created using an older version of our text editor.<br/>(Upgrading may affect the existing formatting minimally,<br/> but gives you super powers.)",btnText:"Use New Editor",cancelText:"Keep Existing",handleNo:function(){h.set("upgrade-"+e.token,1)},handleOK:function(){r.busy(),m.upgradeFolio({success:function(){r.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully upgraded. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){r.error(e.Message)}})}}),app.editor.viewOnly(t),$("#tmp-secondary-bar").length>0&&($(".module-container").length<1||$(".empty-module-container").length==$(".module-container").length)&&$("#tmp-secondary-bar .add-module-button").trigger("click")):($("#edit-page").remove(),l.activatePreview(),app.dash.archivedFolioTopBanner(r,t),app.menutcopy(e,m,p,r),$("#home-page").after($("#presentation-buttons").addClass("public"))),app.editor.addWatermark(e,r)}var w=function(){e.UserTeams&&e.editMode&&e.UserTeams.length>0&&(e.Team&&0!=e.Team.Id?(n.find(".logged-in .text").html("You are logged into team <b>"+e.Team.Name+"</b>"),$("#tmp-user-menu .upgrade-btn").remove()):n.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),n.finish(),n.removeClass("on").addClass("logged-in").show(),setTimeout(function(){n.hide("slow").removeClass("logged-in")},2500))};if(e.editMode&&window.location.toString().indexOf("#new")>-1){console.log(window.location.toString().indexOf("#new")+"    :::::::::");var x="Personal Dashboard";e.Team&&0!=e.Team.Id&&(x=e.Team.Name),n.find(".logged-in .text").html("Folio is saved to <b>"+x+"</b>"),n.removeClass("on").addClass("logged-in").show(),setTimeout(function(){n.hide("slow").removeClass("logged-in")},2500)}else e.editMode||w()},app.dashboard=function(e){app.console=consologs(e),window.location.hostname.indexOf("localhost")>-1||"app.xtensio.tech"==window.location.hostname||e.isAdmin||(console.log("Disabling Logs"),logger.disableLogger()),console.log(e),e.isDashboard=!0;var t=["#66D7C4","#FFD271","#D45D77","#9D557C","#3C688F","#1ab9d3","#fd9f4c","#c93555","#7e8589","#dcbc9f"];e.colors=t,e.myLabel={ID:0,Name:"My Templates",TimeStamp:0,Token:"own",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"},e.xtensioLabel={ID:0,Name:"Xtensio Templates",TimeStamp:0,Token:"xtensio",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"};var a,n=app.core.main(e),o=n.utility,i=n.apiHelper,s=n.eventManager,r=n.pageManager,l=n.store,c=n.appHub,d=n.modStore,u=n.plusHelper;app.plugin.main(e,n,null,u),a=app.popup.main(e,s,o,i,r,u,d);var m=document.location.href;m=m.toLowerCase(),m.indexOf("teams/create")>-1?a.signUpTeam():e.isSignup?a.signUp():e.loginState?a.signIn():(app.common.main(e,i,s,o,a,l,c,{},app.plugin,u),app.dash.main(e,s,i,o,a,u),app.menu.xSelect(),"not-set"!=e.ExploreTabFolioToken?($("#tmp-dash-topbar .explore").show(),$("#tmp-dash-topbar .explore").click(function(){$("#tmp-dashboard-content .explore.not-populated").length>0&&(app.dash.getExploreFolio(e,i,a),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated"))})):($("#tmp-dash-topbar a.explore").hide(),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated")));var p=$("#notify-popup");e.UserTeams&&e.UserTeams.length>0&&(e.Team&&0!=e.Team.Id?(p.find(".logged-in .text").html("You are logged into team: <b>"+e.Team.Name+"</b>"),$("#tmp-user-menu .upgrade-btn").remove()):p.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),p.removeClass("on").addClass("logged-in").show(),setTimeout(function(){p.hide("slow").removeClass("logged-in")},2500))};